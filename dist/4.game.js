(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{10:function(e,t,r){"use strict";r.r(t),r.d(t,"MeshLODLevel",function(){return M}),r.d(t,"_CreationDataStorage",function(){return T}),r.d(t,"_InstancesBatch",function(){return A}),r.d(t,"Mesh",function(){return I});var i=r(1),n=r(7),s=r(5),a=r(41),o=r(27),u=r(0),h=r(25),c=r(3),l=r(24),f=r(32),d=r(23),p=r(56),g=r(53),m=r(14),v=r(16),y=r(66),_=r(37),x=r(4),b=r(2),V=r(9),M=function(){return function(e,t){this.distance=e,this.mesh=t}}(),T=function(){return function(){}}(),D=function(){return function(){this.visibleInstances={},this.renderIdForInstances=new Array,this.batchCache=new A,this.instancesBufferSize=2048}}(),A=function(){return function(){this.mustReturn=!1,this.visibleInstances=new Array,this.renderSelf=new Array}}(),I=function(e){function t(r,i,n,s,u,h){void 0===i&&(i=null),void 0===n&&(n=null),void 0===s&&(s=null),void 0===h&&(h=!0);var c=e.call(this,r,i)||this;if(c.delayLoadState=x.a.DELAYLOADSTATE_NONE,c.instances=new Array,c._LODLevels=new Array,c._instanceDataStorage=new D,c._originalBuilderSideOrientation=t.DEFAULTSIDE,c.overrideMaterialSideOrientation=null,c._areNormalsFrozen=!1,c._source=null,c._isMesh=!0,i=c.getScene(),s){if(s._geometry&&s._geometry.applyToMesh(c),a.a.DeepCopy(s,c,["name","material","skeleton","instances","parent","uniqueId","source","metadata","hasLODLevels","geometry","isBlocked","areNormalsFrozen","onBeforeDrawObservable","onBeforeRenderObservable","onAfterRenderObservable","onBeforeDraw","onAfterWorldMatrixUpdateObservable","onCollideObservable","onCollisionPositionChangeObservable","onRebuildObservable","onDisposeObservable"],["_poseMatrix"]),c._source=s,i.useClonedMeshhMap&&(s.meshMap||(s.meshMap={}),s.meshMap[c.uniqueId]=c),c._originalBuilderSideOrientation=s._originalBuilderSideOrientation,c._creationDataStorage=s._creationDataStorage,c._source._ranges){var l=c._source._ranges;for(var r in l)l.hasOwnProperty(r)&&l[r]&&c.createAnimationRange(r,l[r].from,l[r].to)}var f;if(s.metadata&&s.metadata.clone?c.metadata=s.metadata.clone():c.metadata=s.metadata,o.a&&o.a.HasTags(s)&&o.a.AddTagsTo(c,o.a.GetTags(s,!0)),c.parent=s.parent,c.setPivotMatrix(s.getPivotMatrix()),c.id=r+"."+s.id,c.material=s.material,!u)for(var d=s.getDescendants(!0),p=0;p<d.length;p++){var g=d[p];g.clone&&g.clone(r+"."+g.name,c)}var m=c.getScene().getPhysicsEngine();if(h&&m){var v=m.getImpostorForPhysicsObject(s);v&&(c.physicsImpostor=v.clone(c))}for(f=0;f<i.particleSystems.length;f++){var y=i.particleSystems[f];y.emitter===s&&y.clone(y.name,c)}c.refreshBoundingInfo(),c.computeWorldMatrix(!0)}return null!==n&&(c.parent=n),c}return i.d(t,e),Object.defineProperty(t.prototype,"onBeforeRenderObservable",{get:function(){return this._onBeforeRenderObservable||(this._onBeforeRenderObservable=new n.c),this._onBeforeRenderObservable},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onAfterRenderObservable",{get:function(){return this._onAfterRenderObservable||(this._onAfterRenderObservable=new n.c),this._onAfterRenderObservable},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onBeforeDrawObservable",{get:function(){return this._onBeforeDrawObservable||(this._onBeforeDrawObservable=new n.c),this._onBeforeDrawObservable},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onBeforeDraw",{set:function(e){this._onBeforeDrawObserver&&this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver),this._onBeforeDrawObserver=this.onBeforeDrawObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"morphTargetManager",{get:function(){return this._morphTargetManager},set:function(e){this._morphTargetManager!==e&&(this._morphTargetManager=e,this._syncGeometryWithMorphTargetManager())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"source",{get:function(){return this._source},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isUnIndexed",{get:function(){return this._unIndexed},set:function(e){this._unIndexed!==e&&(this._unIndexed=e,this._markSubMeshesAsAttributesDirty())},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"Mesh"},t.prototype.toString=function(t){var r=e.prototype.toString.call(this,t);if(r+=", n vertices: "+this.getTotalVertices(),r+=", parent: "+(this._waitingParentId?this._waitingParentId:this.parent?this.parent.name:"NONE"),this.animations)for(var i=0;i<this.animations.length;i++)r+=", animation[0]: "+this.animations[i].toString(t);if(t)if(this._geometry){var n=this.getIndices(),s=this.getVerticesData(c.VertexBuffer.PositionKind);s&&n&&(r+=", flat shading: "+(s.length/3===n.length?"YES":"NO"))}else r+=", flat shading: UNKNOWN";return r},t.prototype._unBindEffect=function(){e.prototype._unBindEffect.call(this);for(var t=0,r=this.instances;t<r.length;t++){r[t]._unBindEffect()}},Object.defineProperty(t.prototype,"hasLODLevels",{get:function(){return this._LODLevels.length>0},enumerable:!0,configurable:!0}),t.prototype.getLODLevels=function(){return this._LODLevels},t.prototype._sortLODLevels=function(){this._LODLevels.sort(function(e,t){return e.distance<t.distance?1:e.distance>t.distance?-1:0})},t.prototype.addLODLevel=function(e,t){if(t&&t._masterMesh)return V.a.Warn("You cannot use a mesh as LOD level twice"),this;var r=new M(e,t);return this._LODLevels.push(r),t&&(t._masterMesh=this),this._sortLODLevels(),this},t.prototype.getLODLevelAtDistance=function(e){for(var t=0;t<this._LODLevels.length;t++){var r=this._LODLevels[t];if(r.distance===e)return r.mesh}return null},t.prototype.removeLODLevel=function(e){for(var t=0;t<this._LODLevels.length;t++)this._LODLevels[t].mesh===e&&(this._LODLevels.splice(t,1),e&&(e._masterMesh=null));return this._sortLODLevels(),this},t.prototype.getLOD=function(e,t){if(!this._LODLevels||0===this._LODLevels.length)return this;var r;t?r=t:r=this.getBoundingInfo().boundingSphere;var i=r.centerWorld.subtract(e.globalPosition).length();if(this._LODLevels[this._LODLevels.length-1].distance>i)return this.onLODLevelSelection&&this.onLODLevelSelection(i,this,this._LODLevels[this._LODLevels.length-1].mesh),this;for(var n=0;n<this._LODLevels.length;n++){var s=this._LODLevels[n];if(s.distance<i)return s.mesh&&(s.mesh._preActivate(),s.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)),this.onLODLevelSelection&&this.onLODLevelSelection(i,this,s.mesh),s.mesh}return this.onLODLevelSelection&&this.onLODLevelSelection(i,this,this),this},Object.defineProperty(t.prototype,"geometry",{get:function(){return this._geometry},enumerable:!0,configurable:!0}),t.prototype.getTotalVertices=function(){return null===this._geometry||void 0===this._geometry?0:this._geometry.getTotalVertices()},t.prototype.getVerticesData=function(e,t,r){return this._geometry?this._geometry.getVerticesData(e,t,r):null},t.prototype.getVertexBuffer=function(e){return this._geometry?this._geometry.getVertexBuffer(e):null},t.prototype.isVerticesDataPresent=function(e){return this._geometry?this._geometry.isVerticesDataPresent(e):!!this._delayInfo&&-1!==this._delayInfo.indexOf(e)},t.prototype.isVertexBufferUpdatable=function(e){return this._geometry?this._geometry.isVertexBufferUpdatable(e):!!this._delayInfo&&-1!==this._delayInfo.indexOf(e)},t.prototype.getVerticesDataKinds=function(){if(!this._geometry){var e=new Array;return this._delayInfo&&this._delayInfo.forEach(function(t){e.push(t)}),e}return this._geometry.getVerticesDataKinds()},t.prototype.getTotalIndices=function(){return this._geometry?this._geometry.getTotalIndices():0},t.prototype.getIndices=function(e,t){return this._geometry?this._geometry.getIndices(e,t):[]},Object.defineProperty(t.prototype,"isBlocked",{get:function(){return null!==this._masterMesh&&void 0!==this._masterMesh},enumerable:!0,configurable:!0}),t.prototype.isReady=function(t,r){if(void 0===t&&(t=!1),void 0===r&&(r=!1),this.delayLoadState===x.a.DELAYLOADSTATE_LOADING)return!1;if(!e.prototype.isReady.call(this,t))return!1;if(!this.subMeshes||0===this.subMeshes.length)return!0;if(!t)return!0;var i=this.getEngine(),n=this.getScene(),s=r||i.getCaps().instancedArrays&&this.instances.length>0;this.computeWorldMatrix();var a=this.material||n.defaultMaterial;if(a)if(a._storeEffectOnSubMeshes)for(var o=0,u=this.subMeshes;o<u.length;o++){var h=(g=u[o]).getMaterial();if(h)if(h._storeEffectOnSubMeshes){if(!h.isReadyForSubMesh(this,g,s))return!1}else if(!h.isReady(this,s))return!1}else if(!a.isReady(this,s))return!1;for(var c=0,l=this._lightSources;c<l.length;c++){var f=l[c].getShadowGenerator();if(f)for(var d=0,p=this.subMeshes;d<p.length;d++){var g=p[d];if(!f.isReady(g,s))return!1}}for(var m=0,v=this._LODLevels;m<v.length;m++){var y=v[m];if(y.mesh&&!y.mesh.isReady(s))return!1}return!0},Object.defineProperty(t.prototype,"areNormalsFrozen",{get:function(){return this._areNormalsFrozen},enumerable:!0,configurable:!0}),t.prototype.freezeNormals=function(){return this._areNormalsFrozen=!0,this},t.prototype.unfreezeNormals=function(){return this._areNormalsFrozen=!1,this},Object.defineProperty(t.prototype,"overridenInstanceCount",{set:function(e){this._instanceDataStorage.overridenInstanceCount=e},enumerable:!0,configurable:!0}),t.prototype._preActivate=function(){var e=this.getScene().getRenderId();return this._preActivateId===e?this:(this._preActivateId=e,this._instanceDataStorage.visibleInstances=null,this)},t.prototype._preActivateForIntermediateRendering=function(e){return this._instanceDataStorage.visibleInstances&&(this._instanceDataStorage.visibleInstances.intermediateDefaultRenderId=e),this},t.prototype._registerInstanceForRenderId=function(e,t){return this._instanceDataStorage.visibleInstances||(this._instanceDataStorage.visibleInstances={defaultRenderId:t,selfDefaultRenderId:this._renderId}),this._instanceDataStorage.visibleInstances[t]||(this._instanceDataStorage.visibleInstances[t]=new Array),this._instanceDataStorage.visibleInstances[t].push(e),this},t.prototype.refreshBoundingInfo=function(e){if(void 0===e&&(e=!1),this._boundingInfo&&this._boundingInfo.isLocked)return this;var t=this.geometry?this.geometry.boundingBias:null;return this._refreshBoundingInfo(this._getPositionData(e),t),this},t.prototype._createGlobalSubMesh=function(e){var t=this.getTotalVertices();if(!t||!this.getIndices())return null;if(this.subMeshes&&this.subMeshes.length>0){var r=this.getIndices();if(!r)return null;var i=r.length,n=!1;if(e)n=!0;else for(var s=0,a=this.subMeshes;s<a.length;s++){var o=a[s];if(o.indexStart+o.indexCount>=i){n=!0;break}if(o.verticesStart+o.verticesCount>=t){n=!0;break}}if(!n)return this.subMeshes[0]}return this.releaseSubMeshes(),new p.b(0,0,t,0,this.getTotalIndices(),this)},t.prototype.subdivide=function(e){if(!(e<1)){for(var t=this.getTotalIndices(),r=t/e|0,i=0;r%3!=0;)r++;this.releaseSubMeshes();for(var n=0;n<e&&!(i>=t);n++)p.b.CreateFromIndices(0,i,Math.min(r,t-i),this),i+=r;this.synchronizeInstances()}},t.prototype.setVerticesData=function(e,t,r,i){if(void 0===r&&(r=!1),this._geometry)this._geometry.setVerticesData(e,t,r,i);else{var n=new l.VertexData;n.set(t,e);var s=this.getScene();new f.d(f.d.RandomId(),s,n,r,this)}return this},t.prototype.markVerticesDataAsUpdatable=function(e,t){void 0===t&&(t=!0);var r=this.getVertexBuffer(e);r&&r.isUpdatable()!==t&&this.setVerticesData(e,this.getVerticesData(e),t)},t.prototype.setVerticesBuffer=function(e){return this._geometry||(this._geometry=f.d.CreateGeometryForMesh(this)),this._geometry.setVerticesBuffer(e),this},t.prototype.updateVerticesData=function(e,t,r,i){return this._geometry?(i?(this.makeGeometryUnique(),this.updateVerticesData(e,t,r,!1)):this._geometry.updateVerticesData(e,t,r),this):this},t.prototype.updateMeshPositions=function(e,t){void 0===t&&(t=!0);var r=this.getVerticesData(c.VertexBuffer.PositionKind);if(!r)return this;if(e(r),this.updateVerticesData(c.VertexBuffer.PositionKind,r,!1,!1),t){var i=this.getIndices(),n=this.getVerticesData(c.VertexBuffer.NormalKind);if(!n)return this;l.VertexData.ComputeNormals(r,i,n),this.updateVerticesData(c.VertexBuffer.NormalKind,n,!1,!1)}return this},t.prototype.makeGeometryUnique=function(){if(!this._geometry)return this;var e=this._geometry,t=this._geometry.copy(f.d.RandomId());return e.releaseForMesh(this,!0),t.applyToMesh(this),this},t.prototype.setIndices=function(e,t,r){if(void 0===t&&(t=null),void 0===r&&(r=!1),this._geometry)this._geometry.setIndices(e,t,r);else{var i=new l.VertexData;i.indices=e;var n=this.getScene();new f.d(f.d.RandomId(),n,i,r,this)}return this},t.prototype.updateIndices=function(e,t){return this._geometry?(this._geometry.updateIndices(e,t),this):this},t.prototype.toLeftHanded=function(){return this._geometry?(this._geometry.toLeftHanded(),this):this},t.prototype._bind=function(e,t,r){if(!this._geometry)return this;var i,n=this.getScene().getEngine();if(this._unIndexed)i=null;else switch(r){case m.a.PointFillMode:i=null;break;case m.a.WireFrameFillMode:i=e._getLinesIndexBuffer(this.getIndices(),n);break;default:case m.a.TriangleFillMode:i=this._unIndexed?null:this._geometry.getIndexBuffer()}return this._geometry._bind(t,i),this},t.prototype._draw=function(e,t,r,i){if(void 0===i&&(i=!1),!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._onBeforeDrawObservable&&this._onBeforeDrawObservable.notifyObservers(this);var n=this.getScene(),s=n.getEngine();if(this._unIndexed||t==m.a.PointFillMode?s.drawArraysType(t,e.verticesStart,e.verticesCount,r):t==m.a.WireFrameFillMode?s.drawElementsType(t,0,e._linesIndexCount,r):s.drawElementsType(t,e.indexStart,e.indexCount,r),n._isAlternateRenderingEnabled&&!i){var a=e.effect||this._effectiveMaterial.getEffect();if(!a||!n.activeCamera)return this;n._switchToAlternateCameraConfiguration(!0),this._effectiveMaterial.bindView(a),this._effectiveMaterial.bindViewProjection(a),s.setViewport(n.activeCamera._alternateCamera.viewport),this._draw(e,t,r,!0),s.setViewport(n.activeCamera.viewport),n._switchToAlternateCameraConfiguration(!1),this._effectiveMaterial.bindView(a),this._effectiveMaterial.bindViewProjection(a)}return this},t.prototype.registerBeforeRender=function(e){return this.onBeforeRenderObservable.add(e),this},t.prototype.unregisterBeforeRender=function(e){return this.onBeforeRenderObservable.removeCallback(e),this},t.prototype.registerAfterRender=function(e){return this.onAfterRenderObservable.add(e),this},t.prototype.unregisterAfterRender=function(e){return this.onAfterRenderObservable.removeCallback(e),this},t.prototype._getInstancesRenderList=function(e){var t=this.getScene(),r=this._instanceDataStorage.batchCache;if(r.mustReturn=!1,r.renderSelf[e]=this.isEnabled()&&this.isVisible,r.visibleInstances[e]=null,this._instanceDataStorage.visibleInstances){var i=this._instanceDataStorage.visibleInstances,n=t.getRenderId(),s=t._isInIntermediateRendering()?i.intermediateDefaultRenderId:i.defaultRenderId;r.visibleInstances[e]=i[n];var a=this._renderId;!r.visibleInstances[e]&&s&&(r.visibleInstances[e]=i[s],n=Math.max(s,n),a=Math.max(i.selfDefaultRenderId,n));var o=r.visibleInstances[e];if(o&&o.length){if(this._instanceDataStorage.renderIdForInstances[e]===n)return r.mustReturn=!0,r;n!==a&&(r.renderSelf[e]=!1)}this._instanceDataStorage.renderIdForInstances[e]=n}return r},t.prototype._renderWithInstances=function(e,t,r,i,n){var s=r.visibleInstances[e._id];if(!s)return this;for(var a=16*(s.length+1)*4,o=this._instanceDataStorage,u=o.instancesBufferSize,h=o.instancesBuffer;o.instancesBufferSize<a;)o.instancesBufferSize*=2;o.instancesData&&u==o.instancesBufferSize||(o.instancesData=new Float32Array(o.instancesBufferSize/4));var l=0,f=0,d=this.getWorldMatrix();if(r.renderSelf[e._id]&&(d.copyToArray(o.instancesData,l),l+=16,f++),s)for(var p=0;p<s.length;p++){s[p].getWorldMatrix().copyToArray(o.instancesData,l),l+=16,f++}return h&&u==o.instancesBufferSize?h.updateDirectly(o.instancesData,0,f):(h&&h.dispose(),h=new c.Buffer(n,o.instancesData,!0,16,!1,!0),o.instancesBuffer=h,this.setVerticesBuffer(h.createVertexBuffer("world0",0,4)),this.setVerticesBuffer(h.createVertexBuffer("world1",4,4)),this.setVerticesBuffer(h.createVertexBuffer("world2",8,4)),this.setVerticesBuffer(h.createVertexBuffer("world3",12,4))),this._bind(e,i,t),this._draw(e,t,f),n.unbindInstanceAttributes(),this},t.prototype._processRendering=function(e,t,r,i,n,s,a){var o=this.getScene().getEngine();if(n)this._renderWithInstances(e,r,i,t,o);else{i.renderSelf[e._id]&&(s&&s(!1,this.getWorldMatrix(),a),this._draw(e,r,this._instanceDataStorage.overridenInstanceCount));var u=i.visibleInstances[e._id];if(u)for(var h=0;h<u.length;h++){var c=u[h].getWorldMatrix();s&&s(!0,c,a),this._draw(e,r)}}return this},t.prototype.render=function(e,t){if(this._checkOcclusionQuery())return this;var r=this.getScene(),i=this._getInstancesRenderList(e._id);if(i.mustReturn)return this;if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._onBeforeRenderObservable&&this._onBeforeRenderObservable.notifyObservers(this);var n,s=r.getEngine(),a=s.getCaps().instancedArrays&&null!==i.visibleInstances[e._id]&&void 0!==i.visibleInstances[e._id],o=e.getMaterial();if(!o)return this;if(this._effectiveMaterial=o,this._effectiveMaterial._storeEffectOnSubMeshes){if(!this._effectiveMaterial.isReadyForSubMesh(this,e,a))return this}else if(!this._effectiveMaterial.isReady(this,a))return this;t&&s.setAlphaMode(this._effectiveMaterial.alphaMode);for(var u=0,h=r._beforeRenderingMeshStage;u<h.length;u++){h[u].action(this,e,i)}if(!(n=this._effectiveMaterial._storeEffectOnSubMeshes?e.effect:this._effectiveMaterial.getEffect()))return this;var c=this.skeleton&&this.skeleton.overrideMesh||this,l=this.overrideMaterialSideOrientation;null==l&&(l=this._effectiveMaterial.sideOrientation,c._getWorldMatrixDeterminant()<0&&(l=l===m.a.ClockWiseSideOrientation?m.a.CounterClockWiseSideOrientation:m.a.ClockWiseSideOrientation));var f=this._effectiveMaterial._preBind(n,l);this._effectiveMaterial.forceDepthWrite&&s.setDepthWrite(!0);var d=r.forcePointsCloud?m.a.PointFillMode:r.forceWireframe?m.a.WireFrameFillMode:this._effectiveMaterial.fillMode;a||this._bind(e,n,d);var p=c.getWorldMatrix();this._effectiveMaterial._storeEffectOnSubMeshes?this._effectiveMaterial.bindForSubMesh(p,this,e):this._effectiveMaterial.bind(p,this),!this._effectiveMaterial.backFaceCulling&&this._effectiveMaterial.separateCullingPass&&(s.setState(!0,this._effectiveMaterial.zOffset,!1,!f),this._processRendering(e,n,d,i,a,this._onBeforeDraw,this._effectiveMaterial),s.setState(!0,this._effectiveMaterial.zOffset,!1,f)),this._processRendering(e,n,d,i,a,this._onBeforeDraw,this._effectiveMaterial),this._effectiveMaterial.unbind();for(var g=0,v=r._afterRenderingMeshStage;g<v.length;g++){v[g].action(this,e,i)}return this._onAfterRenderObservable&&this._onAfterRenderObservable.notifyObservers(this),this},t.prototype._onBeforeDraw=function(e,t,r){e&&r&&r.bindOnlyWorldMatrix(t)},t.prototype.cleanMatrixWeights=function(){this.isVerticesDataPresent(c.VertexBuffer.MatricesWeightsKind)&&(this.isVerticesDataPresent(c.VertexBuffer.MatricesWeightsExtraKind)?this.normalizeSkinWeightsAndExtra():this.normalizeSkinFourWeights())},t.prototype.normalizeSkinFourWeights=function(){for(var e=this.getVerticesData(c.VertexBuffer.MatricesWeightsKind),t=e.length,r=0;r<t;r+=4){var i=e[r]+e[r+1]+e[r+2]+e[r+3];if(0===i)e[r]=1;else{var n=1/i;e[r]*=n,e[r+1]*=n,e[r+2]*=n,e[r+3]*=n}}this.setVerticesData(c.VertexBuffer.MatricesWeightsKind,e)},t.prototype.normalizeSkinWeightsAndExtra=function(){for(var e=this.getVerticesData(c.VertexBuffer.MatricesWeightsExtraKind),t=this.getVerticesData(c.VertexBuffer.MatricesWeightsKind),r=t.length,i=0;i<r;i+=4){var n=t[i]+t[i+1]+t[i+2]+t[i+3];if(0===(n+=e[i]+e[i+1]+e[i+2]+e[i+3]))t[i]=1;else{var s=1/n;t[i]*=s,t[i+1]*=s,t[i+2]*=s,t[i+3]*=s,e[i]*=s,e[i+1]*=s,e[i+2]*=s,e[i+3]*=s}}this.setVerticesData(c.VertexBuffer.MatricesWeightsKind,t),this.setVerticesData(c.VertexBuffer.MatricesWeightsKind,e)},t.prototype.validateSkinning=function(){var e=this.getVerticesData(c.VertexBuffer.MatricesWeightsExtraKind),t=this.getVerticesData(c.VertexBuffer.MatricesWeightsKind);if(null===t||null==this.skeleton)return{skinned:!1,valid:!0,report:"not skinned"};for(var r=t.length,i=0,n=0,s=0,a=0,o=null===e?4:8,u=new Array,h=0;h<=o;h++)u[h]=0;for(h=0;h<r;h+=4){for(var l=t[h],f=l,d=0===f?0:1,p=1;p<o;p++){var g=p<4?t[h+p]:e[h+p-4];g>l&&i++,0!==g&&d++,f+=g,l=g}if(u[d]++,d>s&&(s=d),0===f)n++;else{var m=1/f,v=0;for(p=0;p<o;p++)v+=p<4?Math.abs(t[h+p]-t[h+p]*m):Math.abs(e[h+p-4]-e[h+p-4]*m);v>.001&&a++}}var y=this.skeleton.bones.length,_=this.getVerticesData(c.VertexBuffer.MatricesIndicesKind),x=this.getVerticesData(c.VertexBuffer.MatricesIndicesExtraKind),b=0;for(h=0;h<r;h++)for(p=0;p<o;p++){var V=p<4?_[p]:x[p-4];(V>=y||V<0)&&b++}return{skinned:!0,valid:0===n&&0===a&&0===b,report:"Number of Weights = "+r/4+"\nMaximum influences = "+s+"\nMissing Weights = "+n+"\nNot Sorted = "+i+"\nNot Normalized = "+a+"\nWeightCounts = ["+u+"]\nNumber of bones = "+y+"\nBad Bone Indices = "+b}},t.prototype._checkDelayState=function(){var e=this.getScene();return this._geometry?this._geometry.load(e):this.delayLoadState===x.a.DELAYLOADSTATE_NOTLOADED&&(this.delayLoadState=x.a.DELAYLOADSTATE_LOADING,this._queueLoad(e)),this},t.prototype._queueLoad=function(e){var t=this;e._addPendingData(this);var r=-1!==this.delayLoadingFile.indexOf(".babylonbinarymeshdata");return s.h.LoadFile(this.delayLoadingFile,function(r){r instanceof ArrayBuffer?t._delayLoadingFunction(r,t):t._delayLoadingFunction(JSON.parse(r),t),t.instances.forEach(function(e){e._syncSubMeshes()}),t.delayLoadState=x.a.DELAYLOADSTATE_LOADED,e._removePendingData(t)},function(){},e.offlineProvider,r),this},t.prototype.isInFrustum=function(t){return this.delayLoadState!==x.a.DELAYLOADSTATE_LOADING&&(!!e.prototype.isInFrustum.call(this,t)&&(this._checkDelayState(),!0))},t.prototype.setMaterialByID=function(e){var t,r=this.getScene().materials;for(t=r.length-1;t>-1;t--)if(r[t].id===e)return this.material=r[t],this;var i=this.getScene().multiMaterials;for(t=i.length-1;t>-1;t--)if(i[t].id===e)return this.material=i[t],this;return this},t.prototype.getAnimatables=function(){var e=new Array;return this.material&&e.push(this.material),this.skeleton&&e.push(this.skeleton),e},t.prototype.bakeTransformIntoVertices=function(e){if(!this.isVerticesDataPresent(c.VertexBuffer.PositionKind))return this;var t=this.subMeshes.splice(0);this._resetPointsArrayCache();var r,i=this.getVerticesData(c.VertexBuffer.PositionKind),n=new Array;for(r=0;r<i.length;r+=3)u.Vector3.TransformCoordinates(u.Vector3.FromArray(i,r),e).toArray(n,r);if(this.setVerticesData(c.VertexBuffer.PositionKind,n,this.getVertexBuffer(c.VertexBuffer.PositionKind).isUpdatable()),this.isVerticesDataPresent(c.VertexBuffer.NormalKind)){for(i=this.getVerticesData(c.VertexBuffer.NormalKind),n=[],r=0;r<i.length;r+=3)u.Vector3.TransformNormal(u.Vector3.FromArray(i,r),e).normalize().toArray(n,r);this.setVerticesData(c.VertexBuffer.NormalKind,n,this.getVertexBuffer(c.VertexBuffer.NormalKind).isUpdatable())}return e.m[0]*e.m[5]*e.m[10]<0&&this.flipFaces(),this.releaseSubMeshes(),this.subMeshes=t,this},t.prototype.bakeCurrentTransformIntoVertices=function(){return this.bakeTransformIntoVertices(this.computeWorldMatrix(!0)),this.scaling.copyFromFloats(1,1,1),this.position.copyFromFloats(0,0,0),this.rotation.copyFromFloats(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=u.Quaternion.Identity()),this._worldMatrix=u.Matrix.Identity(),this},Object.defineProperty(t.prototype,"_positions",{get:function(){return this._geometry?this._geometry._positions:null},enumerable:!0,configurable:!0}),t.prototype._resetPointsArrayCache=function(){return this._geometry&&this._geometry._resetPointsArrayCache(),this},t.prototype._generatePointsArray=function(){return!!this._geometry&&this._geometry._generatePointsArray()},t.prototype.clone=function(e,r,i,n){return void 0===e&&(e=""),void 0===n&&(n=!0),new t(e,this.getScene(),r,this,i,n)},t.prototype.dispose=function(t,r){if(void 0===r&&(r=!1),this.morphTargetManager=null,this._geometry&&this._geometry.releaseForMesh(this,!0),this._onBeforeDrawObservable&&this._onBeforeDrawObservable.clear(),this._onBeforeRenderObservable&&this._onBeforeRenderObservable.clear(),this._onAfterRenderObservable&&this._onAfterRenderObservable.clear(),this._scene.useClonedMeshhMap){if(this.meshMap)for(var i in this.meshMap){(a=this.meshMap[i])&&(a._source=null,this.meshMap[i]=void 0)}this._source&&this._source.meshMap&&(this._source.meshMap[this.uniqueId]=void 0)}else for(var n=0,s=this.getScene().meshes;n<s.length;n++){var a;(a=s[n])._source&&a._source===this&&(a._source=null)}for(this._source=null,this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null);this.instances.length;)this.instances[0].dispose();e.prototype.dispose.call(this,t,r)},t.prototype.applyDisplacementMap=function(e,t,r,i,n,a,o){var u=this;void 0===o&&(o=!1);var h=this.getScene();return s.h.LoadImage(e,function(e){var s=document.createElement("canvas"),h=s.getContext("2d"),c=e.width,l=e.height;s.width=c,s.height=l,h.drawImage(e,0,0);var f=h.getImageData(0,0,c,l).data;u.applyDisplacementMapFromBuffer(f,c,l,t,r,n,a,o),i&&i(u)},function(){},h.offlineProvider),this},t.prototype.applyDisplacementMapFromBuffer=function(e,t,r,i,n,s,a,o){if(void 0===o&&(o=!1),!this.isVerticesDataPresent(c.VertexBuffer.PositionKind)||!this.isVerticesDataPresent(c.VertexBuffer.NormalKind)||!this.isVerticesDataPresent(c.VertexBuffer.UVKind))return V.a.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing"),this;var h=this.getVerticesData(c.VertexBuffer.PositionKind,!0,!0),f=this.getVerticesData(c.VertexBuffer.NormalKind),d=this.getVerticesData(c.VertexBuffer.UVKind),p=u.Vector3.Zero(),g=u.Vector3.Zero(),m=u.Vector2.Zero();s=s||u.Vector2.Zero(),a=a||new u.Vector2(1,1);for(var v=0;v<h.length;v+=3){u.Vector3.FromArrayToRef(h,v,p),u.Vector3.FromArrayToRef(f,v,g),u.Vector2.FromArrayToRef(d,v/3*2,m);var y=4*((Math.abs(m.x*a.x+s.x)*t%t|0)+(Math.abs(m.y*a.y+s.y)*r%r|0)*t),_=.3*(e[y]/255)+.59*(e[y+1]/255)+.11*(e[y+2]/255);g.normalize(),g.scaleInPlace(i+(n-i)*_),(p=p.add(g)).toArray(h,v)}return l.VertexData.ComputeNormals(h,this.getIndices(),f),o?(this.setVerticesData(c.VertexBuffer.PositionKind,h),this.setVerticesData(c.VertexBuffer.NormalKind,f)):(this.updateVerticesData(c.VertexBuffer.PositionKind,h),this.updateVerticesData(c.VertexBuffer.NormalKind,f)),this},t.prototype.convertToFlatShadedMesh=function(){var e,t,r=this.getVerticesDataKinds(),i={},n={},s={},a=!1;for(e=0;e<r.length;e++){t=r[e];var o=this.getVertexBuffer(t);t!==c.VertexBuffer.NormalKind?(i[t]=o,n[t]=i[t].getData(),s[t]=[]):(a=o.isUpdatable(),r.splice(e,1),e--)}var h,l=this.subMeshes.slice(0),f=this.getIndices(),d=this.getTotalIndices();for(h=0;h<d;h++){var g=f[h];for(e=0;e<r.length;e++)for(var m=i[t=r[e]].getStrideSize(),v=0;v<m;v++)s[t].push(n[t][g*m+v])}var y=[],_=s[c.VertexBuffer.PositionKind];for(h=0;h<d;h+=3){f[h]=h,f[h+1]=h+1,f[h+2]=h+2;for(var x=u.Vector3.FromArray(_,3*h),b=u.Vector3.FromArray(_,3*(h+1)),V=u.Vector3.FromArray(_,3*(h+2)),M=x.subtract(b),T=V.subtract(b),D=u.Vector3.Normalize(u.Vector3.Cross(M,T)),A=0;A<3;A++)y.push(D.x),y.push(D.y),y.push(D.z)}for(this.setIndices(f),this.setVerticesData(c.VertexBuffer.NormalKind,y,a),e=0;e<r.length;e++)t=r[e],this.setVerticesData(t,s[t],i[t].isUpdatable());this.releaseSubMeshes();for(var I=0;I<l.length;I++){var B=l[I];p.b.AddToMesh(B.materialIndex,B.indexStart,B.indexCount,B.indexStart,B.indexCount,this)}return this.synchronizeInstances(),this},t.prototype.convertToUnIndexedMesh=function(){var e,t,r=this.getVerticesDataKinds(),i={},n={},s={};for(e=0;e<r.length;e++){t=r[e];var a=this.getVertexBuffer(t);i[t]=a,n[t]=i[t].getData(),s[t]=[]}var o,u=this.subMeshes.slice(0),h=this.getIndices(),c=this.getTotalIndices();for(o=0;o<c;o++){var l=h[o];for(e=0;e<r.length;e++)for(var f=i[t=r[e]].getStrideSize(),d=0;d<f;d++)s[t].push(n[t][l*f+d])}for(o=0;o<c;o+=3)h[o]=o,h[o+1]=o+1,h[o+2]=o+2;for(this.setIndices(h),e=0;e<r.length;e++)t=r[e],this.setVerticesData(t,s[t],i[t].isUpdatable());this.releaseSubMeshes();for(var g=0;g<u.length;g++){var m=u[g];p.b.AddToMesh(m.materialIndex,m.indexStart,m.indexCount,m.indexStart,m.indexCount,this)}return this._unIndexed=!0,this.synchronizeInstances(),this},t.prototype.flipFaces=function(e){void 0===e&&(e=!1);var t,r,i=l.VertexData.ExtractFromMesh(this);if(e&&this.isVerticesDataPresent(c.VertexBuffer.NormalKind)&&i.normals)for(t=0;t<i.normals.length;t++)i.normals[t]*=-1;if(i.indices)for(t=0;t<i.indices.length;t+=3)r=i.indices[t+1],i.indices[t+1]=i.indices[t+2],i.indices[t+2]=r;return i.applyToMesh(this),this},t.prototype.createInstance=function(e){return t._instancedMeshFactory(e,this)},t.prototype.synchronizeInstances=function(){for(var e=0;e<this.instances.length;e++){this.instances[e]._syncSubMeshes()}return this},t.prototype.optimizeIndices=function(e){var t=this,r=this.getIndices(),i=this.getVerticesData(c.VertexBuffer.PositionKind);if(!i||!r)return this;for(var n=new Array,a=0;a<i.length;a+=3)n.push(u.Vector3.FromArray(i,a));var o=new Array;return s.a.SyncAsyncForLoop(n.length,40,function(e){for(var t=n.length-1-e,r=n[t],i=0;i<t;++i){var s=n[i];if(r.equals(s)){o[t]=i;break}}},function(){for(var i=0;i<r.length;++i)r[i]=o[r[i]]||r[i];var n=t.subMeshes.slice(0);t.setIndices(r),t.subMeshes=n,e&&e(t)}),this},t.prototype.serialize=function(e){e.name=this.name,e.id=this.id,e.type=this.getClassName(),o.a&&o.a.HasTags(this)&&(e.tags=o.a.GetTags(this)),e.position=this.position.asArray(),this.rotationQuaternion?e.rotationQuaternion=this.rotationQuaternion.asArray():this.rotation&&(e.rotation=this.rotation.asArray()),e.scaling=this.scaling.asArray(),this._postMultiplyPivotMatrix?e.pivotMatrix=this.getPivotMatrix().asArray():e.localMatrix=this.getPivotMatrix().asArray(),e.isEnabled=this.isEnabled(!1),e.isVisible=this.isVisible,e.infiniteDistance=this.infiniteDistance,e.pickable=this.isPickable,e.receiveShadows=this.receiveShadows,e.billboardMode=this.billboardMode,e.visibility=this.visibility,e.checkCollisions=this.checkCollisions,e.isBlocker=this.isBlocker,this.parent&&(e.parentId=this.parent.id),e.isUnIndexed=this.isUnIndexed;var t=this._geometry;if(t){var r=t.id;e.geometryId=r,e.subMeshes=[];for(var i=0;i<this.subMeshes.length;i++){var n=this.subMeshes[i];e.subMeshes.push({materialIndex:n.materialIndex,verticesStart:n.verticesStart,verticesCount:n.verticesCount,indexStart:n.indexStart,indexCount:n.indexCount})}}this.material?e.materialId=this.material.id:this.material=null,this.morphTargetManager&&(e.morphTargetManagerId=this.morphTargetManager.uniqueId),this.skeleton&&(e.skeletonId=this.skeleton.id);var s=this.getPhysicsImpostor();s&&(e.physicsMass=s.getParam("mass"),e.physicsFriction=s.getParam("friction"),e.physicsRestitution=s.getParam("mass"),e.physicsImpostor=s.type),this.metadata&&(e.metadata=this.metadata),e.instances=[];for(var a=0;a<this.instances.length;a++){var u=this.instances[a];if(!u.doNotSerialize){var h={name:u.name,id:u.id,position:u.position.asArray(),scaling:u.scaling.asArray()};u.parent&&(h.parentId=u.parent.id),u.rotationQuaternion?h.rotationQuaternion=u.rotationQuaternion.asArray():u.rotation&&(h.rotation=u.rotation.asArray()),e.instances.push(h),b.a.AppendSerializedAnimations(u,h),h.ranges=u.serializeAnimationRanges()}}b.a.AppendSerializedAnimations(this,e),e.ranges=this.serializeAnimationRanges(),e.layerMask=this.layerMask,e.alphaIndex=this.alphaIndex,e.hasVertexAlpha=this.hasVertexAlpha,e.overlayAlpha=this.overlayAlpha,e.overlayColor=this.overlayColor.asArray(),e.renderOverlay=this.renderOverlay,e.applyFog=this.applyFog,this.actionManager&&(e.actions=this.actionManager.serialize(this.name))},t.prototype._syncGeometryWithMorphTargetManager=function(){if(this.geometry){this._markSubMeshesAsAttributesDirty();var e=this._morphTargetManager;if(e&&e.vertexCount){if(e.vertexCount!==this.getTotalVertices())return V.a.Error("Mesh is incompatible with morph targets. Targets and mesh must all have the same vertices count."),void(this.morphTargetManager=null);for(var t=0;t<e.numInfluencers;t++){var r=e.getActiveTarget(t),i=r.getPositions();if(!i)return void V.a.Error("Invalid morph target. Target must have positions.");this.geometry.setVerticesData(c.VertexBuffer.PositionKind+t,i,!1,3);var n=r.getNormals();n&&this.geometry.setVerticesData(c.VertexBuffer.NormalKind+t,n,!1,3);var s=r.getTangents();s&&this.geometry.setVerticesData(c.VertexBuffer.TangentKind+t,s,!1,3)}}else for(t=0;this.geometry.isVerticesDataPresent(c.VertexBuffer.PositionKind+t);)this.geometry.removeVerticesData(c.VertexBuffer.PositionKind+t),this.geometry.isVerticesDataPresent(c.VertexBuffer.NormalKind+t)&&this.geometry.removeVerticesData(c.VertexBuffer.NormalKind+t),this.geometry.isVerticesDataPresent(c.VertexBuffer.TangentKind+t)&&this.geometry.removeVerticesData(c.VertexBuffer.TangentKind+t),t++}},t.Parse=function(e,r,i){var n;if((n=e.type&&"GroundMesh"===e.type?t._GroundMeshParser(e,r):new t(e.name,r)).id=e.id,o.a&&o.a.AddTagsTo(n,e.tags),n.position=u.Vector3.FromArray(e.position),void 0!==e.metadata&&(n.metadata=e.metadata),e.rotationQuaternion?n.rotationQuaternion=u.Quaternion.FromArray(e.rotationQuaternion):e.rotation&&(n.rotation=u.Vector3.FromArray(e.rotation)),n.scaling=u.Vector3.FromArray(e.scaling),e.localMatrix?n.setPreTransformMatrix(u.Matrix.FromArray(e.localMatrix)):e.pivotMatrix&&n.setPivotMatrix(u.Matrix.FromArray(e.pivotMatrix)),n.setEnabled(e.isEnabled),n.isVisible=e.isVisible,n.infiniteDistance=e.infiniteDistance,n.showBoundingBox=e.showBoundingBox,n.showSubMeshesBoundingBox=e.showSubMeshesBoundingBox,void 0!==e.applyFog&&(n.applyFog=e.applyFog),void 0!==e.pickable&&(n.isPickable=e.pickable),void 0!==e.alphaIndex&&(n.alphaIndex=e.alphaIndex),n.receiveShadows=e.receiveShadows,n.billboardMode=e.billboardMode,void 0!==e.visibility&&(n.visibility=e.visibility),n.checkCollisions=e.checkCollisions,void 0!==e.isBlocker&&(n.isBlocker=e.isBlocker),n._shouldGenerateFlatShading=e.useFlatShading,e.freezeWorldMatrix&&(n._waitingFreezeWorldMatrix=e.freezeWorldMatrix),e.parentId&&(n._waitingParentId=e.parentId),void 0!==e.actions&&(n._waitingActions=e.actions),void 0!==e.overlayAlpha&&(n.overlayAlpha=e.overlayAlpha),void 0!==e.overlayColor&&(n.overlayColor=u.Color3.FromArray(e.overlayColor)),void 0!==e.renderOverlay&&(n.renderOverlay=e.renderOverlay),n.isUnIndexed=!!e.isUnIndexed,n.hasVertexAlpha=e.hasVertexAlpha,e.delayLoadingFile?(n.delayLoadState=x.a.DELAYLOADSTATE_NOTLOADED,n.delayLoadingFile=i+e.delayLoadingFile,n._boundingInfo=new g.a(u.Vector3.FromArray(e.boundingBoxMinimum),u.Vector3.FromArray(e.boundingBoxMaximum)),e._binaryInfo&&(n._binaryInfo=e._binaryInfo),n._delayInfo=[],e.hasUVs&&n._delayInfo.push(c.VertexBuffer.UVKind),e.hasUVs2&&n._delayInfo.push(c.VertexBuffer.UV2Kind),e.hasUVs3&&n._delayInfo.push(c.VertexBuffer.UV3Kind),e.hasUVs4&&n._delayInfo.push(c.VertexBuffer.UV4Kind),e.hasUVs5&&n._delayInfo.push(c.VertexBuffer.UV5Kind),e.hasUVs6&&n._delayInfo.push(c.VertexBuffer.UV6Kind),e.hasColors&&n._delayInfo.push(c.VertexBuffer.ColorKind),e.hasMatricesIndices&&n._delayInfo.push(c.VertexBuffer.MatricesIndicesKind),e.hasMatricesWeights&&n._delayInfo.push(c.VertexBuffer.MatricesWeightsKind),n._delayLoadingFunction=f.d._ImportGeometry,y.a.ForceFullSceneLoadingForIncremental&&n._checkDelayState()):f.d._ImportGeometry(e,n),e.materialId?n.setMaterialByID(e.materialId):n.material=null,e.morphTargetManagerId>-1&&(n.morphTargetManager=r.getMorphTargetManagerById(e.morphTargetManagerId)),e.skeletonId>-1&&(n.skeleton=r.getLastSkeletonByID(e.skeletonId),e.numBoneInfluencers&&(n.numBoneInfluencers=e.numBoneInfluencers)),e.animations){for(var s=0;s<e.animations.length;s++){var a=e.animations[s];n.animations.push(v.a.Parse(a))}h.a.ParseAnimationRanges(n,e,r)}if(e.autoAnimate&&r.beginAnimation(n,e.autoAnimateFrom,e.autoAnimateTo,e.autoAnimateLoop,e.autoAnimateSpeed||1),e.layerMask&&!isNaN(e.layerMask)?n.layerMask=Math.abs(parseInt(e.layerMask)):n.layerMask=268435455,e.physicsImpostor&&(n.physicsImpostor=new _.a(n,e.physicsImpostor,{mass:e.physicsMass,friction:e.physicsFriction,restitution:e.physicsRestitution},r)),e.instances)for(var l=0;l<e.instances.length;l++){var d=e.instances[l],p=n.createInstance(d.name);if(d.id&&(p.id=d.id),o.a&&(d.tags?o.a.AddTagsTo(p,d.tags):o.a.AddTagsTo(p,e.tags)),p.position=u.Vector3.FromArray(d.position),d.parentId&&(p._waitingParentId=d.parentId),d.rotationQuaternion?p.rotationQuaternion=u.Quaternion.FromArray(d.rotationQuaternion):d.rotation&&(p.rotation=u.Vector3.FromArray(d.rotation)),p.scaling=u.Vector3.FromArray(d.scaling),null!=d.checkCollisions&&null!=d.checkCollisions&&(p.checkCollisions=d.checkCollisions),null!=d.pickable&&null!=d.pickable&&(p.isPickable=d.pickable),null!=d.showBoundingBox&&null!=d.showBoundingBox&&(p.showBoundingBox=d.showBoundingBox),null!=d.showSubMeshesBoundingBox&&null!=d.showSubMeshesBoundingBox&&(p.showSubMeshesBoundingBox=d.showSubMeshesBoundingBox),null!=d.alphaIndex&&null!=d.showSubMeshesBoundingBox&&(p.alphaIndex=d.alphaIndex),d.physicsImpostor&&(p.physicsImpostor=new _.a(p,d.physicsImpostor,{mass:d.physicsMass,friction:d.physicsFriction,restitution:d.physicsRestitution},r)),d.animations){for(s=0;s<d.animations.length;s++)a=d.animations[s],p.animations.push(v.a.Parse(a));h.a.ParseAnimationRanges(p,d,r),d.autoAnimate&&r.beginAnimation(p,d.autoAnimateFrom,d.autoAnimateTo,d.autoAnimateLoop,d.autoAnimateSpeed||1)}}return n},t.CreateRibbon=function(e,t,r,i,n,s,a,o,u){throw"Import MeshBuilder before creating meshes."},t.CreateDisc=function(e,t,r,i,n,s){throw void 0===i&&(i=null),"Import MeshBuilder before creating meshes."},t.CreateBox=function(e,t,r,i,n){throw void 0===r&&(r=null),"Import MeshBuilder before creating meshes."},t.CreateSphere=function(e,t,r,i,n,s){throw"Import MeshBuilder before creating meshes."},t.CreateCylinder=function(e,t,r,i,n,s,a,o,u){throw"Import MeshBuilder before creating meshes."},t.CreateTorus=function(e,t,r,i,n,s,a){throw"Import MeshBuilder before creating meshes."},t.CreateTorusKnot=function(e,t,r,i,n,s,a,o,u,h){throw"Import MeshBuilder before creating meshes."},t.CreateLines=function(e,t,r,i,n){throw void 0===r&&(r=null),void 0===i&&(i=!1),void 0===n&&(n=null),"Import MeshBuilder before creating meshes."},t.CreateDashedLines=function(e,t,r,i,n,s,a,o){throw void 0===s&&(s=null),"Import MeshBuilder before creating meshes."},t.CreatePolygon=function(e,t,r,i,n,s){throw"Import MeshBuilder before creating meshes."},t.ExtrudePolygon=function(e,t,r,i,n,s,a){throw"Import MeshBuilder before creating meshes."},t.ExtrudeShape=function(e,t,r,i,n,s,a,o,u,h){throw void 0===a&&(a=null),"Import MeshBuilder before creating meshes."},t.ExtrudeShapeCustom=function(e,t,r,i,n,s,a,o,u,h,c,l){throw"Import MeshBuilder before creating meshes."},t.CreateLathe=function(e,t,r,i,n,s,a){throw"Import MeshBuilder before creating meshes."},t.CreatePlane=function(e,t,r,i,n){throw"Import MeshBuilder before creating meshes."},t.CreateGround=function(e,t,r,i,n,s){throw"Import MeshBuilder before creating meshes."},t.CreateTiledGround=function(e,t,r,i,n,s,a,o,u){throw"Import MeshBuilder before creating meshes."},t.CreateGroundFromHeightMap=function(e,t,r,i,n,s,a,o,u,h,c){throw"Import MeshBuilder before creating meshes."},t.CreateTube=function(e,t,r,i,n,s,a,o,u,h){throw"Import MeshBuilder before creating meshes."},t.CreatePolyhedron=function(e,t,r){throw"Import MeshBuilder before creating meshes."},t.CreateIcoSphere=function(e,t,r){throw"Import MeshBuilder before creating meshes."},t.CreateDecal=function(e,t,r,i,n,s){throw"Import MeshBuilder before creating meshes."},t.prototype.setPositionsForCPUSkinning=function(){if(!this._sourcePositions){var e=this.getVerticesData(c.VertexBuffer.PositionKind);if(!e)return this._sourcePositions;this._sourcePositions=new Float32Array(e),this.isVertexBufferUpdatable(c.VertexBuffer.PositionKind)||this.setVerticesData(c.VertexBuffer.PositionKind,e,!0)}return this._sourcePositions},t.prototype.setNormalsForCPUSkinning=function(){if(!this._sourceNormals){var e=this.getVerticesData(c.VertexBuffer.NormalKind);if(!e)return this._sourceNormals;this._sourceNormals=new Float32Array(e),this.isVertexBufferUpdatable(c.VertexBuffer.NormalKind)||this.setVerticesData(c.VertexBuffer.NormalKind,e,!0)}return this._sourceNormals},t.prototype.applySkeleton=function(e){if(!this.geometry)return this;if(this.geometry._softwareSkinningFrameId==this.getScene().getFrameId())return this;if(this.geometry._softwareSkinningFrameId=this.getScene().getFrameId(),!this.isVerticesDataPresent(c.VertexBuffer.PositionKind))return this;if(!this.isVerticesDataPresent(c.VertexBuffer.NormalKind))return this;if(!this.isVerticesDataPresent(c.VertexBuffer.MatricesIndicesKind))return this;if(!this.isVerticesDataPresent(c.VertexBuffer.MatricesWeightsKind))return this;if(!this._sourcePositions){var t=this.subMeshes.slice();this.setPositionsForCPUSkinning(),this.subMeshes=t}this._sourceNormals||this.setNormalsForCPUSkinning();var r=this.getVerticesData(c.VertexBuffer.PositionKind);if(!r)return this;r instanceof Float32Array||(r=new Float32Array(r));var i=this.getVerticesData(c.VertexBuffer.NormalKind);if(!i)return this;i instanceof Float32Array||(i=new Float32Array(i));var n=this.getVerticesData(c.VertexBuffer.MatricesIndicesKind),s=this.getVerticesData(c.VertexBuffer.MatricesWeightsKind);if(!s||!n)return this;for(var a,o=this.numBoneInfluencers>4,h=o?this.getVerticesData(c.VertexBuffer.MatricesIndicesExtraKind):null,l=o?this.getVerticesData(c.VertexBuffer.MatricesWeightsExtraKind):null,f=e.getTransformMatrices(this),d=u.Vector3.Zero(),p=new u.Matrix,g=new u.Matrix,m=0,v=0;v<r.length;v+=3,m+=4){var y;for(a=0;a<4;a++)(y=s[m+a])>0&&(u.Matrix.FromFloat32ArrayToRefScaled(f,Math.floor(16*n[m+a]),y,g),p.addToSelf(g));if(o)for(a=0;a<4;a++)(y=l[m+a])>0&&(u.Matrix.FromFloat32ArrayToRefScaled(f,Math.floor(16*h[m+a]),y,g),p.addToSelf(g));u.Vector3.TransformCoordinatesFromFloatsToRef(this._sourcePositions[v],this._sourcePositions[v+1],this._sourcePositions[v+2],p,d),d.toArray(r,v),u.Vector3.TransformNormalFromFloatsToRef(this._sourceNormals[v],this._sourceNormals[v+1],this._sourceNormals[v+2],p,d),d.toArray(i,v),p.reset()}return this.updateVerticesData(c.VertexBuffer.PositionKind,r),this.updateVerticesData(c.VertexBuffer.NormalKind,i),this},t.MinMax=function(e){var t=null,r=null;return e.forEach(function(e){var i=e.getBoundingInfo().boundingBox;t&&r?(t.minimizeInPlace(i.minimumWorld),r.maximizeInPlace(i.maximumWorld)):(t=i.minimumWorld,r=i.maximumWorld)}),t&&r?{min:t,max:r}:{min:u.Vector3.Zero(),max:u.Vector3.Zero()}},t.Center=function(e){var r=e instanceof Array?t.MinMax(e):e;return u.Vector3.Center(r.min,r.max)},t.MergeMeshes=function(e,r,i,n,s){var a;if(void 0===r&&(r=!0),!i){var o=0;for(a=0;a<e.length;a++)if(e[a]&&(o+=e[a].getTotalVertices())>65536)return V.a.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),null}var u,h=null,c=new Array,f=null;for(a=0;a<e.length;a++)if(e[a]){var d=e[a].computeWorldMatrix(!0);(u=l.VertexData.ExtractFromMesh(e[a],!0,!0)).transform(d),h?h.merge(u,i):(h=u,f=e[a]),s&&c.push(e[a].getTotalIndices())}if(f=f,n||(n=new t(f.name+"_merged",f.getScene())),h.applyToMesh(n),n.material=f.material,n.checkCollisions=f.checkCollisions,r)for(a=0;a<e.length;a++)e[a]&&e[a].dispose();if(s){n.releaseSubMeshes(),a=0;for(var g=0;a<c.length;)p.b.CreateFromIndices(0,g,c[a],n),g+=c[a],a++}return n},t.prototype.addInstance=function(e){e._indexInSourceMeshInstanceArray=this.instances.length,this.instances.push(e)},t.prototype.removeInstance=function(e){var t=e._indexInSourceMeshInstanceArray;if(-1!=t){if(t!==this.instances.length-1){var r=this.instances[this.instances.length-1];this.instances[t]=r,r._indexInSourceMeshInstanceArray=t}e._indexInSourceMeshInstanceArray=-1,this.instances.pop()}},t.FRONTSIDE=l.VertexData.FRONTSIDE,t.BACKSIDE=l.VertexData.BACKSIDE,t.DOUBLESIDE=l.VertexData.DOUBLESIDE,t.DEFAULTSIDE=l.VertexData.DEFAULTSIDE,t.NO_CAP=0,t.CAP_START=1,t.CAP_END=2,t.CAP_ALL=3,t._instancedMeshFactory=function(e,t){throw"Import InstancedMesh before creating instances."},t._GroundMeshParser=function(e,t){throw"Import GroundMesh before trying to parse it."},t}(d.a)},105:function(e,t,r){"use strict";r.d(t,"a",function(){return m});var i=r(12),n=r(68),s=r(4),a=r(11),o=r(30),u=r(9),h=r(98),c=r(58);function l(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}var f=l("DXT1"),d=l("DXT3"),p=l("DXT5"),g=l("DX10"),m=function(){function e(){}return e.GetDDSInfo=function(e){var t=new Int32Array(e,0,31),r=new Int32Array(e,0,35),i=1;131072&t[2]&&(i=Math.max(1,t[7]));var n=t[21],a=n===g?r[32]:0,o=s.a.TEXTURETYPE_UNSIGNED_INT;switch(n){case 113:o=s.a.TEXTURETYPE_HALF_FLOAT;break;case 116:o=s.a.TEXTURETYPE_FLOAT;break;case g:if(10===a){o=s.a.TEXTURETYPE_HALF_FLOAT;break}}return{width:t[4],height:t[3],mipmapCount:i,isFourCC:4==(4&t[20]),isRGB:64==(64&t[20]),isLuminance:131072==(131072&t[20]),isCube:512==(512&t[28]),isCompressed:n===f||n===d||n===p,dxgiFormat:a,textureType:o}},e._ToHalfFloat=function(t){e._FloatView||(e._FloatView=new Float32Array(1),e._Int32View=new Int32Array(e._FloatView.buffer)),e._FloatView[0]=t;var r=e._Int32View[0],i=r>>16&32768,n=r>>12&2047,s=r>>23&255;return s<103?i:s>142?(i|=31744,i|=(255==s?0:1)&&8388607&r):s<113?i|=((n|=2048)>>114-s)+(n>>113-s&1):(i|=s-112<<10|n>>1,i+=1&n)},e._FromHalfFloat=function(e){var t=(32768&e)>>15,r=(31744&e)>>10,i=1023&e;return 0===r?(t?-1:1)*Math.pow(2,-14)*(i/Math.pow(2,10)):31==r?i?NaN:1/0*(t?-1:1):(t?-1:1)*Math.pow(2,r-15)*(1+i/Math.pow(2,10))},e._GetHalfFloatAsFloatRGBAArrayBuffer=function(t,r,i,n,s,a){for(var o=new Float32Array(n),u=new Uint16Array(s,i),h=0,c=0;c<r;c++)for(var l=0;l<t;l++){var f=4*(l+c*t);o[h]=e._FromHalfFloat(u[f]),o[h+1]=e._FromHalfFloat(u[f+1]),o[h+2]=e._FromHalfFloat(u[f+2]),e.StoreLODInAlphaChannel?o[h+3]=a:o[h+3]=e._FromHalfFloat(u[f+3]),h+=4}return o},e._GetHalfFloatRGBAArrayBuffer=function(t,r,i,n,s,a){if(e.StoreLODInAlphaChannel){for(var o=new Uint16Array(n),u=new Uint16Array(s,i),h=0,c=0;c<r;c++)for(var l=0;l<t;l++){var f=4*(l+c*t);o[h]=u[f],o[h+1]=u[f+1],o[h+2]=u[f+2],o[h+3]=e._ToHalfFloat(a),h+=4}return o}return new Uint16Array(s,i,n)},e._GetFloatRGBAArrayBuffer=function(t,r,i,n,s,a){if(e.StoreLODInAlphaChannel){for(var o=new Float32Array(n),u=new Float32Array(s,i),h=0,c=0;c<r;c++)for(var l=0;l<t;l++){var f=4*(l+c*t);o[h]=u[f],o[h+1]=u[f+1],o[h+2]=u[f+2],o[h+3]=a,h+=4}return o}return new Float32Array(s,i,n)},e._GetFloatAsUIntRGBAArrayBuffer=function(t,r,n,s,a,o){for(var u=new Uint8Array(s),h=new Float32Array(a,n),c=0,l=0;l<r;l++)for(var f=0;f<t;f++){var d=4*(f+l*t);u[c]=255*i.a.Clamp(h[d]),u[c+1]=255*i.a.Clamp(h[d+1]),u[c+2]=255*i.a.Clamp(h[d+2]),e.StoreLODInAlphaChannel?u[c+3]=o:u[c+3]=255*i.a.Clamp(h[d+3]),c+=4}return u},e._GetHalfFloatAsUIntRGBAArrayBuffer=function(t,r,n,s,a,o){for(var u=new Uint8Array(s),h=new Uint16Array(a,n),c=0,l=0;l<r;l++)for(var f=0;f<t;f++){var d=4*(f+l*t);u[c]=255*i.a.Clamp(e._FromHalfFloat(h[d])),u[c+1]=255*i.a.Clamp(e._FromHalfFloat(h[d+1])),u[c+2]=255*i.a.Clamp(e._FromHalfFloat(h[d+2])),e.StoreLODInAlphaChannel?u[c+3]=o:u[c+3]=255*i.a.Clamp(e._FromHalfFloat(h[d+3])),c+=4}return u},e._GetRGBAArrayBuffer=function(e,t,r,i,n,s,a,o,u){for(var h=new Uint8Array(i),c=new Uint8Array(n,r),l=0,f=0;f<t;f++)for(var d=0;d<e;d++){var p=4*(d+f*e);h[l]=c[p+s],h[l+1]=c[p+a],h[l+2]=c[p+o],h[l+3]=c[p+u],l+=4}return h},e._ExtractLongWordOrder=function(t){return 0===t||255===t||-16777216===t?0:1+e._ExtractLongWordOrder(t>>8)},e._GetRGBArrayBuffer=function(e,t,r,i,n,s,a,o){for(var u=new Uint8Array(i),h=new Uint8Array(n,r),c=0,l=0;l<t;l++)for(var f=0;f<e;f++){var d=3*(f+l*e);u[c]=h[d+s],u[c+1]=h[d+a],u[c+2]=h[d+o],c+=3}return u},e._GetLuminanceArrayBuffer=function(e,t,r,i,n){for(var s=new Uint8Array(i),a=new Uint8Array(n,r),o=0,u=0;u<t;u++)for(var h=0;h<e;h++){var c=h+u*e;s[o]=a[c],o++}return s},e.UploadDDSLevels=function(t,r,i,n,a,o,c,l){void 0===c&&(c=-1);var m=null;n.sphericalPolynomial&&(m=new Array);var v,y,_,x,b,V,M,T=t.getCaps().s3tc,D=new Int32Array(i,0,31),A=0,I=0,B=1;if(542327876===D[0])if(n.isFourCC||n.isRGB||n.isLuminance)if(!n.isCompressed||T){var w=D[22];x=D[1]+4;var E,S=!1;if(n.isFourCC)switch(v=D[21]){case f:B=8,I=T.COMPRESSED_RGBA_S3TC_DXT1_EXT;break;case d:B=16,I=T.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case p:B=16,I=T.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;case 113:case 116:S=!0;break;case g:x+=20;var C=!1;switch(n.dxgiFormat){case 10:S=!0,C=!0;break;case 88:n.isRGB=!0,n.isFourCC=!1,w=32,C=!0}if(C)break;default:return void console.error("Unsupported FourCC code:",(E=v,String.fromCharCode(255&E,E>>8&255,E>>16&255,E>>24&255)))}var P=e._ExtractLongWordOrder(D[23]),O=e._ExtractLongWordOrder(D[24]),F=e._ExtractLongWordOrder(D[25]),R=e._ExtractLongWordOrder(D[26]);S&&(I=t._getRGBABufferInternalSizedFormat(n.textureType)),V=1,131072&D[2]&&!1!==a&&(V=Math.max(1,D[7]));for(var L=0;L<o;L++){for(y=D[4],_=D[3],M=0;M<V;++M){if(-1===c||c===M){var U=-1===c?M:0;if(!n.isCompressed&&n.isFourCC){r.format=s.a.TEXTUREFORMAT_RGBA,A=y*_*4;var z=null;t._badOS||t._badDesktopOS||!t.getCaps().textureHalfFloat&&!t.getCaps().textureFloat?(128===w?(z=e._GetFloatAsUIntRGBAArrayBuffer(y,_,x,A,i,U),m&&0==U&&m.push(e._GetFloatRGBAArrayBuffer(y,_,x,A,i,U))):64===w&&(z=e._GetHalfFloatAsUIntRGBAArrayBuffer(y,_,x,A,i,U),m&&0==U&&m.push(e._GetHalfFloatAsFloatRGBAArrayBuffer(y,_,x,A,i,U))),r.type=s.a.TEXTURETYPE_UNSIGNED_INT):128===w?(r.type=s.a.TEXTURETYPE_FLOAT,z=e._GetFloatRGBAArrayBuffer(y,_,x,A,i,U),m&&0==U&&m.push(z)):64!==w||t.getCaps().textureHalfFloat?(r.type=s.a.TEXTURETYPE_HALF_FLOAT,z=e._GetHalfFloatRGBAArrayBuffer(y,_,x,A,i,U),m&&0==U&&m.push(e._GetHalfFloatAsFloatRGBAArrayBuffer(y,_,x,A,i,U))):(r.type=s.a.TEXTURETYPE_FLOAT,z=e._GetHalfFloatAsFloatRGBAArrayBuffer(y,_,x,A,i,U),m&&0==U&&m.push(z)),z&&t._uploadDataToTextureDirectly(r,z,L,U)}else if(n.isRGB)r.type=s.a.TEXTURETYPE_UNSIGNED_INT,24===w?(r.format=s.a.TEXTUREFORMAT_RGB,A=y*_*3,b=e._GetRGBArrayBuffer(y,_,x,A,i,P,O,F),t._uploadDataToTextureDirectly(r,b,L,U)):(r.format=s.a.TEXTUREFORMAT_RGBA,A=y*_*4,b=e._GetRGBAArrayBuffer(y,_,x,A,i,P,O,F,R),t._uploadDataToTextureDirectly(r,b,L,U));else if(n.isLuminance){var N=t._getUnpackAlignement(),k=y;A=Math.floor((y+N-1)/N)*N*(_-1)+k,b=e._GetLuminanceArrayBuffer(y,_,x,A,i),r.format=s.a.TEXTUREFORMAT_LUMINANCE,r.type=s.a.TEXTURETYPE_UNSIGNED_INT,t._uploadDataToTextureDirectly(r,b,L,U)}else A=Math.max(4,y)/4*Math.max(4,_)/4*B,b=new Uint8Array(i,x,A),r.type=s.a.TEXTURETYPE_UNSIGNED_INT,t._uploadCompressedDataToTextureDirectly(r,I,y,_,b,L,U)}x+=w?y*_*(w/8):A,y*=.5,_*=.5,y=Math.max(1,y),_=Math.max(1,_)}if(void 0!==l)break}m&&m.length>0?n.sphericalPolynomial=h.a.ConvertCubeMapToSphericalPolynomial({size:D[4],right:m[0],left:m[1],up:m[2],down:m[3],front:m[4],back:m[5],format:s.a.TEXTUREFORMAT_RGBA,type:s.a.TEXTURETYPE_FLOAT,gammaSpace:!1}):n.sphericalPolynomial=void 0}else u.a.Error("Compressed textures are not supported on this platform.");else u.a.Error("Unsupported format, must contain a FourCC, RGB or LUMINANCE code");else u.a.Error("Invalid magic number in DDS header")},e.StoreLODInAlphaChannel=!1,e}();a.Engine.prototype.createPrefilteredCubeTexture=function(e,t,r,s,a,h,l,f,d){var p=this;void 0===a&&(a=null),void 0===h&&(h=null),void 0===f&&(f=null),void 0===d&&(d=!0);return this.createCubeTexture(e,t,null,!1,function(e){if(e){var h=e.texture;if(d?e.info.sphericalPolynomial&&(h._sphericalPolynomial=e.info.sphericalPolynomial):h._sphericalPolynomial=new n.b,h._dataSource=o.a.DATASOURCE_CUBEPREFILTERED,p.getCaps().textureLOD)a&&a(h);else{var l=p._gl,f=e.width;if(f){for(var g=[],v=0;v<3;v++){var y=1-v/2,_=s,x=i.a.Log2(f)*r+s,b=_+(x-_)*y,V=Math.round(Math.min(Math.max(b,0),x)),M=new o.a(p,o.a.DATASOURCE_TEMP);if(M.type=h.type,M.format=h.format,M.width=Math.pow(2,Math.max(i.a.Log2(f)-V,0)),M.height=M.width,M.isCube=!0,p._bindTextureDirectly(l.TEXTURE_CUBE_MAP,M,!0),l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_MAG_FILTER,l.LINEAR),l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_MIN_FILTER,l.LINEAR),l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),e.isDDS){var T=e.info,D=e.data;p._unpackFlipY(T.isCompressed),m.UploadDDSLevels(p,M,D,T,!0,6,V)}else u.a.Warn("DDS is the only prefiltered cube map supported so far.");p._bindTextureDirectly(l.TEXTURE_CUBE_MAP,null);var A=new c.a(t);A.isCube=!0,A._texture=M,M.isReady=!0,g.push(A)}h._lodTextureHigh=g[2],h._lodTextureMid=g[1],h._lodTextureLow=g[0],a&&a(h)}}}else a&&a(null)},h,l,f,d,r,s)}},112:function(e,t,r){"use strict";r.d(t,"a",function(){return d});var i=r(5),n=r(0),s=r(12),a=r(68),o=r(30),u=r(58),h=r(4),c=r(19),l=r(18),f=r(9),d=(r(286),r(287),function(){function e(){}return e.GetEnvInfo=function(t){for(var r=new DataView(t),i=0,n=0;n<e._MagicBytes.length;n++)if(r.getUint8(i++)!==e._MagicBytes[n])return f.a.Error("Not a babylon environment map"),null;for(var s="",a=0;a=r.getUint8(i++);)s+=String.fromCharCode(a);var o=JSON.parse(s);return o.specular&&(o.specular.specularDataPosition=i,o.specular.lodGenerationScale=o.specular.lodGenerationScale||.8),o},e.CreateEnvTextureAsync=function(t){var r=this,n=t.getInternalTexture();if(!n)return Promise.reject("The cube texture is invalid.");if(!t._prefiltered)return Promise.reject("The cube texture is invalid (not prefiltered).");var a=n.getEngine();if(a&&a.premultipliedAlpha)return Promise.reject("Env texture can only be created when the engine is created with the premultipliedAlpha option set to false.");if(t.textureType===h.a.TEXTURETYPE_UNSIGNED_INT)return Promise.reject("The cube texture should allow HDR (Full Float or Half Float).");var o=a.getRenderingCanvas();if(!o)return Promise.reject("Env texture can only be created when the engine is associated to a canvas.");var u=h.a.TEXTURETYPE_FLOAT;if(!a.getCaps().textureFloatRender&&(u=h.a.TEXTURETYPE_HALF_FLOAT,!a.getCaps().textureHalfFloatRender))return Promise.reject("Env texture can only be created when the browser supports half float or full float rendering.");var f=n.width,d=new c.Scene(a),p={},g=[],m=s.a.Log2(n.width);m=Math.round(m);for(var v=function(e){for(var r=Math.pow(2,m-e),n=function(n){var s=t.readPixels(n,e),c=a.createRawTexture(s,r,r,h.a.TEXTUREFORMAT_RGBA,!1,!1,h.a.TEXTURE_NEAREST_SAMPLINGMODE,null,u),f=new Promise(function(t,s){var u=new l.a("rgbdEncode","rgbdEncode",null,null,1,null,h.a.TEXTURE_NEAREST_SAMPLINGMODE,a,!1,void 0,h.a.TEXTURETYPE_UNSIGNED_INT,void 0,null,!1);u.getEffect().executeWhenCompiled(function(){u.onApply=function(e){e._bindTexture("textureSampler",c)};var s=a.getRenderWidth(),h=a.getRenderHeight();a.setSize(r,r),d.postProcessManager.directRender([u],null),i.h.ToBlob(o,function(r){var i=new FileReader;i.onload=function(r){var i=r.target.result;p[6*e+n]=i,t()},i.readAsArrayBuffer(r)}),a.setSize(s,h)})});g.push(f)},s=0;s<6;s++)n(s)},y=0;y<=m;y++)v(y);return Promise.all(g).then(function(){d.dispose();for(var i={version:1,width:f,irradiance:r._CreateEnvTextureIrradiance(t),specular:{mipmaps:[],lodGenerationScale:t.lodGenerationScale}},n=0,s=0;s<=m;s++)for(var a=0;a<6;a++){var o=p[6*s+a].byteLength;i.specular.mipmaps.push({length:o,position:n}),n+=o}for(var u=JSON.stringify(i),h=new ArrayBuffer(u.length+1),c=new Uint8Array(h),l=(s=0,u.length);s<l;s++)c[s]=u.charCodeAt(s);c[u.length]=0;var g=e._MagicBytes.length+n+h.byteLength,v=new ArrayBuffer(g),y=new Uint8Array(v),_=new DataView(v),x=0;for(s=0;s<e._MagicBytes.length;s++)_.setUint8(x++,e._MagicBytes[s]);y.set(new Uint8Array(h),x),x+=h.byteLength;for(s=0;s<=m;s++)for(a=0;a<6;a++){var b=p[6*s+a];y.set(new Uint8Array(b),x),x+=b.byteLength}return v})},e._CreateEnvTextureIrradiance=function(e){var t=e.sphericalPolynomial;return null==t?null:{x:[t.x.x,t.x.y,t.x.z],y:[t.y.x,t.y.y,t.y.z],z:[t.z.x,t.z.y,t.z.z],xx:[t.xx.x,t.xx.y,t.xx.z],yy:[t.yy.x,t.yy.y,t.yy.z],zz:[t.zz.x,t.zz.y,t.zz.z],yz:[t.yz.x,t.yz.y,t.yz.z],zx:[t.zx.x,t.zx.y,t.zx.z],xy:[t.xy.x,t.xy.y,t.xy.z]}},e.UploadEnvLevelsAsync=function(t,r,i){if(1!==i.version)throw new Error('Unsupported babylon environment map version "'+i.version+'"');var n=i.specular;if(!n)return Promise.resolve();var a=s.a.Log2(i.width);if(a=Math.round(a)+1,n.mipmaps.length!==6*a)throw new Error('Unsupported specular mipmaps number "'+n.mipmaps.length+'"');t._lodGenerationScale=n.lodGenerationScale;for(var o=new Array(a),u=0;u<a;u++){o[u]=new Array(6);for(var h=0;h<6;h++){var c=n.mipmaps[6*u+h];o[u][h]=new Uint8Array(r,n.specularDataPosition+c.position,c.length)}}return e.UploadLevelsAsync(t,o)},e.UploadLevelsAsync=function(e,t){if(!i.h.IsExponentOfTwo(e.width))throw new Error("Texture size must be a power of two");var r=Math.round(s.a.Log2(e.width))+1,n=e.getEngine(),a=!1,c=!1,f=null,d=null,p=null,g=n.getCaps();if(e.format=h.a.TEXTUREFORMAT_RGBA,e.type=h.a.TEXTURETYPE_UNSIGNED_INT,e.generateMipMaps=!0,n.updateTextureSamplingMode(h.a.TEXTURE_TRILINEAR_SAMPLINGMODE,e),g.textureLOD?n.webGLVersion<2?a=!1:g.textureHalfFloatRender&&g.textureHalfFloatLinearFiltering?(a=!0,e.type=h.a.TEXTURETYPE_HALF_FLOAT):g.textureFloatRender&&g.textureFloatLinearFiltering&&(a=!0,e.type=h.a.TEXTURETYPE_FLOAT):(a=!1,c=!0,p={}),a)f=new l.a("rgbdDecode","rgbdDecode",null,null,1,null,h.a.TEXTURE_TRILINEAR_SAMPLINGMODE,n,!1,void 0,e.type,void 0,null,!1),e._isRGBD=!1,e.invertY=!1,d=n.createRenderTargetCubeTexture(e.width,{generateDepthBuffer:!1,generateMipMaps:!0,generateStencilBuffer:!1,samplingMode:h.a.TEXTURE_TRILINEAR_SAMPLINGMODE,type:e.type,format:h.a.TEXTUREFORMAT_RGBA});else if(e._isRGBD=!0,e.invertY=!0,c)for(var m=e._lodGenerationScale,v=e._lodGenerationOffset,y=0;y<3;y++){var _=(r-1)*m+v,x=v+(_-v)*(1-y/2),b=Math.round(Math.min(Math.max(x,0),_)),V=new o.a(n,o.a.DATASOURCE_TEMP);V.isCube=!0,V.invertY=!0,V.generateMipMaps=!1,n.updateTextureSamplingMode(h.a.TEXTURE_LINEAR_LINEAR,V);var M=new u.a(null);switch(M.isCube=!0,M._texture=V,p[b]=M,y){case 0:e._lodTextureLow=M;break;case 1:e._lodTextureMid=M;break;case 2:e._lodTextureHigh=M}}var T=[],D=function(r){for(var i=function(i){var s=t[r][i],o=new Blob([s],{type:"image/png"}),u=URL.createObjectURL(o),l=new Image;l.src=u;var g=new Promise(function(t,s){l.onload=function(){if(a){var o=n.createTexture(null,!0,!0,null,h.a.TEXTURE_NEAREST_SAMPLINGMODE,null,function(e){s(e)},l);f.getEffect().executeWhenCompiled(function(){f.onApply=function(e){e._bindTexture("textureSampler",o),e.setFloat2("scale",1,1)},n.scenes[0].postProcessManager.directRender([f],d,!0,i,r),n.restoreDefaultFramebuffer(),o.dispose(),window.URL.revokeObjectURL(u),t()})}else{if(n._uploadImageToTexture(e,l,i,r),c){var g=p[r];g&&n._uploadImageToTexture(g._texture,l,i,0)}t()}},l.onerror=function(e){s(e)}});T.push(g)},s=0;s<6;s++)i(s)};for(y=0;y<t.length;y++)D(y);if(t.length<r){var A=void 0,I=Math.pow(2,r-1-t.length),B=I*I*4;switch(e.type){case h.a.TEXTURETYPE_UNSIGNED_INT:A=new Uint8Array(B);break;case h.a.TEXTURETYPE_HALF_FLOAT:A=new Uint16Array(B);break;case h.a.TEXTURETYPE_FLOAT:A=new Float32Array(B)}for(y=t.length;y<r;y++)for(var w=0;w<6;w++)n._uploadArrayBufferViewToTexture(e,A,w,y)}return Promise.all(T).then(function(){d&&(n._releaseFramebufferObjects(d),d._swapAndDie(e)),f&&f.dispose(),c&&(e._lodTextureHigh&&e._lodTextureHigh._texture&&(e._lodTextureHigh._texture.isReady=!0),e._lodTextureMid&&e._lodTextureMid._texture&&(e._lodTextureMid._texture.isReady=!0),e._lodTextureLow&&e._lodTextureLow._texture&&(e._lodTextureLow._texture.isReady=!0))})},e.UploadEnvSpherical=function(e,t){1!==t.version&&f.a.Warn('Unsupported babylon environment map version "'+t.version+'"');var r=t.irradiance;if(r){var i=new a.b;n.Vector3.FromArrayToRef(r.x,0,i.x),n.Vector3.FromArrayToRef(r.y,0,i.y),n.Vector3.FromArrayToRef(r.z,0,i.z),n.Vector3.FromArrayToRef(r.xx,0,i.xx),n.Vector3.FromArrayToRef(r.yy,0,i.yy),n.Vector3.FromArrayToRef(r.zz,0,i.zz),n.Vector3.FromArrayToRef(r.yz,0,i.yz),n.Vector3.FromArrayToRef(r.zx,0,i.zx),n.Vector3.FromArrayToRef(r.xy,0,i.xy),e._sphericalPolynomial=i}},e._UpdateRGBDAsync=function(t,r,i,n,s){return t._dataSource=o.a.DATASOURCE_CUBERAW_RGBD,t._bufferViewArrayArray=r,t._lodGenerationScale=n,t._lodGenerationOffset=s,t._sphericalPolynomial=i,e.UploadLevelsAsync(t,r).then(function(){t.isReady=!0})},e._MagicBytes=[134,22,135,150,246,214,150,54],e}());o.a._UpdateRGBDAsync=d._UpdateRGBDAsync},113:function(e,t,r){"use strict";r.d(t,"a",function(){return i});var i=function(){function e(){var e=this;this.promise=new Promise(function(t,r){e._resolve=t,e._reject=r})}return Object.defineProperty(e.prototype,"resolve",{get:function(){return this._resolve},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"reject",{get:function(){return this._reject},enumerable:!0,configurable:!0}),e}()},117:function(e,t,r){"use strict";r.d(t,"a",function(){return u});var i=r(1),n=r(9),s=r(23),a=r(10),o=r(41);a.Mesh._instancedMeshFactory=function(e,t){return new u(e,t)};var u=function(e){function t(t,r){var i=e.call(this,t,r.getScene())||this;return i._indexInSourceMeshInstanceArray=-1,r.addInstance(i),i._sourceMesh=r,i.position.copyFrom(r.position),i.rotation.copyFrom(r.rotation),i.scaling.copyFrom(r.scaling),r.rotationQuaternion&&(i.rotationQuaternion=r.rotationQuaternion.clone()),i.infiniteDistance=r.infiniteDistance,i.setPivotMatrix(r.getPivotMatrix()),i.refreshBoundingInfo(),i._syncSubMeshes(),i}return i.d(t,e),t.prototype.getClassName=function(){return"InstancedMesh"},Object.defineProperty(t.prototype,"receiveShadows",{get:function(){return this._sourceMesh.receiveShadows},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"material",{get:function(){return this._sourceMesh.material},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"visibility",{get:function(){return this._sourceMesh.visibility},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"skeleton",{get:function(){return this._sourceMesh.skeleton},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderingGroupId",{get:function(){return this._sourceMesh.renderingGroupId},set:function(e){this._sourceMesh&&e!==this._sourceMesh.renderingGroupId&&n.a.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene")},enumerable:!0,configurable:!0}),t.prototype.getTotalVertices=function(){return this._sourceMesh.getTotalVertices()},t.prototype.getTotalIndices=function(){return this._sourceMesh.getTotalIndices()},Object.defineProperty(t.prototype,"sourceMesh",{get:function(){return this._sourceMesh},enumerable:!0,configurable:!0}),t.prototype.isReady=function(e){return void 0===e&&(e=!1),this._sourceMesh.isReady(e,!0)},t.prototype.getVerticesData=function(e,t){return this._sourceMesh.getVerticesData(e,t)},t.prototype.setVerticesData=function(e,t,r,i){return this.sourceMesh&&this.sourceMesh.setVerticesData(e,t,r,i),this.sourceMesh},t.prototype.updateVerticesData=function(e,t,r,i){return this.sourceMesh&&this.sourceMesh.updateVerticesData(e,t,r,i),this.sourceMesh},t.prototype.setIndices=function(e,t){return void 0===t&&(t=null),this.sourceMesh&&this.sourceMesh.setIndices(e,t),this.sourceMesh},t.prototype.isVerticesDataPresent=function(e){return this._sourceMesh.isVerticesDataPresent(e)},t.prototype.getIndices=function(){return this._sourceMesh.getIndices()},Object.defineProperty(t.prototype,"_positions",{get:function(){return this._sourceMesh._positions},enumerable:!0,configurable:!0}),t.prototype.refreshBoundingInfo=function(e){if(void 0===e&&(e=!1),this._boundingInfo&&this._boundingInfo.isLocked)return this;var t=this._sourceMesh.geometry?this._sourceMesh.geometry.boundingBias:null;return this._refreshBoundingInfo(this._sourceMesh._getPositionData(e),t),this},t.prototype._preActivate=function(){return this._currentLOD&&this._currentLOD._preActivate(),this},t.prototype._activate=function(e){return this._currentLOD&&this._currentLOD._registerInstanceForRenderId(this,e),this},t.prototype.getLOD=function(e){if(!e)return this;var t=this.getBoundingInfo();return this._currentLOD=this.sourceMesh.getLOD(e,t.boundingSphere),this._currentLOD===this.sourceMesh?this:this._currentLOD},t.prototype._syncSubMeshes=function(){if(this.releaseSubMeshes(),this._sourceMesh.subMeshes)for(var e=0;e<this._sourceMesh.subMeshes.length;e++)this._sourceMesh.subMeshes[e].clone(this,this._sourceMesh);return this},t.prototype._generatePointsArray=function(){return this._sourceMesh._generatePointsArray()},t.prototype.clone=function(e,t,r){var i=this._sourceMesh.createInstance(e);if(o.a.DeepCopy(this,i,["name","subMeshes","uniqueId"],[]),this.refreshBoundingInfo(),t&&(i.parent=t),!r)for(var n=0;n<this.getScene().meshes.length;n++){var s=this.getScene().meshes[n];s.parent===this&&s.clone(s.name,i)}return i.computeWorldMatrix(!0),i},t.prototype.dispose=function(t,r){void 0===r&&(r=!1),this._sourceMesh.removeInstance(this),e.prototype.dispose.call(this,t,r)},t}(s.a)},134:function(e,t,r){"use strict";r.d(t,"a",function(){return c}),r.d(t,"b",function(){return l});var i=r(1),n=r(9),s=r(0),a=r(3),o=r(10),u=function(e){function t(t,r){var i=e.call(this,t.x,t.y)||this;return i.index=r,i}return i.d(t,e),t}(s.Vector2),h=function(){function e(){this.elements=new Array}return e.prototype.add=function(e){var t=this,r=new Array;return e.forEach(function(e){if(0===r.length||!e.equalsWithEpsilon(r[0])){var i=new u(e,t.elements.length);r.push(i),t.elements.push(i)}}),r},e.prototype.computeBounds=function(){var e=new s.Vector2(this.elements[0].x,this.elements[0].y),t=new s.Vector2(this.elements[0].x,this.elements[0].y);return this.elements.forEach(function(r){r.x<e.x?e.x=r.x:r.x>t.x&&(t.x=r.x),r.y<e.y?e.y=r.y:r.y>t.y&&(t.y=r.y)}),{min:e,max:t,width:t.x-e.x,height:t.y-e.y}},e}(),c=function(){function e(){}return e.Rectangle=function(e,t,r,i){return[new s.Vector2(e,t),new s.Vector2(r,t),new s.Vector2(r,i),new s.Vector2(e,i)]},e.Circle=function(e,t,r,i){void 0===t&&(t=0),void 0===r&&(r=0),void 0===i&&(i=32);for(var n=new Array,a=0,o=2*Math.PI/i,u=0;u<i;u++)n.push(new s.Vector2(t+Math.cos(a)*e,r+Math.sin(a)*e)),a-=o;return n},e.Parse=function(e){var t,r=e.split(/[^-+eE\.\d]+/).map(parseFloat).filter(function(e){return!isNaN(e)}),i=[];for(t=0;t<(2147483646&r.length);t+=2)i.push(new s.Vector2(r[t],r[t+1]));return i},e.StartingAt=function(e,t){return s.Path2.StartingAt(e,t)},e}(),l=function(){function e(e,t,r,i){var a;void 0===i&&(i=earcut),this._points=new h,this._outlinepoints=new h,this._holes=new Array,this._epoints=new Array,this._eholes=new Array,this.bjsEarcut=i,this._name=e,this._scene=r,a=t instanceof s.Path2?t.getPoints():t,this._addToepoint(a),this._points.add(a),this._outlinepoints.add(a),void 0===this.bjsEarcut&&n.a.Warn("Earcut was not found, the polygon will not be built.")}return e.prototype._addToepoint=function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t];this._epoints.push(i.x,i.y)}},e.prototype.addHole=function(e){this._points.add(e);var t=new h;return t.add(e),this._holes.push(t),this._eholes.push(this._epoints.length/2),this._addToepoint(e),this},e.prototype.build=function(e,t){var r=this;void 0===e&&(e=!1),void 0===t&&(t=0);var i=new o.Mesh(this._name,this._scene),n=new Array,s=new Array,u=new Array,h=this._points.computeBounds();this._points.elements.forEach(function(e){n.push(0,1,0),s.push(e.x,0,e.y),u.push((e.x-h.min.x)/h.width,(e.y-h.min.y)/h.height)});for(var c=new Array,l=this.bjsEarcut(this._epoints,this._eholes,2),f=0;f<l.length;f++)c.push(l[f]);if(t>0){var d=s.length/3;this._points.elements.forEach(function(e){n.push(0,-1,0),s.push(e.x,-t,e.y),u.push(1-(e.x-h.min.x)/h.width,1-(e.y-h.min.y)/h.height)});var p=c.length;for(f=0;f<p;f+=3){var g=c[f+0],m=c[f+1],v=c[f+2];c.push(v+d),c.push(m+d),c.push(g+d)}this.addSide(s,n,u,c,h,this._outlinepoints,t,!1),this._holes.forEach(function(e){r.addSide(s,n,u,c,h,e,t,!0)})}return i.setVerticesData(a.VertexBuffer.PositionKind,s,e),i.setVerticesData(a.VertexBuffer.NormalKind,n,e),i.setVerticesData(a.VertexBuffer.UVKind,u,e),i.setIndices(c),i},e.prototype.addSide=function(e,t,r,i,n,a,o,u){for(var h=e.length/3,c=0,l=0;l<a.elements.length;l++){var f,d=a.elements[l];f=l+1>a.elements.length-1?a.elements[0]:a.elements[l+1],e.push(d.x,0,d.y),e.push(d.x,-o,d.y),e.push(f.x,0,f.y),e.push(f.x,-o,f.y);var p=new s.Vector3(d.x,0,d.y),g=new s.Vector3(f.x,0,f.y).subtract(p),m=new s.Vector3(0,1,0),v=s.Vector3.Cross(g,m);v=v.normalize(),r.push(c/n.width,0),r.push(c/n.width,1),c+=g.length(),r.push(c/n.width,0),r.push(c/n.width,1),u?(t.push(v.x,v.y,v.z),t.push(v.x,v.y,v.z),t.push(v.x,v.y,v.z),t.push(v.x,v.y,v.z),i.push(h),i.push(h+2),i.push(h+1),i.push(h+1),i.push(h+2),i.push(h+3)):(t.push(-v.x,-v.y,-v.z),t.push(-v.x,-v.y,-v.z),t.push(-v.x,-v.y,-v.z),t.push(-v.x,-v.y,-v.z),i.push(h),i.push(h+1),i.push(h+2),i.push(h+1),i.push(h+3),i.push(h+2)),h+=4}},e}()},148:function(e,t,r){"use strict";r.d(t,"a",function(){return o});var i=r(1),n=r(0),s=r(3),a=r(10);a.Mesh._GroundMeshParser=function(e,t){return o.Parse(e,t)};var o=function(e){function t(t,r){var i=e.call(this,t,r)||this;return i.generateOctree=!1,i}return i.d(t,e),t.prototype.getClassName=function(){return"GroundMesh"},Object.defineProperty(t.prototype,"subdivisions",{get:function(){return Math.min(this._subdivisionsX,this._subdivisionsY)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"subdivisionsX",{get:function(){return this._subdivisionsX},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"subdivisionsY",{get:function(){return this._subdivisionsY},enumerable:!0,configurable:!0}),t.prototype.optimize=function(e,t){void 0===t&&(t=32),this._subdivisionsX=e,this._subdivisionsY=e,this.subdivide(e);this.createOrUpdateSubmeshesOctree&&this.createOrUpdateSubmeshesOctree(t)},t.prototype.getHeightAtCoordinates=function(e,t){var r=this.getWorldMatrix(),i=n.Tmp.Matrix[5];r.invertToRef(i);var s=n.Tmp.Vector3[8];if(n.Vector3.TransformCoordinatesFromFloatsToRef(e,0,t,i,s),e=s.x,t=s.z,e<this._minX||e>this._maxX||t<this._minZ||t>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());var a=this._getFacetAt(e,t),o=-(a.x*e+a.z*t+a.w)/a.y;return n.Vector3.TransformCoordinatesFromFloatsToRef(0,o,0,r,s),s.y},t.prototype.getNormalAtCoordinates=function(e,t){var r=new n.Vector3(0,1,0);return this.getNormalAtCoordinatesToRef(e,t,r),r},t.prototype.getNormalAtCoordinatesToRef=function(e,t,r){var i=this.getWorldMatrix(),s=n.Tmp.Matrix[5];i.invertToRef(s);var a=n.Tmp.Vector3[8];if(n.Vector3.TransformCoordinatesFromFloatsToRef(e,0,t,s,a),e=a.x,t=a.z,e<this._minX||e>this._maxX||t<this._minZ||t>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());var o=this._getFacetAt(e,t);return n.Vector3.TransformNormalFromFloatsToRef(o.x,o.y,o.z,i,r),this},t.prototype.updateCoordinateHeights=function(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this},t.prototype._getFacetAt=function(e,t){var r=Math.floor((e+this._maxX)*this._subdivisionsX/this._width),i=Math.floor(-(t+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),n=this._heightQuads[i*this._subdivisionsX+r];return t<n.slope.x*e+n.slope.y?n.facet1:n.facet2},t.prototype._initHeightQuads=function(){var e=this._subdivisionsX,t=this._subdivisionsY;this._heightQuads=new Array;for(var r=0;r<t;r++)for(var i=0;i<e;i++){var s={slope:n.Vector2.Zero(),facet1:new n.Vector4(0,0,0,0),facet2:new n.Vector4(0,0,0,0)};this._heightQuads[r*e+i]=s}return this},t.prototype._computeHeightQuads=function(){var e=this.getVerticesData(s.VertexBuffer.PositionKind);if(!e)return this;for(var t=n.Tmp.Vector3[3],r=n.Tmp.Vector3[2],i=n.Tmp.Vector3[1],a=n.Tmp.Vector3[0],o=n.Tmp.Vector3[4],u=n.Tmp.Vector3[5],h=n.Tmp.Vector3[6],c=n.Tmp.Vector3[7],l=n.Tmp.Vector3[8],f=0,d=0,p=0,g=0,m=0,v=0,y=0,_=this._subdivisionsX,x=this._subdivisionsY,b=0;b<x;b++)for(var V=0;V<_;V++){f=3*V,d=b*(_+1)*3,p=(b+1)*(_+1)*3,t.x=e[d+f],t.y=e[d+f+1],t.z=e[d+f+2],r.x=e[d+f+3],r.y=e[d+f+4],r.z=e[d+f+5],i.x=e[p+f],i.y=e[p+f+1],i.z=e[p+f+2],a.x=e[p+f+3],a.y=e[p+f+4],a.z=e[p+f+5],g=(a.z-t.z)/(a.x-t.x),m=t.z-g*t.x,r.subtractToRef(t,o),i.subtractToRef(t,u),a.subtractToRef(t,h),n.Vector3.CrossToRef(h,u,c),n.Vector3.CrossToRef(o,h,l),c.normalize(),l.normalize(),v=-(c.x*t.x+c.y*t.y+c.z*t.z),y=-(l.x*r.x+l.y*r.y+l.z*r.z);var M=this._heightQuads[b*_+V];M.slope.copyFromFloats(g,m),M.facet1.copyFromFloats(c.x,c.y,c.z,v),M.facet2.copyFromFloats(l.x,l.y,l.z,y)}return this},t.prototype.serialize=function(t){e.prototype.serialize.call(this,t),t.subdivisionsX=this._subdivisionsX,t.subdivisionsY=this._subdivisionsY,t.minX=this._minX,t.maxX=this._maxX,t.minZ=this._minZ,t.maxZ=this._maxZ,t.width=this._width,t.height=this._height},t.Parse=function(e,r){var i=new t(e.name,r);return i._subdivisionsX=e.subdivisionsX||1,i._subdivisionsY=e.subdivisionsY||1,i._minX=e.minX,i._maxX=e.maxX,i._minZ=e.minZ,i._maxZ=e.maxZ,i._width=e.width,i._height=e.height,i},t}(a.Mesh)},160:function(e,t,r){"use strict";r.d(t,"a",function(){return i});var i=function(){function e(){}return e.Eval=function(t,r){return"true"===(t=t.match(/\([^\(\)]*\)/g)?t.replace(/\([^\(\)]*\)/g,function(t){return t=t.slice(1,t.length-1),e._HandleParenthesisContent(t,r)}):e._HandleParenthesisContent(t,r))||"false"!==t&&e.Eval(t,r)},e._HandleParenthesisContent=function(t,r){var i;r=r||function(e){return"true"===e};var n=t.split("||");for(var s in n)if(n.hasOwnProperty(s)){var a=e._SimplifyNegation(n[s].trim()),o=a.split("&&");if(o.length>1)for(var u=0;u<o.length;++u){var h=e._SimplifyNegation(o[u].trim());if(!(i="true"!==h&&"false"!==h?"!"===h[0]?!r(h.substring(1)):r(h):"true"===h)){a="false";break}}if(i||"true"===a){i=!0;break}i="true"!==a&&"false"!==a?"!"===a[0]?!r(a.substring(1)):r(a):"true"===a}return i?"true":"false"},e._SimplifyNegation=function(e){return"!true"===(e=(e=e.replace(/^[\s!]+/,function(e){return(e=e.replace(/[\s]/g,function(){return""})).length%2?"!":""})).trim())?e="false":"!false"===e&&(e="true"),e},e}()},197:function(e,t,r){"use strict";r.d(t,"a",function(){return n});var i=r(198),n=function(){function e(){}return e.Ldexp=function(e,t){return t>1023?e*Math.pow(2,1023)*Math.pow(2,t-1023):t<-1074?e*Math.pow(2,-1074)*Math.pow(2,t+1074):e*Math.pow(2,t)},e.Rgbe2float=function(e,t,r,i,n,s){n>0?(n=this.Ldexp(1,n-136),e[s+0]=t*n,e[s+1]=r*n,e[s+2]=i*n):(e[s+0]=0,e[s+1]=0,e[s+2]=0)},e.readStringLine=function(e,t){for(var r="",i="",n=t;n<e.length-t&&"\n"!=(i=String.fromCharCode(e[n]));n++)r+=i;return r},e.RGBE_ReadHeader=function(e){var t,r,i=this.readStringLine(e,0);if("#"!=i[0]||"?"!=i[1])throw"Bad HDR Format.";var n=!1,s=!1,a=0;do{a+=i.length+1,"FORMAT=32-bit_rle_rgbe"==(i=this.readStringLine(e,a))?s=!0:0==i.length&&(n=!0)}while(!n);if(!s)throw"HDR Bad header format, unsupported FORMAT";a+=i.length+1,i=this.readStringLine(e,a);var o=/^\-Y (.*) \+X (.*)$/g.exec(i);if(!o||o.length<3)throw"HDR Bad header format, no size";if(r=parseInt(o[2]),t=parseInt(o[1]),r<8||r>32767)throw"HDR Bad header format, unsupported size";return{height:t,width:r,dataPosition:a+=i.length+1}},e.GetCubeMapTextureData=function(e,t){var r=new Uint8Array(e),n=this.RGBE_ReadHeader(r),s=this.RGBE_ReadPixels_RLE(r,n);return i.a.ConvertPanoramaToCubemap(s,n.width,n.height,t)},e.RGBE_ReadPixels=function(e,t){return this.RGBE_ReadPixels_RLE(e,t)},e.RGBE_ReadPixels_RLE=function(e,t){for(var r,i,n,s,a,o=t.height,u=t.width,h=t.dataPosition,c=0,l=0,f=0,d=new ArrayBuffer(4*u),p=new Uint8Array(d),g=new ArrayBuffer(t.width*t.height*4*3),m=new Float32Array(g);o>0;){if(r=e[h++],i=e[h++],n=e[h++],s=e[h++],2!=r||2!=i||128&n)throw"HDR Bad header format, not RLE";if((n<<8|s)!=u)throw"HDR Bad header format, wrong scan line width";for(c=0,f=0;f<4;f++)for(l=(f+1)*u;c<l;)if(r=e[h++],i=e[h++],r>128){if(0==(a=r-128)||a>l-c)throw"HDR Bad Format, bad scanline data (run)";for(;a-- >0;)p[c++]=i}else{if(0==(a=r)||a>l-c)throw"HDR Bad Format, bad scanline data (non-run)";if(p[c++]=i,--a>0)for(var v=0;v<a;v++)p[c++]=e[h++]}for(f=0;f<u;f++)r=p[f],i=p[f+u],n=p[f+2*u],s=p[f+3*u],this.Rgbe2float(m,r,i,n,s,(t.height-o)*u*3+3*f);o--}return m},e}()},198:function(e,t,r){"use strict";r.d(t,"a",function(){return s});var i=r(0),n=r(4),s=function(){function e(){}return e.ConvertPanoramaToCubemap=function(e,t,r,i){if(!e)throw"ConvertPanoramaToCubemap: input cannot be null";if(e.length!=t*r*3)throw"ConvertPanoramaToCubemap: input size is wrong";return{front:this.CreateCubemapTexture(i,this.FACE_FRONT,e,t,r),back:this.CreateCubemapTexture(i,this.FACE_BACK,e,t,r),left:this.CreateCubemapTexture(i,this.FACE_LEFT,e,t,r),right:this.CreateCubemapTexture(i,this.FACE_RIGHT,e,t,r),up:this.CreateCubemapTexture(i,this.FACE_UP,e,t,r),down:this.CreateCubemapTexture(i,this.FACE_DOWN,e,t,r),size:i,type:n.a.TEXTURETYPE_FLOAT,format:n.a.TEXTUREFORMAT_RGB,gammaSpace:!1}},e.CreateCubemapTexture=function(e,t,r,i,n){for(var s=new ArrayBuffer(e*e*4*3),a=new Float32Array(s),o=t[1].subtract(t[0]).scale(1/e),u=t[3].subtract(t[2]).scale(1/e),h=1/e,c=0,l=0;l<e;l++){for(var f=t[0],d=t[2],p=0;p<e;p++){var g=d.subtract(f).scale(c).add(f);g.normalize();var m=this.CalcProjectionSpherical(g,r,i,n);a[l*e*3+3*p+0]=m.r,a[l*e*3+3*p+1]=m.g,a[l*e*3+3*p+2]=m.b,f=f.add(o),d=d.add(u)}c+=h}return a},e.CalcProjectionSpherical=function(e,t,r,i){for(var n=Math.atan2(e.z,e.x),s=Math.acos(e.y);n<-Math.PI;)n+=2*Math.PI;for(;n>Math.PI;)n-=2*Math.PI;var a=n/Math.PI,o=s/Math.PI;a=.5*a+.5;var u=Math.round(a*r);u<0?u=0:u>=r&&(u=r-1);var h=Math.round(o*i);h<0?h=0:h>=i&&(h=i-1);var c=i-h-1;return{r:t[c*r*3+3*u+0],g:t[c*r*3+3*u+1],b:t[c*r*3+3*u+2]}},e.FACE_FRONT=[new i.Vector3(-1,-1,-1),new i.Vector3(1,-1,-1),new i.Vector3(-1,1,-1),new i.Vector3(1,1,-1)],e.FACE_BACK=[new i.Vector3(1,-1,1),new i.Vector3(-1,-1,1),new i.Vector3(1,1,1),new i.Vector3(-1,1,1)],e.FACE_RIGHT=[new i.Vector3(1,-1,-1),new i.Vector3(1,-1,1),new i.Vector3(1,1,-1),new i.Vector3(1,1,1)],e.FACE_LEFT=[new i.Vector3(-1,-1,1),new i.Vector3(-1,-1,-1),new i.Vector3(-1,1,1),new i.Vector3(-1,1,-1)],e.FACE_DOWN=[new i.Vector3(-1,1,-1),new i.Vector3(1,1,-1),new i.Vector3(-1,1,1),new i.Vector3(1,1,1)],e.FACE_UP=[new i.Vector3(-1,-1,1),new i.Vector3(1,-1,1),new i.Vector3(-1,-1,-1),new i.Vector3(1,-1,-1)],e}()},2:function(e,t,r){"use strict";r.d(t,"b",function(){return c}),r.d(t,"c",function(){return l}),r.d(t,"l",function(){return f}),r.d(t,"e",function(){return d}),r.d(t,"h",function(){return p}),r.d(t,"m",function(){return g}),r.d(t,"n",function(){return m}),r.d(t,"j",function(){return v}),r.d(t,"g",function(){return y}),r.d(t,"f",function(){return _}),r.d(t,"i",function(){return x}),r.d(t,"k",function(){return b}),r.d(t,"d",function(){return V}),r.d(t,"a",function(){return M});var i=r(27),n=r(0),s={},a={},o=function(e,t,r){var n=e();i.a&&i.a.AddTagsTo(n,t.tags);var s=u(n);for(var a in s){var o=s[a],h=t[a],c=o.type;if(null!=h)switch(c){case 0:case 6:case 11:n[a]=h;break;case 1:n[a]=r||h.isRenderTarget?h:h.clone();break;case 2:case 3:case 4:case 5:case 7:case 10:n[a]=r?h:h.clone()}}return n};function u(e){var t=e.getClassName();if(a[t])return a[t];a[t]={};for(var r=a[t],i=e,n=t;n;){var o=s[n];for(var u in o)r[u]=o[u];var h=void 0,c=!1;do{if(!(h=Object.getPrototypeOf(i)).getClassName){c=!0;break}if(h.getClassName()!==n)break;i=h}while(h);if(c)break;n=h.getClassName(),i=h}return r}function h(e,t){return function(r,i){var n=function(e){var t=e.getClassName();return s[t]||(s[t]={}),s[t]}(r);n[i]||(n[i]={type:e,sourceName:t})}}function c(e,t){return void 0===t&&(t=null),function(e,t){return void 0===t&&(t=null),function(r,i){var n=t||"_"+i;Object.defineProperty(r,i,{get:function(){return this[n]},set:function(t){this[n]!==t&&(this[n]=t,r[e].apply(this))},enumerable:!0,configurable:!0})}}(e,t)}function l(e){return h(0,e)}function f(e){return h(1,e)}function d(e){return h(2,e)}function p(e){return h(3,e)}function g(e){return h(4,e)}function m(e){return h(5,e)}function v(e){return h(6,e)}function y(e){return h(7,e)}function _(e){return h(8,e)}function x(e){return h(9,e)}function b(e){return h(10,e)}function V(e){return h(11,e)}var M=function(){function e(){}return e.AppendSerializedAnimations=function(e,t){if(e.animations){t.animations=[];for(var r=0;r<e.animations.length;r++){var i=e.animations[r];t.animations.push(i.serialize())}}},e.Serialize=function(e,t){t||(t={}),i.a&&(t.tags=i.a.GetTags(e));var r=u(e);for(var n in r){var s=r[n],a=s.sourceName||n,o=s.type,h=e[n];if(null!=h)switch(o){case 0:t[a]=h;break;case 1:t[a]=h.serialize();break;case 2:t[a]=h.asArray();break;case 3:t[a]=h.serialize();break;case 4:case 5:t[a]=h.asArray();break;case 6:t[a]=h.id;break;case 7:t[a]=h.serialize();break;case 8:t[a]=h.asArray();break;case 9:t[a]=h.serialize();break;case 10:t[a]=h.asArray();break;case 11:t[a]=h.id}}return t},e.Parse=function(t,r,s,a){void 0===a&&(a=null);var o=t();a||(a=""),i.a&&i.a.AddTagsTo(o,r.tags);var h=u(o);for(var c in h){var l=h[c],f=r[l.sourceName||c],d=l.type;if(null!=f){var p=o;switch(d){case 0:p[c]=f;break;case 1:s&&(p[c]=e._TextureParser(f,s,a));break;case 2:p[c]=n.Color3.FromArray(f);break;case 3:p[c]=e._FresnelParametersParser(f);break;case 4:p[c]=n.Vector2.FromArray(f);break;case 5:p[c]=n.Vector3.FromArray(f);break;case 6:s&&(p[c]=s.getLastMeshByID(f));break;case 7:p[c]=e._ColorCurvesParser(f);break;case 8:p[c]=n.Color4.FromArray(f);break;case 9:p[c]=e._ImageProcessingConfigurationParser(f);break;case 10:p[c]=n.Quaternion.FromArray(f);break;case 11:s&&(p[c]=s.getCameraByID(f))}}}return o},e.Clone=function(e,t){return o(e,t,!1)},e.Instanciate=function(e,t){return o(e,t,!0)},e._ImageProcessingConfigurationParser=function(e){throw"ImageProcessingConfiguration needs to be imported before being deserialized."},e._FresnelParametersParser=function(e){throw"FresnelParameters needs to be imported before being deserialized."},e._ColorCurvesParser=function(e){throw"ColorCurves needs to be imported before being deserialized."},e._TextureParser=function(e,t,r){throw"Texture needs to be imported before being deserialized."},e}()},213:function(e,t,r){"use strict";r.r(t),r.d(t,"AssetTaskState",function(){return i}),r.d(t,"AbstractAssetTask",function(){return f}),r.d(t,"AssetsProgressEvent",function(){return d}),r.d(t,"MeshAssetTask",function(){return p}),r.d(t,"TextFileAssetTask",function(){return g}),r.d(t,"BinaryFileAssetTask",function(){return m}),r.d(t,"ImageAssetTask",function(){return v}),r.d(t,"TextureAssetTask",function(){return y}),r.d(t,"CubeTextureAssetTask",function(){return _}),r.d(t,"HDRCubeTextureAssetTask",function(){return x}),r.d(t,"AssetsManager",function(){return b});var i,n=r(1),s=r(29),a=r(5),o=r(7),u=r(6),h=r(83),c=r(135),l=r(9);!function(e){e[e.INIT=0]="INIT",e[e.RUNNING=1]="RUNNING",e[e.DONE=2]="DONE",e[e.ERROR=3]="ERROR"}(i||(i={}));var f=function(){function e(e){this.name=e,this._isCompleted=!1,this._taskState=i.INIT}return Object.defineProperty(e.prototype,"isCompleted",{get:function(){return this._isCompleted},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"taskState",{get:function(){return this._taskState},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"errorObject",{get:function(){return this._errorObject},enumerable:!0,configurable:!0}),e.prototype._setErrorObject=function(e,t){this._errorObject||(this._errorObject={message:e,exception:t})},e.prototype.run=function(e,t,r){var n=this;this._taskState=i.RUNNING,this.runTask(e,function(){n.onDoneCallback(t,r)},function(e,t){n.onErrorCallback(r,e,t)})},e.prototype.runTask=function(e,t,r){throw new Error("runTask is not implemented")},e.prototype.reset=function(){this._taskState=i.INIT},e.prototype.onErrorCallback=function(e,t,r){this._taskState=i.ERROR,this._errorObject={message:t,exception:r},this.onError&&this.onError(this,t,r),e()},e.prototype.onDoneCallback=function(e,t){try{this._taskState=i.DONE,this._isCompleted=!0,this.onSuccess&&this.onSuccess(this),e()}catch(e){this.onErrorCallback(t,"Task is done, error executing success callback(s)",e)}},e}(),d=function(){return function(e,t,r){this.remainingCount=e,this.totalCount=t,this.task=r}}(),p=function(e){function t(t,r,i,n){var s=e.call(this,t)||this;return s.name=t,s.meshesNames=r,s.rootUrl=i,s.sceneFilename=n,s}return n.d(t,e),t.prototype.runTask=function(e,t,r){var i=this;s.a.ImportMesh(this.meshesNames,this.rootUrl,this.sceneFilename,e,function(e,r,n,s){i.loadedMeshes=e,i.loadedParticleSystems=r,i.loadedSkeletons=n,i.loadedAnimationGroups=s,t()},null,function(e,t,i){r(t,i)})},t}(f),g=function(e){function t(t,r){var i=e.call(this,t)||this;return i.name=t,i.url=r,i}return n.d(t,e),t.prototype.runTask=function(e,t,r){var i=this;e._loadFile(this.url,function(e){i.text=e,t()},void 0,!1,!1,function(e,t){e&&r(e.status+" "+e.statusText,t)})},t}(f),m=function(e){function t(t,r){var i=e.call(this,t)||this;return i.name=t,i.url=r,i}return n.d(t,e),t.prototype.runTask=function(e,t,r){var i=this;e._loadFile(this.url,function(e){i.data=e,t()},void 0,!0,!0,function(e,t){e&&r(e.status+" "+e.statusText,t)})},t}(f),v=function(e){function t(t,r){var i=e.call(this,t)||this;return i.name=t,i.url=r,i}return n.d(t,e),t.prototype.runTask=function(e,t,r){var i=this,n=new Image;a.h.SetCorsBehavior(this.url,n),n.onload=function(){i.image=n,t()},n.onerror=function(e){r("Error loading image",e)},n.src=this.url},t}(f),y=function(e){function t(t,r,i,n,s){void 0===s&&(s=u.a.TRILINEAR_SAMPLINGMODE);var a=e.call(this,t)||this;return a.name=t,a.url=r,a.noMipmap=i,a.invertY=n,a.samplingMode=s,a}return n.d(t,e),t.prototype.runTask=function(e,t,r){this.texture=new u.a(this.url,e,this.noMipmap,this.invertY,this.samplingMode,function(){t()},function(e,t){r(e,t)})},t}(f),_=function(e){function t(t,r,i,n,s){var a=e.call(this,t)||this;return a.name=t,a.url=r,a.extensions=i,a.noMipmap=n,a.files=s,a}return n.d(t,e),t.prototype.runTask=function(e,t,r){this.texture=new h.a(this.url,e,this.extensions,this.noMipmap,this.files,function(){t()},function(e,t){r(e,t)})},t}(f),x=function(e){function t(t,r,i,n,s,a,o){void 0===n&&(n=!1),void 0===s&&(s=!0),void 0===a&&(a=!1),void 0===o&&(o=!1);var u=e.call(this,t)||this;return u.name=t,u.url=r,u.size=i,u.noMipmap=n,u.generateHarmonics=s,u.gammaSpace=a,u.reserved=o,u}return n.d(t,e),t.prototype.run=function(e,t,r){this.texture=new c.a(this.url,e,this.size,this.noMipmap,this.generateHarmonics,this.gammaSpace,this.reserved,function(){t()},function(e,t){r(e,t)})},t}(f),b=function(){function e(e){this._isLoading=!1,this._tasks=new Array,this._waitingTasksCount=0,this._totalTasksCount=0,this.onTaskSuccessObservable=new o.c,this.onTaskErrorObservable=new o.c,this.onTasksDoneObservable=new o.c,this.onProgressObservable=new o.c,this.useDefaultLoadingScreen=!0,this._scene=e}return e.prototype.addMeshTask=function(e,t,r,i){var n=new p(e,t,r,i);return this._tasks.push(n),n},e.prototype.addTextFileTask=function(e,t){var r=new g(e,t);return this._tasks.push(r),r},e.prototype.addBinaryFileTask=function(e,t){var r=new m(e,t);return this._tasks.push(r),r},e.prototype.addImageTask=function(e,t){var r=new v(e,t);return this._tasks.push(r),r},e.prototype.addTextureTask=function(e,t,r,i,n){void 0===n&&(n=u.a.TRILINEAR_SAMPLINGMODE);var s=new y(e,t,r,i,n);return this._tasks.push(s),s},e.prototype.addCubeTextureTask=function(e,t,r,i,n){var s=new _(e,t,r,i,n);return this._tasks.push(s),s},e.prototype.addHDRCubeTextureTask=function(e,t,r,i,n,s,a){void 0===i&&(i=!1),void 0===n&&(n=!0),void 0===s&&(s=!1),void 0===a&&(a=!1);var o=new x(e,t,r,i,n,s,a);return this._tasks.push(o),o},e.prototype.removeTask=function(e){var t=this._tasks.indexOf(e);t>-1&&this._tasks.splice(t,1)},e.prototype._decreaseWaitingTasksCount=function(e){this._waitingTasksCount--;try{this.onProgress&&this.onProgress(this._waitingTasksCount,this._totalTasksCount,e),this.onProgressObservable.notifyObservers(new d(this._waitingTasksCount,this._totalTasksCount,e))}catch(e){l.a.Error("Error running progress callbacks."),console.log(e)}if(0===this._waitingTasksCount){try{this.onFinish&&this.onFinish(this._tasks);for(var t=this._tasks.slice(),r=0,n=t;r<n.length;r++){if((e=n[r]).taskState===i.DONE){var s=this._tasks.indexOf(e);s>-1&&this._tasks.splice(s,1)}}this.onTasksDoneObservable.notifyObservers(this._tasks)}catch(e){l.a.Error("Error running tasks-done callbacks."),console.log(e)}this._isLoading=!1,this._scene.getEngine().hideLoadingUI()}},e.prototype._runTask=function(e){var t=this,r=function(r,i){e._setErrorObject(r,i),t.onTaskError&&t.onTaskError(e),t.onTaskErrorObservable.notifyObservers(e),t._decreaseWaitingTasksCount(e)};e.run(this._scene,function(){try{t.onTaskSuccess&&t.onTaskSuccess(e),t.onTaskSuccessObservable.notifyObservers(e),t._decreaseWaitingTasksCount(e)}catch(e){r("Error executing task success callbacks",e)}},r)},e.prototype.reset=function(){return this._isLoading=!1,this._tasks=new Array,this},e.prototype.load=function(){if(this._isLoading)return this;if(this._isLoading=!0,this._waitingTasksCount=this._tasks.length,this._totalTasksCount=this._tasks.length,0===this._waitingTasksCount)return this._isLoading=!1,this.onFinish&&this.onFinish(this._tasks),this.onTasksDoneObservable.notifyObservers(this._tasks),this;this.useDefaultLoadingScreen&&this._scene.getEngine().displayLoadingUI();for(var e=0;e<this._tasks.length;e++){var t=this._tasks[e];t.taskState===i.INIT&&this._runTask(t)}return this},e}()},24:function(e,t,r){"use strict";r.r(t),r.d(t,"VertexData",function(){return s});var i=r(0),n=r(3),s=function(){function e(){}return e.prototype.set=function(e,t){switch(t){case n.VertexBuffer.PositionKind:this.positions=e;break;case n.VertexBuffer.NormalKind:this.normals=e;break;case n.VertexBuffer.TangentKind:this.tangents=e;break;case n.VertexBuffer.UVKind:this.uvs=e;break;case n.VertexBuffer.UV2Kind:this.uvs2=e;break;case n.VertexBuffer.UV3Kind:this.uvs3=e;break;case n.VertexBuffer.UV4Kind:this.uvs4=e;break;case n.VertexBuffer.UV5Kind:this.uvs5=e;break;case n.VertexBuffer.UV6Kind:this.uvs6=e;break;case n.VertexBuffer.ColorKind:this.colors=e;break;case n.VertexBuffer.MatricesIndicesKind:this.matricesIndices=e;break;case n.VertexBuffer.MatricesWeightsKind:this.matricesWeights=e;break;case n.VertexBuffer.MatricesIndicesExtraKind:this.matricesIndicesExtra=e;break;case n.VertexBuffer.MatricesWeightsExtraKind:this.matricesWeightsExtra=e}},e.prototype.applyToMesh=function(e,t){return this._applyTo(e,t),this},e.prototype.applyToGeometry=function(e,t){return this._applyTo(e,t),this},e.prototype.updateMesh=function(e){return this._update(e),this},e.prototype.updateGeometry=function(e){return this._update(e),this},e.prototype._applyTo=function(e,t){return void 0===t&&(t=!1),this.positions&&e.setVerticesData(n.VertexBuffer.PositionKind,this.positions,t),this.normals&&e.setVerticesData(n.VertexBuffer.NormalKind,this.normals,t),this.tangents&&e.setVerticesData(n.VertexBuffer.TangentKind,this.tangents,t),this.uvs&&e.setVerticesData(n.VertexBuffer.UVKind,this.uvs,t),this.uvs2&&e.setVerticesData(n.VertexBuffer.UV2Kind,this.uvs2,t),this.uvs3&&e.setVerticesData(n.VertexBuffer.UV3Kind,this.uvs3,t),this.uvs4&&e.setVerticesData(n.VertexBuffer.UV4Kind,this.uvs4,t),this.uvs5&&e.setVerticesData(n.VertexBuffer.UV5Kind,this.uvs5,t),this.uvs6&&e.setVerticesData(n.VertexBuffer.UV6Kind,this.uvs6,t),this.colors&&e.setVerticesData(n.VertexBuffer.ColorKind,this.colors,t),this.matricesIndices&&e.setVerticesData(n.VertexBuffer.MatricesIndicesKind,this.matricesIndices,t),this.matricesWeights&&e.setVerticesData(n.VertexBuffer.MatricesWeightsKind,this.matricesWeights,t),this.matricesIndicesExtra&&e.setVerticesData(n.VertexBuffer.MatricesIndicesExtraKind,this.matricesIndicesExtra,t),this.matricesWeightsExtra&&e.setVerticesData(n.VertexBuffer.MatricesWeightsExtraKind,this.matricesWeightsExtra,t),this.indices?e.setIndices(this.indices,null,t):e.setIndices([],null),this},e.prototype._update=function(e,t,r){return this.positions&&e.updateVerticesData(n.VertexBuffer.PositionKind,this.positions,t,r),this.normals&&e.updateVerticesData(n.VertexBuffer.NormalKind,this.normals,t,r),this.tangents&&e.updateVerticesData(n.VertexBuffer.TangentKind,this.tangents,t,r),this.uvs&&e.updateVerticesData(n.VertexBuffer.UVKind,this.uvs,t,r),this.uvs2&&e.updateVerticesData(n.VertexBuffer.UV2Kind,this.uvs2,t,r),this.uvs3&&e.updateVerticesData(n.VertexBuffer.UV3Kind,this.uvs3,t,r),this.uvs4&&e.updateVerticesData(n.VertexBuffer.UV4Kind,this.uvs4,t,r),this.uvs5&&e.updateVerticesData(n.VertexBuffer.UV5Kind,this.uvs5,t,r),this.uvs6&&e.updateVerticesData(n.VertexBuffer.UV6Kind,this.uvs6,t,r),this.colors&&e.updateVerticesData(n.VertexBuffer.ColorKind,this.colors,t,r),this.matricesIndices&&e.updateVerticesData(n.VertexBuffer.MatricesIndicesKind,this.matricesIndices,t,r),this.matricesWeights&&e.updateVerticesData(n.VertexBuffer.MatricesWeightsKind,this.matricesWeights,t,r),this.matricesIndicesExtra&&e.updateVerticesData(n.VertexBuffer.MatricesIndicesExtraKind,this.matricesIndicesExtra,t,r),this.matricesWeightsExtra&&e.updateVerticesData(n.VertexBuffer.MatricesWeightsExtraKind,this.matricesWeightsExtra,t,r),this.indices&&e.setIndices(this.indices,null),this},e.prototype.transform=function(e){var t,r=e.m[0]*e.m[5]*e.m[10]<0,n=i.Vector3.Zero();if(this.positions){var s=i.Vector3.Zero();for(t=0;t<this.positions.length;t+=3)i.Vector3.FromArrayToRef(this.positions,t,s),i.Vector3.TransformCoordinatesToRef(s,e,n),this.positions[t]=n.x,this.positions[t+1]=n.y,this.positions[t+2]=n.z}if(this.normals){var a=i.Vector3.Zero();for(t=0;t<this.normals.length;t+=3)i.Vector3.FromArrayToRef(this.normals,t,a),i.Vector3.TransformNormalToRef(a,e,n),this.normals[t]=n.x,this.normals[t+1]=n.y,this.normals[t+2]=n.z}if(this.tangents){var o=i.Vector4.Zero(),u=i.Vector4.Zero();for(t=0;t<this.tangents.length;t+=4)i.Vector4.FromArrayToRef(this.tangents,t,o),i.Vector4.TransformNormalToRef(o,e,u),this.tangents[t]=u.x,this.tangents[t+1]=u.y,this.tangents[t+2]=u.z,this.tangents[t+3]=u.w}if(r&&this.indices)for(t=0;t<this.indices.length;t+=3){var h=this.indices[t+1];this.indices[t+1]=this.indices[t+2],this.indices[t+2]=h}return this},e.prototype.merge=function(e,t){if(void 0===t&&(t=!1),this._validate(),e._validate(),!this.normals!=!e.normals||!this.tangents!=!e.tangents||!this.uvs!=!e.uvs||!this.uvs2!=!e.uvs2||!this.uvs3!=!e.uvs3||!this.uvs4!=!e.uvs4||!this.uvs5!=!e.uvs5||!this.uvs6!=!e.uvs6||!this.colors!=!e.colors||!this.matricesIndices!=!e.matricesIndices||!this.matricesWeights!=!e.matricesWeights||!this.matricesIndicesExtra!=!e.matricesIndicesExtra||!this.matricesWeightsExtra!=!e.matricesWeightsExtra)throw new Error("Cannot merge vertex data that do not have the same set of attributes");if(e.indices){this.indices||(this.indices=[]);var r=this.positions?this.positions.length/3:0;if(void 0!==this.indices.BYTES_PER_ELEMENT){var i=this.indices.length+e.indices.length,n=t||this.indices instanceof Uint32Array?new Uint32Array(i):new Uint16Array(i);n.set(this.indices);for(var s=this.indices.length,a=0;a<e.indices.length;a++)n[s+a]=e.indices[a]+r;this.indices=n}else for(a=0;a<e.indices.length;a++)this.indices.push(e.indices[a]+r)}return this.positions=this._mergeElement(this.positions,e.positions),this.normals=this._mergeElement(this.normals,e.normals),this.tangents=this._mergeElement(this.tangents,e.tangents),this.uvs=this._mergeElement(this.uvs,e.uvs),this.uvs2=this._mergeElement(this.uvs2,e.uvs2),this.uvs3=this._mergeElement(this.uvs3,e.uvs3),this.uvs4=this._mergeElement(this.uvs4,e.uvs4),this.uvs5=this._mergeElement(this.uvs5,e.uvs5),this.uvs6=this._mergeElement(this.uvs6,e.uvs6),this.colors=this._mergeElement(this.colors,e.colors),this.matricesIndices=this._mergeElement(this.matricesIndices,e.matricesIndices),this.matricesWeights=this._mergeElement(this.matricesWeights,e.matricesWeights),this.matricesIndicesExtra=this._mergeElement(this.matricesIndicesExtra,e.matricesIndicesExtra),this.matricesWeightsExtra=this._mergeElement(this.matricesWeightsExtra,e.matricesWeightsExtra),this},e.prototype._mergeElement=function(e,t){if(!e)return t;if(!t)return e;var r=t.length+e.length,i=e instanceof Float32Array,n=t instanceof Float32Array;if(i){var s=new Float32Array(r);return s.set(e),s.set(t,e.length),s}if(n){var a=e.slice(0),o=0;for(r=t.length;o<r;o++)a.push(t[o]);return a}return e.concat(t)},e.prototype._validate=function(){if(!this.positions)throw new Error("Positions are required");var e=function(e,t){var r=n.VertexBuffer.DeduceStride(e);if(t.length%r!=0)throw new Error("The "+e+"s array count must be a multiple of "+r);return t.length/r},t=e(n.VertexBuffer.PositionKind,this.positions),r=function(r,i){var n=e(r,i);if(n!==t)throw new Error("The "+r+"s element count ("+n+") does not match the positions count ("+t+")")};this.normals&&r(n.VertexBuffer.NormalKind,this.normals),this.tangents&&r(n.VertexBuffer.TangentKind,this.tangents),this.uvs&&r(n.VertexBuffer.UVKind,this.uvs),this.uvs2&&r(n.VertexBuffer.UV2Kind,this.uvs2),this.uvs3&&r(n.VertexBuffer.UV3Kind,this.uvs3),this.uvs4&&r(n.VertexBuffer.UV4Kind,this.uvs4),this.uvs5&&r(n.VertexBuffer.UV5Kind,this.uvs5),this.uvs6&&r(n.VertexBuffer.UV6Kind,this.uvs6),this.colors&&r(n.VertexBuffer.ColorKind,this.colors),this.matricesIndices&&r(n.VertexBuffer.MatricesIndicesKind,this.matricesIndices),this.matricesWeights&&r(n.VertexBuffer.MatricesWeightsKind,this.matricesWeights),this.matricesIndicesExtra&&r(n.VertexBuffer.MatricesIndicesExtraKind,this.matricesIndicesExtra),this.matricesWeightsExtra&&r(n.VertexBuffer.MatricesWeightsExtraKind,this.matricesWeightsExtra)},e.prototype.serialize=function(){var e=this.serialize();return this.positions&&(e.positions=this.positions),this.normals&&(e.normals=this.normals),this.tangents&&(e.tangents=this.tangents),this.uvs&&(e.uvs=this.uvs),this.uvs2&&(e.uvs2=this.uvs2),this.uvs3&&(e.uvs3=this.uvs3),this.uvs4&&(e.uvs4=this.uvs4),this.uvs5&&(e.uvs5=this.uvs5),this.uvs6&&(e.uvs6=this.uvs6),this.colors&&(e.colors=this.colors),this.matricesIndices&&(e.matricesIndices=this.matricesIndices,e.matricesIndices._isExpanded=!0),this.matricesWeights&&(e.matricesWeights=this.matricesWeights),this.matricesIndicesExtra&&(e.matricesIndicesExtra=this.matricesIndicesExtra,e.matricesIndicesExtra._isExpanded=!0),this.matricesWeightsExtra&&(e.matricesWeightsExtra=this.matricesWeightsExtra),e.indices=this.indices,e},e.ExtractFromMesh=function(t,r,i){return e._ExtractFrom(t,r,i)},e.ExtractFromGeometry=function(t,r,i){return e._ExtractFrom(t,r,i)},e._ExtractFrom=function(t,r,i){var s=new e;return t.isVerticesDataPresent(n.VertexBuffer.PositionKind)&&(s.positions=t.getVerticesData(n.VertexBuffer.PositionKind,r,i)),t.isVerticesDataPresent(n.VertexBuffer.NormalKind)&&(s.normals=t.getVerticesData(n.VertexBuffer.NormalKind,r,i)),t.isVerticesDataPresent(n.VertexBuffer.TangentKind)&&(s.tangents=t.getVerticesData(n.VertexBuffer.TangentKind,r,i)),t.isVerticesDataPresent(n.VertexBuffer.UVKind)&&(s.uvs=t.getVerticesData(n.VertexBuffer.UVKind,r,i)),t.isVerticesDataPresent(n.VertexBuffer.UV2Kind)&&(s.uvs2=t.getVerticesData(n.VertexBuffer.UV2Kind,r,i)),t.isVerticesDataPresent(n.VertexBuffer.UV3Kind)&&(s.uvs3=t.getVerticesData(n.VertexBuffer.UV3Kind,r,i)),t.isVerticesDataPresent(n.VertexBuffer.UV4Kind)&&(s.uvs4=t.getVerticesData(n.VertexBuffer.UV4Kind,r,i)),t.isVerticesDataPresent(n.VertexBuffer.UV5Kind)&&(s.uvs5=t.getVerticesData(n.VertexBuffer.UV5Kind,r,i)),t.isVerticesDataPresent(n.VertexBuffer.UV6Kind)&&(s.uvs6=t.getVerticesData(n.VertexBuffer.UV6Kind,r,i)),t.isVerticesDataPresent(n.VertexBuffer.ColorKind)&&(s.colors=t.getVerticesData(n.VertexBuffer.ColorKind,r,i)),t.isVerticesDataPresent(n.VertexBuffer.MatricesIndicesKind)&&(s.matricesIndices=t.getVerticesData(n.VertexBuffer.MatricesIndicesKind,r,i)),t.isVerticesDataPresent(n.VertexBuffer.MatricesWeightsKind)&&(s.matricesWeights=t.getVerticesData(n.VertexBuffer.MatricesWeightsKind,r,i)),t.isVerticesDataPresent(n.VertexBuffer.MatricesIndicesExtraKind)&&(s.matricesIndicesExtra=t.getVerticesData(n.VertexBuffer.MatricesIndicesExtraKind,r,i)),t.isVerticesDataPresent(n.VertexBuffer.MatricesWeightsExtraKind)&&(s.matricesWeightsExtra=t.getVerticesData(n.VertexBuffer.MatricesWeightsExtraKind,r,i)),s.indices=t.getIndices(r,i),s},e.CreateRibbon=function(t){var r=t.pathArray,i=t.closeArray||!1,s=t.closePath||!1,a=t.invertUV||!1,o=Math.floor(r[0].length/2),u=t.offset||o;u=u>o?o:Math.floor(u);var h,c,l,f,d=0===t.sideOrientation?0:t.sideOrientation||e.DEFAULTSIDE,p=t.uvs,g=t.colors,m=[],v=[],y=[],_=[],x=[],b=[],V=[],M=[],T=[],D=[];if(r.length<2){var A=[],I=[];for(l=0;l<r[0].length-u;l++)A.push(r[0][l]),I.push(r[0][l+u]);r=[A,I]}var B,w,E,S,C,P=0,O=s?1:0;for(h=r[0].length,c=0;c<r.length;c++){for(V[c]=0,x[c]=[0],h=h<(w=(B=r[c]).length)?h:w,f=0;f<w;)m.push(B[f].x,B[f].y,B[f].z),f>0&&(E=B[f].subtract(B[f-1]).length()+V[c],x[c].push(E),V[c]=E),f++;s&&(f--,m.push(B[0].x,B[0].y,B[0].z),E=B[f].subtract(B[0]).length()+V[c],x[c].push(E),V[c]=E),T[c]=w+O,D[c]=P,P+=w+O}var F,R,L=null,U=null;for(l=0;l<h+O;l++){for(M[l]=0,b[l]=[0],c=0;c<r.length-1;c++)S=r[c],C=r[c+1],l===h?(L=S[0],U=C[0]):(L=S[l],U=C[l]),E=U.subtract(L).length()+M[l],b[l].push(E),M[l]=E;i&&U&&L&&(S=r[c],C=r[0],l===h&&(U=C[0]),E=U.subtract(L).length()+M[l],M[l]=E)}if(p)for(c=0;c<p.length;c++)_.push(p[c].x,p[c].y);else for(c=0;c<r.length;c++)for(l=0;l<h+O;l++)F=0!=V[c]?x[c][l]/V[c]:0,R=0!=M[l]?b[l][c]/M[l]:0,a?_.push(R,F):_.push(F,R);for(var z=0,N=T[c=0]-1,k=T[c+1]-1,K=N<k?N:k,W=D[1]-D[0],G=i?T.length:T.length-1;z<=K&&c<G;)v.push(z,z+W,z+1),v.push(z+W+1,z+1,z+W),(z+=1)===K&&(++c===T.length-1?(W=D[0]-D[c],N=T[c]-1,k=T[0]-1):(W=D[c+1]-D[c],N=T[c]-1,k=T[c+1]-1),z=D[c],K=N<k?N+z:k+z);if(e.ComputeNormals(m,v,y),s){var j=0,H=0;for(c=0;c<r.length;c++)j=3*D[c],H=c+1<r.length?3*(D[c+1]-1):y.length-3,y[j]=.5*(y[j]+y[H]),y[j+1]=.5*(y[j+1]+y[H+1]),y[j+2]=.5*(y[j+2]+y[H+2]),y[H]=y[j],y[H+1]=y[j+1],y[H+2]=y[j+2]}e._ComputeSides(d,m,v,y,_,t.frontUVs,t.backUVs);var X=null;if(g){X=new Float32Array(4*g.length);for(var Q=0;Q<g.length;Q++)X[4*Q]=g[Q].r,X[4*Q+1]=g[Q].g,X[4*Q+2]=g[Q].b,X[4*Q+3]=g[Q].a}var Y=new e,Z=new Float32Array(m),q=new Float32Array(y),J=new Float32Array(_);return Y.indices=v,Y.positions=Z,Y.normals=q,Y.uvs=J,X&&Y.set(X,n.VertexBuffer.ColorKind),s&&(Y._idx=D),Y},e.CreateBox=function(t){for(var r=[new i.Vector3(0,0,1),new i.Vector3(0,0,-1),new i.Vector3(1,0,0),new i.Vector3(-1,0,0),new i.Vector3(0,1,0),new i.Vector3(0,-1,0)],n=[],s=[],a=[],o=[],u=t.width||t.size||1,h=t.height||t.size||1,c=t.depth||t.size||1,l=0===t.sideOrientation?0:t.sideOrientation||e.DEFAULTSIDE,f=t.faceUV||new Array(6),d=t.faceColors,p=[],g=0;g<6;g++)void 0===f[g]&&(f[g]=new i.Vector4(0,0,1,1)),d&&void 0===d[g]&&(d[g]=new i.Color4(1,1,1,1));for(var m=new i.Vector3(u/2,h/2,c/2),v=0;v<r.length;v++){var y=r[v],_=new i.Vector3(y.y,y.z,y.x),x=i.Vector3.Cross(y,_),b=s.length/3;n.push(b),n.push(b+1),n.push(b+2),n.push(b),n.push(b+2),n.push(b+3);var V=y.subtract(_).subtract(x).multiply(m);s.push(V.x,V.y,V.z),a.push(y.x,y.y,y.z),o.push(f[v].z,f[v].w),d&&p.push(d[v].r,d[v].g,d[v].b,d[v].a),V=y.subtract(_).add(x).multiply(m),s.push(V.x,V.y,V.z),a.push(y.x,y.y,y.z),o.push(f[v].x,f[v].w),d&&p.push(d[v].r,d[v].g,d[v].b,d[v].a),V=y.add(_).add(x).multiply(m),s.push(V.x,V.y,V.z),a.push(y.x,y.y,y.z),o.push(f[v].x,f[v].y),d&&p.push(d[v].r,d[v].g,d[v].b,d[v].a),V=y.add(_).subtract(x).multiply(m),s.push(V.x,V.y,V.z),a.push(y.x,y.y,y.z),o.push(f[v].z,f[v].y),d&&p.push(d[v].r,d[v].g,d[v].b,d[v].a)}e._ComputeSides(l,s,n,a,o,t.frontUVs,t.backUVs);var M=new e;if(M.indices=n,M.positions=s,M.normals=a,M.uvs=o,d){var T=l===e.DOUBLESIDE?p.concat(p):p;M.colors=T}return M},e.CreateSphere=function(t){for(var r=t.segments||32,n=t.diameterX||t.diameter||1,s=t.diameterY||t.diameter||1,a=t.diameterZ||t.diameter||1,o=t.arc&&(t.arc<=0||t.arc>1)?1:t.arc||1,u=t.slice&&t.slice<=0?1:t.slice||1,h=0===t.sideOrientation?0:t.sideOrientation||e.DEFAULTSIDE,c=new i.Vector3(n/2,s/2,a/2),l=2+r,f=2*l,d=[],p=[],g=[],m=[],v=0;v<=l;v++){for(var y=v/l,_=y*Math.PI*u,x=0;x<=f;x++){var b=x/f,V=b*Math.PI*2*o,M=i.Matrix.RotationZ(-_),T=i.Matrix.RotationY(V),D=i.Vector3.TransformCoordinates(i.Vector3.Up(),M),A=i.Vector3.TransformCoordinates(D,T),I=A.multiply(c),B=A.divide(c).normalize();p.push(I.x,I.y,I.z),g.push(B.x,B.y,B.z),m.push(b,y)}if(v>0)for(var w=p.length/3,E=w-2*(f+1);E+f+2<w;E++)d.push(E),d.push(E+1),d.push(E+f+1),d.push(E+f+1),d.push(E+1),d.push(E+f+2)}e._ComputeSides(h,p,d,g,m,t.frontUVs,t.backUVs);var S=new e;return S.indices=d,S.positions=p,S.normals=g,S.uvs=m,S},e.CreateCylinder=function(t){var r,n=t.height||2,s=0===t.diameterTop?0:t.diameterTop||t.diameter||1,a=0===t.diameterBottom?0:t.diameterBottom||t.diameter||1,o=t.tessellation||24,u=t.subdivisions||1,h=!!t.hasRings,c=!!t.enclose,l=t.arc&&(t.arc<=0||t.arc>1)?1:t.arc||1,f=0===t.sideOrientation?0:t.sideOrientation||e.DEFAULTSIDE,d=t.faceUV||new Array(3),p=t.faceColors,g=2+(1+(1!==l&&c?2:0))*(h?u:1);for(r=0;r<g;r++)p&&void 0===p[r]&&(p[r]=new i.Color4(1,1,1,1));for(r=0;r<g;r++)d&&void 0===d[r]&&(d[r]=new i.Vector4(0,0,1,1));var m,v,y,_,x,b,V=new Array,M=new Array,T=new Array,D=new Array,A=new Array,I=2*Math.PI*l/o,B=(a-s)/2/n,w=i.Vector3.Zero(),E=i.Vector3.Zero(),S=i.Vector3.Zero(),C=i.Vector3.Zero(),P=i.Vector3.Zero(),O=i.Axis.Y,F=1,R=1,L=0,U=0;for(_=0;_<=u;_++)for(y=((v=_/u)*(s-a)+a)/2,F=h&&0!==_&&_!==u?2:1,b=0;b<F;b++){for(h&&(R+=b),c&&(R+=2*b),x=0;x<=o;x++)m=x*I,w.x=Math.cos(-m)*y,w.y=-n/2+v*n,w.z=Math.sin(-m)*y,0===s&&_===u?(E.x=T[T.length-3*(o+1)],E.y=T[T.length-3*(o+1)+1],E.z=T[T.length-3*(o+1)+2]):(E.x=w.x,E.z=w.z,E.y=Math.sqrt(E.x*E.x+E.z*E.z)*B,E.normalize()),0===x&&(S.copyFrom(w),C.copyFrom(E)),M.push(w.x,w.y,w.z),T.push(E.x,E.y,E.z),U=h?L!==R?d[R].y:d[R].w:d[R].y+(d[R].w-d[R].y)*v,D.push(d[R].x+(d[R].z-d[R].x)*x/o,U),p&&A.push(p[R].r,p[R].g,p[R].b,p[R].a);1!==l&&c&&(M.push(w.x,w.y,w.z),M.push(0,w.y,0),M.push(0,w.y,0),M.push(S.x,S.y,S.z),i.Vector3.CrossToRef(O,E,P),P.normalize(),T.push(P.x,P.y,P.z,P.x,P.y,P.z),i.Vector3.CrossToRef(C,O,P),P.normalize(),T.push(P.x,P.y,P.z,P.x,P.y,P.z),U=h?L!==R?d[R+1].y:d[R+1].w:d[R+1].y+(d[R+1].w-d[R+1].y)*v,D.push(d[R+1].x,U),D.push(d[R+1].z,U),U=h?L!==R?d[R+2].y:d[R+2].w:d[R+2].y+(d[R+2].w-d[R+2].y)*v,D.push(d[R+2].x,U),D.push(d[R+2].z,U),p&&(A.push(p[R+1].r,p[R+1].g,p[R+1].b,p[R+1].a),A.push(p[R+1].r,p[R+1].g,p[R+1].b,p[R+1].a),A.push(p[R+2].r,p[R+2].g,p[R+2].b,p[R+2].a),A.push(p[R+2].r,p[R+2].g,p[R+2].b,p[R+2].a))),L!==R&&(L=R)}var z=1!==l&&c?o+4:o;for(_=0,R=0;R<u;R++){var N=0,k=0,K=0,W=0;for(x=0;x<o;x++)N=_*(z+1)+x,k=(_+1)*(z+1)+x,K=_*(z+1)+(x+1),W=(_+1)*(z+1)+(x+1),V.push(N,k,K),V.push(W,K,k);1!==l&&c&&(V.push(N+2,k+2,K+2),V.push(W+2,K+2,k+2),V.push(N+4,k+4,K+4),V.push(W+4,K+4,k+4)),_=h?_+2:_+1}var G=function(e){var t=e?s/2:a/2;if(0!==t){var r,u,h,c=e?d[g-1]:d[0],f=null;p&&(f=e?p[g-1]:p[0]);var m=M.length/3,v=e?n/2:-n/2,y=new i.Vector3(0,v,0);M.push(y.x,y.y,y.z),T.push(0,e?1:-1,0),D.push(c.x+.5*(c.z-c.x),c.y+.5*(c.w-c.y)),f&&A.push(f.r,f.g,f.b,f.a);var _=new i.Vector2(.5,.5);for(h=0;h<=o;h++){r=2*Math.PI*h*l/o;var x=Math.cos(-r),b=Math.sin(-r);u=new i.Vector3(x*t,v,b*t);var I=new i.Vector2(x*_.x+.5,b*_.y+.5);M.push(u.x,u.y,u.z),T.push(0,e?1:-1,0),D.push(c.x+(c.z-c.x)*I.x,c.y+(c.w-c.y)*I.y),f&&A.push(f.r,f.g,f.b,f.a)}for(h=0;h<o;h++)e?(V.push(m),V.push(m+(h+2)),V.push(m+(h+1))):(V.push(m),V.push(m+(h+1)),V.push(m+(h+2)))}};G(!1),G(!0),e._ComputeSides(f,M,V,T,D,t.frontUVs,t.backUVs);var j=new e;return j.indices=V,j.positions=M,j.normals=T,j.uvs=D,p&&(j.colors=A),j},e.CreateTorus=function(t){for(var r=[],n=[],s=[],a=[],o=t.diameter||1,u=t.thickness||.5,h=t.tessellation||16,c=0===t.sideOrientation?0:t.sideOrientation||e.DEFAULTSIDE,l=h+1,f=0;f<=h;f++)for(var d=f/h,p=f*Math.PI*2/h-Math.PI/2,g=i.Matrix.Translation(o/2,0,0).multiply(i.Matrix.RotationY(p)),m=0;m<=h;m++){var v=1-m/h,y=m*Math.PI*2/h+Math.PI,_=Math.cos(y),x=Math.sin(y),b=new i.Vector3(_,x,0),V=b.scale(u/2),M=new i.Vector2(d,v);V=i.Vector3.TransformCoordinates(V,g),b=i.Vector3.TransformNormal(b,g),n.push(V.x,V.y,V.z),s.push(b.x,b.y,b.z),a.push(M.x,M.y);var T=(f+1)%l,D=(m+1)%l;r.push(f*l+m),r.push(f*l+D),r.push(T*l+m),r.push(f*l+D),r.push(T*l+D),r.push(T*l+m)}e._ComputeSides(c,n,r,s,a,t.frontUVs,t.backUVs);var A=new e;return A.indices=r,A.positions=n,A.normals=s,A.uvs=a,A},e.CreateLineSystem=function(t){for(var r=[],i=[],n=t.lines,s=t.colors,a=[],o=0,u=0;u<n.length;u++)for(var h=n[u],c=0;c<h.length;c++){if(i.push(h[c].x,h[c].y,h[c].z),s){var l=s[u];a.push(l[c].r,l[c].g,l[c].b,l[c].a)}c>0&&(r.push(o-1),r.push(o)),o++}var f=new e;return f.indices=r,f.positions=i,s&&(f.colors=a),f},e.CreateDashedLines=function(t){var r,n,s=t.dashSize||3,a=t.gapSize||1,o=t.dashNb||200,u=t.points,h=new Array,c=new Array,l=i.Vector3.Zero(),f=0,d=0,p=0,g=0,m=0;for(m=0;m<u.length-1;m++)u[m+1].subtractToRef(u[m],l),f+=l.length();for(n=s*(r=f/o)/(s+a),m=0;m<u.length-1;m++){u[m+1].subtractToRef(u[m],l),d=Math.floor(l.length()/r),l.normalize();for(var v=0;v<d;v++)p=r*v,h.push(u[m].x+p*l.x,u[m].y+p*l.y,u[m].z+p*l.z),h.push(u[m].x+(p+n)*l.x,u[m].y+(p+n)*l.y,u[m].z+(p+n)*l.z),c.push(g,g+1),g+=2}var y=new e;return y.positions=h,y.indices=c,y},e.CreateGround=function(t){var r,n,s=[],a=[],o=[],u=[],h=t.width||1,c=t.height||1,l=t.subdivisionsX||t.subdivisions||1,f=t.subdivisionsY||t.subdivisions||1;for(r=0;r<=f;r++)for(n=0;n<=l;n++){var d=new i.Vector3(n*h/l-h/2,0,(f-r)*c/f-c/2),p=new i.Vector3(0,1,0);a.push(d.x,d.y,d.z),o.push(p.x,p.y,p.z),u.push(n/l,1-r/f)}for(r=0;r<f;r++)for(n=0;n<l;n++)s.push(n+1+(r+1)*(l+1)),s.push(n+1+r*(l+1)),s.push(n+r*(l+1)),s.push(n+(r+1)*(l+1)),s.push(n+1+(r+1)*(l+1)),s.push(n+r*(l+1));var g=new e;return g.indices=s,g.positions=a,g.normals=o,g.uvs=u,g},e.CreateTiledGround=function(t){var r,n,s,a,o=void 0!==t.xmin&&null!==t.xmin?t.xmin:-1,u=void 0!==t.zmin&&null!==t.zmin?t.zmin:-1,h=void 0!==t.xmax&&null!==t.xmax?t.xmax:1,c=void 0!==t.zmax&&null!==t.zmax?t.zmax:1,l=t.subdivisions||{w:1,h:1},f=t.precision||{w:1,h:1},d=new Array,p=new Array,g=new Array,m=new Array;l.h=l.h<1?1:l.h,l.w=l.w<1?1:l.w,f.w=f.w<1?1:f.w,f.h=f.h<1?1:f.h;var v=(h-o)/l.w,y=(c-u)/l.h;function _(e,t,s,a){var o=p.length/3,u=f.w+1;for(r=0;r<f.h;r++)for(n=0;n<f.w;n++){var h=[o+n+r*u,o+(n+1)+r*u,o+(n+1)+(r+1)*u,o+n+(r+1)*u];d.push(h[1]),d.push(h[2]),d.push(h[3]),d.push(h[0]),d.push(h[1]),d.push(h[3])}var c=i.Vector3.Zero(),l=new i.Vector3(0,1,0);for(r=0;r<=f.h;r++)for(c.z=r*(a-t)/f.h+t,n=0;n<=f.w;n++)c.x=n*(s-e)/f.w+e,c.y=0,p.push(c.x,c.y,c.z),g.push(l.x,l.y,l.z),m.push(n/f.w,r/f.h)}for(s=0;s<l.h;s++)for(a=0;a<l.w;a++)_(o+a*v,u+s*y,o+(a+1)*v,u+(s+1)*y);var x=new e;return x.indices=d,x.positions=p,x.normals=g,x.uvs=m,x},e.CreateGroundFromHeightMap=function(t){var r,n,s=[],a=[],o=[],u=[],h=t.colorFilter||new i.Color3(.3,.59,.11),c=t.alphaFilter||0;for(r=0;r<=t.subdivisions;r++)for(n=0;n<=t.subdivisions;n++){var l=new i.Vector3(n*t.width/t.subdivisions-t.width/2,0,(t.subdivisions-r)*t.height/t.subdivisions-t.height/2),f=4*(((l.x+t.width/2)/t.width*(t.bufferWidth-1)|0)+((1-(l.z+t.height/2)/t.height)*(t.bufferHeight-1)|0)*t.bufferWidth),d=t.buffer[f]/255,p=t.buffer[f+1]/255,g=t.buffer[f+2]/255,m=t.buffer[f+3]/255,v=d*h.r+p*h.g+g*h.b;l.y=m>=c?t.minHeight+(t.maxHeight-t.minHeight)*v:t.minHeight-i.Epsilon,a.push(l.x,l.y,l.z),o.push(0,0,0),u.push(n/t.subdivisions,1-r/t.subdivisions)}for(r=0;r<t.subdivisions;r++)for(n=0;n<t.subdivisions;n++){var y=n+1+(r+1)*(t.subdivisions+1),_=n+1+r*(t.subdivisions+1),x=n+r*(t.subdivisions+1),b=n+(r+1)*(t.subdivisions+1),V=a[3*y+1]>=t.minHeight,M=a[3*_+1]>=t.minHeight,T=a[3*x+1]>=t.minHeight;V&&M&&T&&(s.push(y),s.push(_),s.push(x)),a[3*b+1]>=t.minHeight&&V&&T&&(s.push(b),s.push(y),s.push(x))}e.ComputeNormals(a,s,o);var D=new e;return D.indices=s,D.positions=a,D.normals=o,D.uvs=u,D},e.CreatePlane=function(t){var r=[],i=[],n=[],s=[],a=t.width||t.size||1,o=t.height||t.size||1,u=0===t.sideOrientation?0:t.sideOrientation||e.DEFAULTSIDE,h=a/2,c=o/2;i.push(-h,-c,0),n.push(0,0,-1),s.push(0,0),i.push(h,-c,0),n.push(0,0,-1),s.push(1,0),i.push(h,c,0),n.push(0,0,-1),s.push(1,1),i.push(-h,c,0),n.push(0,0,-1),s.push(0,1),r.push(0),r.push(1),r.push(2),r.push(0),r.push(2),r.push(3),e._ComputeSides(u,i,r,n,s,t.frontUVs,t.backUVs);var l=new e;return l.indices=r,l.positions=i,l.normals=n,l.uvs=s,l},e.CreateDisc=function(t){var r=new Array,i=new Array,n=new Array,s=new Array,a=t.radius||.5,o=t.tessellation||64,u=t.arc&&(t.arc<=0||t.arc>1)?1:t.arc||1,h=0===t.sideOrientation?0:t.sideOrientation||e.DEFAULTSIDE;r.push(0,0,0),s.push(.5,.5);for(var c=2*Math.PI*u,l=c/o,f=0;f<c;f+=l){var d=Math.cos(f),p=Math.sin(f),g=(d+1)/2,m=(1-p)/2;r.push(a*d,a*p,0),s.push(g,m)}1===u&&(r.push(r[3],r[4],r[5]),s.push(s[2],s[3]));for(var v=r.length/3,y=1;y<v-1;y++)i.push(y+1,0,y);e.ComputeNormals(r,i,n),e._ComputeSides(h,r,i,n,s,t.frontUVs,t.backUVs);var _=new e;return _.indices=i,_.positions=r,_.normals=n,_.uvs=s,_},e.CreatePolygon=function(t,r,s,a,o,u){for(var h=s||new Array(3),c=a,l=[],f=0;f<3;f++)void 0===h[f]&&(h[f]=new i.Vector4(0,0,1,1)),c&&void 0===c[f]&&(c[f]=new i.Color4(1,1,1,1));for(var d=t.getVerticesData(n.VertexBuffer.PositionKind),p=t.getVerticesData(n.VertexBuffer.NormalKind),g=t.getVerticesData(n.VertexBuffer.UVKind),m=t.getIndices(),v=0,y=0,_=0;_<p.length;_+=3)Math.abs(p[_+1])<.001&&(y=1),Math.abs(p[_+1]-1)<.001&&(y=0),Math.abs(p[_+1]+1)<.001&&(y=2),g[2*(v=_/3)]=(1-g[2*v])*h[y].x+g[2*v]*h[y].z,g[2*v+1]=(1-g[2*v+1])*h[y].y+g[2*v+1]*h[y].w,c&&l.push(c[y].r,c[y].g,c[y].b,c[y].a);e._ComputeSides(r,d,m,p,g,o,u);var x=new e;if(x.indices=m,x.positions=d,x.normals=p,x.uvs=g,c){var b=r===e.DOUBLESIDE?l.concat(l):l;x.colors=b}return x},e.CreateIcoSphere=function(t){var r,n=t.sideOrientation||e.DEFAULTSIDE,s=t.radius||1,a=void 0===t.flat||t.flat,o=t.subdivisions||4,u=t.radiusX||s,h=t.radiusY||s,c=t.radiusZ||s,l=(1+Math.sqrt(5))/2,f=[-1,l,-0,1,l,0,-1,-l,0,1,-l,0,0,-1,-l,0,1,-l,0,-1,l,0,1,l,l,0,1,l,0,-1,-l,0,1,-l,0,-1],d=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],p=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],g=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],m=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],v=new Array,y=new Array,_=new Array,x=new Array,b=0,V=new Array(3),M=new Array(3);for(r=0;r<3;r++)V[r]=i.Vector3.Zero(),M[r]=i.Vector2.Zero();for(var T=0;T<20;T++){for(r=0;r<3;r++){var D=d[3*T+r];V[r].copyFromFloats(f[3*p[D]],f[3*p[D]+1],f[3*p[D]+2]),V[r].normalize().scaleInPlace(s),M[r].copyFromFloats(g[2*D]*(138/1024)+60/1024+m[T]*(-40/1024),g[2*D+1]*(239/1024)+26/1024+m[T]*(20/1024))}for(var A=function(e,t,r,n){var s,l=i.Vector3.Lerp(V[0],V[2],t/o),f=i.Vector3.Lerp(V[1],V[2],t/o),d=o===t?V[2]:i.Vector3.Lerp(l,f,e/(o-t));if(d.normalize(),a){var p=i.Vector3.Lerp(V[0],V[2],n/o),g=i.Vector3.Lerp(V[1],V[2],n/o);s=i.Vector3.Lerp(p,g,r/(o-n))}else s=new i.Vector3(d.x,d.y,d.z);s.x/=u,s.y/=h,s.z/=c,s.normalize();var m=i.Vector2.Lerp(M[0],M[2],t/o),T=i.Vector2.Lerp(M[1],M[2],t/o),D=o===t?M[2]:i.Vector2.Lerp(m,T,e/(o-t));y.push(d.x*u,d.y*h,d.z*c),_.push(s.x,s.y,s.z),x.push(D.x,D.y),v.push(b),b++},I=0;I<o;I++)for(var B=0;B+I<o;B++)A(B,I,B+1/3,I+1/3),A(B+1,I,B+1/3,I+1/3),A(B,I+1,B+1/3,I+1/3),B+I+1<o&&(A(B+1,I,B+2/3,I+2/3),A(B+1,I+1,B+2/3,I+2/3),A(B,I+1,B+2/3,I+2/3))}e._ComputeSides(n,y,v,_,x,t.frontUVs,t.backUVs);var w=new e;return w.indices=v,w.positions=y,w.normals=_,w.uvs=x,w},e.CreatePolyhedron=function(t){var r=[];r[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},r[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},r[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},r[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},r[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},r[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},r[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},r[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},r[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},r[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},r[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},r[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},r[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},r[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},r[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};var n,s,a,o,u,h,c=t.type&&(t.type<0||t.type>=r.length)?0:t.type||0,l=t.size,f=t.sizeX||l||1,d=t.sizeY||l||1,p=t.sizeZ||l||1,g=t.custom||r[c],m=g.face.length,v=t.faceUV||new Array(m),y=t.faceColors,_=void 0===t.flat||t.flat,x=0===t.sideOrientation?0:t.sideOrientation||e.DEFAULTSIDE,b=new Array,V=new Array,M=new Array,T=new Array,D=new Array,A=0,I=0,B=new Array,w=0,E=0;if(_)for(E=0;E<m;E++)y&&void 0===y[E]&&(y[E]=new i.Color4(1,1,1,1)),v&&void 0===v[E]&&(v[E]=new i.Vector4(0,0,1,1));if(_)for(E=0;E<m;E++){var S=g.face[E].length;for(a=2*Math.PI/S,o=.5*Math.tan(a/2),u=.5,w=0;w<S;w++)b.push(g.vertex[g.face[E][w]][0]*f,g.vertex[g.face[E][w]][1]*d,g.vertex[g.face[E][w]][2]*p),B.push(A),A++,n=v[E].x+(v[E].z-v[E].x)*(.5+o),s=v[E].y+(v[E].w-v[E].y)*(u-.5),T.push(n,s),h=o*Math.cos(a)-u*Math.sin(a),u=o*Math.sin(a)+u*Math.cos(a),o=h,y&&D.push(y[E].r,y[E].g,y[E].b,y[E].a);for(w=0;w<S-2;w++)V.push(B[0+I],B[w+2+I],B[w+1+I]);I+=S}else{for(w=0;w<g.vertex.length;w++)b.push(g.vertex[w][0]*f,g.vertex[w][1]*d,g.vertex[w][2]*p),T.push(0,0);for(E=0;E<m;E++)for(w=0;w<g.face[E].length-2;w++)V.push(g.face[E][0],g.face[E][w+2],g.face[E][w+1])}e.ComputeNormals(b,V,M),e._ComputeSides(x,b,V,M,T,t.frontUVs,t.backUVs);var C=new e;return C.positions=b,C.indices=V,C.normals=M,C.uvs=T,y&&_&&(C.colors=D),C},e.CreateTorusKnot=function(t){var r,n,s=new Array,a=new Array,o=new Array,u=new Array,h=t.radius||2,c=t.tube||.5,l=t.radialSegments||32,f=t.tubularSegments||32,d=t.p||2,p=t.q||3,g=0===t.sideOrientation?0:t.sideOrientation||e.DEFAULTSIDE,m=function(e){var t=Math.cos(e),r=Math.sin(e),n=p/d*e,s=Math.cos(n),a=h*(2+s)*.5*t,o=h*(2+s)*r*.5,u=h*Math.sin(n)*.5;return new i.Vector3(a,o,u)};for(r=0;r<=l;r++){var v=r%l/l*2*d*Math.PI,y=m(v),_=m(v+.01),x=_.subtract(y),b=_.add(y),V=i.Vector3.Cross(x,b);for(b=i.Vector3.Cross(V,x),V.normalize(),b.normalize(),n=0;n<f;n++){var M=n%f/f*2*Math.PI,T=-c*Math.cos(M),D=c*Math.sin(M);a.push(y.x+T*b.x+D*V.x),a.push(y.y+T*b.y+D*V.y),a.push(y.z+T*b.z+D*V.z),u.push(r/l),u.push(n/f)}}for(r=0;r<l;r++)for(n=0;n<f;n++){var A=(n+1)%f,I=r*f+n,B=(r+1)*f+n,w=(r+1)*f+A,E=r*f+A;s.push(E),s.push(B),s.push(I),s.push(E),s.push(w),s.push(B)}e.ComputeNormals(a,s,o),e._ComputeSides(g,a,s,o,u,t.frontUVs,t.backUVs);var S=new e;return S.indices=s,S.positions=a,S.normals=o,S.uvs=u,S},e.ComputeNormals=function(e,t,r,n){var s=0,a=0,o=0,u=0,h=0,c=0,l=0,f=0,d=0,p=0,g=0,m=0,v=0,y=0,_=0,x=0,b=0,V=0,M=0,T=0,D=!1,A=!1,I=!1,B=!1,w=1,E=0,S=null;if(n&&(D=!!n.facetNormals,A=!!n.facetPositions,I=!!n.facetPartitioning,w=!0===n.useRightHandedSystem?-1:1,E=n.ratio||0,B=!!n.depthSort,S=n.distanceTo,B)){void 0===S&&(S=i.Vector3.Zero());var C=n.depthSortedFacets}var P=0,O=0,F=0,R=0;if(I&&n&&n.bbSize){var L=0,U=0,z=0,N=0,k=0,K=0,W=0,G=0,j=0,H=0,X=0,Q=0,Y=0,Z=0,q=0,J=0,$=n.bbSize.x>n.bbSize.y?n.bbSize.x:n.bbSize.y;$=$>n.bbSize.z?$:n.bbSize.z,P=n.subDiv.X*E/n.bbSize.x,O=n.subDiv.Y*E/n.bbSize.y,F=n.subDiv.Z*E/n.bbSize.z,R=n.subDiv.max*n.subDiv.max,n.facetPartitioning.length=0}for(s=0;s<e.length;s++)r[s]=0;var ee=t.length/3|0;for(s=0;s<ee;s++){if(v=(m=3*t[3*s])+1,y=m+2,x=(_=3*t[3*s+1])+1,b=_+2,M=(V=3*t[3*s+2])+1,T=V+2,a=e[m]-e[_],o=e[v]-e[x],u=e[y]-e[b],h=e[V]-e[_],c=e[M]-e[x],f=w*(o*(l=e[T]-e[b])-u*c),d=w*(u*h-a*l),p=w*(a*c-o*h),f/=g=0===(g=Math.sqrt(f*f+d*d+p*p))?1:g,d/=g,p/=g,D&&n&&(n.facetNormals[s].x=f,n.facetNormals[s].y=d,n.facetNormals[s].z=p),A&&n&&(n.facetPositions[s].x=(e[m]+e[_]+e[V])/3,n.facetPositions[s].y=(e[v]+e[x]+e[M])/3,n.facetPositions[s].z=(e[y]+e[b]+e[T])/3),I&&n&&(L=Math.floor((n.facetPositions[s].x-n.bInfo.minimum.x*E)*P),U=Math.floor((n.facetPositions[s].y-n.bInfo.minimum.y*E)*O),z=Math.floor((n.facetPositions[s].z-n.bInfo.minimum.z*E)*F),N=Math.floor((e[m]-n.bInfo.minimum.x*E)*P),k=Math.floor((e[v]-n.bInfo.minimum.y*E)*O),K=Math.floor((e[y]-n.bInfo.minimum.z*E)*F),W=Math.floor((e[_]-n.bInfo.minimum.x*E)*P),G=Math.floor((e[x]-n.bInfo.minimum.y*E)*O),j=Math.floor((e[b]-n.bInfo.minimum.z*E)*F),H=Math.floor((e[V]-n.bInfo.minimum.x*E)*P),X=Math.floor((e[M]-n.bInfo.minimum.y*E)*O),Q=Math.floor((e[T]-n.bInfo.minimum.z*E)*F),Z=N+n.subDiv.max*k+R*K,q=W+n.subDiv.max*G+R*j,J=H+n.subDiv.max*X+R*Q,Y=L+n.subDiv.max*U+R*z,n.facetPartitioning[Y]=n.facetPartitioning[Y]?n.facetPartitioning[Y]:new Array,n.facetPartitioning[Z]=n.facetPartitioning[Z]?n.facetPartitioning[Z]:new Array,n.facetPartitioning[q]=n.facetPartitioning[q]?n.facetPartitioning[q]:new Array,n.facetPartitioning[J]=n.facetPartitioning[J]?n.facetPartitioning[J]:new Array,n.facetPartitioning[Z].push(s),q!=Z&&n.facetPartitioning[q].push(s),J!=q&&J!=Z&&n.facetPartitioning[J].push(s),Y!=Z&&Y!=q&&Y!=J&&n.facetPartitioning[Y].push(s)),B&&n&&n.facetPositions){var te=C[s];te.ind=3*s,te.sqDistance=i.Vector3.DistanceSquared(n.facetPositions[s],S)}r[m]+=f,r[v]+=d,r[y]+=p,r[_]+=f,r[x]+=d,r[b]+=p,r[V]+=f,r[M]+=d,r[T]+=p}for(s=0;s<r.length/3;s++)f=r[3*s],d=r[3*s+1],p=r[3*s+2],f/=g=0===(g=Math.sqrt(f*f+d*d+p*p))?1:g,d/=g,p/=g,r[3*s]=f,r[3*s+1]=d,r[3*s+2]=p},e._ComputeSides=function(t,r,n,s,a,o,u){var h,c,l=n.length,f=s.length;switch(t=t||e.DEFAULTSIDE){case e.FRONTSIDE:break;case e.BACKSIDE:var d;for(h=0;h<l;h+=3)d=n[h],n[h]=n[h+2],n[h+2]=d;for(c=0;c<f;c++)s[c]=-s[c];break;case e.DOUBLESIDE:for(var p=r.length,g=p/3,m=0;m<p;m++)r[p+m]=r[m];for(h=0;h<l;h+=3)n[h+l]=n[h+2]+g,n[h+1+l]=n[h+1]+g,n[h+2+l]=n[h]+g;for(c=0;c<f;c++)s[f+c]=-s[c];var v=a.length,y=0;for(y=0;y<v;y++)a[y+v]=a[y];for(o=o||new i.Vector4(0,0,1,1),u=u||new i.Vector4(0,0,1,1),y=0,h=0;h<v/2;h++)a[y]=o.x+(o.z-o.x)*a[y],a[y+1]=o.y+(o.w-o.y)*a[y+1],a[y+v]=u.x+(u.z-u.x)*a[y+v],a[y+v+1]=u.y+(u.w-u.y)*a[y+v+1],y+=2}},e.ImportVertexData=function(t,r){var s=new e,a=t.positions;a&&s.set(a,n.VertexBuffer.PositionKind);var o=t.normals;o&&s.set(o,n.VertexBuffer.NormalKind);var u=t.tangents;u&&s.set(u,n.VertexBuffer.TangentKind);var h=t.uvs;h&&s.set(h,n.VertexBuffer.UVKind);var c=t.uv2s;c&&s.set(c,n.VertexBuffer.UV2Kind);var l=t.uv3s;l&&s.set(l,n.VertexBuffer.UV3Kind);var f=t.uv4s;f&&s.set(f,n.VertexBuffer.UV4Kind);var d=t.uv5s;d&&s.set(d,n.VertexBuffer.UV5Kind);var p=t.uv6s;p&&s.set(p,n.VertexBuffer.UV6Kind);var g=t.colors;g&&s.set(i.Color4.CheckColors4(g,a.length/3),n.VertexBuffer.ColorKind);var m=t.matricesIndices;m&&s.set(m,n.VertexBuffer.MatricesIndicesKind);var v=t.matricesWeights;v&&s.set(v,n.VertexBuffer.MatricesWeightsKind);var y=t.indices;y&&(s.indices=y),r.setAllVerticesData(s,t.updatable)},e.FRONTSIDE=0,e.BACKSIDE=1,e.DOUBLESIDE=2,e.DEFAULTSIDE=0,e}()},257:function(e,t,r){"use strict";var i,n=r(23),s=r(3),a=r(233),o=r(0),u=r(56),h=r(10),c=0,l=function(){function e(e,t,r){this.pos=e,this.normal=t,this.uv=r}return e.prototype.clone=function(){return new e(this.pos.clone(),this.normal.clone(),this.uv.clone())},e.prototype.flip=function(){this.normal=this.normal.scale(-1)},e.prototype.interpolate=function(t,r){return new e(o.Vector3.Lerp(this.pos,t.pos,r),o.Vector3.Lerp(this.normal,t.normal,r),o.Vector2.Lerp(this.uv,t.uv,r))},e}(),f=function(){function e(e,t){this.normal=e,this.w=t}return e.FromPoints=function(t,r,i){var n=i.subtract(t),s=r.subtract(t);if(0===n.lengthSquared()||0===s.lengthSquared())return null;var a=o.Vector3.Normalize(o.Vector3.Cross(n,s));return new e(a,o.Vector3.Dot(a,t))},e.prototype.clone=function(){return new e(this.normal.clone(),this.w)},e.prototype.flip=function(){this.normal.scaleInPlace(-1),this.w=-this.w},e.prototype.splitPolygon=function(t,r,i,n,s){var a,u,h=0,c=[];for(a=0;a<t.vertices.length;a++){var l=(u=o.Vector3.Dot(this.normal,t.vertices[a].pos)-this.w)<-e.EPSILON?2:u>e.EPSILON?1:0;h|=l,c.push(l)}switch(h){case 0:(o.Vector3.Dot(this.normal,t.plane.normal)>0?r:i).push(t);break;case 1:n.push(t);break;case 2:s.push(t);break;case 3:var f,p=[],g=[];for(a=0;a<t.vertices.length;a++){var m=(a+1)%t.vertices.length,v=c[a],y=c[m],_=t.vertices[a],x=t.vertices[m];if(2!==v&&p.push(_),1!==v&&g.push(2!==v?_.clone():_),3==(v|y)){u=(this.w-o.Vector3.Dot(this.normal,_.pos))/o.Vector3.Dot(this.normal,x.pos.subtract(_.pos));var b=_.interpolate(x,u);p.push(b),g.push(b.clone())}}p.length>=3&&(f=new d(p,t.shared)).plane&&n.push(f),g.length>=3&&(f=new d(g,t.shared)).plane&&s.push(f)}},e.EPSILON=1e-5,e}(),d=function(){function e(e,t){this.vertices=e,this.shared=t,this.plane=f.FromPoints(e[0].pos,e[1].pos,e[2].pos)}return e.prototype.clone=function(){return new e(this.vertices.map(function(e){return e.clone()}),this.shared)},e.prototype.flip=function(){this.vertices.reverse().map(function(e){e.flip()}),this.plane.flip()},e}(),p=function(){function e(e){this.plane=null,this.front=null,this.back=null,this.polygons=new Array,e&&this.build(e)}return e.prototype.clone=function(){var t=new e;return t.plane=this.plane&&this.plane.clone(),t.front=this.front&&this.front.clone(),t.back=this.back&&this.back.clone(),t.polygons=this.polygons.map(function(e){return e.clone()}),t},e.prototype.invert=function(){for(var e=0;e<this.polygons.length;e++)this.polygons[e].flip();this.plane&&this.plane.flip(),this.front&&this.front.invert(),this.back&&this.back.invert();var t=this.front;this.front=this.back,this.back=t},e.prototype.clipPolygons=function(e){if(!this.plane)return e.slice();for(var t=new Array,r=new Array,i=0;i<e.length;i++)this.plane.splitPolygon(e[i],t,r,t,r);return this.front&&(t=this.front.clipPolygons(t)),r=this.back?this.back.clipPolygons(r):[],t.concat(r)},e.prototype.clipTo=function(e){this.polygons=e.clipPolygons(this.polygons),this.front&&this.front.clipTo(e),this.back&&this.back.clipTo(e)},e.prototype.allPolygons=function(){var e=this.polygons.slice();return this.front&&(e=e.concat(this.front.allPolygons())),this.back&&(e=e.concat(this.back.allPolygons())),e},e.prototype.build=function(t){if(t.length){this.plane||(this.plane=t[0].plane.clone());for(var r=new Array,i=new Array,n=0;n<t.length;n++)this.plane.splitPolygon(t[n],this.polygons,this.polygons,r,i);r.length&&(this.front||(this.front=new e),this.front.build(r)),i.length&&(this.back||(this.back=new e),this.back.build(i))}},e}(),g=function(){function e(){this.polygons=new Array}return e.FromMesh=function(t){var r,i,n,a,u,f,p,g,m,v,y=new Array,_=null;if(!(t instanceof h.Mesh))throw"BABYLON.CSG: Wrong Mesh type, must be BABYLON.Mesh";t.computeWorldMatrix(!0),p=t.getWorldMatrix(),g=t.position.clone(),m=t.rotation.clone(),t.rotationQuaternion&&(_=t.rotationQuaternion.clone()),v=t.scaling.clone();for(var x=t.getIndices(),b=t.getVerticesData(s.VertexBuffer.PositionKind),V=t.getVerticesData(s.VertexBuffer.NormalKind),M=t.getVerticesData(s.VertexBuffer.UVKind),T=t.subMeshes,D=0,A=T.length;D<A;D++)for(var I=T[D].indexStart,B=T[D].indexCount+T[D].indexStart;I<B;I+=3){f=[];for(var w=0;w<3;w++){var E=new o.Vector3(V[3*x[I+w]],V[3*x[I+w]+1],V[3*x[I+w]+2]);n=new o.Vector2(M[2*x[I+w]],M[2*x[I+w]+1]);var S=new o.Vector3(b[3*x[I+w]],b[3*x[I+w]+1],b[3*x[I+w]+2]);a=o.Vector3.TransformCoordinates(S,p),i=o.Vector3.TransformNormal(E,p),r=new l(a,i,n),f.push(r)}(u=new d(f,{subMeshId:D,meshId:c,materialIndex:T[D].materialIndex})).plane&&y.push(u)}var C=e.FromPolygons(y);return C.matrix=p,C.position=g,C.rotation=m,C.scaling=v,C.rotationQuaternion=_,c++,C},e.FromPolygons=function(t){var r=new e;return r.polygons=t,r},e.prototype.clone=function(){var t=new e;return t.polygons=this.polygons.map(function(e){return e.clone()}),t.copyTransformAttributes(this),t},e.prototype.union=function(t){var r=new p(this.clone().polygons),i=new p(t.clone().polygons);return r.clipTo(i),i.clipTo(r),i.invert(),i.clipTo(r),i.invert(),r.build(i.allPolygons()),e.FromPolygons(r.allPolygons()).copyTransformAttributes(this)},e.prototype.unionInPlace=function(e){var t=new p(this.polygons),r=new p(e.polygons);t.clipTo(r),r.clipTo(t),r.invert(),r.clipTo(t),r.invert(),t.build(r.allPolygons()),this.polygons=t.allPolygons()},e.prototype.subtract=function(t){var r=new p(this.clone().polygons),i=new p(t.clone().polygons);return r.invert(),r.clipTo(i),i.clipTo(r),i.invert(),i.clipTo(r),i.invert(),r.build(i.allPolygons()),r.invert(),e.FromPolygons(r.allPolygons()).copyTransformAttributes(this)},e.prototype.subtractInPlace=function(e){var t=new p(this.polygons),r=new p(e.polygons);t.invert(),t.clipTo(r),r.clipTo(t),r.invert(),r.clipTo(t),r.invert(),t.build(r.allPolygons()),t.invert(),this.polygons=t.allPolygons()},e.prototype.intersect=function(t){var r=new p(this.clone().polygons),i=new p(t.clone().polygons);return r.invert(),i.clipTo(r),i.invert(),r.clipTo(i),i.clipTo(r),r.build(i.allPolygons()),r.invert(),e.FromPolygons(r.allPolygons()).copyTransformAttributes(this)},e.prototype.intersectInPlace=function(e){var t=new p(this.polygons),r=new p(e.polygons);t.invert(),r.clipTo(t),r.invert(),t.clipTo(r),r.clipTo(t),t.build(r.allPolygons()),t.invert(),this.polygons=t.allPolygons()},e.prototype.inverse=function(){var e=this.clone();return e.inverseInPlace(),e},e.prototype.inverseInPlace=function(){this.polygons.map(function(e){e.flip()})},e.prototype.copyTransformAttributes=function(e){return this.matrix=e.matrix,this.position=e.position,this.rotation=e.rotation,this.scaling=e.scaling,this.rotationQuaternion=e.rotationQuaternion,this},e.prototype.buildMeshGeometry=function(e,t,r){var i=this.matrix.clone();i.invert();var n,a,c,l=new h.Mesh(e,t),f=[],d=[],p=[],g=[],m=o.Vector3.Zero(),v=o.Vector3.Zero(),y=o.Vector2.Zero(),_=this.polygons,x=[0,0,0],b={},V=0,M={};r&&_.sort(function(e,t){return e.shared.meshId===t.shared.meshId?e.shared.subMeshId-t.shared.subMeshId:e.shared.meshId-t.shared.meshId});for(var T=0,D=_.length;T<D;T++){M[(n=_[T]).shared.meshId]||(M[n.shared.meshId]={}),M[n.shared.meshId][n.shared.subMeshId]||(M[n.shared.meshId][n.shared.subMeshId]={indexStart:1/0,indexEnd:-1/0,materialIndex:n.shared.materialIndex}),c=M[n.shared.meshId][n.shared.subMeshId];for(var A=2,I=n.vertices.length;A<I;A++){x[0]=0,x[1]=A-1,x[2]=A;for(var B=0;B<3;B++){m.copyFrom(n.vertices[x[B]].pos),v.copyFrom(n.vertices[x[B]].normal),y.copyFrom(n.vertices[x[B]].uv);var w=o.Vector3.TransformCoordinates(m,i),E=o.Vector3.TransformNormal(v,i);void 0!==(a=b[w.x+","+w.y+","+w.z])&&p[3*a]===E.x&&p[3*a+1]===E.y&&p[3*a+2]===E.z&&g[2*a]===y.x&&g[2*a+1]===y.y||(f.push(w.x,w.y,w.z),g.push(y.x,y.y),p.push(v.x,v.y,v.z),a=b[w.x+","+w.y+","+w.z]=f.length/3-1),d.push(a),c.indexStart=Math.min(V,c.indexStart),c.indexEnd=Math.max(V,c.indexEnd),V++}}}if(l.setVerticesData(s.VertexBuffer.PositionKind,f),l.setVerticesData(s.VertexBuffer.NormalKind,p),l.setVerticesData(s.VertexBuffer.UVKind,g),l.setIndices(d,null),r){var S,C=0;for(var P in l.subMeshes=new Array,M){for(var O in S=-1,M[P])c=M[P][O],u.b.CreateFromIndices(c.materialIndex+C,c.indexStart,c.indexEnd-c.indexStart+1,l),S=Math.max(c.materialIndex,S);C+=++S}}return l},e.prototype.toMesh=function(e,t,r,i){var n=this.buildMeshGeometry(e,r,i);return n.material=t,n.position.copyFrom(this.position),n.rotation.copyFrom(this.rotation),this.rotationQuaternion&&(n.rotationQuaternion=this.rotationQuaternion.clone()),n.scaling.copyFrom(this.scaling),n.computeWorldMatrix(!0),n},e}(),m=r(32),v=r(148),y=r(117),_=r(82),x=r(24),b=r(28),V=r(5),M=function(){return function(e,t,r){this.quality=e,this.distance=t,this.optimizeMesh=r}}(),T=function(){function e(){this.running=!1,this._simplificationArray=[]}return e.prototype.addTask=function(e){this._simplificationArray.push(e)},e.prototype.executeNext=function(){var e=this._simplificationArray.pop();e?(this.running=!0,this.runSimplification(e)):this.running=!1},e.prototype.runSimplification=function(e){var t=this;if(e.parallelProcessing)e.settings.forEach(function(r){t.getSimplifier(e).simplify(r,function(i){e.mesh.addLODLevel(r.distance,i),i.isVisible=!0,r.quality===e.settings[e.settings.length-1].quality&&e.successCallback&&e.successCallback(),t.executeNext()})});else{var r=this.getSimplifier(e);V.a.Run(e.settings.length,function(t){var i,n;i=e.settings[t.index],n=function(){t.executeNext()},r.simplify(i,function(t){e.mesh.addLODLevel(i.distance,t),t.isVisible=!0,n()})},function(){e.successCallback&&e.successCallback(),t.executeNext()})}},e.prototype.getSimplifier=function(e){switch(e.simplificationType){case i.QUADRATIC:default:return new w(e.mesh)}},e}();!function(e){e[e.QUADRATIC=0]="QUADRATIC"}(i||(i={}));var D=function(){return function(e){this.vertices=e,this.error=new Array(4),this.deleted=!1,this.isDirty=!1,this.deletePending=!1,this.borderFactor=0}}(),A=function(){function e(e,t){this.position=e,this.id=t,this.isBorder=!0,this.q=new I,this.triangleCount=0,this.triangleStart=0,this.originalOffsets=[]}return e.prototype.updatePosition=function(e){this.position.copyFrom(e)},e}(),I=function(){function e(e){this.data=new Array(10);for(var t=0;t<10;++t)e&&e[t]?this.data[t]=e[t]:this.data[t]=0}return e.prototype.det=function(e,t,r,i,n,s,a,o,u){return this.data[e]*this.data[n]*this.data[u]+this.data[r]*this.data[i]*this.data[o]+this.data[t]*this.data[s]*this.data[a]-this.data[r]*this.data[n]*this.data[a]-this.data[e]*this.data[s]*this.data[o]-this.data[t]*this.data[i]*this.data[u]},e.prototype.addInPlace=function(e){for(var t=0;t<10;++t)this.data[t]+=e.data[t]},e.prototype.addArrayInPlace=function(e){for(var t=0;t<10;++t)this.data[t]+=e[t]},e.prototype.add=function(t){for(var r=new e,i=0;i<10;++i)r.data[i]=this.data[i]+t.data[i];return r},e.FromData=function(t,r,i,n){return new e(e.DataFromNumbers(t,r,i,n))},e.DataFromNumbers=function(e,t,r,i){return[e*e,e*t,e*r,e*i,t*t,t*r,t*i,r*r,r*i,i*i]},e}(),B=function(){return function(e,t){this.vertexId=e,this.triangleId=t}}(),w=function(){function e(e){this._mesh=e,this.syncIterations=5e3,this.aggressiveness=7,this.decimationIterations=100,this.boundingBoxEpsilon=o.Epsilon}return e.prototype.simplify=function(e,t){var r=this;this.initDecimatedMesh(),V.a.Run(this._mesh.subMeshes.length,function(t){r.initWithMesh(t.index,function(){r.runDecimation(e,t.index,function(){t.executeNext()})},e.optimizeMesh)},function(){setTimeout(function(){t(r._reconstructedMesh)},0)})},e.prototype.runDecimation=function(e,t,r){var i=this,n=~~(this.triangles.length*e.quality),s=0,a=this.triangles.length;V.a.Run(this.decimationIterations,function(e){var t,r;a-s<=n?e.breakLoop():(t=e.index,r=function(){e.executeNext()},setTimeout(function(){t%5==0&&i.updateMesh(0===t);for(var e=0;e<i.triangles.length;++e)i.triangles[e].isDirty=!1;var u=1e-9*Math.pow(t+3,i.aggressiveness);V.a.SyncAsyncForLoop(i.triangles.length,i.syncIterations,function(e){var t=~~((i.triangles.length/2+e)%i.triangles.length),r=i.triangles[t];if(r&&!(r.error[3]>u||r.deleted||r.isDirty))for(var n=0;n<3;++n)if(r.error[n]<u){var a=[],h=[],c=r.vertices[n],l=r.vertices[(n+1)%3];if(c.isBorder||l.isBorder)continue;var f=o.Vector3.Zero();i.calculateError(c,l,f);var d=new Array;if(i.isFlipped(c,l,f,a,d))continue;if(i.isFlipped(l,c,f,h,d))continue;if(a.indexOf(!0)<0||h.indexOf(!0)<0)continue;var p=new Array;if(d.forEach(function(e){-1===p.indexOf(e)&&(e.deletePending=!0,p.push(e))}),p.length%2!=0)continue;c.q=l.q.add(c.q),c.updatePosition(f);var g=i.references.length;s=i.updateTriangles(c,c,a,s),s=i.updateTriangles(c,l,h,s);var m=i.references.length-g;if(m<=c.triangleCount){if(m)for(var v=0;v<m;v++)i.references[c.triangleStart+v]=i.references[g+v]}else c.triangleStart=g;c.triangleCount=m;break}},r,function(){return a-s<=n})},0))},function(){setTimeout(function(){i.reconstructMesh(t),r()},0)})},e.prototype.initWithMesh=function(e,t,r){var i=this;this.vertices=[],this.triangles=[];var n=this._mesh.getVerticesData(s.VertexBuffer.PositionKind),a=this._mesh.getIndices(),u=this._mesh.subMeshes[e],h=[],c=u.verticesCount;V.a.SyncAsyncForLoop(c,this.syncIterations/4>>0,function(e){if(n){var t=e+u.verticesStart,s=o.Vector3.FromArray(n,3*t),a=function(e){if(r)for(var t=0;t<i.vertices.length;++t)if(i.vertices[t].position.equals(e))return i.vertices[t];return null}(s)||new A(s,i.vertices.length);a.originalOffsets.push(t),a.id===i.vertices.length&&i.vertices.push(a),h.push(a.id)}},function(){V.a.SyncAsyncForLoop(u.indexCount/3,i.syncIterations,function(e){if(a){var t=3*(u.indexStart/3+e),r=a[t+0],n=a[t+1],s=a[t+2],o=i.vertices[h[r-u.verticesStart]],c=i.vertices[h[n-u.verticesStart]],l=i.vertices[h[s-u.verticesStart]],f=new D([o,c,l]);f.originalOffset=t,i.triangles.push(f)}},function(){i.init(t)})})},e.prototype.init=function(e){var t=this;V.a.SyncAsyncForLoop(this.triangles.length,this.syncIterations,function(e){var r=t.triangles[e];r.normal=o.Vector3.Cross(r.vertices[1].position.subtract(r.vertices[0].position),r.vertices[2].position.subtract(r.vertices[0].position)).normalize();for(var i=0;i<3;i++)r.vertices[i].q.addArrayInPlace(I.DataFromNumbers(r.normal.x,r.normal.y,r.normal.z,-o.Vector3.Dot(r.normal,r.vertices[0].position)))},function(){V.a.SyncAsyncForLoop(t.triangles.length,t.syncIterations,function(e){for(var r=t.triangles[e],i=0;i<3;++i)r.error[i]=t.calculateError(r.vertices[i],r.vertices[(i+1)%3]);r.error[3]=Math.min(r.error[0],r.error[1],r.error[2])},function(){e()})})},e.prototype.reconstructMesh=function(e){var t,r,i,n=[];for(t=0;t<this.vertices.length;++t)this.vertices[t].triangleCount=0;for(t=0;t<this.triangles.length;++t)if(!this.triangles[t].deleted){for(r=this.triangles[t],i=0;i<3;++i)r.vertices[i].triangleCount=1;n.push(r)}var a=this._reconstructedMesh.getVerticesData(s.VertexBuffer.PositionKind)||[],o=this._reconstructedMesh.getVerticesData(s.VertexBuffer.NormalKind)||[],h=this._reconstructedMesh.getVerticesData(s.VertexBuffer.UVKind)||[],c=this._reconstructedMesh.getVerticesData(s.VertexBuffer.ColorKind)||[],l=this._mesh.getVerticesData(s.VertexBuffer.NormalKind),f=this._mesh.getVerticesData(s.VertexBuffer.UVKind),d=this._mesh.getVerticesData(s.VertexBuffer.ColorKind),p=0;for(t=0;t<this.vertices.length;++t){var g=this.vertices[t];g.id=p,g.triangleCount&&g.originalOffsets.forEach(function(e){l&&(a.push(g.position.x),a.push(g.position.y),a.push(g.position.z),o.push(l[3*e]),o.push(l[3*e+1]),o.push(l[3*e+2]),f&&f.length?(h.push(f[2*e]),h.push(f[2*e+1])):d&&d.length&&(c.push(d[4*e]),c.push(d[4*e+1]),c.push(d[4*e+2]),c.push(d[4*e+3])),++p)})}var m=this._reconstructedMesh.getTotalIndices(),v=this._reconstructedMesh.getTotalVertices(),y=this._reconstructedMesh.subMeshes;this._reconstructedMesh.subMeshes=[];var _=this._reconstructedMesh.getIndices(),x=this._mesh.getIndices();for(t=0;t<n.length;++t)r=n[t],[0,1,2].forEach(function(e){var t=x[r.originalOffset+e],i=r.vertices[e].originalOffsets.indexOf(t);i<0&&(i=0),_.push(r.vertices[e].id+i+v)});this._reconstructedMesh.setIndices(_),this._reconstructedMesh.setVerticesData(s.VertexBuffer.PositionKind,a),this._reconstructedMesh.setVerticesData(s.VertexBuffer.NormalKind,o),h.length>0&&this._reconstructedMesh.setVerticesData(s.VertexBuffer.UVKind,h),c.length>0&&this._reconstructedMesh.setVerticesData(s.VertexBuffer.ColorKind,c);var b=this._mesh.subMeshes[e];e>0&&(this._reconstructedMesh.subMeshes=[],y.forEach(function(e){u.b.AddToMesh(e.materialIndex,e.verticesStart,e.verticesCount,e.indexStart,e.indexCount,e.getMesh())}),u.b.AddToMesh(b.materialIndex,v,p,m,3*n.length,this._reconstructedMesh))},e.prototype.initDecimatedMesh=function(){this._reconstructedMesh=new h.Mesh(this._mesh.name+"Decimated",this._mesh.getScene()),this._reconstructedMesh.material=this._mesh.material,this._reconstructedMesh.parent=this._mesh.parent,this._reconstructedMesh.isVisible=!1,this._reconstructedMesh.renderingGroupId=this._mesh.renderingGroupId},e.prototype.isFlipped=function(e,t,r,i,n){for(var s=0;s<e.triangleCount;++s){var a=this.triangles[this.references[e.triangleStart+s].triangleId];if(!a.deleted){var u=this.references[e.triangleStart+s].vertexId,h=a.vertices[(u+1)%3],c=a.vertices[(u+2)%3];if(h!==t&&c!==t){var l=h.position.subtract(r);l=l.normalize();var f=c.position.subtract(r);if(f=f.normalize(),Math.abs(o.Vector3.Dot(l,f))>.999)return!0;var d=o.Vector3.Cross(l,f).normalize();if(i[s]=!1,o.Vector3.Dot(d,a.normal)<.2)return!0}else i[s]=!0,n.push(a)}}return!1},e.prototype.updateTriangles=function(e,t,r,i){for(var n=i,s=0;s<t.triangleCount;++s){var a=this.references[t.triangleStart+s],o=this.triangles[a.triangleId];o.deleted||(r[s]&&o.deletePending?(o.deleted=!0,n++):(o.vertices[a.vertexId]=e,o.isDirty=!0,o.error[0]=this.calculateError(o.vertices[0],o.vertices[1])+o.borderFactor/2,o.error[1]=this.calculateError(o.vertices[1],o.vertices[2])+o.borderFactor/2,o.error[2]=this.calculateError(o.vertices[2],o.vertices[0])+o.borderFactor/2,o.error[3]=Math.min(o.error[0],o.error[1],o.error[2]),this.references.push(a)))}return n},e.prototype.identifyBorder=function(){for(var e=0;e<this.vertices.length;++e){var t,r=[],i=[],n=this.vertices[e];for(t=0;t<n.triangleCount;++t)for(var s=this.triangles[this.references[n.triangleStart+t].triangleId],a=0;a<3;a++){for(var o=0,u=s.vertices[a];o<r.length&&i[o]!==u.id;)++o;o===r.length?(r.push(1),i.push(u.id)):r[o]++}for(t=0;t<r.length;++t)1===r[t]?this.vertices[i[t]].isBorder=!0:this.vertices[i[t]].isBorder=!1}},e.prototype.updateMesh=function(e){var t,r,i,n;if(void 0===e&&(e=!1),!e){var s=[];for(t=0;t<this.triangles.length;++t)this.triangles[t].deleted||s.push(this.triangles[t]);this.triangles=s}for(t=0;t<this.vertices.length;++t)this.vertices[t].triangleCount=0,this.vertices[t].triangleStart=0;for(t=0;t<this.triangles.length;++t)for(r=this.triangles[t],i=0;i<3;++i)(n=r.vertices[i]).triangleCount++;var a=0;for(t=0;t<this.vertices.length;++t)this.vertices[t].triangleStart=a,a+=this.vertices[t].triangleCount,this.vertices[t].triangleCount=0;var o=new Array(3*this.triangles.length);for(t=0;t<this.triangles.length;++t)for(r=this.triangles[t],i=0;i<3;++i)o[(n=r.vertices[i]).triangleStart+n.triangleCount]=new B(i,t),n.triangleCount++;this.references=o,e&&this.identifyBorder()},e.prototype.vertexError=function(e,t){var r=t.x,i=t.y,n=t.z;return e.data[0]*r*r+2*e.data[1]*r*i+2*e.data[2]*r*n+2*e.data[3]*r+e.data[4]*i*i+2*e.data[5]*i*n+2*e.data[6]*i+e.data[7]*n*n+2*e.data[8]*n+e.data[9]},e.prototype.calculateError=function(e,t,r){var i=e.q.add(t.q),n=e.isBorder&&t.isBorder,s=0,a=i.det(0,1,2,1,4,5,2,5,7);if(0===a||n){var u=e.position.add(t.position).divide(new o.Vector3(2,2,2)),h=this.vertexError(i,e.position),c=this.vertexError(i,t.position),l=this.vertexError(i,u);(s=Math.min(h,c,l))===h?r&&r.copyFrom(e.position):s===c?r&&r.copyFrom(t.position):r&&r.copyFrom(u)}else r||(r=o.Vector3.Zero()),r.x=-1/a*i.det(1,2,3,4,5,6,5,7,8),r.y=1/a*i.det(0,2,3,1,5,6,2,7,8),r.z=-1/a*i.det(0,1,3,1,4,6,2,5,8),s=this.vertexError(i,r);return s},e}(),E=r(19),S=r(15);Object.defineProperty(E.Scene.prototype,"simplificationQueue",{get:function(){if(!this._simplificationQueue){this._simplificationQueue=new T;var e=this._getComponent(S.a.NAME_SIMPLIFICATIONQUEUE);e||(e=new C(this),this._addComponent(e))}return this._simplificationQueue},set:function(e){this._simplificationQueue=e},enumerable:!0,configurable:!0}),h.Mesh.prototype.simplify=function(e,t,r,n){return void 0===t&&(t=!0),void 0===r&&(r=i.QUADRATIC),this.getScene().simplificationQueue.addTask({settings:e,parallelProcessing:t,mesh:this,simplificationType:r,successCallback:n}),this};var C=function(){function e(e){this.name=S.a.NAME_SIMPLIFICATIONQUEUE,this.scene=e}return e.prototype.register=function(){this.scene._beforeCameraUpdateStage.registerStep(S.a.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE,this,this._beforeCameraUpdate)},e.prototype.rebuild=function(){},e.prototype.dispose=function(){},e.prototype._beforeCameraUpdate=function(){this.scene._simplificationQueue&&!this.scene._simplificationQueue.running&&this.scene._simplificationQueue.executeNext()},e}(),P=r(134),O=r(49);r.d(t,"a",function(){return n.a}),r.d(t,"d",function(){return s.Buffer}),r.d(t,"F",function(){return s.VertexBuffer}),r.d(t,"h",function(){return a.a}),r.d(t,"e",function(){return g}),r.d(t,"i",function(){return m.d}),r.d(t,"J",function(){return m.l}),r.d(t,"u",function(){return m.g}),r.d(t,"c",function(){return m.a}),r.d(t,"z",function(){return m.h}),r.d(t,"g",function(){return m.c}),r.d(t,"f",function(){return m.b}),r.d(t,"C",function(){return m.j}),r.d(t,"j",function(){return m.e}),r.d(t,"B",function(){return m.i}),r.d(t,"r",function(){return m.f}),r.d(t,"D",function(){return m.k}),r.d(t,"k",function(){return v.a}),r.d(t,"m",function(){return y.a}),r.d(t,"n",function(){return _.b}),r.d(t,"l",function(){return _.a}),r.d(t,"q",function(){return h.MeshLODLevel}),r.d(t,"H",function(){return h._CreationDataStorage}),r.d(t,"I",function(){return h._InstancesBatch}),r.d(t,"o",function(){return h.Mesh}),r.d(t,"G",function(){return x.VertexData}),r.d(t,"p",function(){return b.MeshBuilder}),r.d(t,"x",function(){return M}),r.d(t,"w",function(){return T}),r.d(t,"y",function(){return i}),r.d(t,"v",function(){return C}),r.d(t,"s",function(){return P.a}),r.d(t,"t",function(){return P.b}),r.d(t,"b",function(){return u.a}),r.d(t,"A",function(){return u.b}),r.d(t,"E",function(){return O.a})},264:function(e,t,r){"use strict";var i=r(160),n=r(213),s=r(105),a=r(2),o=r(113),u=r(112),h=r(29),c=r(9),l=r(79),f=function(){function e(e,t,r,i,n,s,a,o,u){this.onProcessFileCallback=function(){return!0},this._engine=e,this._currentScene=t,this._sceneLoadedCallback=r,this._progressCallback=i,this._additionalRenderLoopLogicCallback=n,this._textureLoadingCallback=s,this._startingProcessingFilesCallback=a,this._onReloadCallback=o,this._errorCallback=u}return Object.defineProperty(e,"FilesToLoad",{get:function(){return l.a.FilesToLoad},enumerable:!0,configurable:!0}),e.prototype.monitorElementForDragNDrop=function(e){var t=this;e&&(this._elementToMonitor=e,this._dragEnterHandler=function(e){t.drag(e)},this._dragOverHandler=function(e){t.drag(e)},this._dropHandler=function(e){t.drop(e)},this._elementToMonitor.addEventListener("dragenter",this._dragEnterHandler,!1),this._elementToMonitor.addEventListener("dragover",this._dragOverHandler,!1),this._elementToMonitor.addEventListener("drop",this._dropHandler,!1))},e.prototype.dispose=function(){this._elementToMonitor&&(this._elementToMonitor.removeEventListener("dragenter",this._dragEnterHandler),this._elementToMonitor.removeEventListener("dragover",this._dragOverHandler),this._elementToMonitor.removeEventListener("drop",this._dropHandler))},e.prototype.renderFunction=function(){if(this._additionalRenderLoopLogicCallback&&this._additionalRenderLoopLogicCallback(),this._currentScene){if(this._textureLoadingCallback){var e=this._currentScene.getWaitingItemsCount();e>0&&this._textureLoadingCallback(e)}this._currentScene.render()}},e.prototype.drag=function(e){e.stopPropagation(),e.preventDefault()},e.prototype.drop=function(e){e.stopPropagation(),e.preventDefault(),this.loadFiles(e)},e.prototype._traverseFolder=function(e,t,r,i){var n=this,s=e.createReader(),a=e.fullPath.replace(/^\//,"").replace(/(.+?)\/?$/,"$1/");s.readEntries(function(e){r.count+=e.length;for(var s=0,o=e;s<o.length;s++){var u=o[s];u.isFile?u.file(function(e){e.correctName=a+e.name,t.push(e),0==--r.count&&i()}):u.isDirectory&&n._traverseFolder(u,t,r,i)}--r.count&&i()})},e.prototype._processFiles=function(t){for(var r=0;r<t.length;r++){var i=t[r].correctName.toLowerCase(),n=i.split(".").pop();this.onProcessFileCallback(t[r],i,n)&&("babylon"!==n&&"stl"!==n&&"obj"!==n&&"gltf"!==n&&"glb"!==n||-1!==i.indexOf(".binary.babylon")||-1!==i.indexOf(".incremental.babylon")||(this._sceneFileToLoad=t[r]),e.FilesToLoad[i]=t[r])}},e.prototype.loadFiles=function(e){var t=this;if(e&&e.dataTransfer&&e.dataTransfer.files&&(this._filesToLoad=e.dataTransfer.files),e&&e.target&&e.target.files&&(this._filesToLoad=e.target.files),this._filesToLoad&&0!==this._filesToLoad.length&&(this._startingProcessingFilesCallback&&this._startingProcessingFilesCallback(this._filesToLoad),this._filesToLoad&&this._filesToLoad.length>0)){for(var r=new Array,i=[],n=e.dataTransfer?e.dataTransfer.items:null,s=0;s<this._filesToLoad.length;s++){var a=this._filesToLoad[s],o=a.name.toLowerCase(),u=void 0;if(a.correctName=o,n){var h=n[s];h.getAsEntry?u=h.getAsEntry():h.webkitGetAsEntry&&(u=h.webkitGetAsEntry())}u&&u.isDirectory?i.push(u):r.push(a)}if(0===i.length)this._processFiles(r),this._processReload();else for(var c={count:i.length},l=0,f=i;l<f.length;l++){var d=f[l];this._traverseFolder(d,r,c,function(){t._processFiles(r),0===c.count&&t._processReload()})}}},e.prototype._processReload=function(){this._onReloadCallback?this._onReloadCallback(this._sceneFileToLoad):this.reload()},e.prototype.reload=function(){var e=this;this._sceneFileToLoad?(this._currentScene&&(c.a.errorsCount>0&&c.a.ClearLogCache(),this._engine.stopRenderLoop()),h.a.LoadAsync("file:",this._sceneFileToLoad,this._engine,function(t){e._progressCallback&&e._progressCallback(t)}).then(function(t){e._currentScene&&e._currentScene.dispose(),e._currentScene=t,e._sceneLoadedCallback&&e._sceneLoadedCallback(e._sceneFileToLoad,e._currentScene),e._currentScene.executeWhenReady(function(){e._engine.runRenderLoop(function(){e.renderFunction()})})}).catch(function(t){e._errorCallback&&e._errorCallback(e._sceneFileToLoad,e._currentScene,t.message)})):c.a.Error("Please provide a valid .babylon file.")},e}(),d=r(98),p=r(197),g=r(198),m=r(149),v=r(7),y=r(162),_=r(163),x=r(239),b=r(240),V=r(36),M=r(80),T=r(27),D=r(101),A=r(119),I=r(5),B=r(241),w=r(104),E=r(242),S=r(26),C=r(41),P=r(55),O=r(59),F=r(243);r.d(t,"b",function(){return i.a}),r.d(t,"c",function(){return n.AssetTaskState}),r.d(t,"a",function(){return n.AbstractAssetTask}),r.d(t,"e",function(){return n.AssetsProgressEvent}),r.d(t,"E",function(){return n.MeshAssetTask}),r.d(t,"fb",function(){return n.TextFileAssetTask}),r.d(t,"g",function(){return n.BinaryFileAssetTask}),r.d(t,"x",function(){return n.ImageAssetTask}),r.d(t,"gb",function(){return n.TextureAssetTask}),r.d(t,"k",function(){return n.CubeTextureAssetTask}),r.d(t,"u",function(){return n.HDRCubeTextureAssetTask}),r.d(t,"d",function(){return n.AssetsManager}),r.d(t,"m",function(){return s.a}),r.d(t,"pb",function(){return a.b}),r.d(t,"qb",function(){return a.c}),r.d(t,"zb",function(){return a.l}),r.d(t,"sb",function(){return a.e}),r.d(t,"vb",function(){return a.h}),r.d(t,"Ab",function(){return a.m}),r.d(t,"Bb",function(){return a.n}),r.d(t,"xb",function(){return a.j}),r.d(t,"ub",function(){return a.g}),r.d(t,"tb",function(){return a.f}),r.d(t,"wb",function(){return a.i}),r.d(t,"yb",function(){return a.k}),r.d(t,"rb",function(){return a.d}),r.d(t,"Y",function(){return a.a}),r.d(t,"o",function(){return o.a}),r.d(t,"p",function(){return u.a}),r.d(t,"s",function(){return f}),r.d(t,"j",function(){return d.a}),r.d(t,"v",function(){return p.a}),r.d(t,"I",function(){return g.a}),r.d(t,"z",function(){return m.a}),r.d(t,"q",function(){return v.a}),r.d(t,"H",function(){return v.d}),r.d(t,"F",function(){return v.b}),r.d(t,"G",function(){return v.c}),r.d(t,"L",function(){return y.a}),r.d(t,"S",function(){return y.b}),r.d(t,"P",function(){return _.a}),r.d(t,"T",function(){return x.h}),r.d(t,"hb",function(){return x.l}),r.d(t,"w",function(){return x.b}),r.d(t,"Z",function(){return x.k}),r.d(t,"N",function(){return x.f}),r.d(t,"A",function(){return x.c}),r.d(t,"l",function(){return x.a}),r.d(t,"J",function(){return x.e}),r.d(t,"Q",function(){return x.g}),r.d(t,"D",function(){return x.d}),r.d(t,"V",function(){return x.j}),r.d(t,"U",function(){return x.i}),r.d(t,"W",function(){return b.a}),r.d(t,"ab",function(){return V.a}),r.d(t,"bb",function(){return V.b}),r.d(t,"cb",function(){return M.a}),r.d(t,"eb",function(){return T.a}),r.d(t,"ib",function(){return D.a}),r.d(t,"db",function(){return A.a}),r.d(t,"i",function(){return I.c}),r.d(t,"h",function(){return I.b}),r.d(t,"r",function(){return I.d}),r.d(t,"B",function(){return I.e}),r.d(t,"R",function(){return I.g}),r.d(t,"jb",function(){return I.h}),r.d(t,"K",function(){return I.f}),r.d(t,"ob",function(){return I.i}),r.d(t,"f",function(){return I.a}),r.d(t,"kb",function(){return B.a}),r.d(t,"y",function(){return w.a}),r.d(t,"lb",function(){return w.b}),r.d(t,"mb",function(){return E.a}),r.d(t,"C",function(){return c.a}),r.d(t,"nb",function(){return S.a}),r.d(t,"t",function(){return l.a}),r.d(t,"n",function(){return C.a}),r.d(t,"M",function(){return P.a}),r.d(t,"O",function(){return O.a}),r.d(t,"X",function(){return F.a}),r.d(t,"nb",function(){return S.a})},28:function(e,t,r){"use strict";r.r(t),r.d(t,"MeshBuilder",function(){return d});var i=r(5),n=r(19),s=r(0),a=r(10),o=r(3),u=r(82),h=r(24),c=r(148),l=r(134),f=r(53);a.Mesh.CreateRibbon=function(e,t,r,i,n,s,a,o,u){return void 0===r&&(r=!1),void 0===a&&(a=!1),d.CreateRibbon(e,{pathArray:t,closeArray:r,closePath:i,offset:n,updatable:a,sideOrientation:o,instance:u},s)},a.Mesh.CreateDisc=function(e,t,r,i,n,s){void 0===i&&(i=null);var a={radius:t,tessellation:r,sideOrientation:s,updatable:n};return d.CreateDisc(e,a,i)},a.Mesh.CreateBox=function(e,t,r,i,n){void 0===r&&(r=null);var s={size:t,sideOrientation:n,updatable:i};return d.CreateBox(e,s,r)},a.Mesh.CreateSphere=function(e,t,r,i,n,s){var a={segments:t,diameterX:r,diameterY:r,diameterZ:r,sideOrientation:s,updatable:n};return d.CreateSphere(e,a,i)},a.Mesh.CreateCylinder=function(e,t,r,i,s,o,u,h,c){void 0!==u&&u instanceof n.Scene||(void 0!==u&&(c=h||a.Mesh.DEFAULTSIDE,h=u),u=o,o=1);var l={height:t,diameterTop:r,diameterBottom:i,tessellation:s,subdivisions:o,sideOrientation:c,updatable:h};return d.CreateCylinder(e,l,u)},a.Mesh.CreateTorus=function(e,t,r,i,n,s,a){var o={diameter:t,thickness:r,tessellation:i,sideOrientation:a,updatable:s};return d.CreateTorus(e,o,n)},a.Mesh.CreateTorusKnot=function(e,t,r,i,n,s,a,o,u,h){var c={radius:t,tube:r,radialSegments:i,tubularSegments:n,p:s,q:a,sideOrientation:h,updatable:u};return d.CreateTorusKnot(e,c,o)},a.Mesh.CreateLines=function(e,t,r,i,n){void 0===r&&(r=null),void 0===i&&(i=!1),void 0===n&&(n=null);var s={points:t,updatable:i,instance:n};return d.CreateLines(e,s,r)},a.Mesh.CreateDashedLines=function(e,t,r,i,n,s,a,o){void 0===s&&(s=null);var u={points:t,dashSize:r,gapSize:i,dashNb:n,updatable:a,instance:o};return d.CreateDashedLines(e,u,s)},a.Mesh.CreatePolygon=function(e,t,r,i,n,s){var a={shape:t,holes:i,updatable:n,sideOrientation:s};return d.CreatePolygon(e,a,r)},a.Mesh.ExtrudePolygon=function(e,t,r,i,n,s,a){var o={shape:t,holes:n,depth:r,updatable:s,sideOrientation:a};return d.ExtrudePolygon(e,o,i)},a.Mesh.ExtrudeShape=function(e,t,r,i,n,s,o,u,h,c){void 0===o&&(o=null);var l={shape:t,path:r,scale:i,rotation:n,cap:0===s?0:s||a.Mesh.NO_CAP,sideOrientation:h,instance:c,updatable:u};return d.ExtrudeShape(e,l,o)},a.Mesh.ExtrudeShapeCustom=function(e,t,r,i,n,s,o,u,h,c,l,f){var p={shape:t,path:r,scaleFunction:i,rotationFunction:n,ribbonCloseArray:s,ribbonClosePath:o,cap:0===u?0:u||a.Mesh.NO_CAP,sideOrientation:l,instance:f,updatable:c};return d.ExtrudeShapeCustom(e,p,h)},a.Mesh.CreateLathe=function(e,t,r,i,n,s,a){var o={shape:t,radius:r,tessellation:i,sideOrientation:a,updatable:s};return d.CreateLathe(e,o,n)},a.Mesh.CreatePlane=function(e,t,r,i,n){var s={size:t,width:t,height:t,sideOrientation:n,updatable:i};return d.CreatePlane(e,s,r)},a.Mesh.CreateGround=function(e,t,r,i,n,s){var a={width:t,height:r,subdivisions:i,updatable:s};return d.CreateGround(e,a,n)},a.Mesh.CreateTiledGround=function(e,t,r,i,n,s,a,o,u){var h={xmin:t,zmin:r,xmax:i,zmax:n,subdivisions:s,precision:a,updatable:u};return d.CreateTiledGround(e,h,o)},a.Mesh.CreateGroundFromHeightMap=function(e,t,r,i,n,s,a,o,u,h,c){var l={width:r,height:i,subdivisions:n,minHeight:s,maxHeight:a,updatable:u,onReady:h,alphaFilter:c};return d.CreateGroundFromHeightMap(e,t,l,o)},a.Mesh.CreateTube=function(e,t,r,i,n,s,a,o,u,h){var c={path:t,radius:r,tessellation:i,radiusFunction:n,arc:1,cap:s,updatable:o,sideOrientation:u,instance:h};return d.CreateTube(e,c,a)},a.Mesh.CreatePolyhedron=function(e,t,r){return d.CreatePolyhedron(e,t,r)},a.Mesh.CreateIcoSphere=function(e,t,r){return d.CreateIcoSphere(e,t,r)},a.Mesh.CreateDecal=function(e,t,r,i,n,s){var a={position:r,normal:i,size:n,angle:s};return d.CreateDecal(e,t,a)};var d=function(){function e(){}return e._UpdateSideOrientation=function(e){return e==a.Mesh.DOUBLESIDE?a.Mesh.DOUBLESIDE:null==e?a.Mesh.FRONTSIDE:e},e.CreateBox=function(t,r,i){void 0===i&&(i=null);var n=new a.Mesh(t,i);return r.sideOrientation=e._UpdateSideOrientation(r.sideOrientation),n._originalBuilderSideOrientation=r.sideOrientation,h.VertexData.CreateBox(r).applyToMesh(n,r.updatable),n},e.CreateSphere=function(t,r,i){var n=new a.Mesh(t,i);return r.sideOrientation=e._UpdateSideOrientation(r.sideOrientation),n._originalBuilderSideOrientation=r.sideOrientation,h.VertexData.CreateSphere(r).applyToMesh(n,r.updatable),n},e.CreateDisc=function(t,r,i){void 0===i&&(i=null);var n=new a.Mesh(t,i);return r.sideOrientation=e._UpdateSideOrientation(r.sideOrientation),n._originalBuilderSideOrientation=r.sideOrientation,h.VertexData.CreateDisc(r).applyToMesh(n,r.updatable),n},e.CreateIcoSphere=function(t,r,i){var n=new a.Mesh(t,i);return r.sideOrientation=e._UpdateSideOrientation(r.sideOrientation),n._originalBuilderSideOrientation=r.sideOrientation,h.VertexData.CreateIcoSphere(r).applyToMesh(n,r.updatable),n},e.CreateRibbon=function(t,r,i){void 0===i&&(i=null);var n=r.pathArray,u=r.closeArray,c=r.closePath,l=e._UpdateSideOrientation(r.sideOrientation),d=r.instance,p=r.updatable;if(d){var g=s.Tmp.Vector3[0].setAll(Number.MAX_VALUE),m=s.Tmp.Vector3[1].setAll(-Number.MAX_VALUE),v=d.getVerticesData(o.VertexBuffer.PositionKind);if(function(e){for(var t=n[0].length,r=d,i=0,s=r._originalBuilderSideOrientation===a.Mesh.DOUBLESIDE?2:1,o=1;o<=s;++o)for(var u=0;u<n.length;++u){var h=n[u],c=h.length;t=t<c?t:c;for(var l=0;l<t;++l){var f=h[l];e[i]=f.x,e[i+1]=f.y,e[i+2]=f.z,g.minimizeInPlaceFromFloats(f.x,f.y,f.z),m.maximizeInPlaceFromFloats(f.x,f.y,f.z),i+=3}r._creationDataStorage&&r._creationDataStorage.closePath&&(f=h[0],e[i]=f.x,e[i+1]=f.y,e[i+2]=f.z,i+=3)}}(v),d._boundingInfo?d._boundingInfo.reConstruct(g,m,d._worldMatrix):d._boundingInfo=new f.a(g,m,d._worldMatrix),d.updateVerticesData(o.VertexBuffer.PositionKind,v,!1,!1),r.colors){for(var y=d.getVerticesData(o.VertexBuffer.ColorKind),_=0,x=0;_<r.colors.length;_++,x+=4){var b=r.colors[_];y[x]=b.r,y[x+1]=b.g,y[x+2]=b.b,y[x+3]=b.a}d.updateVerticesData(o.VertexBuffer.ColorKind,y,!1,!1)}if(r.uvs){for(var V=d.getVerticesData(o.VertexBuffer.UVKind),M=0;M<r.uvs.length;M++)V[2*M]=r.uvs[M].x,V[2*M+1]=r.uvs[M].y;d.updateVerticesData(o.VertexBuffer.UVKind,V,!1,!1)}if(!d.areNormalsFrozen||d.isFacetDataEnabled){var T=d.getIndices(),D=d.getVerticesData(o.VertexBuffer.NormalKind),A=d.isFacetDataEnabled?d.getFacetDataParameters():null;if(h.VertexData.ComputeNormals(v,T,D,A),d._creationDataStorage&&d._creationDataStorage.closePath)for(var I=0,B=0,w=0;w<n.length;w++)I=3*d._creationDataStorage.idx[w],B=w+1<n.length?3*(d._creationDataStorage.idx[w+1]-1):D.length-3,D[I]=.5*(D[I]+D[B]),D[I+1]=.5*(D[I+1]+D[B+1]),D[I+2]=.5*(D[I+2]+D[B+2]),D[B]=D[I],D[B+1]=D[I+1],D[B+2]=D[I+2];d.areNormalsFrozen||d.updateVerticesData(o.VertexBuffer.NormalKind,D,!1,!1)}return d}var E=new a.Mesh(t,i);E._originalBuilderSideOrientation=l,E._creationDataStorage=new a._CreationDataStorage;var S=h.VertexData.CreateRibbon(r);return c&&(E._creationDataStorage.idx=S._idx),E._creationDataStorage.closePath=c,E._creationDataStorage.closeArray=u,S.applyToMesh(E,p),E},e.CreateCylinder=function(t,r,i){var n=new a.Mesh(t,i);return r.sideOrientation=e._UpdateSideOrientation(r.sideOrientation),n._originalBuilderSideOrientation=r.sideOrientation,h.VertexData.CreateCylinder(r).applyToMesh(n,r.updatable),n},e.CreateTorus=function(t,r,i){var n=new a.Mesh(t,i);return r.sideOrientation=e._UpdateSideOrientation(r.sideOrientation),n._originalBuilderSideOrientation=r.sideOrientation,h.VertexData.CreateTorus(r).applyToMesh(n,r.updatable),n},e.CreateTorusKnot=function(t,r,i){var n=new a.Mesh(t,i);return r.sideOrientation=e._UpdateSideOrientation(r.sideOrientation),n._originalBuilderSideOrientation=r.sideOrientation,h.VertexData.CreateTorusKnot(r).applyToMesh(n,r.updatable),n},e.CreateLineSystem=function(e,t,r){var i=t.instance,n=t.lines,s=t.colors;if(i){var a,c,l=i.getVerticesData(o.VertexBuffer.PositionKind);s&&(a=i.getVerticesData(o.VertexBuffer.ColorKind));for(var f=0,d=0,p=0;p<n.length;p++)for(var g=n[p],m=0;m<g.length;m++)l[f]=g[m].x,l[f+1]=g[m].y,l[f+2]=g[m].z,s&&a&&(c=s[p],a[d]=c[m].r,a[d+1]=c[m].g,a[d+2]=c[m].b,a[d+3]=c[m].a,d+=4),f+=3;return i.updateVerticesData(o.VertexBuffer.PositionKind,l,!1,!1),s&&a&&i.updateVerticesData(o.VertexBuffer.ColorKind,a,!1,!1),i}var v=!!s,y=new u.b(e,r,null,void 0,void 0,v,t.useVertexAlpha);return h.VertexData.CreateLineSystem(t).applyToMesh(y,t.updatable),y},e.CreateLines=function(t,r,i){void 0===i&&(i=null);var n=r.colors?[r.colors]:null;return e.CreateLineSystem(t,{lines:[r.points],updatable:r.updatable,instance:r.instance,colors:n,useVertexAlpha:r.useVertexAlpha},i)},e.CreateDashedLines=function(e,t,r){void 0===r&&(r=null);var i=t.points,n=t.instance,o=t.gapSize||1,c=t.dashSize||3;if(n){return n.updateMeshPositions(function(e){var t,r,a=s.Vector3.Zero(),o=e.length/6,u=0,h=0,c=0,l=0,f=0,d=0;for(f=0;f<i.length-1;f++)i[f+1].subtractToRef(i[f],a),u+=a.length();t=u/o;var p=n._creationDataStorage.dashSize;for(r=p*t/(p+n._creationDataStorage.gapSize),f=0;f<i.length-1;f++)for(i[f+1].subtractToRef(i[f],a),h=Math.floor(a.length()/t),a.normalize(),d=0;d<h&&l<e.length;)c=t*d,e[l]=i[f].x+c*a.x,e[l+1]=i[f].y+c*a.y,e[l+2]=i[f].z+c*a.z,e[l+3]=i[f].x+(c+r)*a.x,e[l+4]=i[f].y+(c+r)*a.y,e[l+5]=i[f].z+(c+r)*a.z,l+=6,d++;for(;l<e.length;)e[l]=i[f].x,e[l+1]=i[f].y,e[l+2]=i[f].z,l+=3},!1),n}var l=new u.b(e,r);return h.VertexData.CreateDashedLines(t).applyToMesh(l,t.updatable),l._creationDataStorage=new a._CreationDataStorage,l._creationDataStorage.dashSize=c,l._creationDataStorage.gapSize=o,l},e.ExtrudeShape=function(t,r,i){void 0===i&&(i=null);var n=r.path,s=r.shape,o=r.scale||1,u=r.rotation||0,h=0===r.cap?0:r.cap||a.Mesh.NO_CAP,c=r.updatable,l=e._UpdateSideOrientation(r.sideOrientation),f=r.instance||null,d=r.invertUV||!1;return e._ExtrudeShapeGeneric(t,s,n,o,u,null,null,!1,!1,h,!1,i,!!c,l,f,d,r.frontUVs||null,r.backUVs||null)},e.ExtrudeShapeCustom=function(t,r,i){var n=r.path,s=r.shape,o=r.scaleFunction||function(){return 1},u=r.rotationFunction||function(){return 0},h=r.ribbonCloseArray||!1,c=r.ribbonClosePath||!1,l=0===r.cap?0:r.cap||a.Mesh.NO_CAP,f=r.updatable,d=e._UpdateSideOrientation(r.sideOrientation),p=r.instance,g=r.invertUV||!1;return e._ExtrudeShapeGeneric(t,s,n,null,null,o,u,h,c,l,!0,i,!!f,d,p||null,g,r.frontUVs||null,r.backUVs||null)},e.CreateLathe=function(t,r,i){var n,o=r.arc?r.arc<=0||r.arc>1?1:r.arc:1,u=void 0===r.closed||r.closed,h=r.shape,c=r.radius||1,l=r.tessellation||64,f=r.clip||0,d=r.updatable,p=e._UpdateSideOrientation(r.sideOrientation),g=r.cap||a.Mesh.NO_CAP,m=2*Math.PI,v=new Array,y=r.invertUV||!1,_=0,x=0,b=m/l*o,V=new Array;for(_=0;_<=l-f;_++){V=[];for(g!=a.Mesh.CAP_START&&g!=a.Mesh.CAP_ALL||(V.push(new s.Vector3(0,h[0].y,0)),V.push(new s.Vector3(Math.cos(_*b)*h[0].x*c,h[0].y,Math.sin(_*b)*h[0].x*c))),x=0;x<h.length;x++)n=new s.Vector3(Math.cos(_*b)*h[x].x*c,h[x].y,Math.sin(_*b)*h[x].x*c),V.push(n);g!=a.Mesh.CAP_END&&g!=a.Mesh.CAP_ALL||(V.push(new s.Vector3(Math.cos(_*b)*h[h.length-1].x*c,h[h.length-1].y,Math.sin(_*b)*h[h.length-1].x*c)),V.push(new s.Vector3(0,h[h.length-1].y,0))),v.push(V)}return e.CreateRibbon(t,{pathArray:v,closeArray:u,sideOrientation:p,updatable:d,invertUV:y,frontUVs:r.frontUVs,backUVs:r.backUVs},i)},e.CreatePlane=function(t,r,i){var n=new a.Mesh(t,i);return r.sideOrientation=e._UpdateSideOrientation(r.sideOrientation),n._originalBuilderSideOrientation=r.sideOrientation,h.VertexData.CreatePlane(r).applyToMesh(n,r.updatable),r.sourcePlane&&(n.translate(r.sourcePlane.normal,-r.sourcePlane.d),n.setDirection(r.sourcePlane.normal.scale(-1))),n},e.CreateGround=function(e,t,r){var i=new c.a(e,r);return i._setReady(!1),i._subdivisionsX=t.subdivisionsX||t.subdivisions||1,i._subdivisionsY=t.subdivisionsY||t.subdivisions||1,i._width=t.width||1,i._height=t.height||1,i._maxX=i._width/2,i._maxZ=i._height/2,i._minX=-i._maxX,i._minZ=-i._maxZ,h.VertexData.CreateGround(t).applyToMesh(i,t.updatable),i._setReady(!0),i},e.CreateTiledGround=function(e,t,r){var i=new a.Mesh(e,r);return h.VertexData.CreateTiledGround(t).applyToMesh(i,t.updatable),i},e.CreateGroundFromHeightMap=function(e,t,r,n){var a=r.width||10,o=r.height||10,u=r.subdivisions||1,l=r.minHeight||0,f=r.maxHeight||1,d=r.colorFilter||new s.Color3(.3,.59,.11),p=r.alphaFilter||0,g=r.updatable,m=r.onReady,v=new c.a(e,n);v._subdivisionsX=u,v._subdivisionsY=u,v._width=a,v._height=o,v._maxX=v._width/2,v._maxZ=v._height/2,v._minX=-v._maxX,v._minZ=-v._maxZ,v._setReady(!1);return i.h.LoadImage(t,function(e){var t=document.createElement("canvas"),r=t.getContext("2d");if(!r)throw new Error("Unable to get 2d context for CreateGroundFromHeightMap");if(!n.isDisposed){var i=e.width,s=e.height;t.width=i,t.height=s,r.drawImage(e,0,0);var c=r.getImageData(0,0,i,s).data;h.VertexData.CreateGroundFromHeightMap({width:a,height:o,subdivisions:u,minHeight:l,maxHeight:f,colorFilter:d,buffer:c,bufferWidth:i,bufferHeight:s,alphaFilter:p}).applyToMesh(v,g),m&&m(v),v._setReady(!0)}},function(){},n.offlineProvider),v},e.CreatePolygon=function(t,r,i){r.sideOrientation=e._UpdateSideOrientation(r.sideOrientation);for(var n=r.shape,a=r.holes||[],o=r.depth||0,u=[],c=[],f=0;f<n.length;f++)u[f]=new s.Vector2(n[f].x,n[f].z);u[0].equalsWithEpsilon(u[u.length-1],1e-8)&&u.pop();for(var d=new l.b(t,u,i),p=0;p<a.length;p++){c=[];for(var g=0;g<a[p].length;g++)c.push(new s.Vector2(a[p][g].x,a[p][g].z));d.addHole(c)}var m=d.build(r.updatable,o);return m._originalBuilderSideOrientation=r.sideOrientation,h.VertexData.CreatePolygon(m,r.sideOrientation,r.faceUV,r.faceColors,r.frontUVs,r.backUVs).applyToMesh(m,r.updatable),m},e.ExtrudePolygon=function(t,r,i){return e.CreatePolygon(t,r,i)},e.CreateTube=function(t,r,i){var n=r.path,o=r.instance,u=1;void 0!==r.radius?u=r.radius:o&&(u=o._creationDataStorage.radius);var h=r.tessellation||64,c=r.radiusFunction||null,l=r.cap||a.Mesh.NO_CAP,f=r.invertUV||!1,d=r.updatable,p=e._UpdateSideOrientation(r.sideOrientation);r.arc=r.arc&&(r.arc<=0||r.arc>1)?1:r.arc||1;var g,m,v=function(e,t,r,i,n,o,u,h){for(var c,l,f,d,p=t.getTangents(),g=t.getNormals(),m=t.getDistances(),v=2*Math.PI/n*h,y=o||function(){return i},_=s.Tmp.Matrix[0],x=u===a.Mesh.NO_CAP||u===a.Mesh.CAP_END?0:2,b=0;b<e.length;b++){l=y(b,m[b]),c=Array(),f=g[b];for(var V=0;V<n;V++)s.Matrix.RotationAxisToRef(p[b],v*V,_),d=c[V]?c[V]:s.Vector3.Zero(),s.Vector3.TransformCoordinatesToRef(f,_,d),d.scaleInPlace(l).addInPlace(e[b]),c[V]=d;r[x]=c,x++}var M=function(t,r){for(var i=Array(),n=0;n<t;n++)i.push(e[r]);return i};switch(u){case a.Mesh.NO_CAP:break;case a.Mesh.CAP_START:r[0]=M(n,0),r[1]=r[2].slice(0);break;case a.Mesh.CAP_END:r[x]=r[x-1].slice(0),r[x+1]=M(n,e.length-1);break;case a.Mesh.CAP_ALL:r[0]=M(n,0),r[1]=r[2].slice(0),r[x]=r[x-1].slice(0),r[x+1]=M(n,e.length-1)}return r};if(o){var y=o._creationDataStorage,_=r.arc||y.arc;return m=v(n,g=y.path3D.update(n),y.pathArray,u,y.tessellation,c,y.cap,_),o=e.CreateRibbon("",{pathArray:m,instance:o}),y.path3D=g,y.pathArray=m,y.arc=_,y.radius=u,o}m=v(n,g=new s.Path3D(n),new Array,u,h,c,l=l<0||l>3?0:l,r.arc);var x=e.CreateRibbon(t,{pathArray:m,closePath:!0,closeArray:!1,updatable:d,sideOrientation:p,invertUV:f,frontUVs:r.frontUVs,backUVs:r.backUVs},i);return x._creationDataStorage.pathArray=m,x._creationDataStorage.path3D=g,x._creationDataStorage.tessellation=h,x._creationDataStorage.cap=l,x._creationDataStorage.arc=r.arc,x._creationDataStorage.radius=u,x},e.CreatePolyhedron=function(t,r,i){var n=new a.Mesh(t,i);return r.sideOrientation=e._UpdateSideOrientation(r.sideOrientation),n._originalBuilderSideOrientation=r.sideOrientation,h.VertexData.CreatePolyhedron(r).applyToMesh(n,r.updatable),n},e.CreateDecal=function(e,t,r){var i=t.getIndices(),n=t.getVerticesData(o.VertexBuffer.PositionKind),u=t.getVerticesData(o.VertexBuffer.NormalKind),c=r.position||s.Vector3.Zero(),l=r.normal||s.Vector3.Up(),f=r.size||s.Vector3.One(),d=r.angle||0;if(!l){var p=new s.Vector3(0,0,1),g=t.getScene().activeCamera,m=s.Vector3.TransformCoordinates(p,g.getWorldMatrix());l=g.globalPosition.subtract(m)}var v=-Math.atan2(l.z,l.x)-Math.PI/2,y=Math.sqrt(l.x*l.x+l.z*l.z),_=Math.atan2(l.y,y),x=s.Matrix.RotationYawPitchRoll(v,_,d).multiply(s.Matrix.Translation(c.x,c.y,c.z)),b=s.Matrix.Invert(x),V=t.getWorldMatrix().multiply(b),M=new h.VertexData;M.indices=[],M.positions=[],M.normals=[],M.uvs=[];for(var T=0,D=function(e){var t=new s.PositionNormalVertex;if(!i||!n||!u)return t;var r=i[e];return t.position=new s.Vector3(n[3*r],n[3*r+1],n[3*r+2]),t.position=s.Vector3.TransformCoordinates(t.position,V),t.normal=new s.Vector3(u[3*r],u[3*r+1],u[3*r+2]),t.normal=s.Vector3.TransformNormal(t.normal,V),t},A=function(e,t){if(0===e.length)return e;for(var r=.5*Math.abs(s.Vector3.Dot(f,t)),i=function(e,i){var n=s.Vector3.GetClipFactor(e.position,i.position,t,r);return new s.PositionNormalVertex(s.Vector3.Lerp(e.position,i.position,n),s.Vector3.Lerp(e.normal,i.normal,n))},n=new Array,a=0;a<e.length;a+=3){var o,u,h,c=null,l=null,d=null,p=null;switch(((o=s.Vector3.Dot(e[a].position,t)-r>0)?1:0)+((u=s.Vector3.Dot(e[a+1].position,t)-r>0)?1:0)+((h=s.Vector3.Dot(e[a+2].position,t)-r>0)?1:0)){case 0:n.push(e[a]),n.push(e[a+1]),n.push(e[a+2]);break;case 1:if(o&&(c=e[a+1],l=e[a+2],d=i(e[a],c),p=i(e[a],l)),u){c=e[a],l=e[a+2],d=i(e[a+1],c),p=i(e[a+1],l),n.push(d),n.push(l.clone()),n.push(c.clone()),n.push(l.clone()),n.push(d.clone()),n.push(p);break}h&&(c=e[a],l=e[a+1],d=i(e[a+2],c),p=i(e[a+2],l)),c&&l&&d&&p&&(n.push(c.clone()),n.push(l.clone()),n.push(d),n.push(p),n.push(d.clone()),n.push(l.clone()));break;case 2:o||(l=i(c=e[a].clone(),e[a+1]),d=i(c,e[a+2]),n.push(c),n.push(l),n.push(d)),u||(l=i(c=e[a+1].clone(),e[a+2]),d=i(c,e[a]),n.push(c),n.push(l),n.push(d)),h||(l=i(c=e[a+2].clone(),e[a]),d=i(c,e[a+1]),n.push(c),n.push(l),n.push(d))}}return n},I=0;I<i.length;I+=3){var B=new Array;if(B.push(D(I)),B.push(D(I+1)),B.push(D(I+2)),B=A(B,new s.Vector3(1,0,0)),B=A(B,new s.Vector3(-1,0,0)),B=A(B,new s.Vector3(0,1,0)),B=A(B,new s.Vector3(0,-1,0)),B=A(B,new s.Vector3(0,0,1)),0!==(B=A(B,new s.Vector3(0,0,-1))).length)for(var w=0;w<B.length;w++){var E=B[w];M.indices.push(T),E.position.toArray(M.positions,3*T),E.normal.toArray(M.normals,3*T),M.uvs.push(.5+E.position.x/f.x),M.uvs.push(.5+E.position.y/f.y),T++}}var S=new a.Mesh(e,t.getScene());return M.applyToMesh(S),S.position=c.clone(),S.rotation=new s.Vector3(_,v,d),S},e._ExtrudeShapeGeneric=function(t,r,i,n,o,u,h,c,l,f,d,p,g,m,v,y,_,x){var b,V,M=function(e,t,r,i,n,o,u,h,c,l){for(var f=r.getTangents(),d=r.getNormals(),p=r.getBinormals(),g=r.getDistances(),m=0,v=l&&h?h:function(){return null!==o?o:0},y=l&&u?u:function(){return null!==n?n:1},_=c===a.Mesh.NO_CAP||c===a.Mesh.CAP_END?0:2,x=s.Tmp.Matrix[0],b=0;b<t.length;b++){for(var V=new Array,M=v(b,g[b]),T=y(b,g[b]),D=0;D<e.length;D++){s.Matrix.RotationAxisToRef(f[b],m,x);var A=f[b].scale(e[D].z).add(d[b].scale(e[D].x)).add(p[b].scale(e[D].y)),I=V[D]?V[D]:s.Vector3.Zero();s.Vector3.TransformCoordinatesToRef(A,x,I),I.scaleInPlace(T).addInPlace(t[b]),V[D]=I}i[_]=V,m+=M,_++}var B=function(e){var t,r=Array(),i=s.Vector3.Zero();for(t=0;t<e.length;t++)i.addInPlace(e[t]);for(i.scaleInPlace(1/e.length),t=0;t<e.length;t++)r.push(i);return r};switch(c){case a.Mesh.NO_CAP:break;case a.Mesh.CAP_START:i[0]=B(i[2]),i[1]=i[2];break;case a.Mesh.CAP_END:i[_]=i[_-1],i[_+1]=B(i[_-1]);break;case a.Mesh.CAP_ALL:i[0]=B(i[2]),i[1]=i[2],i[_]=i[_-1],i[_+1]=B(i[_-1])}return i};if(v){var T=v._creationDataStorage;return b=T.path3D.update(i),V=M(r,i,T.path3D,T.pathArray,n,o,u,h,T.cap,d),v=a.Mesh.CreateRibbon("",V,!1,!1,0,p||void 0,!1,0,v)}V=M(r,i,b=new s.Path3D(i),new Array,n,o,u,h,f=f<0||f>3?0:f,d);var D=e.CreateRibbon(t,{pathArray:V,closeArray:c,closePath:l,updatable:g,sideOrientation:m,invertUV:y,frontUVs:_||void 0,backUVs:x||void 0},p);return D._creationDataStorage.pathArray=V,D._creationDataStorage.path3D=b,D._creationDataStorage.cap=f,D},e}()},3:function(e,t,r){"use strict";r.r(t),r.d(t,"Buffer",function(){return i}),r.d(t,"VertexBuffer",function(){return n});var i=function(){function e(e,t,r,i,n,s,a){void 0===i&&(i=0),void 0===n&&(n=!1),void 0===s&&(s=!1),void 0===a&&(a=!1),e.getScene?this._engine=e.getScene().getEngine():this._engine=e,this._updatable=r,this._instanced=s,this._data=t,this.byteStride=a?i:i*Float32Array.BYTES_PER_ELEMENT,n||this.create()}return e.prototype.createVertexBuffer=function(e,t,r,i,s,a){void 0===a&&(a=!1);var o=a?t:t*Float32Array.BYTES_PER_ELEMENT,u=i?a?i:i*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new n(this._engine,this,e,this._updatable,!0,u,void 0===s?this._instanced:s,o,r,void 0,void 0,!0)},e.prototype.isUpdatable=function(){return this._updatable},e.prototype.getData=function(){return this._data},e.prototype.getBuffer=function(){return this._buffer},e.prototype.getStrideSize=function(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT},e.prototype.create=function(e){void 0===e&&(e=null),!e&&this._buffer||(e=e||this._data)&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,e),this._data=e):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(e),this._data=e):this._buffer=this._engine.createVertexBuffer(e))},e.prototype._rebuild=function(){this._buffer=null,this.create(this._data)},e.prototype.update=function(e){this.create(e)},e.prototype.updateDirectly=function(e,t,r,i){void 0===i&&(i=!1),this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,e,i?t:t*Float32Array.BYTES_PER_ELEMENT,r?r*this.byteStride:void 0),this._data=null)},e.prototype.dispose=function(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)},e}(),n=function(){function e(t,r,n,s,a,o,u,h,c,l,f,d){if(void 0===f&&(f=!1),void 0===d&&(d=!1),r instanceof i?(this._buffer=r,this._ownsBuffer=!1):(this._buffer=new i(t,r,s,o,a,u,d),this._ownsBuffer=!0),this._kind=n,null==l){var p=this.getData();this.type=e.FLOAT,p instanceof Int8Array?this.type=e.BYTE:p instanceof Uint8Array?this.type=e.UNSIGNED_BYTE:p instanceof Int16Array?this.type=e.SHORT:p instanceof Uint16Array?this.type=e.UNSIGNED_SHORT:p instanceof Int32Array?this.type=e.INT:p instanceof Uint32Array&&(this.type=e.UNSIGNED_INT)}else this.type=l;var g=e.GetTypeByteLength(this.type);d?(this._size=c||(o?o/g:e.DeduceStride(n)),this.byteStride=o||this._buffer.byteStride||this._size*g,this.byteOffset=h||0):(this._size=c||o||e.DeduceStride(n),this.byteStride=o?o*g:this._buffer.byteStride||this._size*g,this.byteOffset=(h||0)*g),this.normalized=f,this._instanced=void 0!==u&&u,this._instanceDivisor=u?1:0}return Object.defineProperty(e.prototype,"instanceDivisor",{get:function(){return this._instanceDivisor},set:function(e){this._instanceDivisor=e,this._instanced=0!=e},enumerable:!0,configurable:!0}),e.prototype._rebuild=function(){this._buffer&&this._buffer._rebuild()},e.prototype.getKind=function(){return this._kind},e.prototype.isUpdatable=function(){return this._buffer.isUpdatable()},e.prototype.getData=function(){return this._buffer.getData()},e.prototype.getBuffer=function(){return this._buffer.getBuffer()},e.prototype.getStrideSize=function(){return this.byteStride/e.GetTypeByteLength(this.type)},e.prototype.getOffset=function(){return this.byteOffset/e.GetTypeByteLength(this.type)},e.prototype.getSize=function(){return this._size},e.prototype.getIsInstanced=function(){return this._instanced},e.prototype.getInstanceDivisor=function(){return this._instanceDivisor},e.prototype.create=function(e){this._buffer.create(e)},e.prototype.update=function(e){this._buffer.update(e)},e.prototype.updateDirectly=function(e,t,r){void 0===r&&(r=!1),this._buffer.updateDirectly(e,t,void 0,r)},e.prototype.dispose=function(){this._ownsBuffer&&this._buffer.dispose()},e.prototype.forEach=function(t,r){e.ForEach(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,t,this.normalized,r)},e.DeduceStride=function(t){switch(t){case e.UVKind:case e.UV2Kind:case e.UV3Kind:case e.UV4Kind:case e.UV5Kind:case e.UV6Kind:return 2;case e.NormalKind:case e.PositionKind:return 3;case e.ColorKind:case e.MatricesIndicesKind:case e.MatricesIndicesExtraKind:case e.MatricesWeightsKind:case e.MatricesWeightsExtraKind:case e.TangentKind:return 4;default:throw new Error("Invalid kind '"+t+"'")}},e.GetTypeByteLength=function(t){switch(t){case e.BYTE:case e.UNSIGNED_BYTE:return 1;case e.SHORT:case e.UNSIGNED_SHORT:return 2;case e.INT:case e.FLOAT:return 4;default:throw new Error("Invalid type '"+t+"'")}},e.ForEach=function(t,r,i,n,s,a,o,u){if(t instanceof Array)for(var h=r/4,c=i/4,l=0;l<a;l+=n){for(var f=0;f<n;f++)u(t[h+f],l+f);h+=c}else{var d=t instanceof ArrayBuffer?new DataView(t):new DataView(t.buffer,t.byteOffset,t.byteLength),p=e.GetTypeByteLength(s);for(l=0;l<a;l+=n){var g=r;for(f=0;f<n;f++){u(e._GetFloatValue(d,s,g,o),l+f),g+=p}r+=i}}},e._GetFloatValue=function(t,r,i,n){switch(r){case e.BYTE:var s=t.getInt8(i);return n&&(s=Math.max(s/127,-1)),s;case e.UNSIGNED_BYTE:s=t.getUint8(i);return n&&(s/=255),s;case e.SHORT:s=t.getInt16(i,!0);return n&&(s=Math.max(s/16383,-1)),s;case e.UNSIGNED_SHORT:s=t.getUint16(i,!0);return n&&(s/=65535),s;case e.FLOAT:return t.getFloat32(i,!0);default:throw new Error("Invalid component type "+r)}},e.BYTE=5120,e.UNSIGNED_BYTE=5121,e.SHORT=5122,e.UNSIGNED_SHORT=5123,e.INT=5124,e.UNSIGNED_INT=5125,e.FLOAT=5126,e.PositionKind="position",e.NormalKind="normal",e.TangentKind="tangent",e.UVKind="uv",e.UV2Kind="uv2",e.UV3Kind="uv3",e.UV4Kind="uv4",e.UV5Kind="uv5",e.UV6Kind="uv6",e.ColorKind="color",e.MatricesIndicesKind="matricesIndices",e.MatricesWeightsKind="matricesWeights",e.MatricesIndicesExtraKind="matricesIndicesExtra",e.MatricesWeightsExtraKind="matricesWeightsExtra",e}()},32:function(e,t,r){"use strict";r.d(t,"d",function(){return d}),r.d(t,"l",function(){return p}),r.d(t,"g",function(){return g}),r.d(t,"a",function(){return m}),r.d(t,"h",function(){return v}),r.d(t,"c",function(){return y}),r.d(t,"b",function(){return _}),r.d(t,"j",function(){return x}),r.d(t,"e",function(){return b}),r.d(t,"i",function(){return V}),r.d(t,"f",function(){return M}),r.d(t,"k",function(){return T});var i=r(1),n=r(0),s=r(24),a=r(3),o=r(56),u=r(66),h=r(53),c=r(4),l=r(5),f=r(27),d=function(){function e(e,t,r,i,n){void 0===i&&(i=!1),void 0===n&&(n=null),this.delayLoadState=c.a.DELAYLOADSTATE_NONE,this._totalVertices=0,this._isDisposed=!1,this._indexBufferIsUpdatable=!1,this.id=e,this.uniqueId=t.getUniqueId(),this._engine=t.getEngine(),this._meshes=[],this._scene=t,this._vertexBuffers={},this._indices=[],this._updatable=i,r?this.setAllVerticesData(r,i):(this._totalVertices=0,this._indices=[]),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObjects={}),n&&(this.applyToMesh(n),n.computeWorldMatrix(!0))}return Object.defineProperty(e.prototype,"boundingBias",{get:function(){return this._boundingBias},set:function(e){this._boundingBias?this._boundingBias.copyFrom(e):this._boundingBias=e.clone(),this._updateBoundingInfo(!0,null)},enumerable:!0,configurable:!0}),e.CreateGeometryForMesh=function(t){var r=new e(e.RandomId(),t.getScene());return r.applyToMesh(t),r},Object.defineProperty(e.prototype,"extend",{get:function(){return this._extend},enumerable:!0,configurable:!0}),e.prototype.getScene=function(){return this._scene},e.prototype.getEngine=function(){return this._engine},e.prototype.isReady=function(){return this.delayLoadState===c.a.DELAYLOADSTATE_LOADED||this.delayLoadState===c.a.DELAYLOADSTATE_NONE},Object.defineProperty(e.prototype,"doNotSerialize",{get:function(){for(var e=0;e<this._meshes.length;e++)if(!this._meshes[e].doNotSerialize)return!1;return!0},enumerable:!0,configurable:!0}),e.prototype._rebuild=function(){for(var e in this._vertexArrayObjects&&(this._vertexArrayObjects={}),0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices)),this._vertexBuffers){this._vertexBuffers[e]._rebuild()}},e.prototype.setAllVerticesData=function(e,t){e.applyToGeometry(this,t),this.notifyUpdate()},e.prototype.setVerticesData=function(e,t,r,i){void 0===r&&(r=!1);var n=new a.VertexBuffer(this._engine,t,e,r,0===this._meshes.length,i);this.setVerticesBuffer(n)},e.prototype.removeVerticesData=function(e){this._vertexBuffers[e]&&(this._vertexBuffers[e].dispose(),delete this._vertexBuffers[e])},e.prototype.setVerticesBuffer=function(e,t){void 0===t&&(t=null);var r=e.getKind();if(this._vertexBuffers[r]&&this._vertexBuffers[r].dispose(),this._vertexBuffers[r]=e,r===a.VertexBuffer.PositionKind){var i=e.getData();null!=t?this._totalVertices=t:null!=i&&(this._totalVertices=i.length/(e.byteStride/4)),this._updateExtend(i),this._resetPointsArrayCache();for(var n=this._meshes,s=n.length,o=0;o<s;o++){var u=n[o];u._boundingInfo=new h.a(this._extend.minimum,this._extend.maximum),u._createGlobalSubMesh(!1),u.computeWorldMatrix(!0)}}this.notifyUpdate(r),this._vertexArrayObjects&&(this._disposeVertexArrayObjects(),this._vertexArrayObjects={})},e.prototype.updateVerticesDataDirectly=function(e,t,r,i){void 0===i&&(i=!1);var n=this.getVertexBuffer(e);n&&(n.updateDirectly(t,r,i),this.notifyUpdate(e))},e.prototype.updateVerticesData=function(e,t,r){void 0===r&&(r=!1);var i=this.getVertexBuffer(e);i&&(i.update(t),e===a.VertexBuffer.PositionKind&&this._updateBoundingInfo(r,t),this.notifyUpdate(e))},e.prototype._updateBoundingInfo=function(e,t){if(e&&this._updateExtend(t),this._resetPointsArrayCache(),e)for(var r=0,i=this._meshes;r<i.length;r++){var n=i[r];n._boundingInfo?n._boundingInfo.reConstruct(this._extend.minimum,this._extend.maximum):n._boundingInfo=new h.a(this._extend.minimum,this._extend.maximum);for(var s=0,a=n.subMeshes;s<a.length;s++){a[s].refreshBoundingInfo()}}},e.prototype._bind=function(e,t){if(e){void 0===t&&(t=this._indexBuffer);var r=this.getVertexBuffers();r&&(t==this._indexBuffer&&this._vertexArrayObjects?(this._vertexArrayObjects[e.key]||(this._vertexArrayObjects[e.key]=this._engine.recordVertexArrayObject(r,t,e)),this._engine.bindVertexArrayObject(this._vertexArrayObjects[e.key],t)):this._engine.bindBuffers(r,t,e))}},e.prototype.getTotalVertices=function(){return this.isReady()?this._totalVertices:0},e.prototype.getVerticesData=function(e,t,r){var i=this.getVertexBuffer(e);if(!i)return null;var n=i.getData();if(!n)return null;var s=i.getSize()*a.VertexBuffer.GetTypeByteLength(i.type),o=this._totalVertices*i.getSize();if(i.type!==a.VertexBuffer.FLOAT||i.byteStride!==s){var u=[];return i.forEach(o,function(e){return u.push(e)}),u}if(!(n instanceof Array||n instanceof Float32Array)||0!==i.byteOffset||n.length!==o){if(n instanceof Array){var h=i.byteOffset/4;return l.h.Slice(n,h,h+o)}if(n instanceof ArrayBuffer)return new Float32Array(n,i.byteOffset,o);h=n.byteOffset+i.byteOffset;if(r||t&&1!==this._meshes.length){var c=new Float32Array(o),f=new Float32Array(n.buffer,h,o);return c.set(f),c}return new Float32Array(n.buffer,h,o)}return r||t&&1!==this._meshes.length?l.h.Slice(n):n},e.prototype.isVertexBufferUpdatable=function(e){var t=this._vertexBuffers[e];return!!t&&t.isUpdatable()},e.prototype.getVertexBuffer=function(e){return this.isReady()?this._vertexBuffers[e]:null},e.prototype.getVertexBuffers=function(){return this.isReady()?this._vertexBuffers:null},e.prototype.isVerticesDataPresent=function(e){return this._vertexBuffers?void 0!==this._vertexBuffers[e]:!!this._delayInfo&&-1!==this._delayInfo.indexOf(e)},e.prototype.getVerticesDataKinds=function(){var e,t=[];if(!this._vertexBuffers&&this._delayInfo)for(e in this._delayInfo)t.push(e);else for(e in this._vertexBuffers)t.push(e);return t},e.prototype.updateIndices=function(e,t){if(this._indexBuffer)if(this._indexBufferIsUpdatable){var r=e.length!==this._indices.length;if(this._indices=e,this._engine.updateDynamicIndexBuffer(this._indexBuffer,e,t),r)for(var i=0,n=this._meshes;i<n.length;i++){n[i]._createGlobalSubMesh(!0)}}else this.setIndices(e,null,!0)},e.prototype.setIndices=function(e,t,r){void 0===t&&(t=null),void 0===r&&(r=!1),this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._disposeVertexArrayObjects(),this._indices=e,this._indexBufferIsUpdatable=r,0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,r)),null!=t&&(this._totalVertices=t);for(var i=0,n=this._meshes;i<n.length;i++){n[i]._createGlobalSubMesh(!0)}this.notifyUpdate()},e.prototype.getTotalIndices=function(){return this.isReady()?this._indices.length:0},e.prototype.getIndices=function(e,t){if(!this.isReady())return null;var r=this._indices;if(t||e&&1!==this._meshes.length){for(var i=r.length,n=[],s=0;s<i;s++)n.push(r[s]);return n}return r},e.prototype.getIndexBuffer=function(){return this.isReady()?this._indexBuffer:null},e.prototype._releaseVertexArrayObject=function(e){void 0===e&&(e=null),e&&this._vertexArrayObjects&&this._vertexArrayObjects[e.key]&&(this._engine.releaseVertexArrayObject(this._vertexArrayObjects[e.key]),delete this._vertexArrayObjects[e.key])},e.prototype.releaseForMesh=function(e,t){var r=this._meshes,i=r.indexOf(e);-1!==i&&(r.splice(i,1),e._geometry=null,0===r.length&&t&&this.dispose())},e.prototype.applyToMesh=function(e){if(e._geometry!==this){var t=e._geometry;t&&t.releaseForMesh(e);var r=this._meshes;e._geometry=this,this._scene.pushGeometry(this),r.push(e),this.isReady()?this._applyToMesh(e):e._boundingInfo=this._boundingInfo}},e.prototype._updateExtend=function(e){void 0===e&&(e=null),e||(e=this.getVerticesData(a.VertexBuffer.PositionKind)),this._extend=l.h.ExtractMinAndMax(e,0,this._totalVertices,this.boundingBias,3)},e.prototype._applyToMesh=function(e){var t=this._meshes.length;for(var r in this._vertexBuffers){1===t&&this._vertexBuffers[r].create();var i=this._vertexBuffers[r].getBuffer();i&&(i.references=t),r===a.VertexBuffer.PositionKind&&(this._extend||this._updateExtend(),e._boundingInfo=new h.a(this._extend.minimum,this._extend.maximum),e._createGlobalSubMesh(!1),e._updateBoundingInfo())}1===t&&this._indices&&this._indices.length>0&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices)),this._indexBuffer&&(this._indexBuffer.references=t),e._syncGeometryWithMorphTargetManager(),e.synchronizeInstances()},e.prototype.notifyUpdate=function(e){this.onGeometryUpdated&&this.onGeometryUpdated(this,e);for(var t=0,r=this._meshes;t<r.length;t++){r[t]._markSubMeshesAsAttributesDirty()}},e.prototype.load=function(e,t){this.delayLoadState!==c.a.DELAYLOADSTATE_LOADING&&(this.isReady()?t&&t():(this.delayLoadState=c.a.DELAYLOADSTATE_LOADING,this._queueLoad(e,t)))},e.prototype._queueLoad=function(e,t){var r=this;this.delayLoadingFile&&(e._addPendingData(this),e._loadFile(this.delayLoadingFile,function(i){if(r._delayLoadingFunction){r._delayLoadingFunction(JSON.parse(i),r),r.delayLoadState=c.a.DELAYLOADSTATE_LOADED,r._delayInfo=[],e._removePendingData(r);for(var n=r._meshes,s=n.length,a=0;a<s;a++)r._applyToMesh(n[a]);t&&t()}},void 0,!0))},e.prototype.toLeftHanded=function(){var e=this.getIndices(!1);if(null!=e&&e.length>0){for(var t=0;t<e.length;t+=3){var r=e[t+0];e[t+0]=e[t+2],e[t+2]=r}this.setIndices(e)}var i=this.getVerticesData(a.VertexBuffer.PositionKind,!1);if(null!=i&&i.length>0){for(t=0;t<i.length;t+=3)i[t+2]=-i[t+2];this.setVerticesData(a.VertexBuffer.PositionKind,i,!1)}var n=this.getVerticesData(a.VertexBuffer.NormalKind,!1);if(null!=n&&n.length>0){for(t=0;t<n.length;t+=3)n[t+2]=-n[t+2];this.setVerticesData(a.VertexBuffer.NormalKind,n,!1)}},e.prototype._resetPointsArrayCache=function(){this._positions=null},e.prototype._generatePointsArray=function(){if(this._positions)return!0;var e=this.getVerticesData(a.VertexBuffer.PositionKind);if(!e||0===e.length)return!1;this._positions=[];for(var t=0;t<e.length;t+=3)this._positions.push(n.Vector3.FromArray(e,t));return!0},e.prototype.isDisposed=function(){return this._isDisposed},e.prototype._disposeVertexArrayObjects=function(){if(this._vertexArrayObjects){for(var e in this._vertexArrayObjects)this._engine.releaseVertexArrayObject(this._vertexArrayObjects[e]);this._vertexArrayObjects={}}},e.prototype.dispose=function(){var e,t=this._meshes,r=t.length;for(e=0;e<r;e++)this.releaseForMesh(t[e]);for(var i in this._meshes=[],this._disposeVertexArrayObjects(),this._vertexBuffers)this._vertexBuffers[i].dispose();this._vertexBuffers={},this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=c.a.DELAYLOADSTATE_NONE,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._isDisposed=!0},e.prototype.copy=function(t){var r=new s.VertexData;r.indices=[];var i=this.getIndices();if(i)for(var n=0;n<i.length;n++)r.indices.push(i[n]);var a,o=!1,u=!1;for(a in this._vertexBuffers){var c=this.getVerticesData(a);if(c&&(c instanceof Float32Array?r.set(new Float32Array(c),a):r.set(c.slice(0),a),!u)){var l=this.getVertexBuffer(a);l&&(u=!(o=l.isUpdatable()))}}var f=new e(t,this._scene,r,o);for(a in f.delayLoadState=this.delayLoadState,f.delayLoadingFile=this.delayLoadingFile,f._delayLoadingFunction=this._delayLoadingFunction,this._delayInfo)f._delayInfo=f._delayInfo||[],f._delayInfo.push(a);return f._boundingInfo=new h.a(this._extend.minimum,this._extend.maximum),f},e.prototype.serialize=function(){var e={};return e.id=this.id,e.updatable=this._updatable,f.a&&f.a.HasTags(this)&&(e.tags=f.a.GetTags(this)),e},e.prototype.toNumberArray=function(e){return Array.isArray(e)?e:Array.prototype.slice.call(e)},e.prototype.serializeVerticeData=function(){var e=this.serialize();return this.isVerticesDataPresent(a.VertexBuffer.PositionKind)&&(e.positions=this.toNumberArray(this.getVerticesData(a.VertexBuffer.PositionKind)),this.isVertexBufferUpdatable(a.VertexBuffer.PositionKind)&&(e.positions._updatable=!0)),this.isVerticesDataPresent(a.VertexBuffer.NormalKind)&&(e.normals=this.toNumberArray(this.getVerticesData(a.VertexBuffer.NormalKind)),this.isVertexBufferUpdatable(a.VertexBuffer.NormalKind)&&(e.normals._updatable=!0)),this.isVerticesDataPresent(a.VertexBuffer.TangentKind)&&(e.tangets=this.toNumberArray(this.getVerticesData(a.VertexBuffer.TangentKind)),this.isVertexBufferUpdatable(a.VertexBuffer.TangentKind)&&(e.tangets._updatable=!0)),this.isVerticesDataPresent(a.VertexBuffer.UVKind)&&(e.uvs=this.toNumberArray(this.getVerticesData(a.VertexBuffer.UVKind)),this.isVertexBufferUpdatable(a.VertexBuffer.UVKind)&&(e.uvs._updatable=!0)),this.isVerticesDataPresent(a.VertexBuffer.UV2Kind)&&(e.uv2s=this.toNumberArray(this.getVerticesData(a.VertexBuffer.UV2Kind)),this.isVertexBufferUpdatable(a.VertexBuffer.UV2Kind)&&(e.uv2s._updatable=!0)),this.isVerticesDataPresent(a.VertexBuffer.UV3Kind)&&(e.uv3s=this.toNumberArray(this.getVerticesData(a.VertexBuffer.UV3Kind)),this.isVertexBufferUpdatable(a.VertexBuffer.UV3Kind)&&(e.uv3s._updatable=!0)),this.isVerticesDataPresent(a.VertexBuffer.UV4Kind)&&(e.uv4s=this.toNumberArray(this.getVerticesData(a.VertexBuffer.UV4Kind)),this.isVertexBufferUpdatable(a.VertexBuffer.UV4Kind)&&(e.uv4s._updatable=!0)),this.isVerticesDataPresent(a.VertexBuffer.UV5Kind)&&(e.uv5s=this.toNumberArray(this.getVerticesData(a.VertexBuffer.UV5Kind)),this.isVertexBufferUpdatable(a.VertexBuffer.UV5Kind)&&(e.uv5s._updatable=!0)),this.isVerticesDataPresent(a.VertexBuffer.UV6Kind)&&(e.uv6s=this.toNumberArray(this.getVerticesData(a.VertexBuffer.UV6Kind)),this.isVertexBufferUpdatable(a.VertexBuffer.UV6Kind)&&(e.uv6s._updatable=!0)),this.isVerticesDataPresent(a.VertexBuffer.ColorKind)&&(e.colors=this.toNumberArray(this.getVerticesData(a.VertexBuffer.ColorKind)),this.isVertexBufferUpdatable(a.VertexBuffer.ColorKind)&&(e.colors._updatable=!0)),this.isVerticesDataPresent(a.VertexBuffer.MatricesIndicesKind)&&(e.matricesIndices=this.toNumberArray(this.getVerticesData(a.VertexBuffer.MatricesIndicesKind)),e.matricesIndices._isExpanded=!0,this.isVertexBufferUpdatable(a.VertexBuffer.MatricesIndicesKind)&&(e.matricesIndices._updatable=!0)),this.isVerticesDataPresent(a.VertexBuffer.MatricesWeightsKind)&&(e.matricesWeights=this.toNumberArray(this.getVerticesData(a.VertexBuffer.MatricesWeightsKind)),this.isVertexBufferUpdatable(a.VertexBuffer.MatricesWeightsKind)&&(e.matricesWeights._updatable=!0)),e.indices=this.toNumberArray(this.getIndices()),e},e.ExtractFromMesh=function(e,t){var r=e._geometry;return r?r.copy(t):null},e.RandomId=function(){return l.h.RandomId()},e._ImportGeometry=function(t,r){var i=r.getScene(),s=t.geometryId;if(s){var u=i.getGeometryByID(s);u&&u.applyToMesh(r)}else if(t instanceof ArrayBuffer){var h=r._binaryInfo;if(h.positionsAttrDesc&&h.positionsAttrDesc.count>0){var c=new Float32Array(t,h.positionsAttrDesc.offset,h.positionsAttrDesc.count);r.setVerticesData(a.VertexBuffer.PositionKind,c,!1)}if(h.normalsAttrDesc&&h.normalsAttrDesc.count>0){var l=new Float32Array(t,h.normalsAttrDesc.offset,h.normalsAttrDesc.count);r.setVerticesData(a.VertexBuffer.NormalKind,l,!1)}if(h.tangetsAttrDesc&&h.tangetsAttrDesc.count>0){var f=new Float32Array(t,h.tangetsAttrDesc.offset,h.tangetsAttrDesc.count);r.setVerticesData(a.VertexBuffer.TangentKind,f,!1)}if(h.uvsAttrDesc&&h.uvsAttrDesc.count>0){var d=new Float32Array(t,h.uvsAttrDesc.offset,h.uvsAttrDesc.count);r.setVerticesData(a.VertexBuffer.UVKind,d,!1)}if(h.uvs2AttrDesc&&h.uvs2AttrDesc.count>0){var p=new Float32Array(t,h.uvs2AttrDesc.offset,h.uvs2AttrDesc.count);r.setVerticesData(a.VertexBuffer.UV2Kind,p,!1)}if(h.uvs3AttrDesc&&h.uvs3AttrDesc.count>0){var g=new Float32Array(t,h.uvs3AttrDesc.offset,h.uvs3AttrDesc.count);r.setVerticesData(a.VertexBuffer.UV3Kind,g,!1)}if(h.uvs4AttrDesc&&h.uvs4AttrDesc.count>0){var m=new Float32Array(t,h.uvs4AttrDesc.offset,h.uvs4AttrDesc.count);r.setVerticesData(a.VertexBuffer.UV4Kind,m,!1)}if(h.uvs5AttrDesc&&h.uvs5AttrDesc.count>0){var v=new Float32Array(t,h.uvs5AttrDesc.offset,h.uvs5AttrDesc.count);r.setVerticesData(a.VertexBuffer.UV5Kind,v,!1)}if(h.uvs6AttrDesc&&h.uvs6AttrDesc.count>0){var y=new Float32Array(t,h.uvs6AttrDesc.offset,h.uvs6AttrDesc.count);r.setVerticesData(a.VertexBuffer.UV6Kind,y,!1)}if(h.colorsAttrDesc&&h.colorsAttrDesc.count>0){var _=new Float32Array(t,h.colorsAttrDesc.offset,h.colorsAttrDesc.count);r.setVerticesData(a.VertexBuffer.ColorKind,_,!1,h.colorsAttrDesc.stride)}if(h.matricesIndicesAttrDesc&&h.matricesIndicesAttrDesc.count>0){for(var x=new Int32Array(t,h.matricesIndicesAttrDesc.offset,h.matricesIndicesAttrDesc.count),b=[],V=0;V<x.length;V++){var M=x[V];b.push(255&M),b.push((65280&M)>>8),b.push((16711680&M)>>16),b.push(M>>24)}r.setVerticesData(a.VertexBuffer.MatricesIndicesKind,b,!1)}if(h.matricesWeightsAttrDesc&&h.matricesWeightsAttrDesc.count>0){var T=new Float32Array(t,h.matricesWeightsAttrDesc.offset,h.matricesWeightsAttrDesc.count);r.setVerticesData(a.VertexBuffer.MatricesWeightsKind,T,!1)}if(h.indicesAttrDesc&&h.indicesAttrDesc.count>0){var D=new Int32Array(t,h.indicesAttrDesc.offset,h.indicesAttrDesc.count);r.setIndices(D,null)}if(h.subMeshesAttrDesc&&h.subMeshesAttrDesc.count>0){var A=new Int32Array(t,h.subMeshesAttrDesc.offset,5*h.subMeshesAttrDesc.count);r.subMeshes=[];for(V=0;V<h.subMeshesAttrDesc.count;V++){var I=A[5*V+0],B=A[5*V+1],w=A[5*V+2],E=A[5*V+3],S=A[5*V+4];o.b.AddToMesh(I,B,w,E,S,r)}}}else if(t.positions&&t.normals&&t.indices){if(r.setVerticesData(a.VertexBuffer.PositionKind,t.positions,t.positions._updatable),r.setVerticesData(a.VertexBuffer.NormalKind,t.normals,t.normals._updatable),t.tangents&&r.setVerticesData(a.VertexBuffer.TangentKind,t.tangents,t.tangents._updatable),t.uvs&&r.setVerticesData(a.VertexBuffer.UVKind,t.uvs,t.uvs._updatable),t.uvs2&&r.setVerticesData(a.VertexBuffer.UV2Kind,t.uvs2,t.uvs2._updatable),t.uvs3&&r.setVerticesData(a.VertexBuffer.UV3Kind,t.uvs3,t.uvs3._updatable),t.uvs4&&r.setVerticesData(a.VertexBuffer.UV4Kind,t.uvs4,t.uvs4._updatable),t.uvs5&&r.setVerticesData(a.VertexBuffer.UV5Kind,t.uvs5,t.uvs5._updatable),t.uvs6&&r.setVerticesData(a.VertexBuffer.UV6Kind,t.uvs6,t.uvs6._updatable),t.colors&&r.setVerticesData(a.VertexBuffer.ColorKind,n.Color4.CheckColors4(t.colors,t.positions.length/3),t.colors._updatable),t.matricesIndices)if(t.matricesIndices._isExpanded)delete t.matricesIndices._isExpanded,r.setVerticesData(a.VertexBuffer.MatricesIndicesKind,t.matricesIndices,t.matricesIndices._updatable);else{for(b=[],V=0;V<t.matricesIndices.length;V++){var C=t.matricesIndices[V];b.push(255&C),b.push((65280&C)>>8),b.push((16711680&C)>>16),b.push(C>>24)}r.setVerticesData(a.VertexBuffer.MatricesIndicesKind,b,t.matricesIndices._updatable)}if(t.matricesIndicesExtra)if(t.matricesIndicesExtra._isExpanded)delete t.matricesIndices._isExpanded,r.setVerticesData(a.VertexBuffer.MatricesIndicesExtraKind,t.matricesIndicesExtra,t.matricesIndicesExtra._updatable);else{for(b=[],V=0;V<t.matricesIndicesExtra.length;V++){C=t.matricesIndicesExtra[V];b.push(255&C),b.push((65280&C)>>8),b.push((16711680&C)>>16),b.push(C>>24)}r.setVerticesData(a.VertexBuffer.MatricesIndicesExtraKind,b,t.matricesIndicesExtra._updatable)}t.matricesWeights&&(e._CleanMatricesWeights(t,r),r.setVerticesData(a.VertexBuffer.MatricesWeightsKind,t.matricesWeights,t.matricesWeights._updatable)),t.matricesWeightsExtra&&r.setVerticesData(a.VertexBuffer.MatricesWeightsExtraKind,t.matricesWeightsExtra,t.matricesWeights._updatable),r.setIndices(t.indices,null)}if(t.subMeshes){r.subMeshes=[];for(var P=0;P<t.subMeshes.length;P++){var O=t.subMeshes[P];o.b.AddToMesh(O.materialIndex,O.verticesStart,O.verticesCount,O.indexStart,O.indexCount,r)}}r._shouldGenerateFlatShading&&(r.convertToFlatShadedMesh(),delete r._shouldGenerateFlatShading),r.computeWorldMatrix(!0),i.onMeshImportedObservable.notifyObservers(r)},e._CleanMatricesWeights=function(e,t){if(u.a.CleanBoneMatrixWeights){var r=0;if(e.skeletonId>-1){var i=t.getScene().getLastSkeletonByID(e.skeletonId);if(i){r=i.bones.length;for(var n=t.getVerticesData(a.VertexBuffer.MatricesIndicesKind),s=t.getVerticesData(a.VertexBuffer.MatricesIndicesExtraKind),o=e.matricesWeights,h=e.matricesWeightsExtra,c=e.numBoneInfluencer,l=o.length,f=0;f<l;f+=4){for(var d=0,p=-1,g=0;g<4;g++){d+=m=o[f+g],m<.001&&p<0&&(p=g)}if(h)for(g=0;g<4;g++){var m;d+=m=h[f+g],m<.001&&p<0&&(p=g+4)}if((p<0||p>c-1)&&(p=c-1),d>.001){var v=1/d;for(g=0;g<4;g++)o[f+g]*=v;if(h)for(g=0;g<4;g++)h[f+g]*=v}else p>=4?(h[f+p-4]=1-d,s[f+p-4]=r):(o[f+p]=1-d,n[f+p]=r)}t.setVerticesData(a.VertexBuffer.MatricesIndicesKind,n),e.matricesWeightsExtra&&t.setVerticesData(a.VertexBuffer.MatricesIndicesExtraKind,s)}}}},e.Parse=function(t,r,i){if(r.getGeometryByID(t.id))return null;var o=new e(t.id,r,void 0,t.updatable);return f.a&&f.a.AddTagsTo(o,t.tags),t.delayLoadingFile?(o.delayLoadState=c.a.DELAYLOADSTATE_NOTLOADED,o.delayLoadingFile=i+t.delayLoadingFile,o._boundingInfo=new h.a(n.Vector3.FromArray(t.boundingBoxMinimum),n.Vector3.FromArray(t.boundingBoxMaximum)),o._delayInfo=[],t.hasUVs&&o._delayInfo.push(a.VertexBuffer.UVKind),t.hasUVs2&&o._delayInfo.push(a.VertexBuffer.UV2Kind),t.hasUVs3&&o._delayInfo.push(a.VertexBuffer.UV3Kind),t.hasUVs4&&o._delayInfo.push(a.VertexBuffer.UV4Kind),t.hasUVs5&&o._delayInfo.push(a.VertexBuffer.UV5Kind),t.hasUVs6&&o._delayInfo.push(a.VertexBuffer.UV6Kind),t.hasColors&&o._delayInfo.push(a.VertexBuffer.ColorKind),t.hasMatricesIndices&&o._delayInfo.push(a.VertexBuffer.MatricesIndicesKind),t.hasMatricesWeights&&o._delayInfo.push(a.VertexBuffer.MatricesWeightsKind),o._delayLoadingFunction=s.VertexData.ImportVertexData):s.VertexData.ImportVertexData(t,o),r.pushGeometry(o,!0),o},e}(),p=function(e){function t(t,r,i,n){void 0===i&&(i=!1),void 0===n&&(n=null);var s=e.call(this,t,r,void 0,!1,n)||this;return s._canBeRegenerated=i,s._beingRegenerated=!0,s.regenerate(),s._beingRegenerated=!1,s}return i.d(t,e),t.prototype.canBeRegenerated=function(){return this._canBeRegenerated},t.prototype.regenerate=function(){this._canBeRegenerated&&(this._beingRegenerated=!0,this.setAllVerticesData(this._regenerateVertexData(),!1),this._beingRegenerated=!1)},t.prototype.asNewGeometry=function(t){return e.prototype.copy.call(this,t)},t.prototype.setAllVerticesData=function(t,r){this._beingRegenerated&&e.prototype.setAllVerticesData.call(this,t,!1)},t.prototype.setVerticesData=function(t,r,i){this._beingRegenerated&&e.prototype.setVerticesData.call(this,t,r,!1)},t.prototype._regenerateVertexData=function(){throw new Error("Abstract method")},t.prototype.copy=function(e){throw new Error("Must be overriden in sub-classes.")},t.prototype.serialize=function(){var t=e.prototype.serialize.call(this);return t.canBeRegenerated=this.canBeRegenerated(),t},t}(d),g=function(e){function t(t,r,i,n,a,o,u,h,c){void 0===c&&(c=s.VertexData.DEFAULTSIDE);var l=e.call(this,t,r,u,h)||this;return l.pathArray=i,l.closeArray=n,l.closePath=a,l.offset=o,l.side=c,l}return i.d(t,e),t.prototype._regenerateVertexData=function(){return s.VertexData.CreateRibbon({pathArray:this.pathArray,closeArray:this.closeArray,closePath:this.closePath,offset:this.offset,sideOrientation:this.side})},t.prototype.copy=function(e){return new t(e,this.getScene(),this.pathArray,this.closeArray,this.closePath,this.offset,this.canBeRegenerated(),void 0,this.side)},t}(p),m=function(e){function t(t,r,i,n,a,o){void 0===a&&(a=null),void 0===o&&(o=s.VertexData.DEFAULTSIDE);var u=e.call(this,t,r,n,a)||this;return u.size=i,u.side=o,u}return i.d(t,e),t.prototype._regenerateVertexData=function(){return s.VertexData.CreateBox({size:this.size,sideOrientation:this.side})},t.prototype.copy=function(e){return new t(e,this.getScene(),this.size,this.canBeRegenerated(),void 0,this.side)},t.prototype.serialize=function(){var t=e.prototype.serialize.call(this);return t.size=this.size,t},t.Parse=function(e,r){if(r.getGeometryByID(e.id))return null;var i=new t(e.id,r,e.size,e.canBeRegenerated,null);return f.a&&f.a.AddTagsTo(i,e.tags),r.pushGeometry(i,!0),i},t}(p),v=function(e){function t(t,r,i,n,a,o,u){void 0===o&&(o=null),void 0===u&&(u=s.VertexData.DEFAULTSIDE);var h=e.call(this,t,r,a,o)||this;return h.segments=i,h.diameter=n,h.side=u,h}return i.d(t,e),t.prototype._regenerateVertexData=function(){return s.VertexData.CreateSphere({segments:this.segments,diameter:this.diameter,sideOrientation:this.side})},t.prototype.copy=function(e){return new t(e,this.getScene(),this.segments,this.diameter,this.canBeRegenerated(),null,this.side)},t.prototype.serialize=function(){var t=e.prototype.serialize.call(this);return t.segments=this.segments,t.diameter=this.diameter,t},t.Parse=function(e,r){if(r.getGeometryByID(e.id))return null;var i=new t(e.id,r,e.segments,e.diameter,e.canBeRegenerated,null);return f.a&&f.a.AddTagsTo(i,e.tags),r.pushGeometry(i,!0),i},t}(p),y=function(e){function t(t,r,i,n,a,o,u){void 0===o&&(o=null),void 0===u&&(u=s.VertexData.DEFAULTSIDE);var h=e.call(this,t,r,a,o)||this;return h.radius=i,h.tessellation=n,h.side=u,h}return i.d(t,e),t.prototype._regenerateVertexData=function(){return s.VertexData.CreateDisc({radius:this.radius,tessellation:this.tessellation,sideOrientation:this.side})},t.prototype.copy=function(e){return new t(e,this.getScene(),this.radius,this.tessellation,this.canBeRegenerated(),null,this.side)},t}(p),_=function(e){function t(t,r,i,n,a,o,u,h,c,l){void 0===u&&(u=1),void 0===c&&(c=null),void 0===l&&(l=s.VertexData.DEFAULTSIDE);var f=e.call(this,t,r,h,c)||this;return f.height=i,f.diameterTop=n,f.diameterBottom=a,f.tessellation=o,f.subdivisions=u,f.side=l,f}return i.d(t,e),t.prototype._regenerateVertexData=function(){return s.VertexData.CreateCylinder({height:this.height,diameterTop:this.diameterTop,diameterBottom:this.diameterBottom,tessellation:this.tessellation,subdivisions:this.subdivisions,sideOrientation:this.side})},t.prototype.copy=function(e){return new t(e,this.getScene(),this.height,this.diameterTop,this.diameterBottom,this.tessellation,this.subdivisions,this.canBeRegenerated(),null,this.side)},t.prototype.serialize=function(){var t=e.prototype.serialize.call(this);return t.height=this.height,t.diameterTop=this.diameterTop,t.diameterBottom=this.diameterBottom,t.tessellation=this.tessellation,t},t.Parse=function(e,r){if(r.getGeometryByID(e.id))return null;var i=new t(e.id,r,e.height,e.diameterTop,e.diameterBottom,e.tessellation,e.subdivisions,e.canBeRegenerated,null);return f.a&&f.a.AddTagsTo(i,e.tags),r.pushGeometry(i,!0),i},t}(p),x=function(e){function t(t,r,i,n,a,o,u,h){void 0===u&&(u=null),void 0===h&&(h=s.VertexData.DEFAULTSIDE);var c=e.call(this,t,r,o,u)||this;return c.diameter=i,c.thickness=n,c.tessellation=a,c.side=h,c}return i.d(t,e),t.prototype._regenerateVertexData=function(){return s.VertexData.CreateTorus({diameter:this.diameter,thickness:this.thickness,tessellation:this.tessellation,sideOrientation:this.side})},t.prototype.copy=function(e){return new t(e,this.getScene(),this.diameter,this.thickness,this.tessellation,this.canBeRegenerated(),null,this.side)},t.prototype.serialize=function(){var t=e.prototype.serialize.call(this);return t.diameter=this.diameter,t.thickness=this.thickness,t.tessellation=this.tessellation,t},t.Parse=function(e,r){if(r.getGeometryByID(e.id))return null;var i=new t(e.id,r,e.diameter,e.thickness,e.tessellation,e.canBeRegenerated,null);return f.a&&f.a.AddTagsTo(i,e.tags),r.pushGeometry(i,!0),i},t}(p),b=function(e){function t(t,r,i,n,s,a,o){void 0===o&&(o=null);var u=e.call(this,t,r,a,o)||this;return u.width=i,u.height=n,u.subdivisions=s,u}return i.d(t,e),t.prototype._regenerateVertexData=function(){return s.VertexData.CreateGround({width:this.width,height:this.height,subdivisions:this.subdivisions})},t.prototype.copy=function(e){return new t(e,this.getScene(),this.width,this.height,this.subdivisions,this.canBeRegenerated(),null)},t.prototype.serialize=function(){var t=e.prototype.serialize.call(this);return t.width=this.width,t.height=this.height,t.subdivisions=this.subdivisions,t},t.Parse=function(e,r){if(r.getGeometryByID(e.id))return null;var i=new t(e.id,r,e.width,e.height,e.subdivisions,e.canBeRegenerated,null);return f.a&&f.a.AddTagsTo(i,e.tags),r.pushGeometry(i,!0),i},t}(p),V=function(e){function t(t,r,i,n,s,a,o,u,h,c){void 0===c&&(c=null);var l=e.call(this,t,r,h,c)||this;return l.xmin=i,l.zmin=n,l.xmax=s,l.zmax=a,l.subdivisions=o,l.precision=u,l}return i.d(t,e),t.prototype._regenerateVertexData=function(){return s.VertexData.CreateTiledGround({xmin:this.xmin,zmin:this.zmin,xmax:this.xmax,zmax:this.zmax,subdivisions:this.subdivisions,precision:this.precision})},t.prototype.copy=function(e){return new t(e,this.getScene(),this.xmin,this.zmin,this.xmax,this.zmax,this.subdivisions,this.precision,this.canBeRegenerated(),null)},t}(p),M=function(e){function t(t,r,i,n,a,o){void 0===a&&(a=null),void 0===o&&(o=s.VertexData.DEFAULTSIDE);var u=e.call(this,t,r,n,a)||this;return u.size=i,u.side=o,u}return i.d(t,e),t.prototype._regenerateVertexData=function(){return s.VertexData.CreatePlane({size:this.size,sideOrientation:this.side})},t.prototype.copy=function(e){return new t(e,this.getScene(),this.size,this.canBeRegenerated(),null,this.side)},t.prototype.serialize=function(){var t=e.prototype.serialize.call(this);return t.size=this.size,t},t.Parse=function(e,r){if(r.getGeometryByID(e.id))return null;var i=new t(e.id,r,e.size,e.canBeRegenerated,null);return f.a&&f.a.AddTagsTo(i,e.tags),r.pushGeometry(i,!0),i},t}(p),T=function(e){function t(t,r,i,n,a,o,u,h,c,l,f){void 0===l&&(l=null),void 0===f&&(f=s.VertexData.DEFAULTSIDE);var d=e.call(this,t,r,c,l)||this;return d.radius=i,d.tube=n,d.radialSegments=a,d.tubularSegments=o,d.p=u,d.q=h,d.side=f,d}return i.d(t,e),t.prototype._regenerateVertexData=function(){return s.VertexData.CreateTorusKnot({radius:this.radius,tube:this.tube,radialSegments:this.radialSegments,tubularSegments:this.tubularSegments,p:this.p,q:this.q,sideOrientation:this.side})},t.prototype.copy=function(e){return new t(e,this.getScene(),this.radius,this.tube,this.radialSegments,this.tubularSegments,this.p,this.q,this.canBeRegenerated(),null,this.side)},t.prototype.serialize=function(){var t=e.prototype.serialize.call(this);return t.radius=this.radius,t.tube=this.tube,t.radialSegments=this.radialSegments,t.tubularSegments=this.tubularSegments,t.p=this.p,t.q=this.q,t},t.Parse=function(e,r){if(r.getGeometryByID(e.id))return null;var i=new t(e.id,r,e.radius,e.tube,e.radialSegments,e.tubularSegments,e.p,e.q,e.canBeRegenerated,null);return f.a&&f.a.AddTagsTo(i,e.tags),r.pushGeometry(i,!0),i},t}(p)},41:function(e,t,r){"use strict";r.d(t,"a",function(){return n});var i=function(e,t){return e?e.getClassName&&"Mesh"===e.getClassName()?null:e.getClassName&&"SubMesh"===e.getClassName()?e.clone(t):e.clone?e.clone():null:null},n=function(){function e(){}return e.DeepCopy=function(e,t,r,n){for(var s in e)if(("_"!==s[0]||n&&-1!==n.indexOf(s))&&(!r||-1===r.indexOf(s))){var a=e[s],o=typeof a;if("function"!==o)try{if("object"===o)if(a instanceof Array){if(t[s]=[],a.length>0)if("object"==typeof a[0])for(var u=0;u<a.length;u++){var h=i(a[u],t);-1===t[s].indexOf(h)&&t[s].push(h)}else t[s]=a.slice(0)}else t[s]=i(a,t);else t[s]=a}catch(e){}}},e}()},43:function(e,t,r){"use strict";r.d(t,"a",function(){return i});var i=function(){function e(){}return e.BuildArray=function(e,t){for(var r=[],i=0;i<e;++i)r.push(t());return r},e}()},49:function(e,t,r){"use strict";r.d(t,"a",function(){return u});var i=r(1),n=r(2),s=r(27),a=r(7),o=r(0),u=function(e){function t(r,i,n){void 0===i&&(i=null),void 0===n&&(n=!0);var s=e.call(this,r,i)||this;return s._forward=new o.Vector3(0,0,1),s._forwardInverted=new o.Vector3(0,0,-1),s._up=new o.Vector3(0,1,0),s._right=new o.Vector3(1,0,0),s._rightInverted=new o.Vector3(-1,0,0),s._position=o.Vector3.Zero(),s._rotation=o.Vector3.Zero(),s._scaling=o.Vector3.One(),s._isDirty=!1,s.billboardMode=t.BILLBOARDMODE_NONE,s.scalingDeterminant=1,s.infiniteDistance=!1,s.ignoreNonUniformScaling=!1,s._localMatrix=o.Matrix.Zero(),s._absolutePosition=o.Vector3.Zero(),s._pivotMatrix=o.Matrix.Identity(),s._postMultiplyPivotMatrix=!1,s._isWorldMatrixFrozen=!1,s._indexInSceneTransformNodesArray=-1,s.onAfterWorldMatrixUpdateObservable=new a.c,s._nonUniformScaling=!1,n&&s.getScene().addTransformNode(s),s}return i.d(t,e),t.prototype.getClassName=function(){return"TransformNode"},Object.defineProperty(t.prototype,"position",{get:function(){return this._position},set:function(e){this._position=e,this._isDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rotation",{get:function(){return this._rotation},set:function(e){this._rotation=e,this._isDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaling",{get:function(){return this._scaling},set:function(e){this._scaling=e,this._isDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rotationQuaternion",{get:function(){return this._rotationQuaternion},set:function(e){this._rotationQuaternion=e,e&&this.rotation.setAll(0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"forward",{get:function(){return o.Vector3.Normalize(o.Vector3.TransformNormal(this.getScene().useRightHandedSystem?this._forwardInverted:this._forward,this.getWorldMatrix()))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"up",{get:function(){return o.Vector3.Normalize(o.Vector3.TransformNormal(this._up,this.getWorldMatrix()))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return o.Vector3.Normalize(o.Vector3.TransformNormal(this.getScene().useRightHandedSystem?this._rightInverted:this._right,this.getWorldMatrix()))},enumerable:!0,configurable:!0}),t.prototype.updatePoseMatrix=function(e){return this._poseMatrix.copyFrom(e),this},t.prototype.getPoseMatrix=function(){return this._poseMatrix},t.prototype._isSynchronized=function(){return!this._isDirty&&(this.billboardMode===this._cache.billboardMode&&this.billboardMode===t.BILLBOARDMODE_NONE&&(!this._cache.pivotMatrixUpdated&&(!this.infiniteDistance&&(!!this._cache.position.equals(this._position)&&(!(this._rotationQuaternion&&!this._cache.rotationQuaternion.equals(this._rotationQuaternion))&&(!!this._cache.rotation.equals(this._rotation)&&!!this._cache.scaling.equals(this._scaling)))))))},t.prototype._initCache=function(){e.prototype._initCache.call(this),this._cache.localMatrixUpdated=!1,this._cache.position=o.Vector3.Zero(),this._cache.scaling=o.Vector3.Zero(),this._cache.rotation=o.Vector3.Zero(),this._cache.rotationQuaternion=new o.Quaternion(0,0,0,0),this._cache.billboardMode=-1,this._cache.infiniteDistance=!1},t.prototype.markAsDirty=function(e){return"rotation"===e&&(this.rotationQuaternion=null),this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this},Object.defineProperty(t.prototype,"absolutePosition",{get:function(){return this._absolutePosition},enumerable:!0,configurable:!0}),t.prototype.setPreTransformMatrix=function(e){return this.setPivotMatrix(e,!1)},t.prototype.setPivotMatrix=function(e,t){return void 0===t&&(t=!0),this._pivotMatrix.copyFrom(e),this._cache.pivotMatrixUpdated=!0,this._postMultiplyPivotMatrix=t,this._postMultiplyPivotMatrix&&(this._pivotMatrixInverse?this._pivotMatrix.invertToRef(this._pivotMatrixInverse):this._pivotMatrixInverse=o.Matrix.Invert(this._pivotMatrix)),this},t.prototype.getPivotMatrix=function(){return this._pivotMatrix},t.prototype.freezeWorldMatrix=function(){return this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0),this._isWorldMatrixFrozen=!0,this},t.prototype.unfreezeWorldMatrix=function(){return this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0),this},Object.defineProperty(t.prototype,"isWorldMatrixFrozen",{get:function(){return this._isWorldMatrixFrozen},enumerable:!0,configurable:!0}),t.prototype.getAbsolutePosition=function(){return this.computeWorldMatrix(),this._absolutePosition},t.prototype.setAbsolutePosition=function(e){if(!e)return this;var t,r,i;if(void 0===e.x){if(arguments.length<3)return this;t=arguments[0],r=arguments[1],i=arguments[2]}else t=e.x,r=e.y,i=e.z;if(this.parent){var n=o.Tmp.Matrix[0];this.parent.getWorldMatrix().invertToRef(n),o.Vector3.TransformCoordinatesFromFloatsToRef(t,r,i,n,this.position)}else this.position.x=t,this.position.y=r,this.position.z=i;return this},t.prototype.setPositionWithLocalVector=function(e){return this.computeWorldMatrix(),this.position=o.Vector3.TransformNormal(e,this._localMatrix),this},t.prototype.getPositionExpressedInLocalSpace=function(){this.computeWorldMatrix();var e=o.Tmp.Matrix[0];return this._localMatrix.invertToRef(e),o.Vector3.TransformNormal(this.position,e)},t.prototype.locallyTranslate=function(e){return this.computeWorldMatrix(!0),this.position=o.Vector3.TransformCoordinates(e,this._localMatrix),this},t.prototype.lookAt=function(e,r,i,n,s){void 0===r&&(r=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===s&&(s=o.Space.LOCAL);var a=t._lookAtVectorCache,u=s===o.Space.LOCAL?this.position:this.getAbsolutePosition();if(e.subtractToRef(u,a),this.setDirection(a,r,i,n),s===o.Space.WORLD&&this.parent)if(this.rotationQuaternion){var h=o.Tmp.Matrix[0];this.rotationQuaternion.toRotationMatrix(h);var c=o.Tmp.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(c),c.invert(),h.multiplyToRef(c,h),this.rotationQuaternion.fromRotationMatrix(h)}else{var l=o.Tmp.Quaternion[0];o.Quaternion.FromEulerVectorToRef(this.rotation,l);h=o.Tmp.Matrix[0];l.toRotationMatrix(h);c=o.Tmp.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(c),c.invert(),h.multiplyToRef(c,h),l.fromRotationMatrix(h),l.toEulerAnglesToRef(this.rotation)}return this},t.prototype.getDirection=function(e){var t=o.Vector3.Zero();return this.getDirectionToRef(e,t),t},t.prototype.getDirectionToRef=function(e,t){return o.Vector3.TransformNormalToRef(e,this.getWorldMatrix(),t),this},t.prototype.setDirection=function(e,t,r,i){void 0===t&&(t=0),void 0===r&&(r=0),void 0===i&&(i=0);var n=-Math.atan2(e.z,e.x)+Math.PI/2,s=Math.sqrt(e.x*e.x+e.z*e.z),a=-Math.atan2(e.y,s);return this.rotationQuaternion?o.Quaternion.RotationYawPitchRollToRef(n+t,a+r,i,this.rotationQuaternion):(this.rotation.x=a+r,this.rotation.y=n+t,this.rotation.z=i),this},t.prototype.setPivotPoint=function(e,t){void 0===t&&(t=o.Space.LOCAL),0==this.getScene().getRenderId()&&this.computeWorldMatrix(!0);var r=this.getWorldMatrix();if(t==o.Space.WORLD){var i=o.Tmp.Matrix[0];r.invertToRef(i),e=o.Vector3.TransformCoordinates(e,i)}return this.setPivotMatrix(o.Matrix.Translation(-e.x,-e.y,-e.z),!0)},t.prototype.getPivotPoint=function(){var e=o.Vector3.Zero();return this.getPivotPointToRef(e),e},t.prototype.getPivotPointToRef=function(e){return e.x=-this._pivotMatrix.m[12],e.y=-this._pivotMatrix.m[13],e.z=-this._pivotMatrix.m[14],this},t.prototype.getAbsolutePivotPoint=function(){var e=o.Vector3.Zero();return this.getAbsolutePivotPointToRef(e),e},t.prototype.getAbsolutePivotPointToRef=function(e){return e.x=this._pivotMatrix.m[12],e.y=this._pivotMatrix.m[13],e.z=this._pivotMatrix.m[14],this.getPivotPointToRef(e),o.Vector3.TransformCoordinatesToRef(e,this.getWorldMatrix(),e),this},t.prototype.setParent=function(e){if(!e&&!this.parent)return this;var t=o.Tmp.Quaternion[0],r=o.Tmp.Vector3[0],i=o.Tmp.Vector3[1];if(e){var n=o.Tmp.Matrix[0],s=o.Tmp.Matrix[1];this.computeWorldMatrix(!0),e.computeWorldMatrix(!0),e.getWorldMatrix().invertToRef(s),this.getWorldMatrix().multiplyToRef(s,n),n.decompose(i,t,r)}else this.parent&&this.parent.computeWorldMatrix&&this.parent.computeWorldMatrix(!0),this.computeWorldMatrix(!0),this.getWorldMatrix().decompose(i,t,r);return this.rotationQuaternion?this.rotationQuaternion.copyFrom(t):t.toEulerAnglesToRef(this.rotation),this.scaling.copyFrom(i),this.position.copyFrom(r),this.parent=e,this},Object.defineProperty(t.prototype,"nonUniformScaling",{get:function(){return this._nonUniformScaling},enumerable:!0,configurable:!0}),t.prototype._updateNonUniformScalingState=function(e){return this._nonUniformScaling!==e&&(this._nonUniformScaling=e,!0)},t.prototype.attachToBone=function(e,t){return this._transformToBoneReferal=t,this.parent=e,e.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this},t.prototype.detachFromBone=function(){return this.parent?(this.parent.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this._transformToBoneReferal=null,this.parent=null,this):this},t.prototype.rotate=function(e,r,i){var n;if(e.normalize(),this.rotationQuaternion||(this.rotationQuaternion=this.rotation.toQuaternion(),this.rotation.setAll(0)),i&&i!==o.Space.LOCAL){if(this.parent){var s=o.Tmp.Matrix[0];this.parent.getWorldMatrix().invertToRef(s),e=o.Vector3.TransformNormal(e,s)}(n=o.Quaternion.RotationAxisToRef(e,r,t._rotationAxisCache)).multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}else n=o.Quaternion.RotationAxisToRef(e,r,t._rotationAxisCache),this.rotationQuaternion.multiplyToRef(n,this.rotationQuaternion);return this},t.prototype.rotateAround=function(e,t,r){t.normalize(),this.rotationQuaternion||(this.rotationQuaternion=o.Quaternion.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation.setAll(0));var i=o.Tmp.Vector3[0],n=o.Tmp.Vector3[1],s=o.Tmp.Vector3[2],a=o.Tmp.Quaternion[0],u=o.Tmp.Matrix[0],h=o.Tmp.Matrix[1],c=o.Tmp.Matrix[2],l=o.Tmp.Matrix[3];return e.subtractToRef(this.position,i),o.Matrix.TranslationToRef(i.x,i.y,i.z,u),o.Matrix.TranslationToRef(-i.x,-i.y,-i.z,h),o.Matrix.RotationAxisToRef(t,r,c),h.multiplyToRef(c,l),l.multiplyToRef(u,l),l.decompose(n,a,s),this.position.addInPlace(s),a.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion),this},t.prototype.translate=function(e,t,r){var i=e.scale(t);if(r&&r!==o.Space.LOCAL)this.setAbsolutePosition(this.getAbsolutePosition().add(i));else{var n=this.getPositionExpressedInLocalSpace().add(i);this.setPositionWithLocalVector(n)}return this},t.prototype.addRotation=function(e,t,r){var i;this.rotationQuaternion?i=this.rotationQuaternion:(i=o.Tmp.Quaternion[1],o.Quaternion.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,i));var n=o.Tmp.Quaternion[0];return o.Quaternion.RotationYawPitchRollToRef(t,e,r,n),i.multiplyInPlace(n),this.rotationQuaternion||i.toEulerAnglesToRef(this.rotation),this},t.prototype.computeWorldMatrix=function(e){if(this._isWorldMatrixFrozen)return this._worldMatrix;if(!e&&this.isSynchronized())return this._currentRenderId=this.getScene().getRenderId(),this._worldMatrix;(this._updateCache(),this._cache.position.copyFrom(this.position),this._cache.scaling.copyFrom(this.scaling),this._cache.pivotMatrixUpdated=!1,this._cache.billboardMode=this.billboardMode,this._cache.infiniteDistance=this.infiniteDistance,this._currentRenderId=this.getScene().getRenderId(),this._childRenderId=this.getScene().getRenderId(),this._isDirty=!1,o.Matrix.ScalingToRef(this.scaling.x*this.scalingDeterminant,this.scaling.y*this.scalingDeterminant,this.scaling.z*this.scalingDeterminant,o.Tmp.Matrix[1]),this.rotationQuaternion)&&(this.rotation.length()&&(this.rotationQuaternion.multiplyInPlace(o.Quaternion.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)),this.rotation.copyFromFloats(0,0,0)));this.rotationQuaternion?(this.rotationQuaternion.toRotationMatrix(o.Tmp.Matrix[0]),this._cache.rotationQuaternion.copyFrom(this.rotationQuaternion)):(o.Matrix.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,o.Tmp.Matrix[0]),this._cache.rotation.copyFrom(this.rotation));var r=this.getScene().activeCamera;if(this.infiniteDistance&&!this.parent&&r){var i=r.getWorldMatrix(),n=new o.Vector3(i.m[12],i.m[13],i.m[14]);o.Matrix.TranslationToRef(this.position.x+n.x,this.position.y+n.y,this.position.z+n.z,o.Tmp.Matrix[2])}else o.Matrix.TranslationToRef(this.position.x,this.position.y,this.position.z,o.Tmp.Matrix[2]);if(this._pivotMatrix.multiplyToRef(o.Tmp.Matrix[1],o.Tmp.Matrix[4]),o.Tmp.Matrix[4].multiplyToRef(o.Tmp.Matrix[0],o.Tmp.Matrix[5]),this.billboardMode!==t.BILLBOARDMODE_NONE&&r){if((this.billboardMode&t.BILLBOARDMODE_ALL)!==t.BILLBOARDMODE_ALL){var s=o.Tmp.Vector3[3];this.parent&&this.parent.getWorldMatrix?this._transformToBoneReferal?(this.parent.getWorldMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),o.Tmp.Matrix[6]),o.Vector3.TransformCoordinatesToRef(this.position,o.Tmp.Matrix[6],s)):o.Vector3.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),s):s.copyFrom(this.position),s.subtractInPlace(r.globalPosition);var a=o.Tmp.Vector3[4].copyFromFloats(0,0,0);(this.billboardMode&t.BILLBOARDMODE_X)===t.BILLBOARDMODE_X&&(a.x=Math.atan2(-s.y,s.z)),(this.billboardMode&t.BILLBOARDMODE_Y)===t.BILLBOARDMODE_Y&&(a.y=Math.atan2(s.x,s.z)),(this.billboardMode&t.BILLBOARDMODE_Z)===t.BILLBOARDMODE_Z&&(a.z=Math.atan2(s.y,s.x)),o.Matrix.RotationYawPitchRollToRef(a.y,a.x,a.z,o.Tmp.Matrix[0])}else o.Tmp.Matrix[1].copyFrom(r.getViewMatrix()),o.Tmp.Matrix[1].setTranslationFromFloats(0,0,0),o.Tmp.Matrix[1].invertToRef(o.Tmp.Matrix[0]);o.Tmp.Matrix[1].copyFrom(o.Tmp.Matrix[5]),o.Tmp.Matrix[1].multiplyToRef(o.Tmp.Matrix[0],o.Tmp.Matrix[5])}return this._postMultiplyPivotMatrix&&o.Tmp.Matrix[5].multiplyToRef(this._pivotMatrixInverse,o.Tmp.Matrix[5]),o.Tmp.Matrix[5].multiplyToRef(o.Tmp.Matrix[2],this._localMatrix),this.parent&&this.parent.getWorldMatrix?(this.billboardMode!==t.BILLBOARDMODE_NONE?(this._transformToBoneReferal?(this.parent.getWorldMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),o.Tmp.Matrix[6]),o.Tmp.Matrix[5].copyFrom(o.Tmp.Matrix[6])):o.Tmp.Matrix[5].copyFrom(this.parent.getWorldMatrix()),this._localMatrix.getTranslationToRef(o.Tmp.Vector3[5]),o.Vector3.TransformCoordinatesToRef(o.Tmp.Vector3[5],o.Tmp.Matrix[5],o.Tmp.Vector3[5]),this._worldMatrix.copyFrom(this._localMatrix),this._worldMatrix.setTranslation(o.Tmp.Vector3[5])):this._transformToBoneReferal?(this._localMatrix.multiplyToRef(this.parent.getWorldMatrix(),o.Tmp.Matrix[6]),o.Tmp.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),this._worldMatrix)):this._localMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix),this._markSyncedWithParent()):this._worldMatrix.copyFrom(this._localMatrix),this.ignoreNonUniformScaling?this._updateNonUniformScalingState(!1):this.scaling.isNonUniform?this._updateNonUniformScalingState(!0):this.parent&&this.parent._nonUniformScaling?this._updateNonUniformScalingState(this.parent._nonUniformScaling):this._updateNonUniformScalingState(!1),this._afterComputeWorldMatrix(),this._absolutePosition.copyFromFloats(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=o.Matrix.Invert(this._worldMatrix)),this._worldMatrixDeterminant=this._worldMatrix.determinant(),this._worldMatrix},t.prototype._afterComputeWorldMatrix=function(){},t.prototype.registerAfterWorldMatrixUpdate=function(e){return this.onAfterWorldMatrixUpdateObservable.add(e),this},t.prototype.unregisterAfterWorldMatrixUpdate=function(e){return this.onAfterWorldMatrixUpdateObservable.removeCallback(e),this},t.prototype.getPositionInCameraSpace=function(e){return void 0===e&&(e=null),e||(e=this.getScene().activeCamera),o.Vector3.TransformCoordinates(this.absolutePosition,e.getViewMatrix())},t.prototype.getDistanceToCamera=function(e){return void 0===e&&(e=null),e||(e=this.getScene().activeCamera),this.absolutePosition.subtract(e.position).length()},t.prototype.clone=function(e,r,i){var s=this,a=n.a.Clone(function(){return new t(e,s.getScene())},this);if(a.name=e,a.id=e,r&&(a.parent=r),!i)for(var o=this.getDescendants(!0),u=0;u<o.length;u++){var h=o[u];h.clone&&h.clone(e+"."+h.name,a)}return a},t.prototype.serialize=function(e){var t=n.a.Serialize(this,e);return t.type=this.getClassName(),this.parent&&(t.parentId=this.parent.id),s.a&&s.a.HasTags(this)&&(t.tags=s.a.GetTags(this)),t.localMatrix=this.getPivotMatrix().asArray(),t.isEnabled=this.isEnabled(),this.parent&&(t.parentId=this.parent.id),t},t.Parse=function(e,r,i){var a=n.a.Parse(function(){return new t(e.name,r)},e,r,i);return s.a&&s.a.AddTagsTo(a,e.tags),e.localMatrix?a.setPreTransformMatrix(o.Matrix.FromArray(e.localMatrix)):e.pivotMatrix&&a.setPivotMatrix(o.Matrix.FromArray(e.pivotMatrix)),a.setEnabled(e.isEnabled),e.parentId&&(a._waitingParentId=e.parentId),a},t.prototype.getChildTransformNodes=function(e,r){var i=[];return this._getDescendants(i,e,function(e){return(!r||r(e))&&e instanceof t}),i},t.prototype.dispose=function(t,r){if(void 0===r&&(r=!1),this.getScene().stopAnimation(this),this.getScene().removeTransformNode(this),this.onAfterWorldMatrixUpdateObservable.clear(),t)for(var i=0,n=this.getChildTransformNodes(!0);i<n.length;i++){var s=n[i];s.parent=null,s.computeWorldMatrix(!0)}e.prototype.dispose.call(this,t,r)},t.BILLBOARDMODE_NONE=0,t.BILLBOARDMODE_X=1,t.BILLBOARDMODE_Y=2,t.BILLBOARDMODE_Z=4,t.BILLBOARDMODE_ALL=7,t._lookAtVectorCache=new o.Vector3(0,0,0),t._rotationAxisCache=new o.Quaternion,i.c([Object(n.n)("position")],t.prototype,"_position",void 0),i.c([Object(n.n)("rotation")],t.prototype,"_rotation",void 0),i.c([Object(n.k)("rotationQuaternion")],t.prototype,"_rotationQuaternion",void 0),i.c([Object(n.n)("scaling")],t.prototype,"_scaling",void 0),i.c([Object(n.c)()],t.prototype,"billboardMode",void 0),i.c([Object(n.c)()],t.prototype,"scalingDeterminant",void 0),i.c([Object(n.c)()],t.prototype,"infiniteDistance",void 0),i.c([Object(n.c)()],t.prototype,"ignoreNonUniformScaling",void 0),t}(r(25).a)},51:function(e,t,r){"use strict";r.d(t,"a",function(){return i});var i=function(){function e(){}return e.IsWindowObjectExist=function(){return"undefined"!=typeof window},e.GetDOMTextContent=function(e){for(var t="",r=e.firstChild;r;)3===r.nodeType&&(t+=r.textContent),r=r.nextSibling;return t},e}()},56:function(e,t,r){"use strict";r.d(t,"a",function(){return h}),r.d(t,"b",function(){return c});var i=r(1),n=r(5),s=r(3),a=r(127),o=r(53),u=r(4),h=function(){function e(){}return Object.defineProperty(e.prototype,"effect",{get:function(){return this._materialEffect},enumerable:!0,configurable:!0}),e.prototype.setEffect=function(e,t){void 0===t&&(t=null),this._materialEffect!==e?(this._materialDefines=t,this._materialEffect=e):e||(this._materialDefines=null)},e}(),c=function(e){function t(t,r,i,n,s,a,o,u){void 0===u&&(u=!0);var h=e.call(this)||this;return h.materialIndex=t,h.verticesStart=r,h.verticesCount=i,h.indexStart=n,h.indexCount=s,h._renderId=0,h._mesh=a,h._renderingMesh=o||a,a.subMeshes.push(h),h._trianglePlanes=[],h._id=a.subMeshes.length-1,u&&(h.refreshBoundingInfo(),a.computeWorldMatrix(!0)),h}return i.d(t,e),t.AddToMesh=function(e,r,i,n,s,a,o,u){return void 0===u&&(u=!0),new t(e,r,i,n,s,a,o,u)},Object.defineProperty(t.prototype,"IsGlobal",{get:function(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()},enumerable:!0,configurable:!0}),t.prototype.getBoundingInfo=function(){return this.IsGlobal?this._mesh.getBoundingInfo():this._boundingInfo},t.prototype.setBoundingInfo=function(e){return this._boundingInfo=e,this},t.prototype.getMesh=function(){return this._mesh},t.prototype.getRenderingMesh=function(){return this._renderingMesh},t.prototype.getMaterial=function(){var e=this._renderingMesh.material;if(null==e)return this._mesh.getScene().defaultMaterial;if(e.getSubMaterial){var t=e.getSubMaterial(this.materialIndex);return this._currentMaterial!==t&&(this._currentMaterial=t,this._materialDefines=null),t}return e},t.prototype.refreshBoundingInfo=function(){if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.geometry)return this;var e=this._renderingMesh.getVerticesData(s.VertexBuffer.PositionKind);if(!e)return this._boundingInfo=this._mesh.getBoundingInfo(),this;var t,r=this._renderingMesh.getIndices();if(0===this.indexStart&&this.indexCount===r.length){var i=this._renderingMesh.getBoundingInfo();t={minimum:i.minimum.clone(),maximum:i.maximum.clone()}}else t=n.h.ExtractMinAndMaxIndexed(e,r,this.indexStart,this.indexCount,this._renderingMesh.geometry.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(t.minimum,t.maximum):this._boundingInfo=new o.a(t.minimum,t.maximum),this},t.prototype._checkCollision=function(e){return this.getBoundingInfo()._checkCollision(e)},t.prototype.updateBoundingInfo=function(e){var t=this.getBoundingInfo();return t||(this.refreshBoundingInfo(),t=this.getBoundingInfo()),t.update(e),this},t.prototype.isInFrustum=function(e){var t=this.getBoundingInfo();return!!t&&t.isInFrustum(e,this._mesh.cullingStrategy)},t.prototype.isCompletelyInFrustum=function(e){var t=this.getBoundingInfo();return!!t&&t.isCompletelyInFrustum(e)},t.prototype.render=function(e){return this._renderingMesh.render(this,e),this},t.prototype._getLinesIndexBuffer=function(e,t){if(!this._linesIndexBuffer){for(var r=[],i=this.indexStart;i<this.indexStart+this.indexCount;i+=3)r.push(e[i],e[i+1],e[i+1],e[i+2],e[i+2],e[i]);this._linesIndexBuffer=t.createIndexBuffer(r),this._linesIndexCount=r.length}return this._linesIndexBuffer},t.prototype.canIntersects=function(e){var t=this.getBoundingInfo();return!!t&&e.intersectsBox(t.boundingBox)},t.prototype.intersects=function(e,t,r,i){var n=this.getMaterial();if(!n)return null;switch(n.fillMode){case u.a.MATERIAL_PointListDrawMode:case u.a.MATERIAL_LineListDrawMode:case u.a.MATERIAL_LineLoopDrawMode:case u.a.MATERIAL_LineStripDrawMode:case u.a.MATERIAL_TriangleFanDrawMode:case u.a.MATERIAL_TriangleStripDrawMode:return null}return"InstancedLinesMesh"===this._mesh.getClassName()||"LinesMesh"===this._mesh.getClassName()?this._intersectLines(e,t,r,this._mesh.intersectionThreshold,i):this._intersectTriangles(e,t,r,i)},t.prototype._intersectLines=function(e,t,r,i,n){for(var s=null,o=this.indexStart;o<this.indexStart+this.indexCount;o+=2){var u=t[r[o]],h=t[r[o+1]],c=e.intersectionSegment(u,h,i);if(!(c<0)&&((n||!s||c<s.distance)&&((s=new a.a(null,null,c)).faceId=o/2,n)))break}return s},t.prototype._intersectTriangles=function(e,t,r,i){for(var n=null,s=this.indexStart;s<this.indexStart+this.indexCount;s+=3){var a=t[r[s]],o=t[r[s+1]],u=t[r[s+2]],h=e.intersectsTriangle(a,o,u);if(h){if(h.distance<0)continue;if((i||!n||h.distance<n.distance)&&((n=h).faceId=s/3,i))break}}return n},t.prototype._rebuild=function(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)},t.prototype.clone=function(e,r){var i=new t(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,e,r,!1);if(!this.IsGlobal){var n=this.getBoundingInfo();if(!n)return i;i._boundingInfo=new o.a(n.minimum,n.maximum)}return i},t.prototype.dispose=function(){this._linesIndexBuffer&&(this._mesh.getScene().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);var e=this._mesh.subMeshes.indexOf(this);this._mesh.subMeshes.splice(e,1)},t.prototype.getClassName=function(){return"SubMesh"},t.CreateFromIndices=function(e,r,i,n,s){for(var a=Number.MAX_VALUE,o=-Number.MAX_VALUE,u=(s||n).getIndices(),h=r;h<r+i;h++){var c=u[h];c<a&&(a=c),c>o&&(o=c)}return new t(e,a,o-a+1,r,i,n,s)},t}(h)},79:function(e,t,r){"use strict";r.d(t,"a",function(){return i});var i=function(){function e(){}return e.FilesToLoad={},e}()},82:function(e,t,r){"use strict";r.d(t,"b",function(){return c}),r.d(t,"a",function(){return l});var i=r(1),n=r(0),s=r(3),a=r(10),o=r(117),u=r(14),h=r(78),c=(r(223),r(224),function(e){function t(t,r,i,a,o,u,c){void 0===r&&(r=null),void 0===i&&(i=null);var l=e.call(this,t,r,i,a,o)||this;l.useVertexColor=u,l.useVertexAlpha=c,l.color=new n.Color3(1,1,1),l.alpha=1,a&&(l.color=a.color.clone(),l.alpha=a.alpha,l.useVertexColor=a.useVertexColor,l.useVertexAlpha=a.useVertexAlpha),l.intersectionThreshold=.1;var f={attributes:[s.VertexBuffer.PositionKind,"world0","world1","world2","world3"],uniforms:["world","viewProjection"],needAlphaBlending:!0,defines:[]};return!1===c&&(f.needAlphaBlending=!1),u?(f.defines.push("#define VERTEXCOLOR"),f.attributes.push(s.VertexBuffer.ColorKind)):f.uniforms.push("color"),l._colorShader=new h.a("colorShader",l.getScene(),"color",f),l}return i.d(t,e),t.prototype.getClassName=function(){return"LinesMesh"},Object.defineProperty(t.prototype,"material",{get:function(){return this._colorShader},set:function(e){},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"checkCollisions",{get:function(){return!1},enumerable:!0,configurable:!0}),t.prototype._bind=function(e,t,r){return this._geometry?(this._geometry._bind(this._colorShader.getEffect()),this.useVertexColor||this._colorShader.setColor4("color",this.color.toColor4(this.alpha)),this):this},t.prototype._draw=function(e,t,r){return this._geometry&&this._geometry.getVertexBuffers()&&(this._unIndexed||this._geometry.getIndexBuffer())?(this.getScene().getEngine().drawElementsType(u.a.LineListDrawMode,e.indexStart,e.indexCount,r),this):this},t.prototype.dispose=function(t){this._colorShader.dispose(!1,!1,!0),e.prototype.dispose.call(this,t)},t.prototype.clone=function(e,r,i){return new t(e,this.getScene(),r,this,i)},t.prototype.createInstance=function(e){return new l(e,this)},t}(a.Mesh)),l=function(e){function t(t,r){var i=e.call(this,t,r)||this;return i.intersectionThreshold=r.intersectionThreshold,i}return i.d(t,e),t.prototype.getClassName=function(){return"InstancedLinesMesh"},t}(o.a)},98:function(e,t,r){"use strict";r.d(t,"a",function(){return u});var i=r(0),n=r(12),s=r(68),a=r(4),o=function(){return function(e,t,r,i){this.name=e,this.worldAxisForNormal=t,this.worldAxisForFileX=r,this.worldAxisForFileY=i}}(),u=function(){function e(){}return e.ConvertCubeMapTextureToSphericalPolynomial=function(e){if(!e.isCube)return null;var t,r,i=e.getSize().width,n=e.readPixels(0),s=e.readPixels(1);e.isRenderTarget?(t=e.readPixels(3),r=e.readPixels(2)):(t=e.readPixels(2),r=e.readPixels(3));var o=e.readPixels(4),u=e.readPixels(5),h=e.gammaSpace,c=a.a.TEXTUREFORMAT_RGBA,l=a.a.TEXTURETYPE_UNSIGNED_INT;e.textureType&&e.textureType!==a.a.TEXTURETYPE_UNSIGNED_INT&&(l=a.a.TEXTURETYPE_FLOAT);var f={size:i,right:n,left:s,up:t,down:r,front:o,back:u,format:c,type:l,gammaSpace:h};return this.ConvertCubeMapToSphericalPolynomial(f)},e.ConvertCubeMapToSphericalPolynomial=function(e){for(var t=new s.a,r=0,o=2/e.size,u=o,h=.5*o-1,c=0;c<6;c++)for(var l=this.FileFaces[c],f=e[l.name],d=h,p=e.format===a.a.TEXTUREFORMAT_RGBA?4:3,g=0;g<e.size;g++){for(var m=h,v=0;v<e.size;v++){var y=l.worldAxisForFileX.scale(m).add(l.worldAxisForFileY.scale(d)).add(l.worldAxisForNormal);y.normalize();var _=Math.pow(1+m*m+d*d,-1.5),x=f[g*e.size*p+v*p+0],b=f[g*e.size*p+v*p+1],V=f[g*e.size*p+v*p+2];e.type===a.a.TEXTURETYPE_UNSIGNED_INT&&(x/=255,b/=255,V/=255),e.gammaSpace&&(x=Math.pow(n.a.Clamp(x),i.ToLinearSpace),b=Math.pow(n.a.Clamp(b),i.ToLinearSpace),V=Math.pow(n.a.Clamp(V),i.ToLinearSpace));var M=new i.Color3(x,b,V);t.addLight(y,M,_),r+=_,m+=o}d+=u}var T=6*(4*Math.PI)/6/r;return t.scale(T),t.convertIncidentRadianceToIrradiance(),t.convertIrradianceToLambertianRadiance(),s.b.FromHarmonics(t)},e.FileFaces=[new o("right",new i.Vector3(1,0,0),new i.Vector3(0,0,-1),new i.Vector3(0,-1,0)),new o("left",new i.Vector3(-1,0,0),new i.Vector3(0,0,1),new i.Vector3(0,-1,0)),new o("up",new i.Vector3(0,1,0),new i.Vector3(1,0,0),new i.Vector3(0,0,1)),new o("down",new i.Vector3(0,-1,0),new i.Vector3(1,0,0),new i.Vector3(0,0,-1)),new o("front",new i.Vector3(0,0,1),new i.Vector3(1,0,0),new i.Vector3(0,-1,0)),new o("back",new i.Vector3(0,0,-1),new i.Vector3(-1,0,0),new i.Vector3(0,-1,0))],e}()}}]);