(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{102:function(e,t,r){"use strict";r.d(t,"a",function(){return _});var i=r(1),s=r(2),n=r(5),o=r(7),a=r(0),h=r(21),u=r(3),c=r(6),l=r(39),d=r(14),f=r(17),p=r(4),_=(r(276),r(277),function(){function e(t,r){this._vertexBuffers={},this._maxSize=0,this._mainTextureDesiredSize={width:0,height:0},this._shouldRender=!0,this._postProcesses=[],this._textures=[],this._emissiveTextureAndColor={texture:null,color:new a.Color4},this.neutralColor=new a.Color4,this.isEnabled=!0,this.onDisposeObservable=new o.c,this.onBeforeRenderMainTextureObservable=new o.c,this.onBeforeComposeObservable=new o.c,this.onAfterComposeObservable=new o.c,this.onSizeChangedObservable=new o.c,this.name=t,this._scene=r||h.a.LastCreatedScene,e._SceneComponentInitialization(this._scene),this._engine=this._scene.getEngine(),this._maxSize=this._engine.getCaps().maxTextureSize,this._scene.effectLayers.push(this),this._generateIndexBuffer(),this._genrateVertexBuffer()}return Object.defineProperty(e.prototype,"camera",{get:function(){return this._effectLayerOptions.camera},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderingGroupId",{get:function(){return this._effectLayerOptions.renderingGroupId},enumerable:!0,configurable:!0}),e.prototype._init=function(e){this._effectLayerOptions=i.a({mainTextureRatio:.5,alphaBlendingMode:p.a.ALPHA_COMBINE,camera:null,renderingGroupId:-1},e),this._setMainTextureSize(),this._createMainTexture(),this._createTextureAndPostProcesses(),this._mergeEffect=this._createMergeEffect()},e.prototype._generateIndexBuffer=function(){var e=[];e.push(0),e.push(1),e.push(2),e.push(0),e.push(2),e.push(3),this._indexBuffer=this._engine.createIndexBuffer(e)},e.prototype._genrateVertexBuffer=function(){var e=[];e.push(1,1),e.push(-1,1),e.push(-1,-1),e.push(1,-1);var t=new u.VertexBuffer(this._engine,e,u.VertexBuffer.PositionKind,!1,!1,2);this._vertexBuffers[u.VertexBuffer.PositionKind]=t},e.prototype._setMainTextureSize=function(){this._effectLayerOptions.mainTextureFixedSize?(this._mainTextureDesiredSize.width=this._effectLayerOptions.mainTextureFixedSize,this._mainTextureDesiredSize.height=this._effectLayerOptions.mainTextureFixedSize):(this._mainTextureDesiredSize.width=this._engine.getRenderWidth()*this._effectLayerOptions.mainTextureRatio,this._mainTextureDesiredSize.height=this._engine.getRenderHeight()*this._effectLayerOptions.mainTextureRatio,this._mainTextureDesiredSize.width=this._engine.needPOTTextures?n.h.GetExponentOfTwo(this._mainTextureDesiredSize.width,this._maxSize):this._mainTextureDesiredSize.width,this._mainTextureDesiredSize.height=this._engine.needPOTTextures?n.h.GetExponentOfTwo(this._mainTextureDesiredSize.height,this._maxSize):this._mainTextureDesiredSize.height),this._mainTextureDesiredSize.width=Math.floor(this._mainTextureDesiredSize.width),this._mainTextureDesiredSize.height=Math.floor(this._mainTextureDesiredSize.height)},e.prototype._createMainTexture=function(){var e=this;this._mainTexture=new l.a("HighlightLayerMainRTT",{width:this._mainTextureDesiredSize.width,height:this._mainTextureDesiredSize.height},this._scene,!1,!0,p.a.TEXTURETYPE_UNSIGNED_INT),this._mainTexture.activeCamera=this._effectLayerOptions.camera,this._mainTexture.wrapU=c.a.CLAMP_ADDRESSMODE,this._mainTexture.wrapV=c.a.CLAMP_ADDRESSMODE,this._mainTexture.anisotropicFilteringLevel=1,this._mainTexture.updateSamplingMode(c.a.BILINEAR_SAMPLINGMODE),this._mainTexture.renderParticles=!1,this._mainTexture.renderList=null,this._mainTexture.ignoreCameraViewport=!0,this._mainTexture.customRenderFunction=function(t,r,i,s){var n;e.onBeforeRenderMainTextureObservable.notifyObservers(e);var o=e._scene.getEngine();if(s.length){for(o.setColorWrite(!1),n=0;n<s.length;n++)e._renderSubMesh(s.data[n]);o.setColorWrite(!0)}for(n=0;n<t.length;n++)e._renderSubMesh(t.data[n]);for(n=0;n<r.length;n++)e._renderSubMesh(r.data[n]);for(n=0;n<i.length;n++)e._renderSubMesh(i.data[n])},this._mainTexture.onClearObservable.add(function(t){t.clear(e.neutralColor,!0,!0,!0)})},e.prototype._addCustomEffectDefines=function(e){},e.prototype._isReady=function(e,t,r){var i=e.getMaterial();if(!i)return!1;if(!i.isReadyForSubMesh(e.getMesh(),e,t))return!1;var s=[],n=[u.VertexBuffer.PositionKind],o=e.getMesh(),a=!1,h=!1;if(i){var c=i.needAlphaTesting(),l=i.getAlphaTestTexture(),d=l&&l.hasAlpha&&(i.useAlphaFromDiffuseTexture||i._useAlphaFromAlbedoTexture);l&&(c||d)&&(s.push("#define DIFFUSE"),o.isVerticesDataPresent(u.VertexBuffer.UV2Kind)&&1===l.coordinatesIndex?(s.push("#define DIFFUSEUV2"),h=!0):o.isVerticesDataPresent(u.VertexBuffer.UVKind)&&(s.push("#define DIFFUSEUV1"),a=!0),c&&(s.push("#define ALPHATEST"),s.push("#define ALPHATESTVALUE 0.4")));var p=i.opacityTexture;p&&(s.push("#define OPACITY"),o.isVerticesDataPresent(u.VertexBuffer.UV2Kind)&&1===p.coordinatesIndex?(s.push("#define OPACITYUV2"),h=!0):o.isVerticesDataPresent(u.VertexBuffer.UVKind)&&(s.push("#define OPACITYUV1"),a=!0))}r&&(s.push("#define EMISSIVE"),o.isVerticesDataPresent(u.VertexBuffer.UV2Kind)&&1===r.coordinatesIndex?(s.push("#define EMISSIVEUV2"),h=!0):o.isVerticesDataPresent(u.VertexBuffer.UVKind)&&(s.push("#define EMISSIVEUV1"),a=!0)),o.isVerticesDataPresent(u.VertexBuffer.ColorKind)&&o.hasVertexAlpha&&(n.push(u.VertexBuffer.ColorKind),s.push("#define VERTEXALPHA")),a&&(n.push(u.VertexBuffer.UVKind),s.push("#define UV1")),h&&(n.push(u.VertexBuffer.UV2Kind),s.push("#define UV2")),o.useBones&&o.computeBonesUsingShaders?(n.push(u.VertexBuffer.MatricesIndicesKind),n.push(u.VertexBuffer.MatricesWeightsKind),o.numBoneInfluencers>4&&(n.push(u.VertexBuffer.MatricesIndicesExtraKind),n.push(u.VertexBuffer.MatricesWeightsExtraKind)),s.push("#define NUM_BONE_INFLUENCERS "+o.numBoneInfluencers),s.push("#define BonesPerMesh "+(o.skeleton?o.skeleton.bones.length+1:0))):s.push("#define NUM_BONE_INFLUENCERS 0");var _=o.morphTargetManager,g=0;_&&_.numInfluencers>0&&(s.push("#define MORPHTARGETS"),g=_.numInfluencers,s.push("#define NUM_MORPH_INFLUENCERS "+g),f.a.PrepareAttributesForMorphTargets(n,o,{NUM_MORPH_INFLUENCERS:g})),t&&(s.push("#define INSTANCES"),n.push("world0"),n.push("world1"),n.push("world2"),n.push("world3")),this._addCustomEffectDefines(s);var m=s.join("\n");return this._cachedDefines!==m&&(this._cachedDefines=m,this._effectLayerMapGenerationEffect=this._scene.getEngine().createEffect("glowMapGeneration",n,["world","mBones","viewProjection","color","morphTargetInfluences","diffuseMatrix","emissiveMatrix","opacityMatrix","opacityIntensity"],["diffuseSampler","emissiveSampler","opacitySampler"],m,void 0,void 0,void 0,{maxSimultaneousMorphTargets:g})),this._effectLayerMapGenerationEffect.isReady()},e.prototype.render=function(){var e=this._mergeEffect;if(e.isReady()){for(var t=0;t<this._postProcesses.length;t++)if(!this._postProcesses[t].isReady())return;var r=this._scene.getEngine();this.onBeforeComposeObservable.notifyObservers(this),r.enableEffect(e),r.setState(!1),r.bindBuffers(this._vertexBuffers,this._indexBuffer,e);var i=r.getAlphaMode();r.setAlphaMode(this._effectLayerOptions.alphaBlendingMode),this._internalRender(e),r.setAlphaMode(i),this.onAfterComposeObservable.notifyObservers(this);var s=this._mainTexture.getSize();this._setMainTextureSize(),s.width===this._mainTextureDesiredSize.width&&s.height===this._mainTextureDesiredSize.height||(this.onSizeChangedObservable.notifyObservers(this),this._disposeTextureAndPostProcesses(),this._createMainTexture(),this._createTextureAndPostProcesses())}},e.prototype.hasMesh=function(e){return-1===this.renderingGroupId||e.renderingGroupId===this.renderingGroupId},e.prototype.shouldRender=function(){return this.isEnabled&&this._shouldRender},e.prototype._shouldRenderMesh=function(e){return!0},e.prototype._canRenderMesh=function(e,t){return!t.needAlphaBlendingForMesh(e)},e.prototype._shouldRenderEmissiveTextureForMesh=function(){return!0},e.prototype._renderSubMesh=function(e){var t=this;if(this.shouldRender()){var r=e.getMaterial(),i=e.getRenderingMesh(),s=this._scene,n=s.getEngine();if(r&&this._canRenderMesh(i,r)){n.setState(r.backFaceCulling);var o=i._getInstancesRenderList(e._id);if(!o.mustReturn&&this._shouldRenderMesh(i)){var a=n.getCaps().instancedArrays&&null!==o.visibleInstances[e._id]&&void 0!==o.visibleInstances[e._id];if(this._setEmissiveTextureAndColor(i,e,r),this._isReady(e,a,this._emissiveTextureAndColor.texture)){n.enableEffect(this._effectLayerMapGenerationEffect),i._bind(e,this._effectLayerMapGenerationEffect,d.a.TriangleFillMode),this._effectLayerMapGenerationEffect.setMatrix("viewProjection",s.getTransformMatrix()),this._effectLayerMapGenerationEffect.setFloat4("color",this._emissiveTextureAndColor.color.r,this._emissiveTextureAndColor.color.g,this._emissiveTextureAndColor.color.b,this._emissiveTextureAndColor.color.a);var h=r.needAlphaTesting(),u=r.getAlphaTestTexture(),c=u&&u.hasAlpha&&(r.useAlphaFromDiffuseTexture||r._useAlphaFromAlbedoTexture);if(u&&(h||c))this._effectLayerMapGenerationEffect.setTexture("diffuseSampler",u),(l=u.getTextureMatrix())&&this._effectLayerMapGenerationEffect.setMatrix("diffuseMatrix",l);var l,p=r.opacityTexture;if(p)this._effectLayerMapGenerationEffect.setTexture("opacitySampler",p),this._effectLayerMapGenerationEffect.setFloat("opacityIntensity",p.level),(l=p.getTextureMatrix())&&this._effectLayerMapGenerationEffect.setMatrix("opacityMatrix",l);this._emissiveTextureAndColor.texture&&(this._effectLayerMapGenerationEffect.setTexture("emissiveSampler",this._emissiveTextureAndColor.texture),this._effectLayerMapGenerationEffect.setMatrix("emissiveMatrix",this._emissiveTextureAndColor.texture.getTextureMatrix())),i.useBones&&i.computeBonesUsingShaders&&i.skeleton&&this._effectLayerMapGenerationEffect.setMatrices("mBones",i.skeleton.getTransformMatrices(i)),f.a.BindMorphTargetParameters(i,this._effectLayerMapGenerationEffect),i._processRendering(e,this._effectLayerMapGenerationEffect,d.a.TriangleFillMode,o,a,function(e,r){return t._effectLayerMapGenerationEffect.setMatrix("world",r)})}else this._mainTexture.resetRefreshCounter()}}}},e.prototype._rebuild=function(){var e=this._vertexBuffers[u.VertexBuffer.PositionKind];e&&e._rebuild(),this._generateIndexBuffer()},e.prototype._disposeTextureAndPostProcesses=function(){this._mainTexture.dispose();for(var e=0;e<this._postProcesses.length;e++)this._postProcesses[e]&&this._postProcesses[e].dispose();this._postProcesses=[];for(e=0;e<this._textures.length;e++)this._textures[e]&&this._textures[e].dispose();this._textures=[]},e.prototype.dispose=function(){var e=this._vertexBuffers[u.VertexBuffer.PositionKind];e&&(e.dispose(),this._vertexBuffers[u.VertexBuffer.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._disposeTextureAndPostProcesses();var t=this._scene.effectLayers.indexOf(this,0);t>-1&&this._scene.effectLayers.splice(t,1),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onBeforeRenderMainTextureObservable.clear(),this.onBeforeComposeObservable.clear(),this.onAfterComposeObservable.clear(),this.onSizeChangedObservable.clear()},e.prototype.getClassName=function(){return"EffectLayer"},e.Parse=function(e,t,r){return n.h.Instantiate(e.customType).Parse(e,t,r)},e._SceneComponentInitialization=function(e){throw"Import EffectLayerSceneComponent before creating EffectLayer."},i.c([Object(s.c)()],e.prototype,"name",void 0),i.c([Object(s.f)()],e.prototype,"neutralColor",void 0),i.c([Object(s.c)()],e.prototype,"isEnabled",void 0),i.c([Object(s.d)()],e.prototype,"camera",null),i.c([Object(s.c)()],e.prototype,"renderingGroupId",null),e}())},106:function(e,t,r){"use strict";r.d(t,"a",function(){return o});var i=r(1),s=r(2),n=r(0),o=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._needProjectionMatrixCompute=!0,t}return i.d(t,e),t.prototype._setPosition=function(e){this._position=e},Object.defineProperty(t.prototype,"position",{get:function(){return this._position},set:function(e){this._setPosition(e)},enumerable:!0,configurable:!0}),t.prototype._setDirection=function(e){this._direction=e},Object.defineProperty(t.prototype,"direction",{get:function(){return this._direction},set:function(e){this._setDirection(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"shadowMinZ",{get:function(){return this._shadowMinZ},set:function(e){this._shadowMinZ=e,this.forceProjectionMatrixCompute()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"shadowMaxZ",{get:function(){return this._shadowMaxZ},set:function(e){this._shadowMaxZ=e,this.forceProjectionMatrixCompute()},enumerable:!0,configurable:!0}),t.prototype.computeTransformedInformation=function(){return!(!this.parent||!this.parent.getWorldMatrix)&&(this.transformedPosition||(this.transformedPosition=n.Vector3.Zero()),n.Vector3.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),this.direction&&(this.transformedDirection||(this.transformedDirection=n.Vector3.Zero()),n.Vector3.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this.transformedDirection)),!0)},t.prototype.getDepthScale=function(){return 50},t.prototype.getShadowDirection=function(e){return this.transformedDirection?this.transformedDirection:this.direction},t.prototype.getAbsolutePosition=function(){return this.transformedPosition?this.transformedPosition:this.position},t.prototype.setDirectionToTarget=function(e){return this.direction=n.Vector3.Normalize(e.subtract(this.position)),this.direction},t.prototype.getRotation=function(){this.direction.normalize();var e=n.Vector3.Cross(this.direction,n.Axis.Y),t=n.Vector3.Cross(e,this.direction);return n.Vector3.RotationFromAxis(e,t,this.direction)},t.prototype.needCube=function(){return!1},t.prototype.needProjectionMatrixCompute=function(){return this._needProjectionMatrixCompute},t.prototype.forceProjectionMatrixCompute=function(){this._needProjectionMatrixCompute=!0},t.prototype._initCache=function(){e.prototype._initCache.call(this),this._cache.position=n.Vector3.Zero()},t.prototype._isSynchronized=function(){return!!this._cache.position.equals(this.position)},t.prototype.computeWorldMatrix=function(e){return!e&&this.isSynchronized()?(this._currentRenderId=this.getScene().getRenderId(),this._worldMatrix):(this._updateCache(),this._cache.position.copyFrom(this.position),this._worldMatrix||(this._worldMatrix=n.Matrix.Identity()),n.Matrix.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this.parent&&this.parent.getWorldMatrix&&(this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix),this._markSyncedWithParent()),this._worldMatrixDeterminant=this._worldMatrix.determinant(),this._worldMatrix)},t.prototype.getDepthMinZ=function(e){return void 0!==this.shadowMinZ?this.shadowMinZ:e.minZ},t.prototype.getDepthMaxZ=function(e){return void 0!==this.shadowMaxZ?this.shadowMaxZ:e.maxZ},t.prototype.setShadowProjectionMatrix=function(e,t,r){return this.customProjectionMatrixBuilder?this.customProjectionMatrixBuilder(t,r,e):this._setDefaultShadowProjectionMatrix(e,t,r),this},i.c([Object(s.n)()],t.prototype,"position",null),i.c([Object(s.n)()],t.prototype,"direction",null),i.c([Object(s.c)()],t.prototype,"shadowMinZ",null),i.c([Object(s.c)()],t.prototype,"shadowMaxZ",null),t}(r(44).a)},107:function(e,t,r){"use strict";r.d(t,"a",function(){return u});var i=r(1),s=r(2),n=r(0),o=r(25),a=r(44),h=r(106);o.a.AddNodeConstructor("Light_Type_1",function(e,t){return function(){return new u(e,n.Vector3.Zero(),t)}});var u=function(e){function t(t,r,i){var s=e.call(this,t,i)||this;return s._shadowFrustumSize=0,s._shadowOrthoScale=.1,s.autoUpdateExtends=!0,s._orthoLeft=Number.MAX_VALUE,s._orthoRight=Number.MIN_VALUE,s._orthoTop=Number.MIN_VALUE,s._orthoBottom=Number.MAX_VALUE,s.position=r.scale(-1),s.direction=r,s}return i.d(t,e),Object.defineProperty(t.prototype,"shadowFrustumSize",{get:function(){return this._shadowFrustumSize},set:function(e){this._shadowFrustumSize=e,this.forceProjectionMatrixCompute()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"shadowOrthoScale",{get:function(){return this._shadowOrthoScale},set:function(e){this._shadowOrthoScale=e,this.forceProjectionMatrixCompute()},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"DirectionalLight"},t.prototype.getTypeID=function(){return a.a.LIGHTTYPEID_DIRECTIONALLIGHT},t.prototype._setDefaultShadowProjectionMatrix=function(e,t,r){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(e):this._setDefaultAutoExtendShadowProjectionMatrix(e,t,r)},t.prototype._setDefaultFixedFrustumShadowProjectionMatrix=function(e){var t=this.getScene().activeCamera;t&&n.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:t.minZ,void 0!==this.shadowMaxZ?this.shadowMaxZ:t.maxZ,e)},t.prototype._setDefaultAutoExtendShadowProjectionMatrix=function(e,t,r){var i=this.getScene().activeCamera;if(i){if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){var s=n.Vector3.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE;for(var o=0;o<r.length;o++){var a=r[o];if(a)for(var h=a.getBoundingInfo().boundingBox,u=0;u<h.vectorsWorld.length;u++)n.Vector3.TransformCoordinatesToRef(h.vectorsWorld[u],t,s),s.x<this._orthoLeft&&(this._orthoLeft=s.x),s.y<this._orthoBottom&&(this._orthoBottom=s.y),s.x>this._orthoRight&&(this._orthoRight=s.x),s.y>this._orthoTop&&(this._orthoTop=s.y)}}var c=this._orthoRight-this._orthoLeft,l=this._orthoTop-this._orthoBottom;n.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-c*this.shadowOrthoScale,this._orthoRight+c*this.shadowOrthoScale,this._orthoBottom-l*this.shadowOrthoScale,this._orthoTop+l*this.shadowOrthoScale,void 0!==this.shadowMinZ?this.shadowMinZ:i.minZ,void 0!==this.shadowMaxZ?this.shadowMaxZ:i.maxZ,e)}},t.prototype._buildUniformLayout=function(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()},t.prototype.transferToEffect=function(e,t){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,t),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,t),this)},t.prototype.getDepthMinZ=function(e){return 1},t.prototype.getDepthMaxZ=function(e){return 1},t.prototype.prepareLightSpecificDefines=function(e,t){e["DIRLIGHT"+t]=!0},i.c([Object(s.c)()],t.prototype,"shadowFrustumSize",null),i.c([Object(s.c)()],t.prototype,"shadowOrthoScale",null),i.c([Object(s.c)()],t.prototype,"autoUpdateExtends",void 0),t}(h.a)},108:function(e,t,r){"use strict";r.d(t,"a",function(){return u});var i=r(1),s=r(2),n=r(0),o=r(25),a=r(44),h=r(106);o.a.AddNodeConstructor("Light_Type_0",function(e,t){return function(){return new u(e,n.Vector3.Zero(),t)}});var u=function(e){function t(t,r,i){var s=e.call(this,t,i)||this;return s._shadowAngle=Math.PI/2,s.position=r,s}return i.d(t,e),Object.defineProperty(t.prototype,"shadowAngle",{get:function(){return this._shadowAngle},set:function(e){this._shadowAngle=e,this.forceProjectionMatrixCompute()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"direction",{get:function(){return this._direction},set:function(e){var t=this.needCube();this._direction=e,this.needCube()!==t&&this._shadowGenerator&&this._shadowGenerator.recreateShadowMap()},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"PointLight"},t.prototype.getTypeID=function(){return a.a.LIGHTTYPEID_POINTLIGHT},t.prototype.needCube=function(){return!this.direction},t.prototype.getShadowDirection=function(t){if(this.direction)return e.prototype.getShadowDirection.call(this,t);switch(t){case 0:return new n.Vector3(1,0,0);case 1:return new n.Vector3(-1,0,0);case 2:return new n.Vector3(0,-1,0);case 3:return new n.Vector3(0,1,0);case 4:return new n.Vector3(0,0,1);case 5:return new n.Vector3(0,0,-1)}return n.Vector3.Zero()},t.prototype._setDefaultShadowProjectionMatrix=function(e,t,r){var i=this.getScene().activeCamera;i&&n.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,this.getDepthMinZ(i),this.getDepthMaxZ(i),e)},t.prototype._buildUniformLayout=function(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()},t.prototype.transferToEffect=function(e,t){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,t):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,t),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,t),this},t.prototype.prepareLightSpecificDefines=function(e,t){e["POINTLIGHT"+t]=!0},i.c([Object(s.c)()],t.prototype,"shadowAngle",null),t}(h.a)},109:function(e,t,r){"use strict";r.d(t,"a",function(){return u});var i=r(1),s=r(2),n=r(0),o=r(25),a=r(44),h=r(106);o.a.AddNodeConstructor("Light_Type_2",function(e,t){return function(){return new u(e,n.Vector3.Zero(),n.Vector3.Zero(),0,0,t)}});var u=function(e){function t(t,r,i,s,o,a){var h=e.call(this,t,a)||this;return h._innerAngle=0,h._projectionTextureMatrix=n.Matrix.Zero(),h._projectionTextureLightNear=1e-6,h._projectionTextureLightFar=1e3,h._projectionTextureUpDirection=n.Vector3.Up(),h._projectionTextureViewLightDirty=!0,h._projectionTextureProjectionLightDirty=!0,h._projectionTextureDirty=!0,h._projectionTextureViewTargetVector=n.Vector3.Zero(),h._projectionTextureViewLightMatrix=n.Matrix.Zero(),h._projectionTextureProjectionLightMatrix=n.Matrix.Zero(),h._projectionTextureScalingMatrix=n.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),h.position=r,h.direction=i,h.angle=s,h.exponent=o,h}return i.d(t,e),Object.defineProperty(t.prototype,"angle",{get:function(){return this._angle},set:function(e){this._angle=e,this._cosHalfAngle=Math.cos(.5*e),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"innerAngle",{get:function(){return this._innerAngle},set:function(e){this._innerAngle=e,this._computeAngleValues()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"shadowAngleScale",{get:function(){return this._shadowAngleScale},set:function(e){this._shadowAngleScale=e,this.forceProjectionMatrixCompute()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"projectionTextureMatrix",{get:function(){return this._projectionTextureMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"projectionTextureLightNear",{get:function(){return this._projectionTextureLightNear},set:function(e){this._projectionTextureLightNear=e,this._projectionTextureProjectionLightDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"projectionTextureLightFar",{get:function(){return this._projectionTextureLightFar},set:function(e){this._projectionTextureLightFar=e,this._projectionTextureProjectionLightDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"projectionTextureUpDirection",{get:function(){return this._projectionTextureUpDirection},set:function(e){this._projectionTextureUpDirection=e,this._projectionTextureProjectionLightDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"projectionTexture",{get:function(){return this._projectionTexture},set:function(e){this._projectionTexture=e,this._projectionTextureDirty=!0},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"SpotLight"},t.prototype.getTypeID=function(){return a.a.LIGHTTYPEID_SPOTLIGHT},t.prototype._setDirection=function(t){e.prototype._setDirection.call(this,t),this._projectionTextureViewLightDirty=!0},t.prototype._setPosition=function(t){e.prototype._setPosition.call(this,t),this._projectionTextureViewLightDirty=!0},t.prototype._setDefaultShadowProjectionMatrix=function(e,t,r){var i=this.getScene().activeCamera;if(i){this._shadowAngleScale=this._shadowAngleScale||1;var s=this._shadowAngleScale*this._angle;n.Matrix.PerspectiveFovLHToRef(s,1,this.getDepthMinZ(i),this.getDepthMaxZ(i),e)}},t.prototype._computeProjectionTextureViewLightMatrix=function(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.position.addToRef(this.direction,this._projectionTextureViewTargetVector),n.Matrix.LookAtLHToRef(this.position,this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)},t.prototype._computeProjectionTextureProjectionLightMatrix=function(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;var e=this.projectionTextureLightFar,t=this.projectionTextureLightNear,r=e/(e-t),i=-r*t,s=1/Math.tan(this._angle/2);n.Matrix.FromValuesToRef(s/1,0,0,0,0,s,0,0,0,0,r,1,0,0,i,0,this._projectionTextureProjectionLightMatrix)},t.prototype._computeProjectionTextureMatrix=function(){this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)},t.prototype._buildUniformLayout=function(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",3),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()},t.prototype._computeAngleValues=function(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale},t.prototype.transferToEffect=function(e,t){var r;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,t),r=n.Vector3.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,t),r=n.Vector3.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",r.x,r.y,r.z,this._cosHalfAngle,t),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,t),this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),e.setMatrix("textureProjectionMatrix"+t,this._projectionTextureMatrix),e.setTexture("projectionLightSampler"+t,this.projectionTexture)),this},t.prototype.dispose=function(){e.prototype.dispose.call(this),this._projectionTexture&&this._projectionTexture.dispose()},t.prototype.prepareLightSpecificDefines=function(e,t){e["SPOTLIGHT"+t]=!0,e["PROJECTEDLIGHTTEXTURE"+t]=!!this.projectionTexture},i.c([Object(s.c)()],t.prototype,"angle",null),i.c([Object(s.c)()],t.prototype,"innerAngle",null),i.c([Object(s.c)()],t.prototype,"shadowAngleScale",null),i.c([Object(s.c)()],t.prototype,"exponent",void 0),i.c([Object(s.c)()],t.prototype,"projectionTextureLightNear",null),i.c([Object(s.c)()],t.prototype,"projectionTextureLightFar",null),i.c([Object(s.c)()],t.prototype,"projectionTextureUpDirection",null),i.c([Object(s.l)("projectedLightTexture")],t.prototype,"_projectionTexture",void 0),t}(h.a)},194:function(e,t,r){"use strict";r.d(t,"a",function(){return g});var i=r(1),s=r(2),n=r(5),o=r(0),a=r(3),h=r(6),u=r(39),c=r(14),l=r(50),d=r(102),f=r(38),p=r(4),_=r(26);r(230),r(231);f.a.prototype.getGlowLayerByName=function(e){for(var t=0;t<this.effectLayers.length;t++)if(this.effectLayers[t].name===e&&this.effectLayers[t].getEffectName()===g.EffectName)return this.effectLayers[t];return null};var g=function(e){function t(r,s,n){var a=e.call(this,r,s)||this;return a._intensity=1,a._includedOnlyMeshes=[],a._excludedMeshes=[],a.neutralColor=new o.Color4(0,0,0,1),a._options=i.a({mainTextureRatio:t.DefaultTextureRatio,blurKernelSize:32,mainTextureFixedSize:void 0,camera:null,mainTextureSamples:1,renderingGroupId:-1},n),a._init({alphaBlendingMode:p.a.ALPHA_ADD,camera:a._options.camera,mainTextureFixedSize:a._options.mainTextureFixedSize,mainTextureRatio:a._options.mainTextureRatio,renderingGroupId:a._options.renderingGroupId}),a}return i.d(t,e),Object.defineProperty(t.prototype,"blurKernelSize",{get:function(){return this._horizontalBlurPostprocess1.kernel},set:function(e){this._horizontalBlurPostprocess1.kernel=e,this._verticalBlurPostprocess1.kernel=e,this._horizontalBlurPostprocess2.kernel=e,this._verticalBlurPostprocess2.kernel=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"intensity",{get:function(){return this._intensity},set:function(e){this._intensity=e},enumerable:!0,configurable:!0}),t.prototype.getEffectName=function(){return t.EffectName},t.prototype._createMergeEffect=function(){return this._engine.createEffect("glowMapMerge",[a.VertexBuffer.PositionKind],["offset"],["textureSampler","textureSampler2"],"#define EMISSIVE \n")},t.prototype._createTextureAndPostProcesses=function(){var e=this,t=this._mainTextureDesiredSize.width,r=this._mainTextureDesiredSize.height;t=this._engine.needPOTTextures?n.h.GetExponentOfTwo(t,this._maxSize):t,r=this._engine.needPOTTextures?n.h.GetExponentOfTwo(r,this._maxSize):r;var i=0;i=this._engine.getCaps().textureHalfFloatRender?p.a.TEXTURETYPE_HALF_FLOAT:p.a.TEXTURETYPE_UNSIGNED_INT,this._blurTexture1=new u.a("GlowLayerBlurRTT",{width:t,height:r},this._scene,!1,!0,i),this._blurTexture1.wrapU=h.a.CLAMP_ADDRESSMODE,this._blurTexture1.wrapV=h.a.CLAMP_ADDRESSMODE,this._blurTexture1.updateSamplingMode(h.a.BILINEAR_SAMPLINGMODE),this._blurTexture1.renderParticles=!1,this._blurTexture1.ignoreCameraViewport=!0;var s=Math.floor(t/2),a=Math.floor(r/2);this._blurTexture2=new u.a("GlowLayerBlurRTT2",{width:s,height:a},this._scene,!1,!0,i),this._blurTexture2.wrapU=h.a.CLAMP_ADDRESSMODE,this._blurTexture2.wrapV=h.a.CLAMP_ADDRESSMODE,this._blurTexture2.updateSamplingMode(h.a.BILINEAR_SAMPLINGMODE),this._blurTexture2.renderParticles=!1,this._blurTexture2.ignoreCameraViewport=!0,this._textures=[this._blurTexture1,this._blurTexture2],this._horizontalBlurPostprocess1=new l.a("GlowLayerHBP1",new o.Vector2(1,0),this._options.blurKernelSize/2,{width:t,height:r},null,h.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,i),this._horizontalBlurPostprocess1.width=t,this._horizontalBlurPostprocess1.height=r,this._horizontalBlurPostprocess1.onApplyObservable.add(function(t){t.setTexture("textureSampler",e._mainTexture)}),this._verticalBlurPostprocess1=new l.a("GlowLayerVBP1",new o.Vector2(0,1),this._options.blurKernelSize/2,{width:t,height:r},null,h.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,i),this._horizontalBlurPostprocess2=new l.a("GlowLayerHBP2",new o.Vector2(1,0),this._options.blurKernelSize/2,{width:s,height:a},null,h.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,i),this._horizontalBlurPostprocess2.width=s,this._horizontalBlurPostprocess2.height=a,this._horizontalBlurPostprocess2.onApplyObservable.add(function(t){t.setTexture("textureSampler",e._blurTexture1)}),this._verticalBlurPostprocess2=new l.a("GlowLayerVBP2",new o.Vector2(0,1),this._options.blurKernelSize/2,{width:s,height:a},null,h.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,i),this._postProcesses=[this._horizontalBlurPostprocess1,this._verticalBlurPostprocess1,this._horizontalBlurPostprocess2,this._verticalBlurPostprocess2],this._postProcesses1=[this._horizontalBlurPostprocess1,this._verticalBlurPostprocess1],this._postProcesses2=[this._horizontalBlurPostprocess2,this._verticalBlurPostprocess2],this._mainTexture.samples=this._options.mainTextureSamples,this._mainTexture.onAfterUnbindObservable.add(function(){var t=e._blurTexture1.getInternalTexture();t&&(e._scene.postProcessManager.directRender(e._postProcesses1,t,!0),(t=e._blurTexture2.getInternalTexture())&&e._scene.postProcessManager.directRender(e._postProcesses2,t,!0))}),this._postProcesses.map(function(e){e.autoClear=!1})},t.prototype.isReady=function(t,r){var i=t.getMaterial(),s=t.getRenderingMesh();if(!i||!s)return!1;var n=i.emissiveTexture;return e.prototype._isReady.call(this,t,r,n)},t.prototype.needStencil=function(){return!1},t.prototype._canRenderMesh=function(e,t){return!0},t.prototype._internalRender=function(e){e.setTexture("textureSampler",this._blurTexture1),e.setTexture("textureSampler2",this._blurTexture2),e.setFloat("offset",this._intensity);var t=this._engine,r=t.getStencilBuffer();t.setStencilBuffer(!1),t.drawElementsType(c.a.TriangleFillMode,0,6),t.setStencilBuffer(r)},t.prototype._setEmissiveTextureAndColor=function(e,t,r){var i=1;this.customEmissiveTextureSelector?this._emissiveTextureAndColor.texture=this.customEmissiveTextureSelector(e,t,r):r?(this._emissiveTextureAndColor.texture=r.emissiveTexture,this._emissiveTextureAndColor.texture&&(i=this._emissiveTextureAndColor.texture.level)):this._emissiveTextureAndColor.texture=null,this.customEmissiveColorSelector?this.customEmissiveColorSelector(e,t,r,this._emissiveTextureAndColor.color):r.emissiveColor?this._emissiveTextureAndColor.color.set(r.emissiveColor.r*i,r.emissiveColor.g*i,r.emissiveColor.b*i,r.alpha):this._emissiveTextureAndColor.color.set(this.neutralColor.r,this.neutralColor.g,this.neutralColor.b,this.neutralColor.a)},t.prototype._shouldRenderMesh=function(e){return this.hasMesh(e)},t.prototype._addCustomEffectDefines=function(e){e.push("#define GLOW")},t.prototype.addExcludedMesh=function(e){-1===this._excludedMeshes.indexOf(e.uniqueId)&&this._excludedMeshes.push(e.uniqueId)},t.prototype.removeExcludedMesh=function(e){var t=this._excludedMeshes.indexOf(e.uniqueId);-1!==t&&this._excludedMeshes.splice(t,1)},t.prototype.addIncludedOnlyMesh=function(e){-1===this._includedOnlyMeshes.indexOf(e.uniqueId)&&this._includedOnlyMeshes.push(e.uniqueId)},t.prototype.removeIncludedOnlyMesh=function(e){var t=this._includedOnlyMeshes.indexOf(e.uniqueId);-1!==t&&this._includedOnlyMeshes.splice(t,1)},t.prototype.hasMesh=function(t){return!!e.prototype.hasMesh.call(this,t)&&(this._includedOnlyMeshes.length?-1!==this._includedOnlyMeshes.indexOf(t.uniqueId):!this._excludedMeshes.length||-1===this._excludedMeshes.indexOf(t.uniqueId))},t.prototype._disposeMesh=function(e){this.removeIncludedOnlyMesh(e),this.removeExcludedMesh(e)},t.prototype.getClassName=function(){return"GlowLayer"},t.prototype.serialize=function(){var e,t=s.a.Serialize(this);if(t.customType="BABYLON.GlowLayer",t.includedMeshes=[],this._includedOnlyMeshes.length)for(e=0;e<this._includedOnlyMeshes.length;e++){(r=this._scene.getMeshByUniqueID(this._includedOnlyMeshes[e]))&&t.includedMeshes.push(r.id)}if(t.excludedMeshes=[],this._excludedMeshes.length)for(e=0;e<this._excludedMeshes.length;e++){var r;(r=this._scene.getMeshByUniqueID(this._excludedMeshes[e]))&&t.excludedMeshes.push(r.id)}return t},t.Parse=function(e,r,i){var n,o=s.a.Parse(function(){return new t(e.name,r,e.options)},e,r,i);for(n=0;n<e.excludedMeshes.length;n++){(a=r.getMeshByID(e.excludedMeshes[n]))&&o.addExcludedMesh(a)}for(n=0;n<e.includedMeshes.length;n++){var a;(a=r.getMeshByID(e.includedMeshes[n]))&&o.addIncludedOnlyMesh(a)}return o},t.EffectName="GlowLayer",t.DefaultBlurKernelSize=32,t.DefaultTextureRatio=.5,i.c([Object(s.c)()],t.prototype,"blurKernelSize",null),i.c([Object(s.c)()],t.prototype,"intensity",null),i.c([Object(s.c)("options")],t.prototype,"_options",void 0),t}(d.a);_.a.RegisteredTypes["BABYLON.GlowLayer"]=g},195:function(e,t,r){"use strict";r.d(t,"a",function(){return d});var i=r(7),s=r(0),n=r(21),o=r(3),a=r(14),h=r(6),u=r(15),c=r(196),l=r(4),d=(r(279),r(280),function(){function e(e,t,r,a,d){this.name=e,this.scale=new s.Vector2(1,1),this.offset=new s.Vector2(0,0),this.alphaBlendingMode=l.a.ALPHA_COMBINE,this.layerMask=268435455,this.renderTargetTextures=[],this.renderOnlyInRenderTargetTextures=!1,this._vertexBuffers={},this.onDisposeObservable=new i.c,this.onBeforeRenderObservable=new i.c,this.onAfterRenderObservable=new i.c,this.texture=t?new h.a(t,r,!0):null,this.isBackground=void 0===a||a,this.color=void 0===d?new s.Color4(1,1,1,1):d,this._scene=r||n.a.LastCreatedScene;var f=this._scene._getComponent(u.a.NAME_LAYER);f||(f=new c.a(this._scene),this._scene._addComponent(f)),this._scene.layers.push(this);var p=this._scene.getEngine(),_=[];_.push(1,1),_.push(-1,1),_.push(-1,-1),_.push(1,-1);var g=new o.VertexBuffer(p,_,o.VertexBuffer.PositionKind,!1,!1,2);this._vertexBuffers[o.VertexBuffer.PositionKind]=g,this._createIndexBuffer(),this._effect=p.createEffect("layer",[o.VertexBuffer.PositionKind],["textureMatrix","color","scale","offset"],["textureSampler"],""),this._alphaTestEffect=p.createEffect("layer",[o.VertexBuffer.PositionKind],["textureMatrix","color","scale","offset"],["textureSampler"],"#define ALPHATEST")}return Object.defineProperty(e.prototype,"onDispose",{set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onBeforeRender",{set:function(e){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onAfterRender",{set:function(e){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(e)},enumerable:!0,configurable:!0}),e.prototype._createIndexBuffer=function(){var e=this._scene.getEngine(),t=[];t.push(0),t.push(1),t.push(2),t.push(0),t.push(2),t.push(3),this._indexBuffer=e.createIndexBuffer(t)},e.prototype._rebuild=function(){var e=this._vertexBuffers[o.VertexBuffer.PositionKind];e&&e._rebuild(),this._createIndexBuffer()},e.prototype.render=function(){var e=this.alphaTest?this._alphaTestEffect:this._effect;if(e.isReady()&&this.texture&&this.texture.isReady()){var t=this._scene.getEngine();this.onBeforeRenderObservable.notifyObservers(this),t.enableEffect(e),t.setState(!1),e.setTexture("textureSampler",this.texture),e.setMatrix("textureMatrix",this.texture.getTextureMatrix()),e.setFloat4("color",this.color.r,this.color.g,this.color.b,this.color.a),e.setVector2("offset",this.offset),e.setVector2("scale",this.scale),t.bindBuffers(this._vertexBuffers,this._indexBuffer,e),this.alphaTest?t.drawElementsType(a.a.TriangleFillMode,0,6):(t.setAlphaMode(this.alphaBlendingMode),t.drawElementsType(a.a.TriangleFillMode,0,6),t.setAlphaMode(l.a.ALPHA_DISABLE)),this.onAfterRenderObservable.notifyObservers(this)}},e.prototype.dispose=function(){var e=this._vertexBuffers[o.VertexBuffer.PositionKind];e&&(e.dispose(),this._vertexBuffers[o.VertexBuffer.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this.texture&&(this.texture.dispose(),this.texture=null),this.renderTargetTextures=[];var t=this._scene.layers.indexOf(this);this._scene.layers.splice(t,1),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderObservable.clear()},e}())},196:function(e,t,r){"use strict";r.d(t,"a",function(){return s});var i=r(15),s=function(){function e(e){this.name=i.a.NAME_LAYER,this.scene=e,this._engine=e.getEngine(),e.layers=new Array}return e.prototype.register=function(){this.scene._beforeCameraDrawStage.registerStep(i.a.STEP_BEFORECAMERADRAW_LAYER,this,this._drawCameraBackground),this.scene._afterCameraDrawStage.registerStep(i.a.STEP_AFTERCAMERADRAW_LAYER,this,this._drawCameraForeground),this.scene._beforeRenderTargetDrawStage.registerStep(i.a.STEP_BEFORERENDERTARGETDRAW_LAYER,this,this._drawRenderTargetBackground),this.scene._afterRenderTargetDrawStage.registerStep(i.a.STEP_AFTERRENDERTARGETDRAW_LAYER,this,this._drawRenderTargetForeground)},e.prototype.rebuild=function(){for(var e=0,t=this.scene.layers;e<t.length;e++){t[e]._rebuild()}},e.prototype.dispose=function(){for(var e=this.scene.layers;e.length;)e[0].dispose()},e.prototype._draw=function(e){var t=this.scene.layers;if(t.length){this._engine.setDepthBuffer(!1);for(var r=0,i=t;r<i.length;r++){var s=i[r];e(s)&&s.render()}this._engine.setDepthBuffer(!0)}},e.prototype._drawCameraPredicate=function(e,t,r){return!e.renderOnlyInRenderTargetTextures&&e.isBackground===t&&0!=(e.layerMask&r)},e.prototype._drawCameraBackground=function(e){var t=this;this._draw(function(r){return t._drawCameraPredicate(r,!0,e.layerMask)})},e.prototype._drawCameraForeground=function(e){var t=this;this._draw(function(r){return t._drawCameraPredicate(r,!1,e.layerMask)})},e.prototype._drawRenderTargetPredicate=function(e,t,r,i){return e.renderTargetTextures.length>0&&e.isBackground===t&&e.renderTargetTextures.indexOf(i)>-1&&0!=(e.layerMask&r)},e.prototype._drawRenderTargetBackground=function(e){var t=this;this._draw(function(r){return t._drawRenderTargetPredicate(r,!0,t.scene.activeCamera.layerMask,e)})},e.prototype._drawRenderTargetForeground=function(e){var t=this;this._draw(function(r){return t._drawRenderTargetPredicate(r,!1,t.scene.activeCamera.layerMask,e)})},e}()},258:function(e,t,r){"use strict";var i=r(0),s=r(6),n=r(4),o=function(){function e(e,t,r,o,a){this.size=e,this.position=t,this.alphaMode=n.a.ALPHA_ONEONE,this.color=r||new i.Color3(1,1,1),this.texture=o?new s.a(o,a.getScene(),!0):null,this._system=a,a.lensFlares.push(this)}return e.AddFlare=function(t,r,i,s,n){return new e(t,r,i,s,n)},e.prototype.dispose=function(){this.texture&&this.texture.dispose();var e=this._system.lensFlares.indexOf(this);this._system.lensFlares.splice(e,1)},e}(),a=r(5),h=r(12),u=r(21),c=r(3),l=r(35),d=r(14),f=(r(281),r(282),function(){function e(t,r,i){this.name=t,this.lensFlares=new Array,this.borderLimit=300,this.viewportBorder=0,this.layerMask=268435455,this._vertexBuffers={},this._isEnabled=!0,this._scene=i||u.a.LastCreatedScene,e._SceneComponentInitialization(this._scene),this._emitter=r,this.id=t,i.lensFlareSystems.push(this),this.meshesSelectionPredicate=function(e){return i.activeCamera&&e.material&&e.isVisible&&e.isEnabled()&&e.isBlocker&&0!=(e.layerMask&i.activeCamera.layerMask)};var s=i.getEngine(),n=[];n.push(1,1),n.push(-1,1),n.push(-1,-1),n.push(1,-1),this._vertexBuffers[c.VertexBuffer.PositionKind]=new c.VertexBuffer(s,n,c.VertexBuffer.PositionKind,!1,!1,2);var o=[];o.push(0),o.push(1),o.push(2),o.push(0),o.push(2),o.push(3),this._indexBuffer=s.createIndexBuffer(o),this._effect=s.createEffect("lensFlare",[c.VertexBuffer.PositionKind],["color","viewportMatrix"],["textureSampler"],"")}return Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(e){this._isEnabled=e},enumerable:!0,configurable:!0}),e.prototype.getScene=function(){return this._scene},e.prototype.getEmitter=function(){return this._emitter},e.prototype.setEmitter=function(e){this._emitter=e},e.prototype.getEmitterPosition=function(){return this._emitter.getAbsolutePosition?this._emitter.getAbsolutePosition():this._emitter.position},e.prototype.computeEffectivePosition=function(e){var t=this.getEmitterPosition();return t=i.Vector3.Project(t,i.Matrix.Identity(),this._scene.getTransformMatrix(),e),this._positionX=t.x,this._positionY=t.y,t=i.Vector3.TransformCoordinates(this.getEmitterPosition(),this._scene.getViewMatrix()),this.viewportBorder>0&&(e.x-=this.viewportBorder,e.y-=this.viewportBorder,e.width+=2*this.viewportBorder,e.height+=2*this.viewportBorder,t.x+=this.viewportBorder,t.y+=this.viewportBorder,this._positionX+=this.viewportBorder,this._positionY+=this.viewportBorder),t.z>0&&(this._positionX>e.x&&this._positionX<e.x+e.width&&this._positionY>e.y&&(this._positionY,e.y,e.height),!0)},e.prototype._isVisible=function(){if(!this._isEnabled||!this._scene.activeCamera)return!1;var e=this.getEmitterPosition().subtract(this._scene.activeCamera.globalPosition),t=e.length();e.normalize();var r=new l.a(this._scene.activeCamera.globalPosition,e),i=this._scene.pickWithRay(r,this.meshesSelectionPredicate,!0);return!i||!i.hit||i.distance>t},e.prototype.render=function(){if(!this._effect.isReady()||!this._scene.activeCamera)return!1;var e,t,r=this._scene.getEngine(),s=this._scene.activeCamera.viewport.toGlobal(r.getRenderWidth(!0),r.getRenderHeight(!0));if(!this.computeEffectivePosition(s))return!1;if(!this._isVisible())return!1;var o=(e=this._positionX<this.borderLimit+s.x?this.borderLimit+s.x-this._positionX:this._positionX>s.x+s.width-this.borderLimit?this._positionX-s.x-s.width+this.borderLimit:0)>(t=this._positionY<this.borderLimit+s.y?this.borderLimit+s.y-this._positionY:this._positionY>s.y+s.height-this.borderLimit?this._positionY-s.y-s.height+this.borderLimit:0)?e:t;(o-=this.viewportBorder)>this.borderLimit&&(o=this.borderLimit);var a=1-h.a.Clamp(o/this.borderLimit,0,1);if(a<0)return!1;a>1&&(a=1),this.viewportBorder>0&&(s.x+=this.viewportBorder,s.y+=this.viewportBorder,s.width-=2*this.viewportBorder,s.height-=2*this.viewportBorder,this._positionX-=this.viewportBorder,this._positionY-=this.viewportBorder);var u=s.x+s.width/2,c=s.y+s.height/2,l=u-this._positionX,f=c-this._positionY;r.enableEffect(this._effect),r.setState(!1),r.setDepthBuffer(!1),r.bindBuffers(this._vertexBuffers,this._indexBuffer,this._effect);for(var p=0;p<this.lensFlares.length;p++){var _=this.lensFlares[p];r.setAlphaMode(_.alphaMode);var g=u-l*_.position,m=c-f*_.position,y=_.size,x=_.size*r.getAspectRatio(this._scene.activeCamera,!0),M=g/(s.width+2*s.x)*2-1,T=1-m/(s.height+2*s.y)*2,S=i.Matrix.FromValues(y/2,0,0,0,0,x/2,0,0,0,0,1,0,M,T,0,1);this._effect.setMatrix("viewportMatrix",S),this._effect.setTexture("textureSampler",_.texture),this._effect.setFloat4("color",_.color.r*a,_.color.g*a,_.color.b*a,1),r.drawElementsType(d.a.TriangleFillMode,0,6)}return r.setDepthBuffer(!0),r.setAlphaMode(n.a.ALPHA_DISABLE),!0},e.prototype.dispose=function(){var e=this._vertexBuffers[c.VertexBuffer.PositionKind];for(e&&(e.dispose(),this._vertexBuffers[c.VertexBuffer.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null);this.lensFlares.length;)this.lensFlares[0].dispose();var t=this._scene.lensFlareSystems.indexOf(this);this._scene.lensFlareSystems.splice(t,1)},e.Parse=function(t,r,s){var n=r.getLastEntryByID(t.emitterId),a=t.name||"lensFlareSystem#"+t.emitterId,h=new e(a,n,r);h.id=t.id||a,h.borderLimit=t.borderLimit;for(var u=0;u<t.flares.length;u++){var c=t.flares[u];o.AddFlare(c.size,c.position,i.Color3.FromArray(c.color),c.textureName?s+c.textureName:"",h)}return h},e.prototype.serialize=function(){var e={};e.id=this.id,e.name=this.name,e.emitterId=this.getEmitter().id,e.borderLimit=this.borderLimit,e.flares=[];for(var t=0;t<this.lensFlares.length;t++){var r=this.lensFlares[t];e.flares.push({size:r.size,position:r.position,color:r.color.asArray(),textureName:a.h.GetFilename(r.texture?r.texture.name:"")})}return e},e._SceneComponentInitialization=function(e){throw"Import LensFlareSystemSceneComponent before creating LensFlareSystem."},e}()),p=r(15),_=r(38);_.a.AddParser(p.a.NAME_LENSFLARESYSTEM,function(e,t,r,i){if(void 0!==e.lensFlareSystems&&null!==e.lensFlareSystems){r.lensFlareSystems||(r.lensFlareSystems=new Array);for(var s=0,n=e.lensFlareSystems.length;s<n;s++){var o=e.lensFlareSystems[s],a=f.Parse(o,t,i);r.lensFlareSystems.push(a)}}}),_.a.prototype.getLensFlareSystemByName=function(e){for(var t=0;t<this.lensFlareSystems.length;t++)if(this.lensFlareSystems[t].name===e)return this.lensFlareSystems[t];return null},_.a.prototype.getLensFlareSystemByID=function(e){for(var t=0;t<this.lensFlareSystems.length;t++)if(this.lensFlareSystems[t].id===e)return this.lensFlareSystems[t];return null},_.a.prototype.removeLensFlareSystem=function(e){var t=this.lensFlareSystems.indexOf(e);return-1!==t&&this.lensFlareSystems.splice(t,1),t},_.a.prototype.addLensFlareSystem=function(e){this.lensFlareSystems.push(e)};var g=function(){function e(e){this.name=p.a.NAME_LENSFLARESYSTEM,this.scene=e,e.lensFlareSystems=new Array}return e.prototype.register=function(){this.scene._afterCameraDrawStage.registerStep(p.a.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM,this,this._draw)},e.prototype.rebuild=function(){},e.prototype.addFromContainer=function(e){var t=this;e.lensFlareSystems&&e.lensFlareSystems.forEach(function(e){t.scene.addLensFlareSystem(e)})},e.prototype.removeFromContainer=function(e){var t=this;e.lensFlareSystems&&e.lensFlareSystems.forEach(function(e){t.scene.removeLensFlareSystem(e)})},e.prototype.serialize=function(e){e.lensFlareSystems=[];for(var t=0,r=this.scene.lensFlareSystems;t<r.length;t++){var i=r[t];e.lensFlareSystems.push(i.serialize())}},e.prototype.dispose=function(){for(var e=this.scene.lensFlareSystems;e.length;)e[0].dispose()},e.prototype._draw=function(e){if(this.scene.lensFlaresEnabled){var t=this.scene.lensFlareSystems;a.h.StartPerformanceCounter("Lens flares",t.length>0);for(var r=0,i=t;r<i.length;r++){var s=i[r];0!=(e.layerMask&s.layerMask)&&s.render()}a.h.EndPerformanceCounter("Lens flares",t.length>0)}},e}();f._SceneComponentInitialization=function(e){var t=e._getComponent(p.a.NAME_LENSFLARESYSTEM);t||(t=new g(e),e._addComponent(t))},r.d(t,"a",function(){return o}),r.d(t,"b",function(){return f}),r.d(t,"c",function(){return g})},259:function(e,t,r){"use strict";var i=r(44),s=r(106),n=r(1),o=r(0),a=r(3),h=r(14),u=r(17),c=r(6),l=r(39),d=r(18),f=r(50),p=r(4),_=(r(283),r(284),r(285),function(){function e(t,r,i){this._bias=5e-5,this._normalBias=0,this._blurBoxOffset=1,this._blurScale=2,this._blurKernel=1,this._useKernelBlur=!1,this._filter=e.FILTER_NONE,this._filteringQuality=e.QUALITY_HIGH,this._contactHardeningLightSizeUVRatio=.1,this._darkness=0,this._transparencyShadow=!1,this.frustumEdgeFalloff=0,this.forceBackFacesOnly=!1,this._lightDirection=o.Vector3.Zero(),this._viewMatrix=o.Matrix.Zero(),this._projectionMatrix=o.Matrix.Zero(),this._transformMatrix=o.Matrix.Zero(),this._cachedPosition=new o.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cachedDirection=new o.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._currentFaceIndex=0,this._currentFaceIndexCache=0,this._defaultTextureMatrix=o.Matrix.Identity(),this._mapSize=t,this._light=r,this._scene=r.getScene(),r._shadowGenerator=this,e._SceneComponentInitialization(this._scene);var s=this._scene.getEngine().getCaps();i?s.textureFloatRender&&s.textureFloatLinearFiltering?this._textureType=p.a.TEXTURETYPE_FLOAT:s.textureHalfFloatRender&&s.textureHalfFloatLinearFiltering?this._textureType=p.a.TEXTURETYPE_HALF_FLOAT:this._textureType=p.a.TEXTURETYPE_UNSIGNED_INT:s.textureHalfFloatRender&&s.textureHalfFloatLinearFiltering?this._textureType=p.a.TEXTURETYPE_HALF_FLOAT:s.textureFloatRender&&s.textureFloatLinearFiltering?this._textureType=p.a.TEXTURETYPE_FLOAT:this._textureType=p.a.TEXTURETYPE_UNSIGNED_INT,this._initializeGenerator(),this._applyFilterValues()}return Object.defineProperty(e.prototype,"bias",{get:function(){return this._bias},set:function(e){this._bias=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"normalBias",{get:function(){return this._normalBias},set:function(e){this._normalBias=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blurBoxOffset",{get:function(){return this._blurBoxOffset},set:function(e){this._blurBoxOffset!==e&&(this._blurBoxOffset=e,this._disposeBlurPostProcesses())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blurScale",{get:function(){return this._blurScale},set:function(e){this._blurScale!==e&&(this._blurScale=e,this._disposeBlurPostProcesses())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blurKernel",{get:function(){return this._blurKernel},set:function(e){this._blurKernel!==e&&(this._blurKernel=e,this._disposeBlurPostProcesses())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useKernelBlur",{get:function(){return this._useKernelBlur},set:function(e){this._useKernelBlur!==e&&(this._useKernelBlur=e,this._disposeBlurPostProcesses())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depthScale",{get:function(){return void 0!==this._depthScale?this._depthScale:this._light.getDepthScale()},set:function(e){this._depthScale=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"filter",{get:function(){return this._filter},set:function(t){if(this._light.needCube()){if(t===e.FILTER_BLUREXPONENTIALSHADOWMAP)return void(this.useExponentialShadowMap=!0);if(t===e.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP)return void(this.useCloseExponentialShadowMap=!0);if(t===e.FILTER_PCF||t===e.FILTER_PCSS)return void(this.usePoissonSampling=!0)}t!==e.FILTER_PCF&&t!==e.FILTER_PCSS||1!==this._scene.getEngine().webGLVersion?this._filter!==t&&(this._filter=t,this._disposeBlurPostProcesses(),this._applyFilterValues(),this._light._markMeshesAsLightDirty()):this.usePoissonSampling=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"usePoissonSampling",{get:function(){return this.filter===e.FILTER_POISSONSAMPLING},set:function(t){(t||this.filter===e.FILTER_POISSONSAMPLING)&&(this.filter=t?e.FILTER_POISSONSAMPLING:e.FILTER_NONE)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useExponentialShadowMap",{get:function(){return this.filter===e.FILTER_EXPONENTIALSHADOWMAP},set:function(t){(t||this.filter===e.FILTER_EXPONENTIALSHADOWMAP)&&(this.filter=t?e.FILTER_EXPONENTIALSHADOWMAP:e.FILTER_NONE)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useBlurExponentialShadowMap",{get:function(){return this.filter===e.FILTER_BLUREXPONENTIALSHADOWMAP},set:function(t){(t||this.filter===e.FILTER_BLUREXPONENTIALSHADOWMAP)&&(this.filter=t?e.FILTER_BLUREXPONENTIALSHADOWMAP:e.FILTER_NONE)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useCloseExponentialShadowMap",{get:function(){return this.filter===e.FILTER_CLOSEEXPONENTIALSHADOWMAP},set:function(t){(t||this.filter===e.FILTER_CLOSEEXPONENTIALSHADOWMAP)&&(this.filter=t?e.FILTER_CLOSEEXPONENTIALSHADOWMAP:e.FILTER_NONE)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useBlurCloseExponentialShadowMap",{get:function(){return this.filter===e.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP},set:function(t){(t||this.filter===e.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP)&&(this.filter=t?e.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP:e.FILTER_NONE)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"usePercentageCloserFiltering",{get:function(){return this.filter===e.FILTER_PCF},set:function(t){(t||this.filter===e.FILTER_PCF)&&(this.filter=t?e.FILTER_PCF:e.FILTER_NONE)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"filteringQuality",{get:function(){return this._filteringQuality},set:function(e){this._filteringQuality=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useContactHardeningShadow",{get:function(){return this.filter===e.FILTER_PCSS},set:function(t){(t||this.filter===e.FILTER_PCSS)&&(this.filter=t?e.FILTER_PCSS:e.FILTER_NONE)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"contactHardeningLightSizeUVRatio",{get:function(){return this._contactHardeningLightSizeUVRatio},set:function(e){this._contactHardeningLightSizeUVRatio=e},enumerable:!0,configurable:!0}),e.prototype.getDarkness=function(){return this._darkness},e.prototype.setDarkness=function(e){return this._darkness=e>=1?1:e<=0?0:e,this},e.prototype.setTransparencyShadow=function(e){return this._transparencyShadow=e,this},e.prototype.getShadowMap=function(){return this._shadowMap},e.prototype.getShadowMapForRendering=function(){return this._shadowMap2?this._shadowMap2:this._shadowMap},e.prototype.addShadowCaster=function(e,t){var r;return void 0===t&&(t=!0),this._shadowMap?(this._shadowMap.renderList||(this._shadowMap.renderList=[]),this._shadowMap.renderList.push(e),t&&(r=this._shadowMap.renderList).push.apply(r,e.getChildMeshes()),this):this},e.prototype.removeShadowCaster=function(e,t){if(void 0===t&&(t=!0),!this._shadowMap||!this._shadowMap.renderList)return this;var r=this._shadowMap.renderList.indexOf(e);if(-1!==r&&this._shadowMap.renderList.splice(r,1),t)for(var i=0,s=e.getChildren();i<s.length;i++){var n=s[i];this.removeShadowCaster(n)}return this},e.prototype.getLight=function(){return this._light},e.prototype._initializeGenerator=function(){this._light._markMeshesAsLightDirty(),this._initializeShadowMap()},e.prototype._initializeShadowMap=function(){var t=this,r=this._scene.getEngine();r.webGLVersion>1?(this._shadowMap=new l.a(this._light.name+"_shadowMap",this._mapSize,this._scene,!1,!0,this._textureType,this._light.needCube(),void 0,!1,!1),this._shadowMap.createDepthStencilTexture(p.a.LESS,!0)):this._shadowMap=new l.a(this._light.name+"_shadowMap",this._mapSize,this._scene,!1,!0,this._textureType,this._light.needCube()),this._shadowMap.wrapU=c.a.CLAMP_ADDRESSMODE,this._shadowMap.wrapV=c.a.CLAMP_ADDRESSMODE,this._shadowMap.anisotropicFilteringLevel=1,this._shadowMap.updateSamplingMode(c.a.BILINEAR_SAMPLINGMODE),this._shadowMap.renderParticles=!1,this._shadowMap.ignoreCameraViewport=!0,this._shadowMap.onBeforeRenderObservable.add(function(i){t._currentFaceIndex=i,t._filter===e.FILTER_PCF&&r.setColorWrite(!1)}),this._shadowMap.customRenderFunction=this._renderForShadowMap.bind(this),this._shadowMap.onAfterUnbindObservable.add(function(){if(t._filter===e.FILTER_PCF&&r.setColorWrite(!0),t.useBlurExponentialShadowMap||t.useBlurCloseExponentialShadowMap){var i=t.getShadowMapForRendering();i&&t._scene.postProcessManager.directRender(t._blurPostProcesses,i.getInternalTexture(),!0)}});var i=new o.Color4(0,0,0,0),s=new o.Color4(1,1,1,1);this._shadowMap.onClearObservable.add(function(r){t._filter===e.FILTER_PCF?r.clear(s,!1,!0,!1):t.useExponentialShadowMap||t.useBlurExponentialShadowMap?r.clear(i,!0,!0,!1):r.clear(s,!0,!0,!1)})},e.prototype._initializeBlurRTTAndPostProcesses=function(){var e=this,t=this._scene.getEngine(),r=this._mapSize/this.blurScale;this.useKernelBlur&&1===this.blurScale||(this._shadowMap2=new l.a(this._light.name+"_shadowMap2",r,this._scene,!1,!0,this._textureType),this._shadowMap2.wrapU=c.a.CLAMP_ADDRESSMODE,this._shadowMap2.wrapV=c.a.CLAMP_ADDRESSMODE,this._shadowMap2.updateSamplingMode(c.a.BILINEAR_SAMPLINGMODE)),this.useKernelBlur?(this._kernelBlurXPostprocess=new f.a(this._light.name+"KernelBlurX",new o.Vector2(1,0),this.blurKernel,1,null,c.a.BILINEAR_SAMPLINGMODE,t,!1,this._textureType),this._kernelBlurXPostprocess.width=r,this._kernelBlurXPostprocess.height=r,this._kernelBlurXPostprocess.onApplyObservable.add(function(t){t.setTexture("textureSampler",e._shadowMap)}),this._kernelBlurYPostprocess=new f.a(this._light.name+"KernelBlurY",new o.Vector2(0,1),this.blurKernel,1,null,c.a.BILINEAR_SAMPLINGMODE,t,!1,this._textureType),this._kernelBlurXPostprocess.autoClear=!1,this._kernelBlurYPostprocess.autoClear=!1,this._textureType===p.a.TEXTURETYPE_UNSIGNED_INT&&(this._kernelBlurXPostprocess.packedFloat=!0,this._kernelBlurYPostprocess.packedFloat=!0),this._blurPostProcesses=[this._kernelBlurXPostprocess,this._kernelBlurYPostprocess]):(this._boxBlurPostprocess=new d.a(this._light.name+"DepthBoxBlur","depthBoxBlur",["screenSize","boxOffset"],[],1,null,c.a.BILINEAR_SAMPLINGMODE,t,!1,"#define OFFSET "+this._blurBoxOffset,this._textureType),this._boxBlurPostprocess.onApplyObservable.add(function(t){t.setFloat2("screenSize",r,r),t.setTexture("textureSampler",e._shadowMap)}),this._boxBlurPostprocess.autoClear=!1,this._blurPostProcesses=[this._boxBlurPostprocess])},e.prototype._renderForShadowMap=function(e,t,r,i){var s,n=this._scene.getEngine();if(i.length){for(n.setColorWrite(!1),s=0;s<i.length;s++)this._renderSubMeshForShadowMap(i.data[s]);n.setColorWrite(!0)}for(s=0;s<e.length;s++)this._renderSubMeshForShadowMap(e.data[s]);for(s=0;s<t.length;s++)this._renderSubMeshForShadowMap(t.data[s]);if(this._transparencyShadow)for(s=0;s<r.length;s++)this._renderSubMeshForShadowMap(r.data[s])},e.prototype._renderSubMeshForShadowMap=function(e){var t=this,r=e.getRenderingMesh(),s=this._scene,n=s.getEngine(),o=e.getMaterial();if(o&&0!==e.verticesCount){n.setState(o.backFaceCulling);var a=r._getInstancesRenderList(e._id);if(!a.mustReturn){var c=n.getCaps().instancedArrays&&null!==a.visibleInstances[e._id]&&void 0!==a.visibleInstances[e._id];if(this.isReady(e,c)){if(n.enableEffect(this._effect),r._bind(e,this._effect,h.a.TriangleFillMode),this._effect.setFloat3("biasAndScale",this.bias,this.normalBias,this.depthScale),this._effect.setMatrix("viewProjection",this.getTransformMatrix()),this.getLight().getTypeID()===i.a.LIGHTTYPEID_DIRECTIONALLIGHT?this._effect.setVector3("lightData",this._cachedDirection):this._effect.setVector3("lightData",this._cachedPosition),s.activeCamera&&this._effect.setFloat2("depthValues",this.getLight().getDepthMinZ(s.activeCamera),this.getLight().getDepthMinZ(s.activeCamera)+this.getLight().getDepthMaxZ(s.activeCamera)),o&&o.needAlphaTesting()){var l=o.getAlphaTestTexture();l&&(this._effect.setTexture("diffuseSampler",l),this._effect.setMatrix("diffuseMatrix",l.getTextureMatrix()||this._defaultTextureMatrix))}if(r.useBones&&r.computeBonesUsingShaders&&r.skeleton){var d=r.skeleton;if(d.isUsingTextureForMatrices){var f=d.getTransformMatrixTexture();if(!f)return;this._effect.setTexture("boneSampler",f),this._effect.setFloat("boneTextureWidth",4*(d.bones.length+1))}else this._effect.setMatrices("mBones",d.getTransformMatrices(r))}u.a.BindMorphTargetParameters(r,this._effect),this.forceBackFacesOnly&&n.setState(!0,0,!1,!0),r._processRendering(e,this._effect,h.a.TriangleFillMode,a,c,function(e,r){return t._effect.setMatrix("world",r)}),this.forceBackFacesOnly&&n.setState(!0,0,!1,!1)}else this._shadowMap&&this._shadowMap.resetRefreshCounter()}}},e.prototype._applyFilterValues=function(){this._shadowMap&&(this.filter===e.FILTER_NONE||this.filter===e.FILTER_PCSS?this._shadowMap.updateSamplingMode(c.a.NEAREST_SAMPLINGMODE):this._shadowMap.updateSamplingMode(c.a.BILINEAR_SAMPLINGMODE))},e.prototype.forceCompilation=function(e,t){var r=this,i=n.a({useInstances:!1},t),s=this.getShadowMap();if(s){var o=s.renderList;if(o){for(var a=new Array,h=0,u=o;h<u.length;h++){var c=u[h];a.push.apply(a,c.subMeshes)}if(0!==a.length){var l=0,d=function(){if(r._scene&&r._scene.getEngine()){for(;r.isReady(a[l],i.useInstances);)if(++l>=a.length)return void(e&&e(r));setTimeout(d,16)}};d()}else e&&e(this)}else e&&e(this)}else e&&e(this)},e.prototype.forceCompilationAsync=function(e){var t=this;return new Promise(function(r){t.forceCompilation(function(){r()},e)})},e.prototype.isReady=function(e,t){var r=[];this._textureType!==p.a.TEXTURETYPE_UNSIGNED_INT&&r.push("#define FLOAT"),this.useExponentialShadowMap||this.useBlurExponentialShadowMap?r.push("#define ESM"):(this.usePercentageCloserFiltering||this.useContactHardeningShadow)&&r.push("#define DEPTHTEXTURE");var s=[a.VertexBuffer.PositionKind],n=e.getMesh(),o=e.getMaterial();if(this.normalBias&&n.isVerticesDataPresent(a.VertexBuffer.NormalKind)&&(s.push(a.VertexBuffer.NormalKind),r.push("#define NORMAL"),n.nonUniformScaling&&r.push("#define NONUNIFORMSCALING"),this.getLight().getTypeID()===i.a.LIGHTTYPEID_DIRECTIONALLIGHT&&r.push("#define DIRECTIONINLIGHTDATA")),o&&o.needAlphaTesting()){var h=o.getAlphaTestTexture();h&&(r.push("#define ALPHATEST"),n.isVerticesDataPresent(a.VertexBuffer.UVKind)&&(s.push(a.VertexBuffer.UVKind),r.push("#define UV1")),n.isVerticesDataPresent(a.VertexBuffer.UV2Kind)&&1===h.coordinatesIndex&&(s.push(a.VertexBuffer.UV2Kind),r.push("#define UV2")))}if(n.useBones&&n.computeBonesUsingShaders&&n.skeleton){s.push(a.VertexBuffer.MatricesIndicesKind),s.push(a.VertexBuffer.MatricesWeightsKind),n.numBoneInfluencers>4&&(s.push(a.VertexBuffer.MatricesIndicesExtraKind),s.push(a.VertexBuffer.MatricesWeightsExtraKind));var c=n.skeleton;r.push("#define NUM_BONE_INFLUENCERS "+n.numBoneInfluencers),c.isUsingTextureForMatrices?r.push("#define BONETEXTURE"):r.push("#define BonesPerMesh "+(c.bones.length+1))}else r.push("#define NUM_BONE_INFLUENCERS 0");var l=n.morphTargetManager,d=0;l&&l.numInfluencers>0&&(r.push("#define MORPHTARGETS"),d=l.numInfluencers,r.push("#define NUM_MORPH_INFLUENCERS "+d),u.a.PrepareAttributesForMorphTargets(s,n,{NUM_MORPH_INFLUENCERS:d})),t&&(r.push("#define INSTANCES"),s.push("world0"),s.push("world1"),s.push("world2"),s.push("world3"));var f=r.join("\n");return this._cachedDefines!==f&&(this._cachedDefines=f,this._effect=this._scene.getEngine().createEffect("shadowMap",s,["world","mBones","viewProjection","diffuseMatrix","lightData","depthValues","biasAndScale","morphTargetInfluences","boneTextureWidth"],["diffuseSampler","boneSampler"],f,void 0,void 0,void 0,{maxSimultaneousMorphTargets:d})),!!this._effect.isReady()&&((this.useBlurExponentialShadowMap||this.useBlurCloseExponentialShadowMap)&&(this._blurPostProcesses&&this._blurPostProcesses.length||this._initializeBlurRTTAndPostProcesses()),!(this._kernelBlurXPostprocess&&!this._kernelBlurXPostprocess.isReady())&&(!(this._kernelBlurYPostprocess&&!this._kernelBlurYPostprocess.isReady())&&!(this._boxBlurPostprocess&&!this._boxBlurPostprocess.isReady())))},e.prototype.prepareDefines=function(t,r){var i=this._scene,s=this._light;i.shadowsEnabled&&s.shadowEnabled&&(t["SHADOW"+r]=!0,this.useContactHardeningShadow&&(t["SHADOWPCSS"+r]=!0,this._filteringQuality===e.QUALITY_LOW?t["SHADOWLOWQUALITY"+r]=!0:this._filteringQuality===e.QUALITY_MEDIUM&&(t["SHADOWMEDIUMQUALITY"+r]=!0)),this.usePercentageCloserFiltering?(t["SHADOWPCF"+r]=!0,this._filteringQuality===e.QUALITY_LOW?t["SHADOWLOWQUALITY"+r]=!0:this._filteringQuality===e.QUALITY_MEDIUM&&(t["SHADOWMEDIUMQUALITY"+r]=!0)):this.usePoissonSampling?t["SHADOWPOISSON"+r]=!0:this.useExponentialShadowMap||this.useBlurExponentialShadowMap?t["SHADOWESM"+r]=!0:(this.useCloseExponentialShadowMap||this.useBlurCloseExponentialShadowMap)&&(t["SHADOWCLOSEESM"+r]=!0),s.needCube()&&(t["SHADOWCUBE"+r]=!0))},e.prototype.bindShadowLight=function(t,r){var i=this._light,s=this._scene;if(s.shadowsEnabled&&i.shadowEnabled){var n=s.activeCamera;if(n){var o=this.getShadowMap();o&&(i.needCube()||r.setMatrix("lightMatrix"+t,this.getTransformMatrix()),this._filter===e.FILTER_PCF?(r.setDepthStencilTexture("shadowSampler"+t,this.getShadowMapForRendering()),i._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),o.getSize().width,1/o.getSize().width,this.frustumEdgeFalloff,t)):this._filter===e.FILTER_PCSS?(r.setDepthStencilTexture("shadowSampler"+t,this.getShadowMapForRendering()),r.setTexture("depthSampler"+t,this.getShadowMapForRendering()),i._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),1/o.getSize().width,this._contactHardeningLightSizeUVRatio*o.getSize().width,this.frustumEdgeFalloff,t)):(r.setTexture("shadowSampler"+t,this.getShadowMapForRendering()),i._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),this.blurScale/o.getSize().width,this.depthScale,this.frustumEdgeFalloff,t)),i._uniformBuffer.updateFloat2("depthValues",this.getLight().getDepthMinZ(n),this.getLight().getDepthMinZ(n)+this.getLight().getDepthMaxZ(n),t))}}},e.prototype.getTransformMatrix=function(){var e=this._scene;if(this._currentRenderID===e.getRenderId()&&this._currentFaceIndexCache===this._currentFaceIndex)return this._transformMatrix;this._currentRenderID=e.getRenderId(),this._currentFaceIndexCache=this._currentFaceIndex;var t=this._light.position;if(this._light.computeTransformedInformation()&&(t=this._light.transformedPosition),o.Vector3.NormalizeToRef(this._light.getShadowDirection(this._currentFaceIndex),this._lightDirection),1===Math.abs(o.Vector3.Dot(this._lightDirection,o.Vector3.Up()))&&(this._lightDirection.z=1e-13),this._light.needProjectionMatrixCompute()||!this._cachedPosition||!this._cachedDirection||!t.equals(this._cachedPosition)||!this._lightDirection.equals(this._cachedDirection)){this._cachedPosition.copyFrom(t),this._cachedDirection.copyFrom(this._lightDirection),o.Matrix.LookAtLHToRef(t,t.add(this._lightDirection),o.Vector3.Up(),this._viewMatrix);var r=this.getShadowMap();if(r){var i=r.renderList;i&&this._light.setShadowProjectionMatrix(this._projectionMatrix,this._viewMatrix,i)}this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix)}return this._transformMatrix},e.prototype.recreateShadowMap=function(){var e=this._shadowMap;if(e){var t=e.renderList;this._disposeRTTandPostProcesses(),this._initializeGenerator(),this.filter=this.filter,this._applyFilterValues(),this._shadowMap.renderList=t}},e.prototype._disposeBlurPostProcesses=function(){this._shadowMap2&&(this._shadowMap2.dispose(),this._shadowMap2=null),this._boxBlurPostprocess&&(this._boxBlurPostprocess.dispose(),this._boxBlurPostprocess=null),this._kernelBlurXPostprocess&&(this._kernelBlurXPostprocess.dispose(),this._kernelBlurXPostprocess=null),this._kernelBlurYPostprocess&&(this._kernelBlurYPostprocess.dispose(),this._kernelBlurYPostprocess=null),this._blurPostProcesses=[]},e.prototype._disposeRTTandPostProcesses=function(){this._shadowMap&&(this._shadowMap.dispose(),this._shadowMap=null),this._disposeBlurPostProcesses()},e.prototype.dispose=function(){this._disposeRTTandPostProcesses(),this._light&&(this._light._shadowGenerator=null,this._light._markMeshesAsLightDirty())},e.prototype.serialize=function(){var e={},t=this.getShadowMap();if(!t)return e;if(e.lightId=this._light.id,e.mapSize=t.getRenderSize(),e.useExponentialShadowMap=this.useExponentialShadowMap,e.useBlurExponentialShadowMap=this.useBlurExponentialShadowMap,e.useCloseExponentialShadowMap=this.useBlurExponentialShadowMap,e.useBlurCloseExponentialShadowMap=this.useBlurExponentialShadowMap,e.usePoissonSampling=this.usePoissonSampling,e.forceBackFacesOnly=this.forceBackFacesOnly,e.depthScale=this.depthScale,e.darkness=this.getDarkness(),e.blurBoxOffset=this.blurBoxOffset,e.blurKernel=this.blurKernel,e.blurScale=this.blurScale,e.useKernelBlur=this.useKernelBlur,e.transparencyShadow=this._transparencyShadow,e.frustumEdgeFalloff=this.frustumEdgeFalloff,e.bias=this.bias,e.normalBias=this.normalBias,e.usePercentageCloserFiltering=this.usePercentageCloserFiltering,e.useContactHardeningShadow=this.useContactHardeningShadow,e.filteringQuality=this.filteringQuality,e.contactHardeningLightSizeUVRatio=this.contactHardeningLightSizeUVRatio,e.renderList=[],t.renderList)for(var r=0;r<t.renderList.length;r++){var i=t.renderList[r];e.renderList.push(i.id)}return e},e.Parse=function(t,r){for(var i=r.getLightByID(t.lightId),s=new e(t.mapSize,i),n=s.getShadowMap(),o=0;o<t.renderList.length;o++){r.getMeshesByID(t.renderList[o]).forEach(function(e){n&&(n.renderList||(n.renderList=[]),n.renderList.push(e))})}return t.usePoissonSampling?s.usePoissonSampling=!0:t.useExponentialShadowMap?s.useExponentialShadowMap=!0:t.useBlurExponentialShadowMap?s.useBlurExponentialShadowMap=!0:t.useCloseExponentialShadowMap?s.useCloseExponentialShadowMap=!0:t.useBlurCloseExponentialShadowMap?s.useBlurCloseExponentialShadowMap=!0:t.usePercentageCloserFiltering?s.usePercentageCloserFiltering=!0:t.useContactHardeningShadow&&(s.useContactHardeningShadow=!0),t.filteringQuality&&(s.filteringQuality=t.filteringQuality),t.contactHardeningLightSizeUVRatio?s.contactHardeningLightSizeUVRatio=t.contactHardeningLightSizeUVRatio:t.useVarianceShadowMap?s.useExponentialShadowMap=!0:t.useBlurVarianceShadowMap&&(s.useBlurExponentialShadowMap=!0),t.depthScale&&(s.depthScale=t.depthScale),t.blurScale&&(s.blurScale=t.blurScale),t.blurBoxOffset&&(s.blurBoxOffset=t.blurBoxOffset),t.useKernelBlur&&(s.useKernelBlur=t.useKernelBlur),t.blurKernel&&(s.blurKernel=t.blurKernel),void 0!==t.bias&&(s.bias=t.bias),void 0!==t.normalBias&&(s.normalBias=t.normalBias),void 0!==t.frustumEdgeFalloff&&(s.frustumEdgeFalloff=t.frustumEdgeFalloff),t.darkness&&s.setDarkness(t.darkness),t.transparencyShadow&&s.setTransparencyShadow(!0),s.forceBackFacesOnly=t.forceBackFacesOnly,s},e.FILTER_NONE=0,e.FILTER_EXPONENTIALSHADOWMAP=1,e.FILTER_POISSONSAMPLING=2,e.FILTER_BLUREXPONENTIALSHADOWMAP=3,e.FILTER_CLOSEEXPONENTIALSHADOWMAP=4,e.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP=5,e.FILTER_PCF=6,e.FILTER_PCSS=7,e.QUALITY_HIGH=0,e.QUALITY_MEDIUM=1,e.QUALITY_LOW=2,e._SceneComponentInitialization=function(e){throw"Import ShadowGeneratorSceneComponent before creating ShadowGenerator."},e}()),g=r(15);r(38).a.AddParser(g.a.NAME_SHADOWGENERATOR,function(e,t){if(void 0!==e.shadowGenerators&&null!==e.shadowGenerators)for(var r=0,i=e.shadowGenerators.length;r<i;r++){var s=e.shadowGenerators[r];_.Parse(s,t)}});var m=function(){function e(e){this.name=g.a.NAME_SHADOWGENERATOR,this.scene=e}return e.prototype.register=function(){this.scene._gatherRenderTargetsStage.registerStep(g.a.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR,this,this._gatherRenderTargets)},e.prototype.rebuild=function(){},e.prototype.serialize=function(e){e.shadowGenerators=[];for(var t=0,r=this.scene.lights;t<r.length;t++){var i=r[t].getShadowGenerator();i&&e.shadowGenerators.push(i.serialize())}},e.prototype.addFromContainer=function(e){},e.prototype.removeFromContainer=function(e){},e.prototype.dispose=function(){},e.prototype._gatherRenderTargets=function(e){var t=this.scene;if(this.scene.shadowsEnabled)for(var r=0;r<t.lights.length;r++){var i=t.lights[r],s=i.getShadowGenerator();if(i.isEnabled()&&i.shadowEnabled&&s){var n=s.getShadowMap();-1!==t.textures.indexOf(n)&&e.push(n)}}},e}();_._SceneComponentInitialization=function(e){var t=e._getComponent(g.a.NAME_SHADOWGENERATOR);t||(t=new m(e),e._addComponent(t))};var y=r(107),x=r(71),M=r(108),T=r(109);r.d(t,"c",function(){return i.a}),r.d(t,"g",function(){return s.a}),r.d(t,"e",function(){return _}),r.d(t,"f",function(){return m}),r.d(t,"a",function(){return y.a}),r.d(t,"b",function(){return x.HemisphericLight}),r.d(t,"d",function(){return M.a}),r.d(t,"h",function(){return T.a})},265:function(e,t,r){"use strict";var i=r(102),s=r(22),n=r(15),o=r(38);o.a.AddParser(n.a.NAME_EFFECTLAYER,function(e,t,r,s){if(e.effectLayers){r.effectLayers||(r.effectLayers=new Array);for(var n=0;n<e.effectLayers.length;n++){var o=i.a.Parse(e.effectLayers[n],t,s);r.effectLayers.push(o)}}}),o.a.prototype.removeEffectLayer=function(e){var t=this.effectLayers.indexOf(e);return-1!==t&&this.effectLayers.splice(t,1),t},o.a.prototype.addEffectLayer=function(e){this.effectLayers.push(e)};var a=function(){function e(e){this.name=n.a.NAME_EFFECTLAYER,this._renderEffects=!1,this._needStencil=!1,this._previousStencilState=!1,this.scene=e,this._engine=e.getEngine(),e.effectLayers=new Array}return e.prototype.register=function(){this.scene._isReadyForMeshStage.registerStep(n.a.STEP_ISREADYFORMESH_EFFECTLAYER,this,this._isReadyForMesh),this.scene._cameraDrawRenderTargetStage.registerStep(n.a.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER,this,this._renderMainTexture),this.scene._beforeCameraDrawStage.registerStep(n.a.STEP_BEFORECAMERADRAW_EFFECTLAYER,this,this._setStencil),this.scene._afterRenderingGroupDrawStage.registerStep(n.a.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW,this,this._drawRenderingGroup),this.scene._afterCameraDrawStage.registerStep(n.a.STEP_AFTERCAMERADRAW_EFFECTLAYER,this,this._setStencilBack),this.scene._afterCameraDrawStage.registerStep(n.a.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW,this,this._drawCamera)},e.prototype.rebuild=function(){for(var e=0,t=this.scene.effectLayers;e<t.length;e++){t[e]._rebuild()}},e.prototype.serialize=function(e){e.effectLayers=[];for(var t=0,r=this.scene.effectLayers;t<r.length;t++){var i=r[t];i.serialize&&e.effectLayers.push(i.serialize())}},e.prototype.addFromContainer=function(e){var t=this;e.effectLayers&&e.effectLayers.forEach(function(e){t.scene.addEffectLayer(e)})},e.prototype.removeFromContainer=function(e){var t=this;e.effectLayers&&e.effectLayers.forEach(function(e){t.scene.removeEffectLayer(e)})},e.prototype.dispose=function(){for(var e=this.scene.effectLayers;e.length;)e[0].dispose()},e.prototype._isReadyForMesh=function(e,t){for(var r=0,i=this.scene.effectLayers;r<i.length;r++){var s=i[r];if(s.hasMesh(e))for(var n=0,o=e.subMeshes;n<o.length;n++){var a=o[n];if(!s.isReady(a,t))return!1}}return!0},e.prototype._renderMainTexture=function(e){this._renderEffects=!1,this._needStencil=!1;var t=this.scene.effectLayers;if(t&&t.length>0){this._previousStencilState=this._engine.getStencilBuffer();for(var r=0,i=t;r<i.length;r++){var n=i[r];if(n.shouldRender()&&(!n.camera||n.camera.cameraRigMode===s.a.RIG_MODE_NONE&&e===n.camera||n.camera.cameraRigMode!==s.a.RIG_MODE_NONE&&n.camera._rigCameras.indexOf(e)>-1)){this._renderEffects=!0,this._needStencil=this._needStencil||n.needStencil();var o=n._mainTexture;o._shouldRender()&&(this.scene.incrementRenderId(),o.render(!1,!1))}}this.scene.incrementRenderId()}},e.prototype._setStencil=function(){this._needStencil&&this._engine.setStencilBuffer(!0)},e.prototype._setStencilBack=function(){this._needStencil&&this._engine.setStencilBuffer(this._previousStencilState)},e.prototype._draw=function(e){if(this._renderEffects){this._engine.setDepthBuffer(!1);for(var t=this.scene.effectLayers,r=0;r<t.length;r++){var i=t[r];i.renderingGroupId===e&&i.shouldRender()&&i.render()}this._engine.setDepthBuffer(!0)}},e.prototype._drawCamera=function(){this._renderEffects&&this._draw(-1)},e.prototype._drawRenderingGroup=function(e){!this.scene._isInIntermediateRendering()&&this._renderEffects&&this._draw(e)},e}();i.a._SceneComponentInitialization=function(e){var t=e._getComponent(n.a.NAME_EFFECTLAYER);t||(t=new a(e),e._addComponent(t))};var h=r(194),u=r(1),c=r(2),l=r(7),d=r(5),f=r(0),p=r(3),_=r(14),g=r(6),m=r(39),y=r(18),x=r(69),M=r(50),T=r(4),S=r(9),E=r(26);r(230),r(231),r(278);o.a.prototype.getHighlightLayerByName=function(e){for(var t=0;t<this.effectLayers.length;t++)if(this.effectLayers[t].name===e&&this.effectLayers[t].getEffectName()===L.EffectName)return this.effectLayers[t];return null};var b=function(e){function t(t,r,i,s,n,o,a,h){void 0===o&&(o=g.a.BILINEAR_SAMPLINGMODE);var u=e.call(this,t,"glowBlurPostProcess",["screenSize","direction","blurWidth"],null,s,n,o,a,h)||this;return u.direction=r,u.kernel=i,u.onApplyObservable.add(function(e){e.setFloat2("screenSize",u.width,u.height),e.setVector2("direction",u.direction),e.setFloat("blurWidth",u.kernel)}),u}return u.d(t,e),t}(y.a),L=function(e){function t(r,i,s){var n=e.call(this,r,i)||this;return n.name=r,n.innerGlow=!0,n.outerGlow=!0,n.onBeforeBlurObservable=new l.c,n.onAfterBlurObservable=new l.c,n._instanceGlowingMeshStencilReference=t.GlowingMeshStencilReference++,n._meshes={},n._excludedMeshes={},n.neutralColor=t.NeutralColor,n._engine.isStencilEnable||S.a.Warn("Rendering the Highlight Layer requires the stencil to be active on the canvas. var engine = new Engine(canvas, antialias, { stencil: true }"),n._options=u.a({mainTextureRatio:.5,blurTextureSizeRatio:.5,blurHorizontalSize:1,blurVerticalSize:1,alphaBlendingMode:T.a.ALPHA_COMBINE,camera:null,renderingGroupId:-1},s),n._init({alphaBlendingMode:n._options.alphaBlendingMode,camera:n._options.camera,mainTextureFixedSize:n._options.mainTextureFixedSize,mainTextureRatio:n._options.mainTextureRatio,renderingGroupId:n._options.renderingGroupId}),n._shouldRender=!1,n}return u.d(t,e),Object.defineProperty(t.prototype,"blurHorizontalSize",{get:function(){return this._horizontalBlurPostprocess.kernel},set:function(e){this._horizontalBlurPostprocess.kernel=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"blurVerticalSize",{get:function(){return this._verticalBlurPostprocess.kernel},set:function(e){this._verticalBlurPostprocess.kernel=e},enumerable:!0,configurable:!0}),t.prototype.getEffectName=function(){return t.EffectName},t.prototype._createMergeEffect=function(){return this._engine.createEffect("glowMapMerge",[p.VertexBuffer.PositionKind],["offset"],["textureSampler"],this._options.isStroke?"#define STROKE \n":void 0)},t.prototype._createTextureAndPostProcesses=function(){var e=this,t=this._mainTextureDesiredSize.width*this._options.blurTextureSizeRatio,r=this._mainTextureDesiredSize.height*this._options.blurTextureSizeRatio;t=this._engine.needPOTTextures?d.h.GetExponentOfTwo(t,this._maxSize):t,r=this._engine.needPOTTextures?d.h.GetExponentOfTwo(r,this._maxSize):r;var i=0;i=this._engine.getCaps().textureHalfFloatRender?T.a.TEXTURETYPE_HALF_FLOAT:T.a.TEXTURETYPE_UNSIGNED_INT,this._blurTexture=new m.a("HighlightLayerBlurRTT",{width:t,height:r},this._scene,!1,!0,i),this._blurTexture.wrapU=g.a.CLAMP_ADDRESSMODE,this._blurTexture.wrapV=g.a.CLAMP_ADDRESSMODE,this._blurTexture.anisotropicFilteringLevel=16,this._blurTexture.updateSamplingMode(g.a.TRILINEAR_SAMPLINGMODE),this._blurTexture.renderParticles=!1,this._blurTexture.ignoreCameraViewport=!0,this._textures=[this._blurTexture],this._options.alphaBlendingMode===T.a.ALPHA_COMBINE?(this._downSamplePostprocess=new x.b("HighlightLayerPPP",this._options.blurTextureSizeRatio,null,g.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine()),this._downSamplePostprocess.onApplyObservable.add(function(t){t.setTexture("textureSampler",e._mainTexture)}),this._horizontalBlurPostprocess=new b("HighlightLayerHBP",new f.Vector2(1,0),this._options.blurHorizontalSize,1,null,g.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine()),this._horizontalBlurPostprocess.onApplyObservable.add(function(e){e.setFloat2("screenSize",t,r)}),this._verticalBlurPostprocess=new b("HighlightLayerVBP",new f.Vector2(0,1),this._options.blurVerticalSize,1,null,g.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine()),this._verticalBlurPostprocess.onApplyObservable.add(function(e){e.setFloat2("screenSize",t,r)}),this._postProcesses=[this._downSamplePostprocess,this._horizontalBlurPostprocess,this._verticalBlurPostprocess]):(this._horizontalBlurPostprocess=new M.a("HighlightLayerHBP",new f.Vector2(1,0),this._options.blurHorizontalSize/2,{width:t,height:r},null,g.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,i),this._horizontalBlurPostprocess.width=t,this._horizontalBlurPostprocess.height=r,this._horizontalBlurPostprocess.onApplyObservable.add(function(t){t.setTexture("textureSampler",e._mainTexture)}),this._verticalBlurPostprocess=new M.a("HighlightLayerVBP",new f.Vector2(0,1),this._options.blurVerticalSize/2,{width:t,height:r},null,g.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,i),this._postProcesses=[this._horizontalBlurPostprocess,this._verticalBlurPostprocess]),this._mainTexture.onAfterUnbindObservable.add(function(){e.onBeforeBlurObservable.notifyObservers(e);var t=e._blurTexture.getInternalTexture();t&&e._scene.postProcessManager.directRender(e._postProcesses,t,!0),e.onAfterBlurObservable.notifyObservers(e)}),this._postProcesses.map(function(e){e.autoClear=!1})},t.prototype.needStencil=function(){return!0},t.prototype.isReady=function(t,r){var i=t.getMaterial(),s=t.getRenderingMesh();if(!i||!s||!this._meshes)return!1;var n=null,o=this._meshes[s.uniqueId];return o&&o.glowEmissiveOnly&&i&&(n=i.emissiveTexture),e.prototype._isReady.call(this,t,r,n)},t.prototype._internalRender=function(e){e.setTexture("textureSampler",this._blurTexture);var t=this._engine,r=t.getStencilBuffer(),i=t.getStencilFunction(),s=t.getStencilMask(),n=t.getStencilOperationPass(),o=t.getStencilOperationFail(),a=t.getStencilOperationDepthFail(),h=t.getStencilFunctionReference();t.setStencilOperationPass(T.a.REPLACE),t.setStencilOperationFail(T.a.KEEP),t.setStencilOperationDepthFail(T.a.KEEP),t.setStencilMask(0),t.setStencilBuffer(!0),t.setStencilFunctionReference(this._instanceGlowingMeshStencilReference),this.outerGlow&&(e.setFloat("offset",0),t.setStencilFunction(T.a.NOTEQUAL),t.drawElementsType(_.a.TriangleFillMode,0,6)),this.innerGlow&&(e.setFloat("offset",1),t.setStencilFunction(T.a.EQUAL),t.drawElementsType(_.a.TriangleFillMode,0,6)),t.setStencilFunction(i),t.setStencilMask(s),t.setStencilBuffer(r),t.setStencilOperationPass(n),t.setStencilOperationFail(o),t.setStencilOperationDepthFail(a),t.setStencilFunctionReference(h)},t.prototype.shouldRender=function(){return!!e.prototype.shouldRender.call(this)&&!!this._meshes},t.prototype._shouldRenderMesh=function(t){return(!this._excludedMeshes||!this._excludedMeshes[t.uniqueId])&&!!e.prototype.hasMesh.call(this,t)},t.prototype._setEmissiveTextureAndColor=function(e,t,r){var i=this._meshes[e.uniqueId];i?this._emissiveTextureAndColor.color.set(i.color.r,i.color.g,i.color.b,1):this._emissiveTextureAndColor.color.set(this.neutralColor.r,this.neutralColor.g,this.neutralColor.b,this.neutralColor.a),i&&i.glowEmissiveOnly&&r?(this._emissiveTextureAndColor.texture=r.emissiveTexture,this._emissiveTextureAndColor.color.set(1,1,1,1)):this._emissiveTextureAndColor.texture=null},t.prototype.addExcludedMesh=function(e){this._excludedMeshes&&(this._excludedMeshes[e.uniqueId]||(this._excludedMeshes[e.uniqueId]={mesh:e,beforeRender:e.onBeforeRenderObservable.add(function(e){e.getEngine().setStencilBuffer(!1)}),afterRender:e.onAfterRenderObservable.add(function(e){e.getEngine().setStencilBuffer(!0)})}))},t.prototype.removeExcludedMesh=function(e){if(this._excludedMeshes){var t=this._excludedMeshes[e.uniqueId];t&&(t.beforeRender&&e.onBeforeRenderObservable.remove(t.beforeRender),t.afterRender&&e.onAfterRenderObservable.remove(t.afterRender)),this._excludedMeshes[e.uniqueId]=null}},t.prototype.hasMesh=function(t){return!!this._meshes&&(!!e.prototype.hasMesh.call(this,t)&&(void 0!==this._meshes[t.uniqueId]&&null!==this._meshes[t.uniqueId]))},t.prototype.addMesh=function(e,t,r){var i=this;if(void 0===r&&(r=!1),this._meshes){var s=this._meshes[e.uniqueId];s?s.color=t:(this._meshes[e.uniqueId]={mesh:e,color:t,observerHighlight:e.onBeforeRenderObservable.add(function(e){i._excludedMeshes&&i._excludedMeshes[e.uniqueId]?i._defaultStencilReference(e):e.getScene().getEngine().setStencilFunctionReference(i._instanceGlowingMeshStencilReference)}),observerDefault:e.onAfterRenderObservable.add(this._defaultStencilReference),glowEmissiveOnly:r},e.onDisposeObservable.add(function(){i._disposeMesh(e)})),this._shouldRender=!0}},t.prototype.removeMesh=function(e){if(this._meshes){var t=this._meshes[e.uniqueId];for(var r in t&&(t.observerHighlight&&e.onBeforeRenderObservable.remove(t.observerHighlight),t.observerDefault&&e.onAfterRenderObservable.remove(t.observerDefault),delete this._meshes[e.uniqueId]),this._shouldRender=!1,this._meshes)if(this._meshes[r]){this._shouldRender=!0;break}}},t.prototype._defaultStencilReference=function(e){e.getScene().getEngine().setStencilFunctionReference(t.NormalMeshStencilReference)},t.prototype._disposeMesh=function(e){this.removeMesh(e),this.removeExcludedMesh(e)},t.prototype.dispose=function(){if(this._meshes){for(var t in this._meshes){(r=this._meshes[t])&&r.mesh&&(r.observerHighlight&&r.mesh.onBeforeRenderObservable.remove(r.observerHighlight),r.observerDefault&&r.mesh.onAfterRenderObservable.remove(r.observerDefault))}this._meshes=null}if(this._excludedMeshes){for(var t in this._excludedMeshes){var r;(r=this._excludedMeshes[t])&&(r.beforeRender&&r.mesh.onBeforeRenderObservable.remove(r.beforeRender),r.afterRender&&r.mesh.onAfterRenderObservable.remove(r.afterRender))}this._excludedMeshes=null}e.prototype.dispose.call(this)},t.prototype.getClassName=function(){return"HighlightLayer"},t.prototype.serialize=function(){var e=c.a.Serialize(this);if(e.customType="BABYLON.HighlightLayer",e.meshes=[],this._meshes)for(var t in this._meshes){var r=this._meshes[t];r&&e.meshes.push({glowEmissiveOnly:r.glowEmissiveOnly,color:r.color.asArray(),meshId:r.mesh.id})}if(e.excludedMeshes=[],this._excludedMeshes)for(var i in this._excludedMeshes){var s=this._excludedMeshes[i];s&&e.excludedMeshes.push(s.mesh.id)}return e},t.Parse=function(e,r,i){var s,n=c.a.Parse(function(){return new t(e.name,r,e.options)},e,r,i);for(s=0;s<e.excludedMeshes.length;s++){(o=r.getMeshByID(e.excludedMeshes[s]))&&n.addExcludedMesh(o)}for(s=0;s<e.meshes.length;s++){var o,a=e.meshes[s];(o=r.getMeshByID(a.meshId))&&n.addMesh(o,f.Color3.FromArray(a.color),a.glowEmissiveOnly)}return n},t.EffectName="HighlightLayer",t.NeutralColor=new f.Color4(0,0,0,0),t.GlowingMeshStencilReference=2,t.NormalMeshStencilReference=1,u.c([Object(c.c)()],t.prototype,"innerGlow",void 0),u.c([Object(c.c)()],t.prototype,"outerGlow",void 0),u.c([Object(c.c)()],t.prototype,"blurHorizontalSize",null),u.c([Object(c.c)()],t.prototype,"blurVerticalSize",null),u.c([Object(c.c)("options")],t.prototype,"_options",void 0),t}(i.a);E.a.RegisteredTypes["BABYLON.HighlightLayer"]=L;var v=r(195),P=r(196);r.d(t,"a",function(){return i.a}),r.d(t,"b",function(){return a}),r.d(t,"c",function(){return h.a}),r.d(t,"d",function(){return L}),r.d(t,"e",function(){return v.a}),r.d(t,"f",function(){return P.a})},44:function(e,t,r){"use strict";r.d(t,"a",function(){return u});var i=r(1),s=r(2),n=r(0),o=r(25),a=r(99),h=r(16),u=function(e){function t(r,i){var s=e.call(this,r,i)||this;return s.diffuse=new n.Color3(1,1,1),s.specular=new n.Color3(1,1,1),s.falloffType=t.FALLOFF_DEFAULT,s.intensity=1,s._range=Number.MAX_VALUE,s._inverseSquaredRange=0,s._photometricScale=1,s._intensityMode=t.INTENSITYMODE_AUTOMATIC,s._radius=1e-5,s.renderPriority=0,s._shadowEnabled=!0,s._excludeWithLayerMask=0,s._includeOnlyWithLayerMask=0,s._lightmapMode=0,s._excludedMeshesIds=new Array,s._includedOnlyMeshesIds=new Array,s._isLight=!0,s.getScene().addLight(s),s._uniformBuffer=new a.a(s.getScene().getEngine()),s._buildUniformLayout(),s.includedOnlyMeshes=new Array,s.excludedMeshes=new Array,s._resyncMeshes(),s}return i.d(t,e),Object.defineProperty(t.prototype,"range",{get:function(){return this._range},set:function(e){this._range=e,this._inverseSquaredRange=1/(this.range*this.range)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"intensityMode",{get:function(){return this._intensityMode},set:function(e){this._intensityMode=e,this._computePhotometricScale()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"radius",{get:function(){return this._radius},set:function(e){this._radius=e,this._computePhotometricScale()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"shadowEnabled",{get:function(){return this._shadowEnabled},set:function(e){this._shadowEnabled!==e&&(this._shadowEnabled=e,this._markMeshesAsLightDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"includedOnlyMeshes",{get:function(){return this._includedOnlyMeshes},set:function(e){this._includedOnlyMeshes=e,this._hookArrayForIncludedOnly(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"excludedMeshes",{get:function(){return this._excludedMeshes},set:function(e){this._excludedMeshes=e,this._hookArrayForExcluded(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"excludeWithLayerMask",{get:function(){return this._excludeWithLayerMask},set:function(e){this._excludeWithLayerMask=e,this._resyncMeshes()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"includeOnlyWithLayerMask",{get:function(){return this._includeOnlyWithLayerMask},set:function(e){this._includeOnlyWithLayerMask=e,this._resyncMeshes()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lightmapMode",{get:function(){return this._lightmapMode},set:function(e){this._lightmapMode!==e&&(this._lightmapMode=e,this._markMeshesAsLightDirty())},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"Light"},t.prototype.toString=function(e){var t="Name: "+this.name;if(t+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(var r=0;r<this.animations.length;r++)t+=", animation[0]: "+this.animations[r].toString(e);return t},t.prototype._syncParentEnabledState=function(){e.prototype._syncParentEnabledState.call(this),this._resyncMeshes()},t.prototype.setEnabled=function(t){e.prototype.setEnabled.call(this,t),this._resyncMeshes()},t.prototype.getShadowGenerator=function(){return this._shadowGenerator},t.prototype.getAbsolutePosition=function(){return n.Vector3.Zero()},t.prototype.canAffectMesh=function(e){return!e||!(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&-1===this.includedOnlyMeshes.indexOf(e))&&(!(this.excludedMeshes&&this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(e))&&((0===this.includeOnlyWithLayerMask||0!=(this.includeOnlyWithLayerMask&e.layerMask))&&!(0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&e.layerMask)))},t.CompareLightsPriority=function(e,t){return e.shadowEnabled!==t.shadowEnabled?(t.shadowEnabled?1:0)-(e.shadowEnabled?1:0):t.renderPriority-e.renderPriority},t.prototype.dispose=function(t,r){void 0===r&&(r=!1),this._shadowGenerator&&(this._shadowGenerator.dispose(),this._shadowGenerator=null),this.getScene().stopAnimation(this);for(var i=0,s=this.getScene().meshes;i<s.length;i++){s[i]._removeLightSource(this)}this._uniformBuffer.dispose(),this.getScene().removeLight(this),e.prototype.dispose.call(this,t,r)},t.prototype.getTypeID=function(){return 0},t.prototype.getScaledIntensity=function(){return this._photometricScale*this.intensity},t.prototype.clone=function(e){var r=t.GetConstructorFromName(this.getTypeID(),e,this.getScene());return r?s.a.Clone(r,this):null},t.prototype.serialize=function(){var e=s.a.Serialize(this);return e.type=this.getTypeID(),this.parent&&(e.parentId=this.parent.id),this.excludedMeshes.length>0&&(e.excludedMeshesIds=[],this.excludedMeshes.forEach(function(t){e.excludedMeshesIds.push(t.id)})),this.includedOnlyMeshes.length>0&&(e.includedOnlyMeshesIds=[],this.includedOnlyMeshes.forEach(function(t){e.includedOnlyMeshesIds.push(t.id)})),s.a.AppendSerializedAnimations(this,e),e.ranges=this.serializeAnimationRanges(),e},t.GetConstructorFromName=function(e,t,r){var i=o.a.Construct("Light_Type_"+e,t,r);return i||null},t.Parse=function(e,r){var i=t.GetConstructorFromName(e.type,e.name,r);if(!i)return null;var n=s.a.Parse(i,e,r);if(e.excludedMeshesIds&&(n._excludedMeshesIds=e.excludedMeshesIds),e.includedOnlyMeshesIds&&(n._includedOnlyMeshesIds=e.includedOnlyMeshesIds),e.parentId&&(n._waitingParentId=e.parentId),e.animations){for(var a=0;a<e.animations.length;a++){var u=e.animations[a];n.animations.push(h.a.Parse(u))}o.a.ParseAnimationRanges(n,e,r)}return e.autoAnimate&&r.beginAnimation(n,e.autoAnimateFrom,e.autoAnimateTo,e.autoAnimateLoop,e.autoAnimateSpeed||1),n},t.prototype._hookArrayForExcluded=function(e){var t=this,r=e.push;e.push=function(){for(var i=[],s=0;s<arguments.length;s++)i[s]=arguments[s];for(var n=r.apply(e,i),o=0,a=i;o<a.length;o++){a[o]._resyncLighSource(t)}return n};var i=e.splice;e.splice=function(r,s){for(var n=i.apply(e,[r,s]),o=0,a=n;o<a.length;o++){a[o]._resyncLighSource(t)}return n};for(var s=0,n=e;s<n.length;s++){n[s]._resyncLighSource(this)}},t.prototype._hookArrayForIncludedOnly=function(e){var t=this,r=e.push;e.push=function(){for(var i=[],s=0;s<arguments.length;s++)i[s]=arguments[s];var n=r.apply(e,i);return t._resyncMeshes(),n};var i=e.splice;e.splice=function(r,s){var n=i.apply(e,[r,s]);return t._resyncMeshes(),n},this._resyncMeshes()},t.prototype._resyncMeshes=function(){for(var e=0,t=this.getScene().meshes;e<t.length;e++){t[e]._resyncLighSource(this)}},t.prototype._markMeshesAsLightDirty=function(){for(var e=0,t=this.getScene().meshes;e<t.length;e++){var r=t[e];-1!==r._lightSources.indexOf(this)&&r._markSubMeshesAsLightDirty()}},t.prototype._computePhotometricScale=function(){this._photometricScale=this._getPhotometricScale(),this.getScene().resetCachedMaterial()},t.prototype._getPhotometricScale=function(){var e=0,r=this.getTypeID(),i=this.intensityMode;switch(i===t.INTENSITYMODE_AUTOMATIC&&(i=r===t.LIGHTTYPEID_DIRECTIONALLIGHT?t.INTENSITYMODE_ILLUMINANCE:t.INTENSITYMODE_LUMINOUSINTENSITY),r){case t.LIGHTTYPEID_POINTLIGHT:case t.LIGHTTYPEID_SPOTLIGHT:switch(i){case t.INTENSITYMODE_LUMINOUSPOWER:e=1/(4*Math.PI);break;case t.INTENSITYMODE_LUMINOUSINTENSITY:e=1;break;case t.INTENSITYMODE_LUMINANCE:e=this.radius*this.radius}break;case t.LIGHTTYPEID_DIRECTIONALLIGHT:switch(i){case t.INTENSITYMODE_ILLUMINANCE:e=1;break;case t.INTENSITYMODE_LUMINANCE:var s=this.radius;s=Math.max(s,.001),e=2*Math.PI*(1-Math.cos(s))}break;case t.LIGHTTYPEID_HEMISPHERICLIGHT:e=1}return e},t.prototype._reorderLightsInScene=function(){var e=this.getScene();0!=this._renderPriority&&(e.requireLightSorting=!0),this.getScene().sortLightsByPriority()},t.FALLOFF_DEFAULT=0,t.FALLOFF_PHYSICAL=1,t.FALLOFF_GLTF=2,t.FALLOFF_STANDARD=3,t.LIGHTMAP_DEFAULT=0,t.LIGHTMAP_SPECULAR=1,t.LIGHTMAP_SHADOWSONLY=2,t.INTENSITYMODE_AUTOMATIC=0,t.INTENSITYMODE_LUMINOUSPOWER=1,t.INTENSITYMODE_LUMINOUSINTENSITY=2,t.INTENSITYMODE_ILLUMINANCE=3,t.INTENSITYMODE_LUMINANCE=4,t.LIGHTTYPEID_POINTLIGHT=0,t.LIGHTTYPEID_DIRECTIONALLIGHT=1,t.LIGHTTYPEID_SPOTLIGHT=2,t.LIGHTTYPEID_HEMISPHERICLIGHT=3,i.c([Object(s.e)()],t.prototype,"diffuse",void 0),i.c([Object(s.e)()],t.prototype,"specular",void 0),i.c([Object(s.c)()],t.prototype,"falloffType",void 0),i.c([Object(s.c)()],t.prototype,"intensity",void 0),i.c([Object(s.c)()],t.prototype,"range",null),i.c([Object(s.c)()],t.prototype,"intensityMode",null),i.c([Object(s.c)()],t.prototype,"radius",null),i.c([Object(s.c)()],t.prototype,"_renderPriority",void 0),i.c([Object(s.b)("_reorderLightsInScene")],t.prototype,"renderPriority",void 0),i.c([Object(s.c)("shadowEnabled")],t.prototype,"_shadowEnabled",void 0),i.c([Object(s.c)("excludeWithLayerMask")],t.prototype,"_excludeWithLayerMask",void 0),i.c([Object(s.c)("includeOnlyWithLayerMask")],t.prototype,"_includeOnlyWithLayerMask",void 0),i.c([Object(s.c)("lightmapMode")],t.prototype,"_lightmapMode",void 0),t}(o.a)},71:function(e,t,r){"use strict";r.r(t),r.d(t,"HemisphericLight",function(){return h});var i=r(1),s=r(2),n=r(0),o=r(25),a=r(44);o.a.AddNodeConstructor("Light_Type_3",function(e,t){return function(){return new h(e,n.Vector3.Zero(),t)}});var h=function(e){function t(t,r,i){var s=e.call(this,t,i)||this;return s.groundColor=new n.Color3(0,0,0),s.direction=r||n.Vector3.Up(),s}return i.d(t,e),t.prototype._buildUniformLayout=function(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",3),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()},t.prototype.getClassName=function(){return"HemisphericLight"},t.prototype.setDirectionToTarget=function(e){return this.direction=n.Vector3.Normalize(e.subtract(n.Vector3.Zero())),this.direction},t.prototype.getShadowGenerator=function(){return null},t.prototype.transferToEffect=function(e,t){var r=n.Vector3.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",r.x,r.y,r.z,0,t),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.intensity),t),this},t.prototype.computeWorldMatrix=function(){return this._worldMatrix||(this._worldMatrix=n.Matrix.Identity()),this._worldMatrix},t.prototype.getTypeID=function(){return a.a.LIGHTTYPEID_HEMISPHERICLIGHT},t.prototype.prepareLightSpecificDefines=function(e,t){e["HEMILIGHT"+t]=!0},i.c([Object(s.e)()],t.prototype,"groundColor",void 0),i.c([Object(s.n)()],t.prototype,"direction",void 0),t}(a.a)}}]);