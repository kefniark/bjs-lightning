(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{11:function(e,t,r){"use strict";r.r(t),r.d(t,"InstancingAttributeInfo",function(){return y}),r.d(t,"DepthTextureCreationOptions",function(){return A}),r.d(t,"EngineCapabilities",function(){return v}),r.d(t,"Engine",function(){return M});var i=r(1),n=r(7),o=r(162),s=r(80),a=r(163),h=r(5),u=r(0),_=r(12),l=r(8),c=r(14),d=r(145),p=r(30),E=r(141),f=r(4),T=r(51),g=r(9),b=r(21),m=r(139),R=function(){return function(){}}(),y=function(){return function(){}}(),A=function(){return function(){}}(),v=function(){return function(){}}(),M=function(){function e(t,r,i,s){void 0===s&&(s=!1);var _=this;this.forcePOTTextures=!1,this.isFullscreen=!1,this.isPointerLock=!1,this.cullBackFaces=!0,this.renderEvenInBackground=!0,this.preventCacheWipeBetweenFrames=!1,this.enableOfflineSupport=!1,this.disableManifestCheck=!1,this.scenes=new Array,this.onNewSceneAddedObservable=new n.c,this.postProcesses=new Array,this.validateShaderPrograms=!1,this.onResizeObservable=new n.c,this.onCanvasBlurObservable=new n.c,this.onCanvasFocusObservable=new n.c,this.onCanvasPointerOutObservable=new n.c,this.onBeforeTextureInitObservable=new n.c,this._vrDisplay=void 0,this._vrSupported=!1,this._vrExclusivePointerMode=!1,this.disableUniformBuffers=!1,this._uniformBuffers=new Array,this.onBeginFrameObservable=new n.c,this.customAnimationFrameRequester=null,this.onEndFrameObservable=new n.c,this.onBeforeShaderCompilationObservable=new n.c,this.onAfterShaderCompilationObservable=new n.c,this._windowIsBackground=!1,this._webGLVersion=1,this._badOS=!1,this._badDesktopOS=!1,this.disableTextureBindingOptimization=!1,this.onVRDisplayChangedObservable=new n.c,this.onVRRequestPresentComplete=new n.c,this.onVRRequestPresentStart=new n.c,this._colorWrite=!0,this._drawCalls=new h.f,this._textureCollisions=new h.f,this._renderingQueueLaunched=!1,this._activeRenderLoops=new Array,this._deterministicLockstep=!1,this._lockstepMaxSteps=4,this.onContextLostObservable=new n.c,this.onContextRestoredObservable=new n.c,this._contextWasLost=!1,this._doNotHandleContextLost=!1,this._performanceMonitor=new o.a,this._fps=60,this._deltaTime=0,this.disablePerformanceMonitorInBackground=!1,this._depthCullingState=new E.b,this._stencilState=new E.c,this._alphaState=new E.a,this._alphaMode=e.ALPHA_DISABLE,this._internalTexturesCache=new Array,this._activeChannel=0,this._currentTextureChannel=-1,this._boundTexturesCache={},this._compiledEffects={},this._vertexAttribArraysEnabled=[],this._uintIndicesCurrentlySet=!1,this._currentBoundBuffer=new Array,this._currentFramebuffer=null,this._currentBufferPointers=new Array,this._currentInstanceLocations=new Array,this._currentInstanceBuffers=new Array,this._firstBoundInternalTextureTracker=new d.a,this._lastBoundInternalTextureTracker=new d.a,this._vaoRecordInProgress=!1,this._mustWipeVertexAttributes=!1,this._nextFreeTextureSlots=new Array,this._maxSimultaneousTextures=0,this._activeRequests=new Array,this._texturesSupported=new Array,this.premultipliedAlpha=!0,this._viewportCached=new u.Vector4(0,0,0,0),this._onVRFullScreenTriggered=function(){if(_._vrDisplay&&_._vrDisplay.isPresenting){_._oldSize=new u.Size(_.getRenderWidth(),_.getRenderHeight()),_._oldHardwareScaleFactor=_.getHardwareScalingLevel();var e=_._vrDisplay.getEyeParameters("left");_.setHardwareScalingLevel(1),_.setSize(2*e.renderWidth,e.renderHeight)}else _.setHardwareScalingLevel(_._oldHardwareScaleFactor),_.setSize(_._oldSize.width,_._oldSize.height)},this._unpackFlipYCached=null,this.enableUnpackFlipYCached=!0,this._boundUniforms={},a.a.Apply();var l=null;if(e.Instances.push(this),t){if(i=i||{},t.getContext){if(l=t,this._renderingCanvas=l,null!=r&&(i.antialias=r),void 0===i.deterministicLockstep&&(i.deterministicLockstep=!1),void 0===i.lockstepMaxSteps&&(i.lockstepMaxSteps=4),void 0===i.preserveDrawingBuffer&&(i.preserveDrawingBuffer=!1),void 0===i.audioEngine&&(i.audioEngine=!0),void 0===i.stencil&&(i.stencil=!0),!1===i.premultipliedAlpha&&(this.premultipliedAlpha=!1),this._deterministicLockstep=i.deterministicLockstep,this._lockstepMaxSteps=i.lockstepMaxSteps,this._doNotHandleContextLost=!!i.doNotHandleContextLost,navigator&&navigator.userAgent)for(var c=navigator.userAgent,p=0,f=e.ExceptionList;p<f.length;p++){var b=f[p],m=b.key,y=b.targets;if(c.indexOf(m)>-1){if(b.capture&&b.captureConstraint){var A=b.capture,v=b.captureConstraint,M=new RegExp(A).exec(c);if(M&&M.length>0)if(parseInt(M[M.length-1])>=v)continue}for(var S=0,x=y;S<x.length;S++){switch(x[S]){case"uniformBuffer":this.disableUniformBuffers=!0;break;case"textureBindingOptimization":this.disableTextureBindingOptimization=!0}}}}if(!i.disableWebGL2Support)try{this._gl=l.getContext("webgl2",i)||l.getContext("experimental-webgl2",i),this._gl&&(this._webGLVersion=2,this._gl.deleteQuery||(this._webGLVersion=1))}catch(e){}if(!this._gl){if(!l)throw new Error("The provided canvas is null or undefined.");try{this._gl=l.getContext("webgl",i)||l.getContext("experimental-webgl",i)}catch(e){throw new Error("WebGL not supported")}}if(!this._gl)throw new Error("WebGL not supported");this._onCanvasFocus=function(){_.onCanvasFocusObservable.notifyObservers(_)},this._onCanvasBlur=function(){_.onCanvasBlurObservable.notifyObservers(_)},l.addEventListener("focus",this._onCanvasFocus),l.addEventListener("blur",this._onCanvasBlur),this._onBlur=function(){_.disablePerformanceMonitorInBackground&&_._performanceMonitor.disable(),_._windowIsBackground=!0},this._onFocus=function(){_.disablePerformanceMonitorInBackground&&_._performanceMonitor.enable(),_._windowIsBackground=!1},this._onCanvasPointerOut=function(e){_.onCanvasPointerOutObservable.notifyObservers(e)},T.a.IsWindowObjectExist()&&(window.addEventListener("blur",this._onBlur),window.addEventListener("focus",this._onFocus)),l.addEventListener("pointerout",this._onCanvasPointerOut),this._doNotHandleContextLost||(this._onContextLost=function(e){e.preventDefault(),_._contextWasLost=!0,g.a.Warn("WebGL context lost."),_.onContextLostObservable.notifyObservers(_)},this._onContextRestored=function(){setTimeout(function(){_._initGLContext(),_._rebuildEffects(),_._rebuildInternalTextures(),_._rebuildBuffers(),_.wipeCaches(!0),g.a.Warn("WebGL context successfully restored."),_.onContextRestoredObservable.notifyObservers(_),_._contextWasLost=!1},0)},l.addEventListener("webglcontextlost",this._onContextLost,!1),l.addEventListener("webglcontextrestored",this._onContextRestored,!1)),i.doNotHandleTouchAction||this._disableTouchAction()}else{this._gl=t,this._renderingCanvas=this._gl.canvas,this._gl.renderbufferStorageMultisample&&(this._webGLVersion=2);var O=this._gl.getContextAttributes();O&&(i.stencil=O.stencil)}var P=T.a.IsWindowObjectExist()&&window.devicePixelRatio||1,D=i.limitDeviceRatio||P;this._hardwareScalingLevel=s?1/Math.min(D,P):1,this.resize(),this._isStencilEnable=!!i.stencil,this._initGLContext(),l&&(this._onFullscreenChange=function(){void 0!==document.fullscreen?_.isFullscreen=document.fullscreen:void 0!==document.mozFullScreen?_.isFullscreen=document.mozFullScreen:void 0!==document.webkitIsFullScreen?_.isFullscreen=document.webkitIsFullScreen:void 0!==document.msIsFullScreen&&(_.isFullscreen=document.msIsFullScreen),_.isFullscreen&&_._pointerLockRequested&&l&&(l.requestPointerLock=l.requestPointerLock||l.msRequestPointerLock||l.mozRequestPointerLock||l.webkitRequestPointerLock,l.requestPointerLock&&l.requestPointerLock())},document.addEventListener("fullscreenchange",this._onFullscreenChange,!1),document.addEventListener("mozfullscreenchange",this._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",this._onFullscreenChange,!1),document.addEventListener("msfullscreenchange",this._onFullscreenChange,!1),this._onPointerLockChange=function(){_.isPointerLock=document.mozPointerLockElement===l||document.webkitPointerLockElement===l||document.msPointerLockElement===l||document.pointerLockElement===l},document.addEventListener("pointerlockchange",this._onPointerLockChange,!1),document.addEventListener("mspointerlockchange",this._onPointerLockChange,!1),document.addEventListener("mozpointerlockchange",this._onPointerLockChange,!1),document.addEventListener("webkitpointerlockchange",this._onPointerLockChange,!1),this._onVRDisplayPointerRestricted=function(){l&&l.requestPointerLock()},this._onVRDisplayPointerUnrestricted=function(){document.exitPointerLock()},T.a.IsWindowObjectExist()&&(window.addEventListener("vrdisplaypointerrestricted",this._onVRDisplayPointerRestricted,!1),window.addEventListener("vrdisplaypointerunrestricted",this._onVRDisplayPointerUnrestricted,!1))),!e.audioEngine&&i.audioEngine&&e.AudioEngineFactory&&(e.audioEngine=e.AudioEngineFactory(this.getRenderingCanvas()));for(var C=0;C<this._caps.maxVertexAttribs;C++)this._currentBufferPointers[C]=new R;this._linkTrackers(this._firstBoundInternalTextureTracker,this._lastBoundInternalTextureTracker),i.autoEnableWebVR&&this.initWebVR(),this._badOS=/iPad/i.test(navigator.userAgent)||/iPhone/i.test(navigator.userAgent),this._badDesktopOS=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),console.log("Babylon.js v"+e.Version+" - "+this.description),this.enableOfflineSupport=void 0!==e.OfflineProviderFactory}}return Object.defineProperty(e,"Instances",{get:function(){return b.a.Instances},enumerable:!0,configurable:!0}),Object.defineProperty(e,"LastCreatedEngine",{get:function(){return b.a.LastCreatedEngine},enumerable:!0,configurable:!0}),Object.defineProperty(e,"LastCreatedScene",{get:function(){return b.a.LastCreatedScene},enumerable:!0,configurable:!0}),e.MarkAllMaterialsAsDirty=function(t,r){for(var i=0;i<e.Instances.length;i++)for(var n=e.Instances[i],o=0;o<n.scenes.length;o++)n.scenes[o].markAllMaterialsAsDirty(t,r)},Object.defineProperty(e,"Version",{get:function(){return"4.0.0-alpha.17"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"description",{get:function(){var e="WebGL"+this.webGLVersion;return this._caps.parallelShaderCompile&&(e+=" - Parallel shader compilation"),e},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ShadersRepository",{get:function(){return l.a.ShadersRepository},set:function(e){l.a.ShadersRepository=e},enumerable:!0,configurable:!0}),e.DefaultLoadingScreenFactory=function(e){throw"Import LoadingScreen or set DefaultLoadingScreenFactory on engine before using the loading screen"},Object.defineProperty(e.prototype,"isInVRExclusivePointerMode",{get:function(){return this._vrExclusivePointerMode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"supportsUniformBuffers",{get:function(){return this.webGLVersion>1&&!this.disableUniformBuffers},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"needPOTTextures",{get:function(){return this._webGLVersion<2||this.forcePOTTextures},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"doNotHandleContextLost",{get:function(){return this._doNotHandleContextLost},set:function(e){this._doNotHandleContextLost=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"performanceMonitor",{get:function(){return this._performanceMonitor},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"texturesSupported",{get:function(){return this._texturesSupported},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textureFormatInUse",{get:function(){return this._textureFormatInUse},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentViewport",{get:function(){return this._cachedViewport},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"emptyTexture",{get:function(){return this._emptyTexture||(this._emptyTexture=this.createRawTexture(new Uint8Array(4),1,1,e.TEXTUREFORMAT_RGBA,!1,!1,e.TEXTURE_NEAREST_SAMPLINGMODE)),this._emptyTexture},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"emptyTexture3D",{get:function(){return this._emptyTexture3D||(this._emptyTexture3D=this.createRawTexture3D(new Uint8Array(4),1,1,1,e.TEXTUREFORMAT_RGBA,!1,!1,e.TEXTURE_NEAREST_SAMPLINGMODE)),this._emptyTexture3D},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"emptyCubeTexture",{get:function(){if(!this._emptyCubeTexture){var t=new Uint8Array(4),r=[t,t,t,t,t,t];this._emptyCubeTexture=this.createRawCubeTexture(r,1,e.TEXTUREFORMAT_RGBA,e.TEXTURETYPE_UNSIGNED_INT,!1,!1,e.TEXTURE_NEAREST_SAMPLINGMODE)}return this._emptyCubeTexture},enumerable:!0,configurable:!0}),e.prototype._disableTouchAction=function(){this._renderingCanvas&&(this._renderingCanvas.setAttribute("touch-action","none"),this._renderingCanvas.style.touchAction="none",this._renderingCanvas.style.msTouchAction="none")},e.prototype._rebuildInternalTextures=function(){for(var e=0,t=this._internalTexturesCache.slice();e<t.length;e++){t[e]._rebuild()}},e.prototype._rebuildEffects=function(){for(var e in this._compiledEffects){this._compiledEffects[e]._prepareEffect()}l.a.ResetCache()},e.prototype.areAllEffectsReady=function(){for(var e in this._compiledEffects){if(!this._compiledEffects[e].isReady())return!1}return!0},e.prototype._rebuildBuffers=function(){for(var e=0,t=this.scenes;e<t.length;e++){var r=t[e];r.resetCachedMaterial(),r._rebuildGeometries(),r._rebuildTextures()}for(var i=0,n=this._uniformBuffers;i<n.length;i++){n[i]._rebuild()}},e.prototype._initGLContext=function(){this._caps=new v,this._caps.maxTexturesImageUnits=this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),this._caps.maxCombinedTexturesImageUnits=this._gl.getParameter(this._gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),this._caps.maxVertexTextureImageUnits=this._gl.getParameter(this._gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this._caps.maxTextureSize=this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),this._caps.maxCubemapTextureSize=this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),this._caps.maxRenderTextureSize=this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),this._caps.maxVertexAttribs=this._gl.getParameter(this._gl.MAX_VERTEX_ATTRIBS),this._caps.maxVaryingVectors=this._gl.getParameter(this._gl.MAX_VARYING_VECTORS),this._caps.maxFragmentUniformVectors=this._gl.getParameter(this._gl.MAX_FRAGMENT_UNIFORM_VECTORS),this._caps.maxVertexUniformVectors=this._gl.getParameter(this._gl.MAX_VERTEX_UNIFORM_VECTORS),this._glVersion=this._gl.getParameter(this._gl.VERSION);var e=this._gl.getExtension("WEBGL_debug_renderer_info");if(null!=e&&(this._glRenderer=this._gl.getParameter(e.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(e.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor="Unknown vendor"),this._glRenderer||(this._glRenderer="Unknown renderer"),this._gl.HALF_FLOAT_OES=36193,34842!==this._gl.RGBA16F&&(this._gl.RGBA16F=34842),34836!==this._gl.RGBA32F&&(this._gl.RGBA32F=34836),35056!==this._gl.DEPTH24_STENCIL8&&(this._gl.DEPTH24_STENCIL8=35056),this._caps.standardDerivatives=this._webGLVersion>1||null!==this._gl.getExtension("OES_standard_derivatives"),this._caps.astc=this._gl.getExtension("WEBGL_compressed_texture_astc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_astc"),this._caps.s3tc=this._gl.getExtension("WEBGL_compressed_texture_s3tc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),this._caps.pvrtc=this._gl.getExtension("WEBGL_compressed_texture_pvrtc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),this._caps.etc1=this._gl.getExtension("WEBGL_compressed_texture_etc1")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),this._caps.etc2=this._gl.getExtension("WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBGL_compressed_texture_es3_0"),this._caps.textureAnisotropicFilterExtension=this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.uintIndices=this._webGLVersion>1||null!==this._gl.getExtension("OES_element_index_uint"),this._caps.fragmentDepthSupported=this._webGLVersion>1||null!==this._gl.getExtension("EXT_frag_depth"),this._caps.highPrecisionShaderSupported=!1,this._caps.timerQuery=this._gl.getExtension("EXT_disjoint_timer_query_webgl2")||this._gl.getExtension("EXT_disjoint_timer_query"),this._caps.timerQuery&&(1===this._webGLVersion&&(this._gl.getQuery=this._caps.timerQuery.getQueryEXT.bind(this._caps.timerQuery)),this._caps.canUseTimestampForTimerQuery=this._gl.getQuery(this._caps.timerQuery.TIMESTAMP_EXT,this._caps.timerQuery.QUERY_COUNTER_BITS_EXT)>0),this._caps.colorBufferFloat=this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_float"),this._caps.textureFloat=!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_float")),this._caps.textureFloatLinearFiltering=!(!this._caps.textureFloat||!this._gl.getExtension("OES_texture_float_linear")),this._caps.textureFloatRender=!(!this._caps.textureFloat||!this._canRenderToFloatFramebuffer()),this._caps.textureHalfFloat=!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_half_float")),this._caps.textureHalfFloatLinearFiltering=!!(this._webGLVersion>1||this._caps.textureHalfFloat&&this._gl.getExtension("OES_texture_half_float_linear")),this._webGLVersion>1&&(this._gl.HALF_FLOAT_OES=5131),this._caps.textureHalfFloatRender=this._caps.textureHalfFloat&&this._canRenderToHalfFloatFramebuffer(),this._caps.textureLOD=!!(this._webGLVersion>1||this._gl.getExtension("EXT_shader_texture_lod")),this._webGLVersion>1)this._caps.drawBuffersExtension=!0;else{var t=this._gl.getExtension("WEBGL_draw_buffers");if(null!==t){this._caps.drawBuffersExtension=!0,this._gl.drawBuffers=t.drawBuffersWEBGL.bind(t),this._gl.DRAW_FRAMEBUFFER=this._gl.FRAMEBUFFER;for(var r=0;r<16;r++)this._gl["COLOR_ATTACHMENT"+r+"_WEBGL"]=t["COLOR_ATTACHMENT"+r+"_WEBGL"]}else this._caps.drawBuffersExtension=!1}if(this._caps.parallelShaderCompile=this._gl.getExtension("KHR_parallel_shader_compile"),this._caps.parallelShaderCompile){var i=this._gl.getParameter(this._caps.parallelShaderCompile.MAX_SHADER_COMPILER_THREADS_KHR);this._caps.parallelShaderCompile.maxShaderCompilerThreadsKHR(i)}if(this._webGLVersion>1)this._caps.depthTextureExtension=!0;else{var n=this._gl.getExtension("WEBGL_depth_texture");null!=n&&(this._caps.depthTextureExtension=!0,this._gl.UNSIGNED_INT_24_8=n.UNSIGNED_INT_24_8_WEBGL)}if(this._webGLVersion>1)this._caps.vertexArrayObject=!0;else{var o=this._gl.getExtension("OES_vertex_array_object");null!=o?(this._caps.vertexArrayObject=!0,this._gl.createVertexArray=o.createVertexArrayOES.bind(o),this._gl.bindVertexArray=o.bindVertexArrayOES.bind(o),this._gl.deleteVertexArray=o.deleteVertexArrayOES.bind(o)):this._caps.vertexArrayObject=!1}if(this._webGLVersion>1)this._caps.instancedArrays=!0;else{var s=this._gl.getExtension("ANGLE_instanced_arrays");null!=s?(this._caps.instancedArrays=!0,this._gl.drawArraysInstanced=s.drawArraysInstancedANGLE.bind(s),this._gl.drawElementsInstanced=s.drawElementsInstancedANGLE.bind(s),this._gl.vertexAttribDivisor=s.vertexAttribDivisorANGLE.bind(s)):this._caps.instancedArrays=!1}if(this._caps.astc&&this.texturesSupported.push("-astc.ktx"),this._caps.s3tc&&this.texturesSupported.push("-dxt.ktx"),this._caps.pvrtc&&this.texturesSupported.push("-pvrtc.ktx"),this._caps.etc2&&this.texturesSupported.push("-etc2.ktx"),this._caps.etc1&&this.texturesSupported.push("-etc1.ktx"),this._gl.getShaderPrecisionFormat){var a=this._gl.getShaderPrecisionFormat(this._gl.VERTEX_SHADER,this._gl.HIGH_FLOAT),h=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);a&&h&&(this._caps.highPrecisionShaderSupported=0!==a.precision&&0!==h.precision)}this.setDepthBuffer(!0),this.setDepthFunctionToLessOrEqual(),this.setDepthWrite(!0),this._maxSimultaneousTextures=this._caps.maxCombinedTexturesImageUnits;for(var u=0;u<this._maxSimultaneousTextures;u++)this._nextFreeTextureSlots.push(u)},Object.defineProperty(e.prototype,"webGLVersion",{get:function(){return this._webGLVersion},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isStencilEnable",{get:function(){return this._isStencilEnable},enumerable:!0,configurable:!0}),e.prototype._prepareWorkingCanvas=function(){if(!this._workingCanvas){this._workingCanvas=document.createElement("canvas");var e=this._workingCanvas.getContext("2d");e&&(this._workingContext=e)}},e.prototype.resetTextureCache=function(){for(var e in this._boundTexturesCache)if(this._boundTexturesCache.hasOwnProperty(e)){var t=this._boundTexturesCache[e];t&&this._removeDesignatedSlot(t),this._boundTexturesCache[e]=null}if(!this.disableTextureBindingOptimization){this._nextFreeTextureSlots=[];for(var r=0;r<this._maxSimultaneousTextures;r++)this._nextFreeTextureSlots.push(r)}this._currentTextureChannel=-1},e.prototype.isDeterministicLockStep=function(){return this._deterministicLockstep},e.prototype.getLockstepMaxSteps=function(){return this._lockstepMaxSteps},e.prototype.getGlInfo=function(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}},e.prototype.getAspectRatio=function(e,t){void 0===t&&(t=!1);var r=e.viewport;return this.getRenderWidth(t)*r.width/(this.getRenderHeight(t)*r.height)},e.prototype.getScreenAspectRatio=function(){return this.getRenderWidth(!0)/this.getRenderHeight(!0)},e.prototype.getRenderWidth=function(e){return void 0===e&&(e=!1),!e&&this._currentRenderTarget?this._currentRenderTarget.width:this._gl.drawingBufferWidth},e.prototype.getRenderHeight=function(e){return void 0===e&&(e=!1),!e&&this._currentRenderTarget?this._currentRenderTarget.height:this._gl.drawingBufferHeight},e.prototype.getRenderingCanvas=function(){return this._renderingCanvas},e.prototype.getRenderingCanvasClientRect=function(){return this._renderingCanvas?this._renderingCanvas.getBoundingClientRect():null},e.prototype.setHardwareScalingLevel=function(e){this._hardwareScalingLevel=e,this.resize()},e.prototype.getHardwareScalingLevel=function(){return this._hardwareScalingLevel},e.prototype.getLoadedTexturesCache=function(){return this._internalTexturesCache},e.prototype.getCaps=function(){return this._caps},e.prototype.getDepthFunction=function(){return this._depthCullingState.depthFunc},e.prototype.setDepthFunction=function(e){this._depthCullingState.depthFunc=e},e.prototype.setDepthFunctionToGreater=function(){this._depthCullingState.depthFunc=this._gl.GREATER},e.prototype.setDepthFunctionToGreaterOrEqual=function(){this._depthCullingState.depthFunc=this._gl.GEQUAL},e.prototype.setDepthFunctionToLess=function(){this._depthCullingState.depthFunc=this._gl.LESS},e.prototype.setDepthFunctionToLessOrEqual=function(){this._depthCullingState.depthFunc=this._gl.LEQUAL},e.prototype.getStencilBuffer=function(){return this._stencilState.stencilTest},e.prototype.setStencilBuffer=function(e){this._stencilState.stencilTest=e},e.prototype.getStencilMask=function(){return this._stencilState.stencilMask},e.prototype.setStencilMask=function(e){this._stencilState.stencilMask=e},e.prototype.getStencilFunction=function(){return this._stencilState.stencilFunc},e.prototype.getStencilFunctionReference=function(){return this._stencilState.stencilFuncRef},e.prototype.getStencilFunctionMask=function(){return this._stencilState.stencilFuncMask},e.prototype.setStencilFunction=function(e){this._stencilState.stencilFunc=e},e.prototype.setStencilFunctionReference=function(e){this._stencilState.stencilFuncRef=e},e.prototype.setStencilFunctionMask=function(e){this._stencilState.stencilFuncMask=e},e.prototype.getStencilOperationFail=function(){return this._stencilState.stencilOpStencilFail},e.prototype.getStencilOperationDepthFail=function(){return this._stencilState.stencilOpDepthFail},e.prototype.getStencilOperationPass=function(){return this._stencilState.stencilOpStencilDepthPass},e.prototype.setStencilOperationFail=function(e){this._stencilState.stencilOpStencilFail=e},e.prototype.setStencilOperationDepthFail=function(e){this._stencilState.stencilOpDepthFail=e},e.prototype.setStencilOperationPass=function(e){this._stencilState.stencilOpStencilDepthPass=e},e.prototype.setDitheringState=function(e){e?this._gl.enable(this._gl.DITHER):this._gl.disable(this._gl.DITHER)},e.prototype.setRasterizerState=function(e){e?this._gl.disable(this._gl.RASTERIZER_DISCARD):this._gl.enable(this._gl.RASTERIZER_DISCARD)},e.prototype.stopRenderLoop=function(e){if(e){var t=this._activeRenderLoops.indexOf(e);t>=0&&this._activeRenderLoops.splice(t,1)}else this._activeRenderLoops=[]},e.prototype._renderLoop=function(){if(!this._contextWasLost){var e=!0;if(!this.renderEvenInBackground&&this._windowIsBackground&&(e=!1),e){this.beginFrame();for(var t=0;t<this._activeRenderLoops.length;t++){(0,this._activeRenderLoops[t])()}this.endFrame()}}this._activeRenderLoops.length>0?this.customAnimationFrameRequester?(this.customAnimationFrameRequester.requestID=h.h.QueueNewFrame(this.customAnimationFrameRequester.renderFunction||this._bindedRenderFunction,this.customAnimationFrameRequester),this._frameHandler=this.customAnimationFrameRequester.requestID):this._vrDisplay&&this._vrDisplay.isPresenting?this._frameHandler=h.h.QueueNewFrame(this._bindedRenderFunction,this._vrDisplay):this._frameHandler=h.h.QueueNewFrame(this._bindedRenderFunction):this._renderingQueueLaunched=!1},e.prototype.runRenderLoop=function(e){-1===this._activeRenderLoops.indexOf(e)&&(this._activeRenderLoops.push(e),this._renderingQueueLaunched||(this._renderingQueueLaunched=!0,this._bindedRenderFunction=this._renderLoop.bind(this),this._frameHandler=h.h.QueueNewFrame(this._bindedRenderFunction)))},e.prototype.switchFullscreen=function(e){this.isFullscreen?h.h.ExitFullscreen():(this._pointerLockRequested=e,this._renderingCanvas&&h.h.RequestFullscreen(this._renderingCanvas))},e.prototype.clear=function(e,t,r,i){void 0===i&&(i=!1),this.applyStates();var n=0;t&&e&&(this._gl.clearColor(e.r,e.g,e.b,void 0!==e.a?e.a:1),n|=this._gl.COLOR_BUFFER_BIT),r&&(this._gl.clearDepth(1),n|=this._gl.DEPTH_BUFFER_BIT),i&&(this._gl.clearStencil(0),n|=this._gl.STENCIL_BUFFER_BIT),this._gl.clear(n)},e.prototype.scissorClear=function(e,t,r,i,n){this.enableScissor(e,t,r,i),this.clear(n,!0,!0,!0),this.disableScissor()},e.prototype.enableScissor=function(e,t,r,i){var n=this._gl;n.enable(n.SCISSOR_TEST),n.scissor(e,t,r,i)},e.prototype.disableScissor=function(){var e=this._gl;e.disable(e.SCISSOR_TEST)},e.prototype._viewport=function(e,t,r,i){e===this._viewportCached.x&&t===this._viewportCached.y&&r===this._viewportCached.z&&i===this._viewportCached.w||(this._viewportCached.x=e,this._viewportCached.y=t,this._viewportCached.z=r,this._viewportCached.w=i,this._gl.viewport(e,t,r,i))},e.prototype.setViewport=function(e,t,r){var i=t||this.getRenderWidth(),n=r||this.getRenderHeight(),o=e.x||0,s=e.y||0;this._cachedViewport=e,this._viewport(o*i,s*n,i*e.width,n*e.height)},e.prototype.setDirectViewport=function(e,t,r,i){var n=this._cachedViewport;return this._cachedViewport=null,this._viewport(e,t,r,i),n},e.prototype.beginFrame=function(){this.onBeginFrameObservable.notifyObservers(this),this._measureFps()},e.prototype.endFrame=function(){this._badOS&&this.flushFramebuffer(),this._vrDisplay&&this._vrDisplay.isPresenting&&this._vrDisplay.submitFrame(),this.onEndFrameObservable.notifyObservers(this)},e.prototype.resize=function(){if(!this._vrDisplay||!this._vrDisplay.isPresenting){var e=this._renderingCanvas?this._renderingCanvas.clientWidth:window.innerWidth,t=this._renderingCanvas?this._renderingCanvas.clientHeight:window.innerHeight;this.setSize(e/this._hardwareScalingLevel,t/this._hardwareScalingLevel)}},e.prototype.setSize=function(e,t){if(this._renderingCanvas&&(this._renderingCanvas.width!==e||this._renderingCanvas.height!==t)){this._renderingCanvas.width=e,this._renderingCanvas.height=t;for(var r=0;r<this.scenes.length;r++)for(var i=this.scenes[r],n=0;n<i.cameras.length;n++){i.cameras[n]._currentRenderId=0}this.onResizeObservable.hasObservers&&this.onResizeObservable.notifyObservers(this)}},e.prototype.isVRDevicePresent=function(){return!!this._vrDisplay},e.prototype.getVRDevice=function(){return this._vrDisplay},e.prototype.initWebVR=function(){return this.initWebVRAsync(),this.onVRDisplayChangedObservable},e.prototype.initWebVRAsync=function(){var e=this,t=function(){var t={vrDisplay:e._vrDisplay,vrSupported:e._vrSupported};e.onVRDisplayChangedObservable.notifyObservers(t),e._webVRInitPromise=new Promise(function(e){e(t)})};return this._onVrDisplayConnect||(this._onVrDisplayConnect=function(r){e._vrDisplay=r.display,t()},this._onVrDisplayDisconnect=function(){e._vrDisplay.cancelAnimationFrame(e._frameHandler),e._vrDisplay=void 0,e._frameHandler=h.h.QueueNewFrame(e._bindedRenderFunction),t()},this._onVrDisplayPresentChange=function(){e._vrExclusivePointerMode=e._vrDisplay&&e._vrDisplay.isPresenting},window.addEventListener("vrdisplayconnect",this._onVrDisplayConnect),window.addEventListener("vrdisplaydisconnect",this._onVrDisplayDisconnect),window.addEventListener("vrdisplaypresentchange",this._onVrDisplayPresentChange)),this._webVRInitPromise=this._webVRInitPromise||this._getVRDisplaysAsync(),this._webVRInitPromise.then(t),this._webVRInitPromise},e.prototype.enableVR=function(){var e=this;if(this._vrDisplay&&!this._vrDisplay.isPresenting){this.onVRRequestPresentStart.notifyObservers(this),this._vrDisplay.requestPresent([{source:this.getRenderingCanvas()}]).then(function(){e.onVRRequestPresentComplete.notifyObservers(!0),e._onVRFullScreenTriggered()}).catch(function(){e.onVRRequestPresentComplete.notifyObservers(!1)})}},e.prototype.disableVR=function(){this._vrDisplay&&this._vrDisplay.isPresenting&&this._vrDisplay.exitPresent().then(this._onVRFullScreenTriggered).catch(this._onVRFullScreenTriggered)},e.prototype._getVRDisplaysAsync=function(){var e=this;return new Promise(function(t){navigator.getVRDisplays?navigator.getVRDisplays().then(function(r){e._vrSupported=!0,e._vrDisplay=r[0],t({vrDisplay:e._vrDisplay,vrSupported:e._vrSupported})}):(e._vrDisplay=void 0,e._vrSupported=!1,t({vrDisplay:e._vrDisplay,vrSupported:e._vrSupported}))})},e.prototype.bindFramebuffer=function(e,t,r,i,n,o,s){void 0===s&&(s=0),this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=e,this.bindUnboundFramebuffer(e._MSAAFramebuffer?e._MSAAFramebuffer:e._framebuffer);var a=this._gl;e.isCube&&(void 0===t&&(t=0),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_CUBE_MAP_POSITIVE_X+t,e._webGLTexture,s),o&&(o._generateStencilBuffer?a.framebufferTexture2D(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.TEXTURE_CUBE_MAP_POSITIVE_X+t,o._webGLTexture,s):a.framebufferTexture2D(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.TEXTURE_CUBE_MAP_POSITIVE_X+t,o._webGLTexture,s))),this._cachedViewport&&!n?this.setViewport(this._cachedViewport,r,i):(r||(r=e.width,s&&(r/=Math.pow(2,s))),i||(i=e.height,s&&(i/=Math.pow(2,s))),this._viewport(0,0,r,i)),this.wipeCaches()},e.prototype.bindUnboundFramebuffer=function(e){this._currentFramebuffer!==e&&(this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,e),this._currentFramebuffer=e)},e.prototype.unBindFramebuffer=function(e,t,r){void 0===t&&(t=!1),this._currentRenderTarget=null;var i=this._gl;e._MSAAFramebuffer&&(i.bindFramebuffer(i.READ_FRAMEBUFFER,e._MSAAFramebuffer),i.bindFramebuffer(i.DRAW_FRAMEBUFFER,e._framebuffer),i.blitFramebuffer(0,0,e.width,e.height,0,0,e.width,e.height,i.COLOR_BUFFER_BIT,i.NEAREST)),!e.generateMipMaps||t||e.isCube||(this._bindTextureDirectly(i.TEXTURE_2D,e,!0),i.generateMipmap(i.TEXTURE_2D),this._bindTextureDirectly(i.TEXTURE_2D,null)),r&&(e._MSAAFramebuffer&&this.bindUnboundFramebuffer(e._framebuffer),r()),this.bindUnboundFramebuffer(null)},e.prototype.unBindMultiColorAttachmentFramebuffer=function(e,t,r){void 0===t&&(t=!1),this._currentRenderTarget=null;var i=this._gl;if(e[0]._MSAAFramebuffer){i.bindFramebuffer(i.READ_FRAMEBUFFER,e[0]._MSAAFramebuffer),i.bindFramebuffer(i.DRAW_FRAMEBUFFER,e[0]._framebuffer);var n=e[0]._attachments;n||(n=new Array(e.length),e[0]._attachments=n);for(var o=0;o<e.length;o++){for(var s=e[o],a=0;a<n.length;a++)n[a]=i.NONE;n[o]=i[this.webGLVersion>1?"COLOR_ATTACHMENT"+o:"COLOR_ATTACHMENT"+o+"_WEBGL"],i.readBuffer(n[o]),i.drawBuffers(n),i.blitFramebuffer(0,0,s.width,s.height,0,0,s.width,s.height,i.COLOR_BUFFER_BIT,i.NEAREST)}for(o=0;o<n.length;o++)n[o]=i[this.webGLVersion>1?"COLOR_ATTACHMENT"+o:"COLOR_ATTACHMENT"+o+"_WEBGL"];i.drawBuffers(n)}for(o=0;o<e.length;o++){!(s=e[o]).generateMipMaps||t||s.isCube||(this._bindTextureDirectly(i.TEXTURE_2D,s),i.generateMipmap(i.TEXTURE_2D),this._bindTextureDirectly(i.TEXTURE_2D,null))}r&&(e[0]._MSAAFramebuffer&&this.bindUnboundFramebuffer(e[0]._framebuffer),r()),this.bindUnboundFramebuffer(null)},e.prototype.generateMipMapsForCubemap=function(e){if(e.generateMipMaps){var t=this._gl;this._bindTextureDirectly(t.TEXTURE_CUBE_MAP,e,!0),t.generateMipmap(t.TEXTURE_CUBE_MAP),this._bindTextureDirectly(t.TEXTURE_CUBE_MAP,null)}},e.prototype.flushFramebuffer=function(){this._gl.flush()},e.prototype.restoreDefaultFramebuffer=function(){this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):this.bindUnboundFramebuffer(null),this._cachedViewport&&this.setViewport(this._cachedViewport),this.wipeCaches()},e.prototype.createUniformBuffer=function(e){var t=this._gl.createBuffer();if(!t)throw new Error("Unable to create uniform buffer");return this.bindUniformBuffer(t),e instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,e,this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(e),this._gl.STATIC_DRAW),this.bindUniformBuffer(null),t.references=1,t},e.prototype.createDynamicUniformBuffer=function(e){var t=this._gl.createBuffer();if(!t)throw new Error("Unable to create dynamic uniform buffer");return this.bindUniformBuffer(t),e instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,e,this._gl.DYNAMIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(e),this._gl.DYNAMIC_DRAW),this.bindUniformBuffer(null),t.references=1,t},e.prototype.updateUniformBuffer=function(e,t,r,i){this.bindUniformBuffer(e),void 0===r&&(r=0),void 0===i?t instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,r,t):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,r,new Float32Array(t)):t instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,t.subarray(r,r+i)):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,new Float32Array(t).subarray(r,r+i)),this.bindUniformBuffer(null)},e.prototype._resetVertexBufferBinding=function(){this.bindArrayBuffer(null),this._cachedVertexBuffers=null},e.prototype.createVertexBuffer=function(e){var t=this._gl.createBuffer();if(!t)throw new Error("Unable to create vertex buffer");return this.bindArrayBuffer(t),e instanceof Array?this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(e),this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.ARRAY_BUFFER,e,this._gl.STATIC_DRAW),this._resetVertexBufferBinding(),t.references=1,t},e.prototype.createDynamicVertexBuffer=function(e){var t=this._gl.createBuffer();if(!t)throw new Error("Unable to create dynamic vertex buffer");return this.bindArrayBuffer(t),e instanceof Array?this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(e),this._gl.DYNAMIC_DRAW):this._gl.bufferData(this._gl.ARRAY_BUFFER,e,this._gl.DYNAMIC_DRAW),this._resetVertexBufferBinding(),t.references=1,t},e.prototype.updateDynamicIndexBuffer=function(e,t,r){var i;void 0===r&&(r=0),this._currentBoundBuffer[this._gl.ELEMENT_ARRAY_BUFFER]=null,this.bindIndexBuffer(e),i=t instanceof Uint16Array||t instanceof Uint32Array?t:e.is32Bits?new Uint32Array(t):new Uint16Array(t),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,i,this._gl.DYNAMIC_DRAW),this._resetIndexBufferBinding()},e.prototype.updateDynamicVertexBuffer=function(e,t,r,i){this.bindArrayBuffer(e),void 0===r&&(r=0),void 0===i?t instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,r,new Float32Array(t)):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,r,t):t instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,new Float32Array(t).subarray(r,r+i)):(t=t instanceof ArrayBuffer?new Uint8Array(t,r,i):new Uint8Array(t.buffer,t.byteOffset+r,i),this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,t)),this._resetVertexBufferBinding()},e.prototype._resetIndexBufferBinding=function(){this.bindIndexBuffer(null),this._cachedIndexBuffer=null},e.prototype.createIndexBuffer=function(e,t){var r,i=this._gl.createBuffer();if(!i)throw new Error("Unable to create index buffer");this.bindIndexBuffer(i);var n=!1;if(e instanceof Uint16Array)r=e;else if(this._caps.uintIndices)if(e instanceof Uint32Array)r=e,n=!0;else{for(var o=0;o<e.length;o++)if(e[o]>65535){n=!0;break}r=n?new Uint32Array(e):new Uint16Array(e)}else r=new Uint16Array(e);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,r,t?this._gl.DYNAMIC_DRAW:this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),i.references=1,i.is32Bits=n,i},e.prototype.bindArrayBuffer=function(e){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.bindBuffer(e,this._gl.ARRAY_BUFFER)},e.prototype.bindUniformBuffer=function(e){this._gl.bindBuffer(this._gl.UNIFORM_BUFFER,e)},e.prototype.bindUniformBufferBase=function(e,t){this._gl.bindBufferBase(this._gl.UNIFORM_BUFFER,t,e)},e.prototype.bindUniformBlock=function(e,t,r){var i=this._gl.getUniformBlockIndex(e,t);this._gl.uniformBlockBinding(e,i,r)},e.prototype.bindIndexBuffer=function(e){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.bindBuffer(e,this._gl.ELEMENT_ARRAY_BUFFER)},e.prototype.bindBuffer=function(e,t){(this._vaoRecordInProgress||this._currentBoundBuffer[t]!==e)&&(this._gl.bindBuffer(t,e),this._currentBoundBuffer[t]=e)},e.prototype.updateArrayBuffer=function(e){this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,e)},e.prototype._vertexAttribPointer=function(e,t,r,i,n,o,s){var a=this._currentBufferPointers[t],h=!1;a.active?(a.buffer!==e&&(a.buffer=e,h=!0),a.size!==r&&(a.size=r,h=!0),a.type!==i&&(a.type=i,h=!0),a.normalized!==n&&(a.normalized=n,h=!0),a.stride!==o&&(a.stride=o,h=!0),a.offset!==s&&(a.offset=s,h=!0)):(h=!0,a.active=!0,a.index=t,a.size=r,a.type=i,a.normalized=n,a.stride=o,a.offset=s,a.buffer=e),(h||this._vaoRecordInProgress)&&(this.bindArrayBuffer(e),this._gl.vertexAttribPointer(t,r,i,n,o,s))},e.prototype._bindIndexBufferWithCache=function(e){null!=e&&this._cachedIndexBuffer!==e&&(this._cachedIndexBuffer=e,this.bindIndexBuffer(e),this._uintIndicesCurrentlySet=e.is32Bits)},e.prototype._bindVertexBuffersAttributes=function(e,t){var r=t.getAttributesNames();this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.unbindAllAttributes();for(var i=0;i<r.length;i++){var n=t.getAttributeLocation(i);if(n>=0){var o=e[r[i]];if(!o)continue;this._gl.enableVertexAttribArray(n),this._vaoRecordInProgress||(this._vertexAttribArraysEnabled[n]=!0);var s=o.getBuffer();s&&(this._vertexAttribPointer(s,n,o.getSize(),o.type,o.normalized,o.byteStride,o.byteOffset),o.getIsInstanced()&&(this._gl.vertexAttribDivisor(n,o.getInstanceDivisor()),this._vaoRecordInProgress||(this._currentInstanceLocations.push(n),this._currentInstanceBuffers.push(s))))}}},e.prototype.recordVertexArrayObject=function(e,t,r){var i=this._gl.createVertexArray();return this._vaoRecordInProgress=!0,this._gl.bindVertexArray(i),this._mustWipeVertexAttributes=!0,this._bindVertexBuffersAttributes(e,r),this.bindIndexBuffer(t),this._vaoRecordInProgress=!1,this._gl.bindVertexArray(null),i},e.prototype.bindVertexArrayObject=function(e,t){this._cachedVertexArrayObject!==e&&(this._cachedVertexArrayObject=e,this._gl.bindVertexArray(e),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._uintIndicesCurrentlySet=null!=t&&t.is32Bits,this._mustWipeVertexAttributes=!0)},e.prototype.bindBuffersDirectly=function(e,t,r,i,n){if(this._cachedVertexBuffers!==e||this._cachedEffectForVertexBuffers!==n){this._cachedVertexBuffers=e,this._cachedEffectForVertexBuffers=n;var o=n.getAttributesCount();this._unbindVertexArrayObject(),this.unbindAllAttributes();for(var s=0,a=0;a<o;a++)if(a<r.length){var h=n.getAttributeLocation(a);h>=0&&(this._gl.enableVertexAttribArray(h),this._vertexAttribArraysEnabled[h]=!0,this._vertexAttribPointer(e,h,r[a],this._gl.FLOAT,!1,i,s)),s+=4*r[a]}}this._bindIndexBufferWithCache(t)},e.prototype._unbindVertexArrayObject=function(){this._cachedVertexArrayObject&&(this._cachedVertexArrayObject=null,this._gl.bindVertexArray(null))},e.prototype.bindBuffers=function(e,t,r){this._cachedVertexBuffers===e&&this._cachedEffectForVertexBuffers===r||(this._cachedVertexBuffers=e,this._cachedEffectForVertexBuffers=r,this._bindVertexBuffersAttributes(e,r)),this._bindIndexBufferWithCache(t)},e.prototype.unbindInstanceAttributes=function(){for(var e,t=0,r=this._currentInstanceLocations.length;t<r;t++){var i=this._currentInstanceBuffers[t];e!=i&&i.references&&(e=i,this.bindArrayBuffer(i));var n=this._currentInstanceLocations[t];this._gl.vertexAttribDivisor(n,0)}this._currentInstanceBuffers.length=0,this._currentInstanceLocations.length=0},e.prototype.releaseVertexArrayObject=function(e){this._gl.deleteVertexArray(e)},e.prototype._releaseBuffer=function(e){return e.references--,0===e.references&&(this._gl.deleteBuffer(e),!0)},e.prototype.createInstancesBuffer=function(e){var t=this._gl.createBuffer();if(!t)throw new Error("Unable to create instance buffer");return t.capacity=e,this.bindArrayBuffer(t),this._gl.bufferData(this._gl.ARRAY_BUFFER,e,this._gl.DYNAMIC_DRAW),t},e.prototype.deleteInstancesBuffer=function(e){this._gl.deleteBuffer(e)},e.prototype.updateAndBindInstancesBuffer=function(e,t,r){if(this.bindArrayBuffer(e),t&&this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,t),void 0!==r[0].index){for(var i=0,n=0;n<r.length;n++){i+=4*(o=r[n]).attributeSize}for(n=0;n<r.length;n++){var o=r[n];this._vertexAttribArraysEnabled[o.index]||(this._gl.enableVertexAttribArray(o.index),this._vertexAttribArraysEnabled[o.index]=!0),this._vertexAttribPointer(e,o.index,o.attributeSize,o.attribyteType||this._gl.FLOAT,o.normalized||!1,i,o.offset),this._gl.vertexAttribDivisor(o.index,1),this._currentInstanceLocations.push(o.index),this._currentInstanceBuffers.push(e)}}else for(var s=0;s<4;s++){var a=r[s];this._vertexAttribArraysEnabled[a]||(this._gl.enableVertexAttribArray(a),this._vertexAttribArraysEnabled[a]=!0),this._vertexAttribPointer(e,a,4,this._gl.FLOAT,!1,64,16*s),this._gl.vertexAttribDivisor(a,1),this._currentInstanceLocations.push(a),this._currentInstanceBuffers.push(e)}},e.prototype.applyStates=function(){this._depthCullingState.apply(this._gl),this._stencilState.apply(this._gl),this._alphaState.apply(this._gl)},e.prototype.draw=function(e,t,r,i){this.drawElementsType(e?c.a.TriangleFillMode:c.a.WireFrameFillMode,t,r,i)},e.prototype.drawPointClouds=function(e,t,r){this.drawArraysType(c.a.PointFillMode,e,t,r)},e.prototype.drawUnIndexed=function(e,t,r,i){this.drawArraysType(e?c.a.TriangleFillMode:c.a.WireFrameFillMode,t,r,i)},e.prototype.drawElementsType=function(e,t,r,i){this.applyStates(),this._drawCalls.addCount(1,!1);var n=this._drawMode(e),o=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,s=this._uintIndicesCurrentlySet?4:2;i?this._gl.drawElementsInstanced(n,r,o,t*s,i):this._gl.drawElements(n,r,o,t*s)},e.prototype.drawArraysType=function(e,t,r,i){this.applyStates(),this._drawCalls.addCount(1,!1);var n=this._drawMode(e);i?this._gl.drawArraysInstanced(n,t,r,i):this._gl.drawArrays(n,t,r)},e.prototype._drawMode=function(e){switch(e){case c.a.TriangleFillMode:return this._gl.TRIANGLES;case c.a.PointFillMode:return this._gl.POINTS;case c.a.WireFrameFillMode:return this._gl.LINES;case c.a.PointListDrawMode:return this._gl.POINTS;case c.a.LineListDrawMode:return this._gl.LINES;case c.a.LineLoopDrawMode:return this._gl.LINE_LOOP;case c.a.LineStripDrawMode:return this._gl.LINE_STRIP;case c.a.TriangleStripDrawMode:return this._gl.TRIANGLE_STRIP;case c.a.TriangleFanDrawMode:return this._gl.TRIANGLE_FAN;default:return this._gl.TRIANGLES}},e.prototype._releaseEffect=function(e){this._compiledEffects[e._key]&&(delete this._compiledEffects[e._key],this._deleteProgram(e.getProgram()))},e.prototype._deleteProgram=function(e){e&&(e.__SPECTOR_rebuildProgram=null,e.transformFeedback&&(this.deleteTransformFeedback(e.transformFeedback),e.transformFeedback=null),this._gl.deleteProgram(e))},e.prototype.createEffect=function(e,t,r,i,n,o,s,a,h){var u=(e.vertexElement||e.vertex||e)+"+"+(e.fragmentElement||e.fragment||e)+"@"+(n||t.defines);if(this._compiledEffects[u]){var _=this._compiledEffects[u];return s&&_.isReady()&&s(_),_}var c=new l.a(e,t,r,i,this,n,o,s,a,h);return c._key=u,this._compiledEffects[u]=c,c},e.prototype._compileShader=function(e,t,r,i){return this._compileRawShader(i+(r?r+"\n":"")+e,t)},e.prototype._compileRawShader=function(e,t){var r=this._gl,i=r.createShader("vertex"===t?r.VERTEX_SHADER:r.FRAGMENT_SHADER);if(!i)throw new Error("Something went wrong while compile the shader.");if(r.shaderSource(i,e),r.compileShader(i),!r.getShaderParameter(i,r.COMPILE_STATUS)){var n=r.getShaderInfoLog(i);if(n)throw new Error(n)}return i},e.prototype.createRawShaderProgram=function(e,t,r,i){void 0===i&&(i=null),r=r||this._gl;var n=this._compileRawShader(e,"vertex"),o=this._compileRawShader(t,"fragment");return this._createShaderProgram(n,o,r,i)},e.prototype.createShaderProgram=function(e,t,r,i,n){void 0===n&&(n=null),i=i||this._gl,this.onBeforeShaderCompilationObservable.notifyObservers(this);var o=this._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"",s=this._compileShader(e,"vertex",r,o),a=this._compileShader(t,"fragment",r,o),h=this._createShaderProgram(s,a,i,n);return this.onAfterShaderCompilationObservable.notifyObservers(this),h},e.prototype._createShaderProgram=function(e,t,r,i){void 0===i&&(i=null);var n=r.createProgram();if(!n)throw new Error("Unable to create program");if(r.attachShader(n,e),r.attachShader(n,t),this.webGLVersion>1&&i){var o=this.createTransformFeedback();this.bindTransformFeedback(o),this.setTranformFeedbackVaryings(n,i),n.transformFeedback=o}return r.linkProgram(n),this.webGLVersion>1&&i&&this.bindTransformFeedback(null),n.context=r,n.vertexShader=e,n.fragmentShader=t,this._caps.parallelShaderCompile?n.isParallelCompiled=!0:this._finalizeProgram(n),n},e.prototype._finalizeProgram=function(e){var t,r=e.context,i=e.vertexShader,n=e.fragmentShader;if(!r.getProgramParameter(e,r.LINK_STATUS)&&(t=r.getProgramInfoLog(e)))throw new Error(t);if(this.validateShaderPrograms&&(r.validateProgram(e),!r.getProgramParameter(e,r.VALIDATE_STATUS)&&(t=r.getProgramInfoLog(e))))throw new Error(t);r.deleteShader(i),r.deleteShader(n),e.context=void 0,e.vertexShader=void 0,e.fragmentShader=void 0,e.onCompiled&&(e.onCompiled(),e.onCompiled=void 0)},e.prototype._isProgramCompiled=function(e){return!e.isParallelCompiled||!!this._gl.getProgramParameter(e,this._caps.parallelShaderCompile.COMPLETION_STATUS_KHR)&&(this._finalizeProgram(e),!0)},e.prototype._executeWhenProgramIsCompiled=function(e,t){e.isParallelCompiled?e.onCompiled=t:t()},e.prototype.getUniforms=function(e,t){for(var r=new Array,i=0;i<t.length;i++)r.push(this._gl.getUniformLocation(e,t[i]));return r},e.prototype.getAttributes=function(e,t){for(var r=[],i=0;i<t.length;i++)try{r.push(this._gl.getAttribLocation(e,t[i]))}catch(e){r.push(-1)}return r},e.prototype.enableEffect=function(e){e&&e!==this._currentEffect&&(this.bindSamplers(e),this._currentEffect=e,e.onBind&&e.onBind(e),e._onBindObservable&&e._onBindObservable.notifyObservers(e))},e.prototype.setIntArray=function(e,t){e&&this._gl.uniform1iv(e,t)},e.prototype.setIntArray2=function(e,t){e&&t.length%2==0&&this._gl.uniform2iv(e,t)},e.prototype.setIntArray3=function(e,t){e&&t.length%3==0&&this._gl.uniform3iv(e,t)},e.prototype.setIntArray4=function(e,t){e&&t.length%4==0&&this._gl.uniform4iv(e,t)},e.prototype.setFloatArray=function(e,t){e&&this._gl.uniform1fv(e,t)},e.prototype.setFloatArray2=function(e,t){e&&t.length%2==0&&this._gl.uniform2fv(e,t)},e.prototype.setFloatArray3=function(e,t){e&&t.length%3==0&&this._gl.uniform3fv(e,t)},e.prototype.setFloatArray4=function(e,t){e&&t.length%4==0&&this._gl.uniform4fv(e,t)},e.prototype.setArray=function(e,t){e&&this._gl.uniform1fv(e,t)},e.prototype.setArray2=function(e,t){e&&t.length%2==0&&this._gl.uniform2fv(e,t)},e.prototype.setArray3=function(e,t){e&&t.length%3==0&&this._gl.uniform3fv(e,t)},e.prototype.setArray4=function(e,t){e&&t.length%4==0&&this._gl.uniform4fv(e,t)},e.prototype.setMatrices=function(e,t){e&&this._gl.uniformMatrix4fv(e,!1,t)},e.prototype.setMatrix=function(e,t){e&&this._gl.uniformMatrix4fv(e,!1,t.toArray())},e.prototype.setMatrix3x3=function(e,t){e&&this._gl.uniformMatrix3fv(e,!1,t)},e.prototype.setMatrix2x2=function(e,t){e&&this._gl.uniformMatrix2fv(e,!1,t)},e.prototype.setInt=function(e,t){e&&this._gl.uniform1i(e,t)},e.prototype.setFloat=function(e,t){e&&this._gl.uniform1f(e,t)},e.prototype.setFloat2=function(e,t,r){e&&this._gl.uniform2f(e,t,r)},e.prototype.setFloat3=function(e,t,r,i){e&&this._gl.uniform3f(e,t,r,i)},e.prototype.setBool=function(e,t){e&&this._gl.uniform1i(e,t)},e.prototype.setFloat4=function(e,t,r,i,n){e&&this._gl.uniform4f(e,t,r,i,n)},e.prototype.setColor3=function(e,t){e&&this._gl.uniform3f(e,t.r,t.g,t.b)},e.prototype.setColor4=function(e,t,r){e&&this._gl.uniform4f(e,t.r,t.g,t.b,r)},e.prototype.setDirectColor4=function(e,t){e&&this._gl.uniform4f(e,t.r,t.g,t.b,t.a)},e.prototype.setState=function(e,t,r,i){void 0===t&&(t=0),void 0===i&&(i=!1),(this._depthCullingState.cull!==e||r)&&(this._depthCullingState.cull=e);var n=this.cullBackFaces?this._gl.BACK:this._gl.FRONT;(this._depthCullingState.cullFace!==n||r)&&(this._depthCullingState.cullFace=n),this.setZOffset(t);var o=i?this._gl.CW:this._gl.CCW;(this._depthCullingState.frontFace!==o||r)&&(this._depthCullingState.frontFace=o)},e.prototype.setZOffset=function(e){this._depthCullingState.zOffset=e},e.prototype.getZOffset=function(){return this._depthCullingState.zOffset},e.prototype.setDepthBuffer=function(e){this._depthCullingState.depthTest=e},e.prototype.getDepthWrite=function(){return this._depthCullingState.depthMask},e.prototype.setDepthWrite=function(e){this._depthCullingState.depthMask=e},e.prototype.setColorWrite=function(e){this._gl.colorMask(e,e,e,e),this._colorWrite=e},e.prototype.getColorWrite=function(){return this._colorWrite},e.prototype.setAlphaConstants=function(e,t,r,i){this._alphaState.setAlphaBlendConstants(e,t,r,i)},e.prototype.setAlphaMode=function(t,r){if(void 0===r&&(r=!1),this._alphaMode!==t){switch(t){case e.ALPHA_DISABLE:this._alphaState.alphaBlend=!1;break;case e.ALPHA_PREMULTIPLIED:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case e.ALPHA_PREMULTIPLIED_PORTERDUFF:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case e.ALPHA_COMBINE:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case e.ALPHA_ONEONE:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case e.ALPHA_ADD:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case e.ALPHA_SUBTRACT:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ZERO,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case e.ALPHA_MULTIPLY:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_COLOR,this._gl.ZERO,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case e.ALPHA_MAXIMIZED:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case e.ALPHA_INTERPOLATE:this._alphaState.setAlphaBlendFunctionParameters(this._gl.CONSTANT_COLOR,this._gl.ONE_MINUS_CONSTANT_COLOR,this._gl.CONSTANT_ALPHA,this._gl.ONE_MINUS_CONSTANT_ALPHA),this._alphaState.alphaBlend=!0;break;case e.ALPHA_SCREENMODE:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0}r||this.setDepthWrite(t===e.ALPHA_DISABLE),this._alphaMode=t}},e.prototype.getAlphaMode=function(){return this._alphaMode},e.prototype.clearInternalTexturesCache=function(){this._internalTexturesCache=[]},e.prototype.wipeCaches=function(e){this.preventCacheWipeBetweenFrames&&!e||(this._currentEffect=null,this._viewportCached.x=0,this._viewportCached.y=0,this._viewportCached.z=0,this._viewportCached.w=0,e&&(this.resetTextureCache(),this._currentProgram=null,this._stencilState.reset(),this._depthCullingState.reset(),this.setDepthFunctionToLessOrEqual(),this._alphaState.reset(),this._unpackFlipYCached=null),this._resetVertexBufferBinding(),this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null,this._unbindVertexArrayObject(),this.bindIndexBuffer(null))},e.prototype.setTextureFormatToUse=function(e){for(var t=0,r=this.texturesSupported.length;t<r;t++)for(var i=0,n=e.length;i<n;i++)if(this._texturesSupported[t]===e[i].toLowerCase())return this._textureFormatInUse=this._texturesSupported[t];return this._textureFormatInUse=null,null},e.prototype._getSamplingParameters=function(t,r){var i=this._gl,n=i.NEAREST,o=i.NEAREST;switch(t){case e.TEXTURE_BILINEAR_SAMPLINGMODE:n=i.LINEAR,o=r?i.LINEAR_MIPMAP_NEAREST:i.LINEAR;break;case e.TEXTURE_TRILINEAR_SAMPLINGMODE:n=i.LINEAR,o=r?i.LINEAR_MIPMAP_LINEAR:i.LINEAR;break;case e.TEXTURE_NEAREST_SAMPLINGMODE:n=i.NEAREST,o=r?i.NEAREST_MIPMAP_LINEAR:i.NEAREST;break;case e.TEXTURE_NEAREST_NEAREST_MIPNEAREST:n=i.NEAREST,o=r?i.NEAREST_MIPMAP_NEAREST:i.NEAREST;break;case e.TEXTURE_NEAREST_LINEAR_MIPNEAREST:n=i.NEAREST,o=r?i.LINEAR_MIPMAP_NEAREST:i.LINEAR;break;case e.TEXTURE_NEAREST_LINEAR_MIPLINEAR:n=i.NEAREST,o=r?i.LINEAR_MIPMAP_LINEAR:i.LINEAR;break;case e.TEXTURE_NEAREST_LINEAR:n=i.NEAREST,o=i.LINEAR;break;case e.TEXTURE_NEAREST_NEAREST:n=i.NEAREST,o=i.NEAREST;break;case e.TEXTURE_LINEAR_NEAREST_MIPNEAREST:n=i.LINEAR,o=r?i.NEAREST_MIPMAP_NEAREST:i.NEAREST;break;case e.TEXTURE_LINEAR_NEAREST_MIPLINEAR:n=i.LINEAR,o=r?i.NEAREST_MIPMAP_LINEAR:i.NEAREST;break;case e.TEXTURE_LINEAR_LINEAR:n=i.LINEAR,o=i.LINEAR;break;case e.TEXTURE_LINEAR_NEAREST:n=i.LINEAR,o=i.NEAREST}return{min:o,mag:n}},e.prototype._partialLoadImg=function(e,t,r,i,n,o){var s;void 0===o&&(o=null);s=h.h.LoadImage(e,function(){r[t]=s,r._internalCount++,i&&i._removePendingData(s),6===r._internalCount&&n(r)},function(e,t){i&&i._removePendingData(s),o&&o(e,t)},i?i.offlineProvider:null),i&&i._addPendingData(s)},e.prototype._cascadeLoadImgs=function(e,t,r,i){void 0===i&&(i=null);var n=[];n._internalCount=0;for(var o=0;o<6;o++)this._partialLoadImg(r[o],o,n,e,t,i)},e.prototype._createTexture=function(){var e=this._gl.createTexture();if(!e)throw new Error("Unable to create texture");return e},e.prototype.createTexture=function(t,r,i,n,o,s,a,u,_,l,c,d){var E=this;void 0===o&&(o=e.TEXTURE_TRILINEAR_SAMPLINGMODE),void 0===s&&(s=null),void 0===a&&(a=null),void 0===u&&(u=null),void 0===_&&(_=null),void 0===l&&(l=null),void 0===c&&(c=null),void 0===d&&(d=[]);for(var f=String(t),T="data:"===f.substr(0,5),g="blob:"===f.substr(0,5),b=T&&-1!==f.indexOf(";base64,"),m=_||new p.a(this,p.a.DATASOURCE_URL),R=f.lastIndexOf("."),y=c||(R>-1?f.substring(R).toLowerCase():""),A=null,v=0,M=e._TextureLoaders;v<M.length;v++){var S=M[v];if(-1===d.indexOf(S)&&S.canLoad(y,this._textureFormatInUse,_,b,!!u)){A=S;break}}A&&(f=A.transformUrl(f,this._textureFormatInUse)),n&&n._addPendingData(m),m.url=f,m.generateMipMaps=!r,m.samplingMode=o,m.invertY=i,this._doNotHandleContextLost||(m._buffer=u);var x=null;s&&!_&&(x=m.onLoadedObservable.add(s)),_||this._internalTexturesCache.push(m);var O=function(e,i){n&&n._removePendingData(m);var s=!1;A&&(A.getFallbackTextureUrl(f,E._textureFormatInUse)&&(s=!0,d.push(A),h.h.Warn(A.constructor.name+" failed when trying to load "+m.url+", falling back to the next supported loader"),E.createTexture(t,r,m.invertY,n,o,null,null,u,m,void 0,void 0,d)));s||(x&&m.onLoadedObservable.remove(x),h.h.UseFallbackTexture&&E.createTexture(h.h.fallbackTexture,r,m.invertY,n,o,null,null,u,m)),a&&a(e||"Unknown error",i)};if(A){var P=function(e){A.loadData(e,m,function(e,t,r,i,s,a){a?O("TextureLoader failed to load data"):E._prepareWebGLTexture(m,n,e,t,m.invertY,!r,i,function(){return s(),!1},o)})};u?P(u):this._loadFile(f,P,void 0,n?n.offlineProvider:void 0,!0,function(e,t){O("Unable to load "+(e&&e.responseURL,t))})}else{var D=function(t){g&&!E._doNotHandleContextLost&&(m._buffer=t),E._prepareWebGLTexture(m,n,t.width,t.height,m.invertY,r,!1,function(r,i,o){var s=E._gl,a=t.width===r&&t.height===i,h=l?E._getInternalFormat(l):".jpg"===y?s.RGB:s.RGBA;if(a)return s.texImage2D(s.TEXTURE_2D,0,h,h,s.UNSIGNED_BYTE,t),!1;var u=E._caps.maxTextureSize;if(t.width>u||t.height>u||null===e._RescalePostProcessFactory)return E._prepareWorkingCanvas(),!(!E._workingCanvas||!E._workingContext)&&(E._workingCanvas.width=r,E._workingCanvas.height=i,E._workingContext.drawImage(t,0,0,t.width,t.height,0,0,r,i),s.texImage2D(s.TEXTURE_2D,0,h,h,s.UNSIGNED_BYTE,E._workingCanvas),m.width=r,m.height=i,!1);var _=new p.a(E,p.a.DATASOURCE_TEMP);return E._bindTextureDirectly(s.TEXTURE_2D,_,!0),s.texImage2D(s.TEXTURE_2D,0,h,h,s.UNSIGNED_BYTE,t),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),E._rescaleTexture(_,m,n,h,function(){E._releaseTexture(_),E._bindTextureDirectly(s.TEXTURE_2D,m,!0),o()}),!0},o)};!T||b?u instanceof HTMLImageElement?D(u):h.h.LoadImage(f,D,O,n?n.offlineProvider:null):"string"==typeof u||u instanceof ArrayBuffer||u instanceof Blob?h.h.LoadImage(u,D,O,n?n.offlineProvider:null):D(u)}return m},e.prototype._rescaleTexture=function(t,r,i,n,o){var s=this,a=this.createRenderTargetTexture({width:r.width,height:r.height},{generateMipMaps:!1,type:e.TEXTURETYPE_UNSIGNED_INT,samplingMode:e.TEXTURE_BILINEAR_SAMPLINGMODE,generateDepthBuffer:!1,generateStencilBuffer:!1});!this._rescalePostProcess&&e._RescalePostProcessFactory&&(this._rescalePostProcess=e._RescalePostProcessFactory(this)),this._rescalePostProcess.getEffect().executeWhenCompiled(function(){s._rescalePostProcess.onApply=function(e){e._bindTexture("textureSampler",t)};var e=i;e||(e=s.scenes[s.scenes.length-1]),e.postProcessManager.directRender([s._rescalePostProcess],a,!0),s._bindTextureDirectly(s._gl.TEXTURE_2D,r,!0),s._gl.copyTexImage2D(s._gl.TEXTURE_2D,0,n,0,0,r.width,r.height,0),s.unBindFramebuffer(a),s._releaseTexture(a),o&&o()})},e.prototype.updateRawTexture=function(t,r,i,n,o,s){if(void 0===o&&(o=null),void 0===s&&(s=e.TEXTURETYPE_UNSIGNED_INT),t){var a=this._getRGBABufferInternalSizedFormat(s,i),h=this._getInternalFormat(i),u=this._getWebGLTextureType(s);this._bindTextureDirectly(this._gl.TEXTURE_2D,t,!0),this._unpackFlipY(void 0===n||!!n),this._doNotHandleContextLost||(t._bufferView=r,t.format=i,t.type=s,t.invertY=n,t._compression=o),t.width%4!=0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),o&&r?this._gl.compressedTexImage2D(this._gl.TEXTURE_2D,0,this.getCaps().s3tc[o],t.width,t.height,0,r):this._gl.texImage2D(this._gl.TEXTURE_2D,0,a,t.width,t.height,0,h,u,r),t.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),t.isReady=!0}},e.prototype.createRawTexture=function(t,r,i,n,o,s,a,h,u){void 0===h&&(h=null),void 0===u&&(u=e.TEXTURETYPE_UNSIGNED_INT);var _=new p.a(this,p.a.DATASOURCE_RAW);_.baseWidth=r,_.baseHeight=i,_.width=r,_.height=i,_.format=n,_.generateMipMaps=o,_.samplingMode=a,_.invertY=s,_._compression=h,_.type=u,this._doNotHandleContextLost||(_._bufferView=t),this.updateRawTexture(_,t,n,s,h,u),this._bindTextureDirectly(this._gl.TEXTURE_2D,_,!0);var l=this._getSamplingParameters(a,o);return this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,l.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,l.min),o&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._internalTexturesCache.push(_),_},e.prototype._unpackFlipY=function(e){this._unpackFlipYCached!==e&&(this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,e?1:0),this.enableUnpackFlipYCached&&(this._unpackFlipYCached=e))},e.prototype._getUnpackAlignement=function(){return this._gl.getParameter(this._gl.UNPACK_ALIGNMENT)},e.prototype.createDynamicTexture=function(e,t,r,i){var n=new p.a(this,p.a.DATASOURCE_DYNAMIC);return n.baseWidth=e,n.baseHeight=t,r&&(e=this.needPOTTextures?h.h.GetExponentOfTwo(e,this._caps.maxTextureSize):e,t=this.needPOTTextures?h.h.GetExponentOfTwo(t,this._caps.maxTextureSize):t),n.width=e,n.height=t,n.isReady=!1,n.generateMipMaps=r,n.samplingMode=i,this.updateTextureSamplingMode(i,n),this._internalTexturesCache.push(n),n},e.prototype.updateTextureSamplingMode=function(e,t){var r=this._getSamplingParameters(e,t.generateMipMaps);t.isCube?(this._setTextureParameterInteger(this._gl.TEXTURE_CUBE_MAP,this._gl.TEXTURE_MAG_FILTER,r.mag,t),this._setTextureParameterInteger(this._gl.TEXTURE_CUBE_MAP,this._gl.TEXTURE_MIN_FILTER,r.min),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)):t.is3D?(this._setTextureParameterInteger(this._gl.TEXTURE_3D,this._gl.TEXTURE_MAG_FILTER,r.mag,t),this._setTextureParameterInteger(this._gl.TEXTURE_3D,this._gl.TEXTURE_MIN_FILTER,r.min),this._bindTextureDirectly(this._gl.TEXTURE_3D,null)):(this._setTextureParameterInteger(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,r.mag,t),this._setTextureParameterInteger(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,r.min),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)),t.samplingMode=e},e.prototype.updateDynamicTexture=function(e,t,r,i,n,o){if(void 0===i&&(i=!1),void 0===o&&(o=!1),e){this._bindTextureDirectly(this._gl.TEXTURE_2D,e,!0,o),this._unpackFlipY(r),i&&this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);var s=n?this._getInternalFormat(n):this._gl.RGBA;this._gl.texImage2D(this._gl.TEXTURE_2D,0,s,s,this._gl.UNSIGNED_BYTE,t),e.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),i&&this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),e.isReady=!0}},e.prototype.updateVideoTexture=function(e,t,r){if(e&&!e._isDisabled){var i=this._bindTextureDirectly(this._gl.TEXTURE_2D,e,!0);this._unpackFlipY(!r);try{if(void 0===this._videoTextureSupported&&(this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,t),0!==this._gl.getError()?this._videoTextureSupported=!1:this._videoTextureSupported=!0),this._videoTextureSupported)this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,t);else{if(!e._workingCanvas){e._workingCanvas=document.createElement("canvas");var n=e._workingCanvas.getContext("2d");if(!n)throw new Error("Unable to get 2d context");e._workingContext=n,e._workingCanvas.width=e.width,e._workingCanvas.height=e.height}e._workingContext.drawImage(t,0,0,t.videoWidth,t.videoHeight,0,0,e.width,e.height),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,e._workingCanvas)}e.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),i||this._bindTextureDirectly(this._gl.TEXTURE_2D,null),e.isReady=!0}catch(t){e._isDisabled=!0}}},e.prototype.updateTextureComparisonFunction=function(t,r){if(1!==this.webGLVersion){var i=this._gl;t.isCube?(this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,t,!0),0===r?(i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_COMPARE_FUNC,e.LEQUAL),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_COMPARE_MODE,i.NONE)):(i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_COMPARE_FUNC,r),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_COMPARE_MODE,i.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)):(this._bindTextureDirectly(this._gl.TEXTURE_2D,t,!0),0===r?(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_COMPARE_FUNC,e.LEQUAL),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_COMPARE_MODE,i.NONE)):(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_COMPARE_FUNC,r),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_COMPARE_MODE,i.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)),t._comparisonFunction=r}else g.a.Error("WebGL 1 does not support texture comparison.")},e.prototype._setupDepthStencilTexture=function(t,r,i,n,o){var s=r.width||r,a=r.height||r;t.baseWidth=s,t.baseHeight=a,t.width=s,t.height=a,t.isReady=!0,t.samples=1,t.generateMipMaps=!1,t._generateDepthBuffer=!0,t._generateStencilBuffer=i,t.samplingMode=n?e.TEXTURE_BILINEAR_SAMPLINGMODE:e.TEXTURE_NEAREST_SAMPLINGMODE,t.type=e.TEXTURETYPE_UNSIGNED_INT,t._comparisonFunction=o;var h=this._gl,u=t.isCube?h.TEXTURE_CUBE_MAP:h.TEXTURE_2D,_=this._getSamplingParameters(t.samplingMode,!1);h.texParameteri(u,h.TEXTURE_MAG_FILTER,_.mag),h.texParameteri(u,h.TEXTURE_MIN_FILTER,_.min),h.texParameteri(u,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(u,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),0===o?(h.texParameteri(u,h.TEXTURE_COMPARE_FUNC,e.LEQUAL),h.texParameteri(u,h.TEXTURE_COMPARE_MODE,h.NONE)):(h.texParameteri(u,h.TEXTURE_COMPARE_FUNC,o),h.texParameteri(u,h.TEXTURE_COMPARE_MODE,h.COMPARE_REF_TO_TEXTURE))},e.prototype.createDepthStencilTexture=function(e,t){if(t.isCube){var r=e.width||e;return this._createDepthStencilCubeTexture(r,t)}return this._createDepthStencilTexture(e,t)},e.prototype._createDepthStencilTexture=function(e,t){var r=new p.a(this,p.a.DATASOURCE_DEPTHTEXTURE);if(!this._caps.depthTextureExtension)return g.a.Error("Depth texture is not supported by your browser or hardware."),r;var n=i.a({bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1},t),o=this._gl;return this._bindTextureDirectly(o.TEXTURE_2D,r,!0),this._setupDepthStencilTexture(r,e,n.generateStencil,n.bilinearFiltering,n.comparisonFunction),this.webGLVersion>1?n.generateStencil?o.texImage2D(o.TEXTURE_2D,0,o.DEPTH24_STENCIL8,r.width,r.height,0,o.DEPTH_STENCIL,o.UNSIGNED_INT_24_8,null):o.texImage2D(o.TEXTURE_2D,0,o.DEPTH_COMPONENT24,r.width,r.height,0,o.DEPTH_COMPONENT,o.UNSIGNED_INT,null):n.generateStencil?o.texImage2D(o.TEXTURE_2D,0,o.DEPTH_STENCIL,r.width,r.height,0,o.DEPTH_STENCIL,o.UNSIGNED_INT_24_8,null):o.texImage2D(o.TEXTURE_2D,0,o.DEPTH_COMPONENT,r.width,r.height,0,o.DEPTH_COMPONENT,o.UNSIGNED_INT,null),this._bindTextureDirectly(o.TEXTURE_2D,null),r},e.prototype._createDepthStencilCubeTexture=function(e,t){var r=new p.a(this,p.a.DATASOURCE_UNKNOWN);if(r.isCube=!0,1===this.webGLVersion)return g.a.Error("Depth cube texture is not supported by WebGL 1."),r;var n=i.a({bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1},t),o=this._gl;this._bindTextureDirectly(o.TEXTURE_CUBE_MAP,r,!0),this._setupDepthStencilTexture(r,e,n.generateStencil,n.bilinearFiltering,n.comparisonFunction);for(var s=0;s<6;s++)n.generateStencil?o.texImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+s,0,o.DEPTH24_STENCIL8,e,e,0,o.DEPTH_STENCIL,o.UNSIGNED_INT_24_8,null):o.texImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+s,0,o.DEPTH_COMPONENT24,e,e,0,o.DEPTH_COMPONENT,o.UNSIGNED_INT,null);return this._bindTextureDirectly(o.TEXTURE_CUBE_MAP,null),r},e.prototype.setFrameBufferDepthStencilTexture=function(e){var t=e.getInternalTexture();if(t&&t._framebuffer&&e.depthStencilTexture){var r=this._gl,i=e.depthStencilTexture;this.bindUnboundFramebuffer(t._framebuffer),i.isCube?i._generateStencilBuffer?r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.TEXTURE_CUBE_MAP_POSITIVE_X,i._webGLTexture,0):r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_CUBE_MAP_POSITIVE_X,i._webGLTexture,0):i._generateStencilBuffer?r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.TEXTURE_2D,i._webGLTexture,0):r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,i._webGLTexture,0),this.bindUnboundFramebuffer(null)}},e.prototype.createRenderTargetTexture=function(t,r){var i=new m.a;void 0!==r&&"object"==typeof r?(i.generateMipMaps=r.generateMipMaps,i.generateDepthBuffer=void 0===r.generateDepthBuffer||r.generateDepthBuffer,i.generateStencilBuffer=i.generateDepthBuffer&&r.generateStencilBuffer,i.type=void 0===r.type?e.TEXTURETYPE_UNSIGNED_INT:r.type,i.samplingMode=void 0===r.samplingMode?e.TEXTURE_TRILINEAR_SAMPLINGMODE:r.samplingMode,i.format=void 0===r.format?e.TEXTUREFORMAT_RGBA:r.format):(i.generateMipMaps=r,i.generateDepthBuffer=!0,i.generateStencilBuffer=!1,i.type=e.TEXTURETYPE_UNSIGNED_INT,i.samplingMode=e.TEXTURE_TRILINEAR_SAMPLINGMODE,i.format=e.TEXTUREFORMAT_RGBA),(i.type!==e.TEXTURETYPE_FLOAT||this._caps.textureFloatLinearFiltering)&&(i.type!==e.TEXTURETYPE_HALF_FLOAT||this._caps.textureHalfFloatLinearFiltering)||(i.samplingMode=e.TEXTURE_NEAREST_SAMPLINGMODE);var n=this._gl,o=new p.a(this,p.a.DATASOURCE_RENDERTARGET);this._bindTextureDirectly(n.TEXTURE_2D,o,!0);var s=t.width||t,a=t.height||t,h=this._getSamplingParameters(i.samplingMode,!!i.generateMipMaps);i.type!==e.TEXTURETYPE_FLOAT||this._caps.textureFloat||(i.type=e.TEXTURETYPE_UNSIGNED_INT,g.a.Warn("Float textures are not supported. Render target forced to TEXTURETYPE_UNSIGNED_BYTE type")),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,h.mag),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,h.min),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texImage2D(n.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(i.type,i.format),s,a,0,this._getInternalFormat(i.format),this._getWebGLTextureType(i.type),null);var u=this._currentFramebuffer,_=n.createFramebuffer();return this.bindUnboundFramebuffer(_),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,o._webGLTexture,0),o._depthStencilBuffer=this._setupFramebufferDepthAttachments(!!i.generateStencilBuffer,i.generateDepthBuffer,s,a),i.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(n.TEXTURE_2D,null),n.bindRenderbuffer(n.RENDERBUFFER,null),this.bindUnboundFramebuffer(u),o._framebuffer=_,o.baseWidth=s,o.baseHeight=a,o.width=s,o.height=a,o.isReady=!0,o.samples=1,o.generateMipMaps=!!i.generateMipMaps,o.samplingMode=i.samplingMode,o.type=i.type,o.format=i.format,o._generateDepthBuffer=i.generateDepthBuffer,o._generateStencilBuffer=!!i.generateStencilBuffer,this._internalTexturesCache.push(o),o},e.prototype.createMultipleRenderTarget=function(t,r){var i=!1,n=!0,o=!1,s=!1,a=1,h=e.TEXTURETYPE_UNSIGNED_INT,u=e.TEXTURE_TRILINEAR_SAMPLINGMODE,_=new Array,l=new Array;void 0!==r&&(i=void 0!==r.generateMipMaps&&r.generateMipMaps,n=void 0===r.generateDepthBuffer||r.generateDepthBuffer,o=void 0!==r.generateStencilBuffer&&r.generateStencilBuffer,s=void 0!==r.generateDepthTexture&&r.generateDepthTexture,a=r.textureCount||1,r.types&&(_=r.types),r.samplingModes&&(l=r.samplingModes));var c=this._gl,d=c.createFramebuffer();this.bindUnboundFramebuffer(d);for(var E=t.width||t,f=t.height||t,T=[],b=[],m=this._setupFramebufferDepthAttachments(o,n,E,f),R=0;R<a;R++){var y=l[R]||u,A=_[R]||h;(A!==e.TEXTURETYPE_FLOAT||this._caps.textureFloatLinearFiltering)&&(A!==e.TEXTURETYPE_HALF_FLOAT||this._caps.textureHalfFloatLinearFiltering)||(y=e.TEXTURE_NEAREST_SAMPLINGMODE);var v=this._getSamplingParameters(y,i);A!==e.TEXTURETYPE_FLOAT||this._caps.textureFloat||(A=e.TEXTURETYPE_UNSIGNED_INT,g.a.Warn("Float textures are not supported. Render target forced to TEXTURETYPE_UNSIGNED_BYTE type"));var M=new p.a(this,p.a.DATASOURCE_MULTIRENDERTARGET),S=c[this.webGLVersion>1?"COLOR_ATTACHMENT"+R:"COLOR_ATTACHMENT"+R+"_WEBGL"];T.push(M),b.push(S),c.activeTexture(c["TEXTURE"+R]),c.bindTexture(c.TEXTURE_2D,M._webGLTexture),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,v.mag),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,v.min),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),c.texImage2D(c.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(A),E,f,0,c.RGBA,this._getWebGLTextureType(A),null),c.framebufferTexture2D(c.DRAW_FRAMEBUFFER,S,c.TEXTURE_2D,M._webGLTexture,0),i&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(c.TEXTURE_2D,null),M._framebuffer=d,M._depthStencilBuffer=m,M.baseWidth=E,M.baseHeight=f,M.width=E,M.height=f,M.isReady=!0,M.samples=1,M.generateMipMaps=i,M.samplingMode=y,M.type=A,M._generateDepthBuffer=n,M._generateStencilBuffer=o,M._attachments=b,this._internalTexturesCache.push(M)}if(s&&this._caps.depthTextureExtension){var x=new p.a(this,p.a.DATASOURCE_MULTIRENDERTARGET);c.activeTexture(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,x._webGLTexture),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.NEAREST),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.NEAREST),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),c.texImage2D(c.TEXTURE_2D,0,this.webGLVersion<2?c.DEPTH_COMPONENT:c.DEPTH_COMPONENT16,E,f,0,c.DEPTH_COMPONENT,c.UNSIGNED_SHORT,null),c.framebufferTexture2D(c.FRAMEBUFFER,c.DEPTH_ATTACHMENT,c.TEXTURE_2D,x._webGLTexture,0),x._framebuffer=d,x.baseWidth=E,x.baseHeight=f,x.width=E,x.height=f,x.isReady=!0,x.samples=1,x.generateMipMaps=i,x.samplingMode=c.NEAREST,x._generateDepthBuffer=n,x._generateStencilBuffer=o,T.push(x),this._internalTexturesCache.push(x)}return c.drawBuffers(b),c.bindRenderbuffer(c.RENDERBUFFER,null),this.bindUnboundFramebuffer(null),this.resetTextureCache(),T},e.prototype._setupFramebufferDepthAttachments=function(e,t,r,i,n){void 0===n&&(n=1);var o=null,s=this._gl;return e?(o=s.createRenderbuffer(),s.bindRenderbuffer(s.RENDERBUFFER,o),n>1?s.renderbufferStorageMultisample(s.RENDERBUFFER,n,s.DEPTH24_STENCIL8,r,i):s.renderbufferStorage(s.RENDERBUFFER,s.DEPTH_STENCIL,r,i),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,o)):t&&(o=s.createRenderbuffer(),s.bindRenderbuffer(s.RENDERBUFFER,o),n>1?s.renderbufferStorageMultisample(s.RENDERBUFFER,n,s.DEPTH_COMPONENT16,r,i):s.renderbufferStorage(s.RENDERBUFFER,s.DEPTH_COMPONENT16,r,i),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,o)),o},e.prototype.updateRenderTargetTextureSampleCount=function(e,t){if(this.webGLVersion<2||!e)return 1;if(e.samples===t)return t;var r=this._gl;if(t=Math.min(t,r.getParameter(r.MAX_SAMPLES)),e._depthStencilBuffer&&(r.deleteRenderbuffer(e._depthStencilBuffer),e._depthStencilBuffer=null),e._MSAAFramebuffer&&(r.deleteFramebuffer(e._MSAAFramebuffer),e._MSAAFramebuffer=null),e._MSAARenderBuffer&&(r.deleteRenderbuffer(e._MSAARenderBuffer),e._MSAARenderBuffer=null),t>1){var i=r.createFramebuffer();if(!i)throw new Error("Unable to create multi sampled framebuffer");e._MSAAFramebuffer=i,this.bindUnboundFramebuffer(e._MSAAFramebuffer);var n=r.createRenderbuffer();if(!n)throw new Error("Unable to create multi sampled framebuffer");r.bindRenderbuffer(r.RENDERBUFFER,n),r.renderbufferStorageMultisample(r.RENDERBUFFER,t,this._getRGBAMultiSampleBufferFormat(e.type),e.width,e.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.RENDERBUFFER,n),e._MSAARenderBuffer=n}else this.bindUnboundFramebuffer(e._framebuffer);return e.samples=t,e._depthStencilBuffer=this._setupFramebufferDepthAttachments(e._generateStencilBuffer,e._generateDepthBuffer,e.width,e.height,t),r.bindRenderbuffer(r.RENDERBUFFER,null),this.bindUnboundFramebuffer(null),t},e.prototype.updateMultipleRenderTargetTextureSampleCount=function(e,t){if(this.webGLVersion<2||!e||0==e.length)return 1;if(e[0].samples===t)return t;var r=this._gl;t=Math.min(t,r.getParameter(r.MAX_SAMPLES)),e[0]._depthStencilBuffer&&(r.deleteRenderbuffer(e[0]._depthStencilBuffer),e[0]._depthStencilBuffer=null),e[0]._MSAAFramebuffer&&(r.deleteFramebuffer(e[0]._MSAAFramebuffer),e[0]._MSAAFramebuffer=null);for(var i=0;i<e.length;i++)e[i]._MSAARenderBuffer&&(r.deleteRenderbuffer(e[i]._MSAARenderBuffer),e[i]._MSAARenderBuffer=null);if(t>1){var n=r.createFramebuffer();if(!n)throw new Error("Unable to create multi sampled framebuffer");this.bindUnboundFramebuffer(n);var o=this._setupFramebufferDepthAttachments(e[0]._generateStencilBuffer,e[0]._generateDepthBuffer,e[0].width,e[0].height,t),s=[];for(i=0;i<e.length;i++){var a=e[i],h=r[this.webGLVersion>1?"COLOR_ATTACHMENT"+i:"COLOR_ATTACHMENT"+i+"_WEBGL"],u=r.createRenderbuffer();if(!u)throw new Error("Unable to create multi sampled framebuffer");r.bindRenderbuffer(r.RENDERBUFFER,u),r.renderbufferStorageMultisample(r.RENDERBUFFER,t,this._getRGBAMultiSampleBufferFormat(a.type),a.width,a.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,h,r.RENDERBUFFER,u),a._MSAAFramebuffer=n,a._MSAARenderBuffer=u,a.samples=t,a._depthStencilBuffer=o,r.bindRenderbuffer(r.RENDERBUFFER,null),s.push(h)}r.drawBuffers(s)}else this.bindUnboundFramebuffer(e[0]._framebuffer);return this.bindUnboundFramebuffer(null),t},e.prototype._uploadCompressedDataToTextureDirectly=function(e,t,r,i,n,o,s){void 0===o&&(o=0),void 0===s&&(s=0);var a=this._gl,h=a.TEXTURE_2D;e.isCube&&(h=a.TEXTURE_CUBE_MAP_POSITIVE_X+o),this._gl.compressedTexImage2D(h,s,t,r,i,0,n)},e.prototype._uploadDataToTextureDirectly=function(e,t,r,i){void 0===r&&(r=0),void 0===i&&(i=0);var n=this._gl,o=this._getWebGLTextureType(e.type),s=this._getInternalFormat(e.format),a=this._getRGBABufferInternalSizedFormat(e.type,s);this._unpackFlipY(e.invertY);var h=n.TEXTURE_2D;e.isCube&&(h=n.TEXTURE_CUBE_MAP_POSITIVE_X+r);var u=Math.round(_.a.Log2(e.width)),l=Math.round(_.a.Log2(e.height)),c=Math.pow(2,Math.max(u-i,0)),d=Math.pow(2,Math.max(l-i,0));n.texImage2D(h,i,a,c,d,0,s,o,t)},e.prototype._uploadArrayBufferViewToTexture=function(e,t,r,i){void 0===r&&(r=0),void 0===i&&(i=0);var n=this._gl,o=e.isCube?n.TEXTURE_CUBE_MAP:n.TEXTURE_2D;this._bindTextureDirectly(o,e,!0),this._uploadDataToTextureDirectly(e,t,r,i),this._bindTextureDirectly(o,null,!0)},e.prototype._uploadImageToTexture=function(e,t,r,i){void 0===r&&(r=0),void 0===i&&(i=0);var n=this._gl,o=this._getWebGLTextureType(e.type),s=this._getInternalFormat(e.format),a=this._getRGBABufferInternalSizedFormat(e.type,s),h=e.isCube?n.TEXTURE_CUBE_MAP:n.TEXTURE_2D;this._bindTextureDirectly(h,e,!0),this._unpackFlipY(e.invertY);var u=n.TEXTURE_2D;e.isCube&&(u=n.TEXTURE_CUBE_MAP_POSITIVE_X+r),n.texImage2D(u,i,a,s,o,t),this._bindTextureDirectly(h,null,!0)},e.prototype.createRenderTargetCubeTexture=function(t,r){var n=i.a({generateMipMaps:!0,generateDepthBuffer:!0,generateStencilBuffer:!1,type:e.TEXTURETYPE_UNSIGNED_INT,samplingMode:e.TEXTURE_TRILINEAR_SAMPLINGMODE,format:e.TEXTUREFORMAT_RGBA},r);n.generateStencilBuffer=n.generateDepthBuffer&&n.generateStencilBuffer,(n.type!==e.TEXTURETYPE_FLOAT||this._caps.textureFloatLinearFiltering)&&(n.type!==e.TEXTURETYPE_HALF_FLOAT||this._caps.textureHalfFloatLinearFiltering)||(n.samplingMode=e.TEXTURE_NEAREST_SAMPLINGMODE);var o=this._gl,s=new p.a(this,p.a.DATASOURCE_RENDERTARGET);this._bindTextureDirectly(o.TEXTURE_CUBE_MAP,s,!0);var a=this._getSamplingParameters(n.samplingMode,n.generateMipMaps);n.type!==e.TEXTURETYPE_FLOAT||this._caps.textureFloat||(n.type=e.TEXTURETYPE_UNSIGNED_INT,g.a.Warn("Float textures are not supported. Cube render target forced to TEXTURETYPE_UNESIGNED_BYTE type")),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_MAG_FILTER,a.mag),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_MIN_FILTER,a.min),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE);for(var h=0;h<6;h++)o.texImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+h,0,this._getRGBABufferInternalSizedFormat(n.type,n.format),t,t,0,this._getInternalFormat(n.format),this._getWebGLTextureType(n.type),null);var u=o.createFramebuffer();return this.bindUnboundFramebuffer(u),s._depthStencilBuffer=this._setupFramebufferDepthAttachments(n.generateStencilBuffer,n.generateDepthBuffer,t,t),n.generateMipMaps&&o.generateMipmap(o.TEXTURE_CUBE_MAP),this._bindTextureDirectly(o.TEXTURE_CUBE_MAP,null),o.bindRenderbuffer(o.RENDERBUFFER,null),this.bindUnboundFramebuffer(null),s._framebuffer=u,s.width=t,s.height=t,s.isReady=!0,s.isCube=!0,s.samples=1,s.generateMipMaps=n.generateMipMaps,s.samplingMode=n.samplingMode,s.type=n.type,s.format=n.format,s._generateDepthBuffer=n.generateDepthBuffer,s._generateStencilBuffer=n.generateStencilBuffer,this._internalTexturesCache.push(s),s},e.prototype.createCubeTexture=function(t,r,i,n,o,s,a,u,_,l,c,d,E){var f=this;void 0===o&&(o=null),void 0===s&&(s=null),void 0===u&&(u=null),void 0===_&&(_=!1),void 0===l&&(l=0),void 0===c&&(c=0),void 0===d&&(d=null),void 0===E&&(E=[]);var T=this._gl,b=d||new p.a(this,p.a.DATASOURCE_CUBE);b.isCube=!0,b.url=t,b.generateMipMaps=!n,b._lodGenerationScale=l,b._lodGenerationOffset=c,this._doNotHandleContextLost||(b._extension=u,b._files=i);for(var m=t.lastIndexOf("."),R=u||(m>-1?t.substring(m).toLowerCase():""),y=null,A=0,v=e._TextureLoaders;A<v.length;A++){var M=v[A];if(-1===E.indexOf(M)&&M.canLoad(R,this._textureFormatInUse,d,!1,!1)){y=M;break}}if(y){t=y.transformUrl(t,this._textureFormatInUse);var S=function(e){f._bindTextureDirectly(T.TEXTURE_CUBE_MAP,b,!0),y.loadCubeData(e,b,_,o,s)};i&&6===i.length?y.supportCascades?this._cascadeLoadFiles(r,S,i,s):s&&s("Textures type does not support cascades."):this._loadFile(t,S,void 0,void 0,!0,function(e,t){if(y){var h=y.getFallbackTextureUrl(b.url,f._textureFormatInUse);if(g.a.Warn(y.constructor.name+" failed when trying to load "+b.url+", falling back to the next supported loader"),h)return E.push(y),void f.createCubeTexture(h,r,i,n,o,s,a,R,_,l,c,b,E)}s&&e&&s(e.status+" "+e.statusText,t)})}else{if(!i)throw new Error("Cannot load cubemap because files were not defined");this._cascadeLoadImgs(r,function(e){var t=f.needPOTTextures?h.h.GetExponentOfTwo(e[0].width,f._caps.maxCubemapTextureSize):e[0].width,r=t;if(f._prepareWorkingCanvas(),f._workingCanvas&&f._workingContext){f._workingCanvas.width=t,f._workingCanvas.height=r;var i=[T.TEXTURE_CUBE_MAP_POSITIVE_X,T.TEXTURE_CUBE_MAP_POSITIVE_Y,T.TEXTURE_CUBE_MAP_POSITIVE_Z,T.TEXTURE_CUBE_MAP_NEGATIVE_X,T.TEXTURE_CUBE_MAP_NEGATIVE_Y,T.TEXTURE_CUBE_MAP_NEGATIVE_Z];f._bindTextureDirectly(T.TEXTURE_CUBE_MAP,b,!0),f._unpackFlipY(!1);for(var s=a?f._getInternalFormat(a):f._gl.RGBA,u=0;u<i.length;u++)f._workingContext.drawImage(e[u],0,0,e[u].width,e[u].height,0,0,t,r),T.texImage2D(i[u],0,s,s,T.UNSIGNED_BYTE,f._workingCanvas);n||T.generateMipmap(T.TEXTURE_CUBE_MAP),f._setCubeMapTextureParams(!n),b.width=t,b.height=r,b.isReady=!0,a&&(b.format=a),b.onLoadedObservable.notifyObservers(b),b.onLoadedObservable.clear(),o&&o()}},i,s)}return this._internalTexturesCache.push(b),b},e.prototype._setCubeMapTextureParams=function(e){var t=this._gl;t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,e?t.LINEAR_MIPMAP_LINEAR:t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),this._bindTextureDirectly(t.TEXTURE_CUBE_MAP,null)},e.prototype.updateRawCubeTexture=function(e,t,r,i,n,o,s){void 0===o&&(o=null),void 0===s&&(s=0),e._bufferViewArray=t,e.format=r,e.type=i,e.invertY=n,e._compression=o;var a=this._gl,u=this._getWebGLTextureType(i),_=this._getInternalFormat(r),l=this._getRGBABufferInternalSizedFormat(i),c=!1;_===a.RGB&&(_=a.RGBA,c=!0),this._bindTextureDirectly(a.TEXTURE_CUBE_MAP,e,!0),this._unpackFlipY(void 0===n||!!n),e.width%4!=0&&a.pixelStorei(a.UNPACK_ALIGNMENT,1);for(var d=0;d<6;d++){var p=t[d];o?a.compressedTexImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+d,s,this.getCaps().s3tc[o],e.width,e.height,0,p):(c&&(p=this._convertRGBtoRGBATextureData(p,e.width,e.height,i)),a.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+d,s,l,e.width,e.height,0,_,u,p))}(!this.needPOTTextures||h.h.IsExponentOfTwo(e.width)&&h.h.IsExponentOfTwo(e.height))&&e.generateMipMaps&&0===s&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),e.isReady=!0},e.prototype.createRawCubeTexture=function(t,r,i,n,o,s,a,u){void 0===u&&(u=null);var _=this._gl,l=new p.a(this,p.a.DATASOURCE_CUBERAW);l.isCube=!0,l.format=i,l.type=n,this._doNotHandleContextLost||(l._bufferViewArray=t);var c=this._getWebGLTextureType(n),d=this._getInternalFormat(i);d===_.RGB&&(d=_.RGBA),c!==_.FLOAT||this._caps.textureFloatLinearFiltering?c!==this._gl.HALF_FLOAT_OES||this._caps.textureHalfFloatLinearFiltering?c!==_.FLOAT||this._caps.textureFloatRender?c!==_.HALF_FLOAT||this._caps.colorBufferFloat||(o=!1,g.a.Warn("Render to half float textures is not supported. Mipmap generation forced to false.")):(o=!1,g.a.Warn("Render to float textures is not supported. Mipmap generation forced to false.")):(o=!1,a=e.TEXTURE_NEAREST_SAMPLINGMODE,g.a.Warn("Half float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively.")):(o=!1,a=e.TEXTURE_NEAREST_SAMPLINGMODE,g.a.Warn("Float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively."));var E=r,f=E;l.width=E,l.height=f,!this.needPOTTextures||h.h.IsExponentOfTwo(l.width)&&h.h.IsExponentOfTwo(l.height)||(o=!1),t&&this.updateRawCubeTexture(l,t,i,n,s,u),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,l,!0),t&&o&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP);var T=this._getSamplingParameters(a,o);return _.texParameteri(_.TEXTURE_CUBE_MAP,_.TEXTURE_MAG_FILTER,T.mag),_.texParameteri(_.TEXTURE_CUBE_MAP,_.TEXTURE_MIN_FILTER,T.min),_.texParameteri(_.TEXTURE_CUBE_MAP,_.TEXTURE_WRAP_S,_.CLAMP_TO_EDGE),_.texParameteri(_.TEXTURE_CUBE_MAP,_.TEXTURE_WRAP_T,_.CLAMP_TO_EDGE),this._bindTextureDirectly(_.TEXTURE_CUBE_MAP,null),l.generateMipMaps=o,l},e.prototype.createRawCubeTextureFromUrl=function(t,r,i,n,o,s,a,h,u,_,l,c){var d=this;void 0===u&&(u=null),void 0===_&&(_=null),void 0===l&&(l=e.TEXTURE_TRILINEAR_SAMPLINGMODE),void 0===c&&(c=!1);var p=this._gl,E=this.createRawCubeTexture(null,i,n,o,!s,c,l);r._addPendingData(E),E.url=t,this._internalTexturesCache.push(E);return this._loadFile(t,function(e){!function(e){var t=E.width,i=a(e);if(i){if(h){var s=d._getWebGLTextureType(o),_=d._getInternalFormat(n),l=d._getRGBABufferInternalSizedFormat(o),f=!1;_===p.RGB&&(_=p.RGBA,f=!0),d._bindTextureDirectly(p.TEXTURE_CUBE_MAP,E,!0),d._unpackFlipY(!1);for(var T=h(i),g=0;g<T.length;g++)for(var b=t>>g,m=0;m<6;m++){var R=T[g][m];f&&(R=d._convertRGBtoRGBATextureData(R,b,b,o)),p.texImage2D(m,g,l,b,b,0,_,s,R)}d._bindTextureDirectly(p.TEXTURE_CUBE_MAP,null)}else d.updateRawCubeTexture(E,i,n,o,c);E.isReady=!0,r._removePendingData(E),u&&u()}}(e)},void 0,r.offlineProvider,!0,function(e,t){r._removePendingData(E),_&&e&&_(e.status+" "+e.statusText,t)}),E},e.prototype.updateRawTexture3D=function(t,r,i,n,o,s){void 0===o&&(o=null),void 0===s&&(s=e.TEXTURETYPE_UNSIGNED_INT);var a=this._getWebGLTextureType(s),h=this._getInternalFormat(i),u=this._getRGBABufferInternalSizedFormat(s,i);this._bindTextureDirectly(this._gl.TEXTURE_3D,t,!0),this._unpackFlipY(void 0===n||!!n),this._doNotHandleContextLost||(t._bufferView=r,t.format=i,t.invertY=n,t._compression=o),t.width%4!=0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),o&&r?this._gl.compressedTexImage3D(this._gl.TEXTURE_3D,0,this.getCaps().s3tc[o],t.width,t.height,t.depth,0,r):this._gl.texImage3D(this._gl.TEXTURE_3D,0,u,t.width,t.height,t.depth,0,h,a,r),t.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_3D),this._bindTextureDirectly(this._gl.TEXTURE_3D,null),t.isReady=!0},e.prototype.createRawTexture3D=function(t,r,i,n,o,s,a,h,u,_){void 0===u&&(u=null),void 0===_&&(_=e.TEXTURETYPE_UNSIGNED_INT);var l=new p.a(this,p.a.DATASOURCE_RAW3D);l.baseWidth=r,l.baseHeight=i,l.baseDepth=n,l.width=r,l.height=i,l.depth=n,l.format=o,l.type=_,l.generateMipMaps=s,l.samplingMode=h,l.is3D=!0,this._doNotHandleContextLost||(l._bufferView=t),this.updateRawTexture3D(l,t,o,a,u,_),this._bindTextureDirectly(this._gl.TEXTURE_3D,l,!0);var c=this._getSamplingParameters(h,s);return this._gl.texParameteri(this._gl.TEXTURE_3D,this._gl.TEXTURE_MAG_FILTER,c.mag),this._gl.texParameteri(this._gl.TEXTURE_3D,this._gl.TEXTURE_MIN_FILTER,c.min),s&&this._gl.generateMipmap(this._gl.TEXTURE_3D),this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._internalTexturesCache.push(l),l},e.prototype._prepareWebGLTextureContinuation=function(e,t,r,i,n){var o=this._gl;if(o){var s=this._getSamplingParameters(n,!r);o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,s.mag),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,s.min),r||i||o.generateMipmap(o.TEXTURE_2D),this._bindTextureDirectly(o.TEXTURE_2D,null),t&&t._removePendingData(e),e.onLoadedObservable.notifyObservers(e),e.onLoadedObservable.clear()}},e.prototype._prepareWebGLTexture=function(t,r,i,n,o,s,a,u,_){var l=this;void 0===_&&(_=e.TEXTURE_TRILINEAR_SAMPLINGMODE);var c=this.getCaps().maxTextureSize,d=Math.min(c,this.needPOTTextures?h.h.GetExponentOfTwo(i,c):i),p=Math.min(c,this.needPOTTextures?h.h.GetExponentOfTwo(n,c):n),E=this._gl;E&&(t._webGLTexture?(this._bindTextureDirectly(E.TEXTURE_2D,t,!0),this._unpackFlipY(void 0===o||!!o),t.baseWidth=i,t.baseHeight=n,t.width=d,t.height=p,t.isReady=!0,u(d,p,function(){l._prepareWebGLTextureContinuation(t,r,s,a,_)})||this._prepareWebGLTextureContinuation(t,r,s,a,_)):r&&r._removePendingData(t))},e.prototype._convertRGBtoRGBATextureData=function(t,r,i,n){var o;o=n===e.TEXTURETYPE_FLOAT?new Float32Array(r*i*4):new Uint32Array(r*i*4);for(var s=0;s<r;s++)for(var a=0;a<i;a++){var h=3*(a*r+s),u=4*(a*r+s);o[u+0]=t[h+0],o[u+1]=t[h+1],o[u+2]=t[h+2],o[u+3]=1}return o},e.prototype._releaseFramebufferObjects=function(e){var t=this._gl;e._framebuffer&&(t.deleteFramebuffer(e._framebuffer),e._framebuffer=null),e._depthStencilBuffer&&(t.deleteRenderbuffer(e._depthStencilBuffer),e._depthStencilBuffer=null),e._MSAAFramebuffer&&(t.deleteFramebuffer(e._MSAAFramebuffer),e._MSAAFramebuffer=null),e._MSAARenderBuffer&&(t.deleteRenderbuffer(e._MSAARenderBuffer),e._MSAARenderBuffer=null)},e.prototype._releaseTexture=function(e){var t=this._gl;this._releaseFramebufferObjects(e),t.deleteTexture(e._webGLTexture),this.unbindAllTextures();var r=this._internalTexturesCache.indexOf(e);-1!==r&&this._internalTexturesCache.splice(r,1),e._lodTextureHigh&&e._lodTextureHigh.dispose(),e._lodTextureMid&&e._lodTextureMid.dispose(),e._lodTextureLow&&e._lodTextureLow.dispose(),this.scenes.forEach(function(t){t.postProcesses.forEach(function(t){t._outputTexture==e&&(t._outputTexture=null)}),t.cameras.forEach(function(t){t._postProcesses.forEach(function(t){t&&t._outputTexture==e&&(t._outputTexture=null)})})})},e.prototype.setProgram=function(e){this._currentProgram!==e&&(this._gl.useProgram(e),this._currentProgram=e)},e.prototype.bindSamplers=function(e){this.setProgram(e.getProgram());for(var t=e.getSamplers(),r=0;r<t.length;r++){var i=e.getUniform(t[r]);i&&(this._boundUniforms[r]=i)}this._currentEffect=null},e.prototype._moveBoundTextureOnTop=function(e){this.disableTextureBindingOptimization||this._lastBoundInternalTextureTracker.previous===e||(this._linkTrackers(e.previous,e.next),this._linkTrackers(this._lastBoundInternalTextureTracker.previous,e),this._linkTrackers(e,this._lastBoundInternalTextureTracker))},e.prototype._getCorrectTextureChannel=function(e,t){if(!t)return-1;if(t._initialSlot=e,this.disableTextureBindingOptimization)e!==t._designatedSlot&&this._textureCollisions.addCount(1,!1);else if(e!==t._designatedSlot)return t._designatedSlot>-1?t._designatedSlot:this._nextFreeTextureSlots.length?this._nextFreeTextureSlots[0]:(this._textureCollisions.addCount(1,!1),this._removeDesignatedSlot(this._firstBoundInternalTextureTracker.next));return e},e.prototype._linkTrackers=function(e,t){e.next=t,t.previous=e},e.prototype._removeDesignatedSlot=function(e){var t=e._designatedSlot;return-1===t?-1:(e._designatedSlot=-1,this.disableTextureBindingOptimization?-1:(this._linkTrackers(e.previous,e.next),this._boundTexturesCache[t]=null,this._nextFreeTextureSlots.push(t),t))},e.prototype._activateCurrentTexture=function(){this._currentTextureChannel!==this._activeChannel&&(this._gl.activeTexture(this._gl.TEXTURE0+this._activeChannel),this._currentTextureChannel=this._activeChannel)},e.prototype._bindTextureDirectly=function(e,t,r,i){void 0===r&&(r=!1),void 0===i&&(i=!1);var n=!1;r&&t&&t._designatedSlot>-1&&(this._activeChannel=t._designatedSlot);var o=this._boundTexturesCache[this._activeChannel],s=t&&t._initialSlot>-1;if(o!==t||i){if(o&&this._removeDesignatedSlot(o),this._activateCurrentTexture(),this._gl.bindTexture(e,t?t._webGLTexture:null),this._boundTexturesCache[this._activeChannel]=t,t){if(!this.disableTextureBindingOptimization){var a=this._nextFreeTextureSlots.indexOf(this._activeChannel);a>-1&&this._nextFreeTextureSlots.splice(a,1),this._linkTrackers(this._lastBoundInternalTextureTracker.previous,t),this._linkTrackers(t,this._lastBoundInternalTextureTracker)}t._designatedSlot=this._activeChannel}}else r&&(n=!0,this._activateCurrentTexture());return s&&!r&&this._bindSamplerUniformToChannel(t._initialSlot,this._activeChannel),n},e.prototype._bindTexture=function(e,t){e<0||(t&&(e=this._getCorrectTextureChannel(e,t)),this._activeChannel=e,this._bindTextureDirectly(this._gl.TEXTURE_2D,t))},e.prototype.setTextureFromPostProcess=function(e,t){this._bindTexture(e,t?t._textures.data[t._currentRenderTextureInd]:null)},e.prototype.setTextureFromPostProcessOutput=function(e,t){this._bindTexture(e,t?t._outputTexture:null)},e.prototype.unbindAllTextures=function(){for(var e=0;e<this._maxSimultaneousTextures;e++)this._activeChannel=e,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&this._bindTextureDirectly(this._gl.TEXTURE_3D,null)},e.prototype.setTexture=function(e,t,r){e<0||(t&&(this._boundUniforms[e]=t),this._setTexture(e,r))},e.prototype.setDepthStencilTexture=function(e,t,r){e<0||(t&&(this._boundUniforms[e]=t),r&&r.depthStencilTexture?this._setTexture(e,r,!1,!0):this._setTexture(e,null))},e.prototype._bindSamplerUniformToChannel=function(e,t){var r=this._boundUniforms[e];r._currentState!==t&&(this._gl.uniform1i(r,t),r._currentState=t)},e.prototype._getTextureWrapMode=function(t){switch(t){case e.TEXTURE_WRAP_ADDRESSMODE:return this._gl.REPEAT;case e.TEXTURE_CLAMP_ADDRESSMODE:return this._gl.CLAMP_TO_EDGE;case e.TEXTURE_MIRROR_ADDRESSMODE:return this._gl.MIRRORED_REPEAT}return this._gl.REPEAT},e.prototype._setTexture=function(t,r,i,n){if(void 0===i&&(i=!1),void 0===n&&(n=!1),!r)return null!=this._boundTexturesCache[t]&&(this._activeChannel=t,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&this._bindTextureDirectly(this._gl.TEXTURE_3D,null)),!1;if(r.video)this._activeChannel=t,r.update();else if(r.delayLoadState===e.DELAYLOADSTATE_NOTLOADED)return r.delayLoad(),!1;var o;o=n?r.depthStencilTexture:r.isReady()?r.getInternalTexture():r.isCube?this.emptyCubeTexture:r.is3D?this.emptyTexture3D:this.emptyTexture,i||(t=this._getCorrectTextureChannel(t,o));var s=!0;if(this._boundTexturesCache[t]===o&&(this._moveBoundTextureOnTop(o),i||this._bindSamplerUniformToChannel(o._initialSlot,t),s=!1),this._activeChannel=t,o&&o.is3D)s&&this._bindTextureDirectly(this._gl.TEXTURE_3D,o,i),o&&o._cachedWrapU!==r.wrapU&&(o._cachedWrapU=r.wrapU,this._setTextureParameterInteger(this._gl.TEXTURE_3D,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(r.wrapU),o)),o&&o._cachedWrapV!==r.wrapV&&(o._cachedWrapV=r.wrapV,this._setTextureParameterInteger(this._gl.TEXTURE_3D,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(r.wrapV),o)),o&&o._cachedWrapR!==r.wrapR&&(o._cachedWrapR=r.wrapR,this._setTextureParameterInteger(this._gl.TEXTURE_3D,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(r.wrapR),o)),this._setAnisotropicLevel(this._gl.TEXTURE_3D,r);else if(o&&o.isCube){if(s&&this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,o,i),o._cachedCoordinatesMode!==r.coordinatesMode){o._cachedCoordinatesMode=r.coordinatesMode;var a=r.coordinatesMode!==e.TEXTURE_CUBIC_MODE&&r.coordinatesMode!==e.TEXTURE_SKYBOX_MODE?this._gl.REPEAT:this._gl.CLAMP_TO_EDGE;this._setTextureParameterInteger(this._gl.TEXTURE_CUBE_MAP,this._gl.TEXTURE_WRAP_S,a,o),this._setTextureParameterInteger(this._gl.TEXTURE_CUBE_MAP,this._gl.TEXTURE_WRAP_T,a)}this._setAnisotropicLevel(this._gl.TEXTURE_CUBE_MAP,r)}else s&&this._bindTextureDirectly(this._gl.TEXTURE_2D,o,i),o&&o._cachedWrapU!==r.wrapU&&(o._cachedWrapU=r.wrapU,this._setTextureParameterInteger(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(r.wrapU),o)),o&&o._cachedWrapV!==r.wrapV&&(o._cachedWrapV=r.wrapV,this._setTextureParameterInteger(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(r.wrapV),o)),this._setAnisotropicLevel(this._gl.TEXTURE_2D,r);return!0},e.prototype.setTextureArray=function(e,t,r){if(!(e<0)&&t){this._textureUnits&&this._textureUnits.length===r.length||(this._textureUnits=new Int32Array(r.length));for(var i=0;i<r.length;i++)this._textureUnits[i]=this._getCorrectTextureChannel(e+i,r[i].getInternalTexture());this._gl.uniform1iv(t,this._textureUnits);for(var n=0;n<r.length;n++)this._setTexture(this._textureUnits[n],r[n],!0)}},e.prototype._setAnisotropicLevel=function(t,r){var i=r.getInternalTexture();if(i){var n=this._caps.textureAnisotropicFilterExtension,o=r.anisotropicFilteringLevel;i.samplingMode!==e.TEXTURE_LINEAR_LINEAR_MIPNEAREST&&i.samplingMode!==e.TEXTURE_LINEAR_LINEAR_MIPLINEAR&&i.samplingMode!==e.TEXTURE_LINEAR_LINEAR&&(o=1),n&&i._cachedAnisotropicFilteringLevel!==o&&(this._setTextureParameterFloat(t,n.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(o,this._caps.maxAnisotropy),i),i._cachedAnisotropicFilteringLevel=o)}},e.prototype._setTextureParameterFloat=function(e,t,r,i){this._bindTextureDirectly(e,i,!0,!0),this._gl.texParameterf(e,t,r)},e.prototype._setTextureParameterInteger=function(e,t,r,i){i&&this._bindTextureDirectly(e,i,!0,!0),this._gl.texParameteri(e,t,r)},e.prototype.readPixels=function(e,t,r,i){var n=new Uint8Array(i*r*4);return this._gl.readPixels(e,t,r,i,this._gl.RGBA,this._gl.UNSIGNED_BYTE,n),n},e.prototype.addExternalData=function(e,t){return this._externalData||(this._externalData=new s.a),this._externalData.add(e,t)},e.prototype.getExternalData=function(e){return this._externalData||(this._externalData=new s.a),this._externalData.get(e)},e.prototype.getOrAddExternalDataWithFactory=function(e,t){return this._externalData||(this._externalData=new s.a),this._externalData.getOrAddWithFactory(e,t)},e.prototype.removeExternalData=function(e){return this._externalData||(this._externalData=new s.a),this._externalData.remove(e)},e.prototype.unbindAllAttributes=function(){if(this._mustWipeVertexAttributes){this._mustWipeVertexAttributes=!1;for(var e=0;e<this._caps.maxVertexAttribs;e++)this._gl.disableVertexAttribArray(e),this._vertexAttribArraysEnabled[e]=!1,this._currentBufferPointers[e].active=!1}else{e=0;for(var t=this._vertexAttribArraysEnabled.length;e<t;e++)e>=this._caps.maxVertexAttribs||!this._vertexAttribArraysEnabled[e]||(this._gl.disableVertexAttribArray(e),this._vertexAttribArraysEnabled[e]=!1,this._currentBufferPointers[e].active=!1)}},e.prototype.releaseEffects=function(){for(var e in this._compiledEffects)this._deleteProgram(this._compiledEffects[e]._program);this._compiledEffects={}},e.prototype.dispose=function(){for(this.hideLoadingUI(),this.stopRenderLoop(),this.onNewSceneAddedObservable.clear();this.postProcesses.length;)this.postProcesses[0].dispose();for(this._emptyTexture&&(this._releaseTexture(this._emptyTexture),this._emptyTexture=null),this._emptyCubeTexture&&(this._releaseTexture(this._emptyCubeTexture),this._emptyCubeTexture=null),this._rescalePostProcess&&this._rescalePostProcess.dispose();this.scenes.length;)this.scenes[0].dispose();1===e.Instances.length&&e.audioEngine&&e.audioEngine.dispose(),this.releaseEffects(),this.unbindAllAttributes(),this._boundUniforms=[],this._dummyFramebuffer&&this._gl.deleteFramebuffer(this._dummyFramebuffer),this.disableVR(),T.a.IsWindowObjectExist()&&(window.removeEventListener("blur",this._onBlur),window.removeEventListener("focus",this._onFocus),window.removeEventListener("vrdisplaypointerrestricted",this._onVRDisplayPointerRestricted),window.removeEventListener("vrdisplaypointerunrestricted",this._onVRDisplayPointerUnrestricted),this._renderingCanvas&&(this._renderingCanvas.removeEventListener("focus",this._onCanvasFocus),this._renderingCanvas.removeEventListener("blur",this._onCanvasBlur),this._renderingCanvas.removeEventListener("pointerout",this._onCanvasPointerOut),this._doNotHandleContextLost||(this._renderingCanvas.removeEventListener("webglcontextlost",this._onContextLost),this._renderingCanvas.removeEventListener("webglcontextrestored",this._onContextRestored))),document.removeEventListener("fullscreenchange",this._onFullscreenChange),document.removeEventListener("mozfullscreenchange",this._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",this._onFullscreenChange),document.removeEventListener("msfullscreenchange",this._onFullscreenChange),document.removeEventListener("pointerlockchange",this._onPointerLockChange),document.removeEventListener("mspointerlockchange",this._onPointerLockChange),document.removeEventListener("mozpointerlockchange",this._onPointerLockChange),document.removeEventListener("webkitpointerlockchange",this._onPointerLockChange),this._onVrDisplayConnect&&(window.removeEventListener("vrdisplayconnect",this._onVrDisplayConnect),this._onVrDisplayDisconnect&&window.removeEventListener("vrdisplaydisconnect",this._onVrDisplayDisconnect),this._onVrDisplayPresentChange&&window.removeEventListener("vrdisplaypresentchange",this._onVrDisplayPresentChange),this._onVrDisplayConnect=null,this._onVrDisplayDisconnect=null));var t=e.Instances.indexOf(this);t>=0&&e.Instances.splice(t,1),this._workingCanvas=null,this._workingContext=null,this._currentBufferPointers=[],this._renderingCanvas=null,this._currentProgram=null,this._bindedRenderFunction=null,this.onResizeObservable.clear(),this.onCanvasBlurObservable.clear(),this.onCanvasFocusObservable.clear(),this.onCanvasPointerOutObservable.clear(),this.onBeginFrameObservable.clear(),this.onEndFrameObservable.clear(),l.a.ResetCache();for(var r=0,i=this._activeRequests;r<i.length;r++){i[r].abort()}},e.prototype.displayLoadingUI=function(){if(T.a.IsWindowObjectExist()){var e=this.loadingScreen;e&&e.displayLoadingUI()}},e.prototype.hideLoadingUI=function(){if(T.a.IsWindowObjectExist()){var e=this.loadingScreen;e&&e.hideLoadingUI()}},Object.defineProperty(e.prototype,"loadingScreen",{get:function(){return!this._loadingScreen&&this._renderingCanvas&&(this._loadingScreen=e.DefaultLoadingScreenFactory(this._renderingCanvas)),this._loadingScreen},set:function(e){this._loadingScreen=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"loadingUIText",{set:function(e){this.loadingScreen.loadingUIText=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"loadingUIBackgroundColor",{set:function(e){this.loadingScreen.loadingUIBackgroundColor=e},enumerable:!0,configurable:!0}),e.prototype.attachContextLostEvent=function(e){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextlost",e,!1)},e.prototype.attachContextRestoredEvent=function(e){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextrestored",e,!1)},e.prototype.getVertexShaderSource=function(e){var t=this._gl.getAttachedShaders(e);return t?this._gl.getShaderSource(t[0]):null},e.prototype.getFragmentShaderSource=function(e){var t=this._gl.getAttachedShaders(e);return t?this._gl.getShaderSource(t[1]):null},e.prototype.getError=function(){return this._gl.getError()},e.prototype.getFps=function(){return this._fps},e.prototype.getDeltaTime=function(){return this._deltaTime},e.prototype._measureFps=function(){this._performanceMonitor.sampleFrame(),this._fps=this._performanceMonitor.averageFPS,this._deltaTime=this._performanceMonitor.instantaneousFrameTime||0},e.prototype._readTexturePixels=function(e,t,r,i,n,o){void 0===i&&(i=-1),void 0===n&&(n=0),void 0===o&&(o=null);var s=this._gl;if(!this._dummyFramebuffer){var a=s.createFramebuffer();if(!a)throw new Error("Unable to create dummy framebuffer");this._dummyFramebuffer=a}s.bindFramebuffer(s.FRAMEBUFFER,this._dummyFramebuffer),i>-1?s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_CUBE_MAP_POSITIVE_X+i,e._webGLTexture,n):s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,e._webGLTexture,n);var h=void 0!==e.type?this._getWebGLTextureType(e.type):s.UNSIGNED_BYTE;switch(h){case s.UNSIGNED_BYTE:o||(o=new Uint8Array(4*t*r)),h=s.UNSIGNED_BYTE;break;default:o||(o=new Float32Array(4*t*r)),h=s.FLOAT}return s.readPixels(0,0,t,r,s.RGBA,h,o),s.bindFramebuffer(s.FRAMEBUFFER,this._currentFramebuffer),o},e.prototype._canRenderToFloatFramebuffer=function(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(e.TEXTURETYPE_FLOAT)},e.prototype._canRenderToHalfFloatFramebuffer=function(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(e.TEXTURETYPE_HALF_FLOAT)},e.prototype._canRenderToFramebuffer=function(e){for(var t=this._gl;t.getError()!==t.NO_ERROR;);var r=!0,i=t.createTexture();t.bindTexture(t.TEXTURE_2D,i),t.texImage2D(t.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(e),1,1,0,t.RGBA,this._getWebGLTextureType(e),null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST);var n=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,n),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,i,0);var o=t.checkFramebufferStatus(t.FRAMEBUFFER);if((r=(r=r&&o===t.FRAMEBUFFER_COMPLETE)&&t.getError()===t.NO_ERROR)&&(t.clear(t.COLOR_BUFFER_BIT),r=r&&t.getError()===t.NO_ERROR),r){t.bindFramebuffer(t.FRAMEBUFFER,null);var s=t.RGBA,a=t.UNSIGNED_BYTE,h=new Uint8Array(4);t.readPixels(0,0,1,1,s,a,h),r=r&&t.getError()===t.NO_ERROR}for(t.deleteTexture(i),t.deleteFramebuffer(n),t.bindFramebuffer(t.FRAMEBUFFER,null);!r&&t.getError()!==t.NO_ERROR;);return r},e.prototype._getWebGLTextureType=function(t){if(1===this._webGLVersion){switch(t){case e.TEXTURETYPE_FLOAT:return this._gl.FLOAT;case e.TEXTURETYPE_HALF_FLOAT:return this._gl.HALF_FLOAT_OES;case e.TEXTURETYPE_UNSIGNED_BYTE:return this._gl.UNSIGNED_BYTE}return this._gl.UNSIGNED_BYTE}switch(t){case e.TEXTURETYPE_BYTE:return this._gl.BYTE;case e.TEXTURETYPE_UNSIGNED_BYTE:return this._gl.UNSIGNED_BYTE;case e.TEXTURETYPE_SHORT:return this._gl.SHORT;case e.TEXTURETYPE_UNSIGNED_SHORT:return this._gl.UNSIGNED_SHORT;case e.TEXTURETYPE_INT:return this._gl.INT;case e.TEXTURETYPE_UNSIGNED_INTEGER:return this._gl.UNSIGNED_INT;case e.TEXTURETYPE_FLOAT:return this._gl.FLOAT;case e.TEXTURETYPE_HALF_FLOAT:return this._gl.HALF_FLOAT;case e.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4:return this._gl.UNSIGNED_SHORT_4_4_4_4;case e.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1:return this._gl.UNSIGNED_SHORT_5_5_5_1;case e.TEXTURETYPE_UNSIGNED_SHORT_5_6_5:return this._gl.UNSIGNED_SHORT_5_6_5;case e.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV:return this._gl.UNSIGNED_INT_2_10_10_10_REV;case e.TEXTURETYPE_UNSIGNED_INT_24_8:return this._gl.UNSIGNED_INT_24_8;case e.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV:return this._gl.UNSIGNED_INT_10F_11F_11F_REV;case e.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV:return this._gl.UNSIGNED_INT_5_9_9_9_REV;case e.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV:return this._gl.FLOAT_32_UNSIGNED_INT_24_8_REV}return this._gl.UNSIGNED_BYTE},e.prototype._getInternalFormat=function(t){var r=this._gl.RGBA;switch(t){case e.TEXTUREFORMAT_ALPHA:r=this._gl.ALPHA;break;case e.TEXTUREFORMAT_LUMINANCE:r=this._gl.LUMINANCE;break;case e.TEXTUREFORMAT_LUMINANCE_ALPHA:r=this._gl.LUMINANCE_ALPHA;break;case e.TEXTUREFORMAT_RED:r=this._gl.RED;break;case e.TEXTUREFORMAT_RG:r=this._gl.RG;break;case e.TEXTUREFORMAT_RGB:r=this._gl.RGB;break;case e.TEXTUREFORMAT_RGBA:r=this._gl.RGBA}if(this._webGLVersion>1)switch(t){case e.TEXTUREFORMAT_RED_INTEGER:r=this._gl.RED_INTEGER;break;case e.TEXTUREFORMAT_RG_INTEGER:r=this._gl.RG_INTEGER;break;case e.TEXTUREFORMAT_RGB_INTEGER:r=this._gl.RGB_INTEGER;break;case e.TEXTUREFORMAT_RGBA_INTEGER:r=this._gl.RGBA_INTEGER}return r},e.prototype._getRGBABufferInternalSizedFormat=function(t,r){if(1===this._webGLVersion){if(void 0!==r)switch(r){case e.TEXTUREFORMAT_ALPHA:return this._gl.ALPHA;case e.TEXTUREFORMAT_LUMINANCE:return this._gl.LUMINANCE;case e.TEXTUREFORMAT_LUMINANCE_ALPHA:return this._gl.LUMINANCE_ALPHA}return this._gl.RGBA}switch(t){case e.TEXTURETYPE_BYTE:switch(r){case e.TEXTUREFORMAT_RED:return this._gl.R8_SNORM;case e.TEXTUREFORMAT_RG:return this._gl.RG8_SNORM;case e.TEXTUREFORMAT_RGB:return this._gl.RGB8_SNORM;case e.TEXTUREFORMAT_RED_INTEGER:return this._gl.R8I;case e.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG8I;case e.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB8I;case e.TEXTUREFORMAT_RGBA_INTEGER:return this._gl.RGBA8I;default:return this._gl.RGBA8_SNORM}case e.TEXTURETYPE_UNSIGNED_BYTE:switch(r){case e.TEXTUREFORMAT_RED:return this._gl.R8;case e.TEXTUREFORMAT_RG:return this._gl.RG8;case e.TEXTUREFORMAT_RGB:return this._gl.RGB8;case e.TEXTUREFORMAT_RGBA:return this._gl.RGBA8;case e.TEXTUREFORMAT_RED_INTEGER:return this._gl.R8UI;case e.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG8UI;case e.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB8UI;case e.TEXTUREFORMAT_RGBA_INTEGER:return this._gl.RGBA8UI;default:return this._gl.RGBA8}case e.TEXTURETYPE_SHORT:switch(r){case e.TEXTUREFORMAT_RED_INTEGER:return this._gl.R16I;case e.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG16I;case e.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB16I;case e.TEXTUREFORMAT_RGBA_INTEGER:default:return this._gl.RGBA16I}case e.TEXTURETYPE_UNSIGNED_SHORT:switch(r){case e.TEXTUREFORMAT_RED_INTEGER:return this._gl.R16UI;case e.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG16UI;case e.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB16UI;case e.TEXTUREFORMAT_RGBA_INTEGER:default:return this._gl.RGBA16UI}case e.TEXTURETYPE_INT:switch(r){case e.TEXTUREFORMAT_RED_INTEGER:return this._gl.R32I;case e.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG32I;case e.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB32I;case e.TEXTUREFORMAT_RGBA_INTEGER:default:return this._gl.RGBA32I}case e.TEXTURETYPE_UNSIGNED_INTEGER:switch(r){case e.TEXTUREFORMAT_RED_INTEGER:return this._gl.R32UI;case e.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG32UI;case e.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB32UI;case e.TEXTUREFORMAT_RGBA_INTEGER:default:return this._gl.RGBA32UI}case e.TEXTURETYPE_FLOAT:switch(r){case e.TEXTUREFORMAT_RED:return this._gl.R32F;case e.TEXTUREFORMAT_RG:return this._gl.RG32F;case e.TEXTUREFORMAT_RGB:return this._gl.RGB32F;case e.TEXTUREFORMAT_RGBA:default:return this._gl.RGBA32F}case e.TEXTURETYPE_HALF_FLOAT:switch(r){case e.TEXTUREFORMAT_RED:return this._gl.R16F;case e.TEXTUREFORMAT_RG:return this._gl.RG16F;case e.TEXTUREFORMAT_RGB:return this._gl.RGB16F;case e.TEXTUREFORMAT_RGBA:default:return this._gl.RGBA16F}case e.TEXTURETYPE_UNSIGNED_SHORT_5_6_5:return this._gl.RGB565;case e.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV:return this._gl.R11F_G11F_B10F;case e.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV:return this._gl.RGB9_E5;case e.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4:return this._gl.RGBA4;case e.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1:return this._gl.RGB5_A1;case e.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV:switch(r){case e.TEXTUREFORMAT_RGBA:return this._gl.RGB10_A2;case e.TEXTUREFORMAT_RGBA_INTEGER:return this._gl.RGB10_A2UI;default:return this._gl.RGB10_A2}}return this._gl.RGBA8},e.prototype._getRGBAMultiSampleBufferFormat=function(t){return t===e.TEXTURETYPE_FLOAT?this._gl.RGBA32F:t===e.TEXTURETYPE_HALF_FLOAT?this._gl.RGBA16F:this._gl.RGBA8},e.prototype._loadFile=function(e,t,r,i,n,o){var s=this,a=h.h.LoadFile(e,t,r,i,n,o);return this._activeRequests.push(a),a.onCompleteObservable.add(function(e){s._activeRequests.splice(s._activeRequests.indexOf(e),1)}),a},e.prototype._loadFileAsync=function(e,t,r){var i=this;return new Promise(function(n,o){i._loadFile(e,function(e){n(e)},void 0,t,r,function(e,t){o(t)})})},e.prototype._partialLoadFile=function(e,t,r,i,n){void 0===n&&(n=null);this._loadFile(e,function(e){r[t]=e,r._internalCount++,6===r._internalCount&&i(r)},void 0,void 0,!0,function(e,t){n&&e&&n(e.status+" "+e.statusText,t)})},e.prototype._cascadeLoadFiles=function(e,t,r,i){void 0===i&&(i=null);var n=[];n._internalCount=0;for(var o=0;o<6;o++)this._partialLoadFile(r[o],o,n,t,i)},e.isSupported=function(){try{var e=document.createElement("canvas");return null!=(e.getContext("webgl")||e.getContext("experimental-webgl"))&&!!window.WebGLRenderingContext}catch(e){return!1}},e.ExceptionList=[{key:"Chrome/63.0",capture:"63\\.0\\.3239\\.(\\d+)",captureConstraint:108,targets:["uniformBuffer"]},{key:"Firefox/58",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Firefox/59",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Macintosh",capture:null,captureConstraint:null,targets:["textureBindingOptimization"]},{key:"iPhone",capture:null,captureConstraint:null,targets:["textureBindingOptimization"]},{key:"iPad",capture:null,captureConstraint:null,targets:["textureBindingOptimization"]}],e._TextureLoaders=[],e.ALPHA_DISABLE=f.a.ALPHA_DISABLE,e.ALPHA_ADD=f.a.ALPHA_ADD,e.ALPHA_COMBINE=f.a.ALPHA_COMBINE,e.ALPHA_SUBTRACT=f.a.ALPHA_SUBTRACT,e.ALPHA_MULTIPLY=f.a.ALPHA_MULTIPLY,e.ALPHA_MAXIMIZED=f.a.ALPHA_MAXIMIZED,e.ALPHA_ONEONE=f.a.ALPHA_ONEONE,e.ALPHA_PREMULTIPLIED=f.a.ALPHA_PREMULTIPLIED,e.ALPHA_PREMULTIPLIED_PORTERDUFF=f.a.ALPHA_PREMULTIPLIED_PORTERDUFF,e.ALPHA_INTERPOLATE=f.a.ALPHA_INTERPOLATE,e.ALPHA_SCREENMODE=f.a.ALPHA_SCREENMODE,e.DELAYLOADSTATE_NONE=f.a.DELAYLOADSTATE_NONE,e.DELAYLOADSTATE_LOADED=f.a.DELAYLOADSTATE_LOADED,e.DELAYLOADSTATE_LOADING=f.a.DELAYLOADSTATE_LOADING,e.DELAYLOADSTATE_NOTLOADED=f.a.DELAYLOADSTATE_NOTLOADED,e.NEVER=f.a.NEVER,e.ALWAYS=f.a.ALWAYS,e.LESS=f.a.LESS,e.EQUAL=f.a.EQUAL,e.LEQUAL=f.a.LEQUAL,e.GREATER=f.a.GREATER,e.GEQUAL=f.a.GEQUAL,e.NOTEQUAL=f.a.NOTEQUAL,e.KEEP=f.a.KEEP,e.REPLACE=f.a.REPLACE,e.INCR=f.a.INCR,e.DECR=f.a.DECR,e.INVERT=f.a.INVERT,e.INCR_WRAP=f.a.INCR_WRAP,e.DECR_WRAP=f.a.DECR_WRAP,e.TEXTURE_CLAMP_ADDRESSMODE=f.a.TEXTURE_CLAMP_ADDRESSMODE,e.TEXTURE_WRAP_ADDRESSMODE=f.a.TEXTURE_WRAP_ADDRESSMODE,e.TEXTURE_MIRROR_ADDRESSMODE=f.a.TEXTURE_MIRROR_ADDRESSMODE,e.TEXTUREFORMAT_ALPHA=f.a.TEXTUREFORMAT_ALPHA,e.TEXTUREFORMAT_LUMINANCE=f.a.TEXTUREFORMAT_LUMINANCE,e.TEXTUREFORMAT_LUMINANCE_ALPHA=f.a.TEXTUREFORMAT_LUMINANCE_ALPHA,e.TEXTUREFORMAT_RGB=f.a.TEXTUREFORMAT_RGB,e.TEXTUREFORMAT_RGBA=f.a.TEXTUREFORMAT_RGBA,e.TEXTUREFORMAT_RED=f.a.TEXTUREFORMAT_RED,e.TEXTUREFORMAT_R=f.a.TEXTUREFORMAT_R,e.TEXTUREFORMAT_RG=f.a.TEXTUREFORMAT_RG,e.TEXTUREFORMAT_RED_INTEGER=f.a.TEXTUREFORMAT_RED_INTEGER,e.TEXTUREFORMAT_R_INTEGER=f.a.TEXTUREFORMAT_R_INTEGER,e.TEXTUREFORMAT_RG_INTEGER=f.a.TEXTUREFORMAT_RG_INTEGER,e.TEXTUREFORMAT_RGB_INTEGER=f.a.TEXTUREFORMAT_RGB_INTEGER,e.TEXTUREFORMAT_RGBA_INTEGER=f.a.TEXTUREFORMAT_RGBA_INTEGER,e.TEXTURETYPE_UNSIGNED_BYTE=f.a.TEXTURETYPE_UNSIGNED_BYTE,e.TEXTURETYPE_UNSIGNED_INT=f.a.TEXTURETYPE_UNSIGNED_INT,e.TEXTURETYPE_FLOAT=f.a.TEXTURETYPE_FLOAT,e.TEXTURETYPE_HALF_FLOAT=f.a.TEXTURETYPE_HALF_FLOAT,e.TEXTURETYPE_BYTE=f.a.TEXTURETYPE_BYTE,e.TEXTURETYPE_SHORT=f.a.TEXTURETYPE_SHORT,e.TEXTURETYPE_UNSIGNED_SHORT=f.a.TEXTURETYPE_UNSIGNED_SHORT,e.TEXTURETYPE_INT=f.a.TEXTURETYPE_INT,e.TEXTURETYPE_UNSIGNED_INTEGER=f.a.TEXTURETYPE_UNSIGNED_INTEGER,e.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=f.a.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4,e.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=f.a.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1,e.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=f.a.TEXTURETYPE_UNSIGNED_SHORT_5_6_5,e.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=f.a.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV,e.TEXTURETYPE_UNSIGNED_INT_24_8=f.a.TEXTURETYPE_UNSIGNED_INT_24_8,e.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=f.a.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV,e.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=f.a.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV,e.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=f.a.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV,e.TEXTURE_NEAREST_SAMPLINGMODE=f.a.TEXTURE_NEAREST_SAMPLINGMODE,e.TEXTURE_BILINEAR_SAMPLINGMODE=f.a.TEXTURE_BILINEAR_SAMPLINGMODE,e.TEXTURE_TRILINEAR_SAMPLINGMODE=f.a.TEXTURE_TRILINEAR_SAMPLINGMODE,e.TEXTURE_NEAREST_NEAREST_MIPLINEAR=f.a.TEXTURE_NEAREST_NEAREST_MIPLINEAR,e.TEXTURE_LINEAR_LINEAR_MIPNEAREST=f.a.TEXTURE_LINEAR_LINEAR_MIPNEAREST,e.TEXTURE_LINEAR_LINEAR_MIPLINEAR=f.a.TEXTURE_LINEAR_LINEAR_MIPLINEAR,e.TEXTURE_NEAREST_NEAREST_MIPNEAREST=f.a.TEXTURE_NEAREST_NEAREST_MIPNEAREST,e.TEXTURE_NEAREST_LINEAR_MIPNEAREST=f.a.TEXTURE_NEAREST_LINEAR_MIPNEAREST,e.TEXTURE_NEAREST_LINEAR_MIPLINEAR=f.a.TEXTURE_NEAREST_LINEAR_MIPLINEAR,e.TEXTURE_NEAREST_LINEAR=f.a.TEXTURE_NEAREST_LINEAR,e.TEXTURE_NEAREST_NEAREST=f.a.TEXTURE_NEAREST_NEAREST,e.TEXTURE_LINEAR_NEAREST_MIPNEAREST=f.a.TEXTURE_LINEAR_NEAREST_MIPNEAREST,e.TEXTURE_LINEAR_NEAREST_MIPLINEAR=f.a.TEXTURE_LINEAR_NEAREST_MIPLINEAR,e.TEXTURE_LINEAR_LINEAR=f.a.TEXTURE_LINEAR_LINEAR,e.TEXTURE_LINEAR_NEAREST=f.a.TEXTURE_LINEAR_NEAREST,e.TEXTURE_EXPLICIT_MODE=f.a.TEXTURE_EXPLICIT_MODE,e.TEXTURE_SPHERICAL_MODE=f.a.TEXTURE_SPHERICAL_MODE,e.TEXTURE_PLANAR_MODE=f.a.TEXTURE_PLANAR_MODE,e.TEXTURE_CUBIC_MODE=f.a.TEXTURE_CUBIC_MODE,e.TEXTURE_PROJECTION_MODE=f.a.TEXTURE_PROJECTION_MODE,e.TEXTURE_SKYBOX_MODE=f.a.TEXTURE_SKYBOX_MODE,e.TEXTURE_INVCUBIC_MODE=f.a.TEXTURE_INVCUBIC_MODE,e.TEXTURE_EQUIRECTANGULAR_MODE=f.a.TEXTURE_EQUIRECTANGULAR_MODE,e.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=f.a.TEXTURE_FIXED_EQUIRECTANGULAR_MODE,e.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=f.a.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE,e.SCALEMODE_FLOOR=f.a.SCALEMODE_FLOOR,e.SCALEMODE_NEAREST=f.a.SCALEMODE_NEAREST,e.SCALEMODE_CEILING=f.a.SCALEMODE_CEILING,e.CollisionsEpsilon=.001,e._RescalePostProcessFactory=null,e}()},116:function(e,t,r){"use strict";r.d(t,"a",function(){return i}),r.d(t,"b",function(){return n}),r.d(t,"c",function(){return h});var i,n,o=r(1),s=r(7),a=r(52);!function(e){e[e.A=0]="A",e[e.B=1]="B",e[e.X=2]="X",e[e.Y=3]="Y",e[e.Start=4]="Start",e[e.Back=5]="Back",e[e.LB=6]="LB",e[e.RB=7]="RB",e[e.LeftStick=8]="LeftStick",e[e.RightStick=9]="RightStick"}(i||(i={})),function(e){e[e.Up=0]="Up",e[e.Down=1]="Down",e[e.Left=2]="Left",e[e.Right=3]="Right"}(n||(n={}));var h=function(e){function t(t,r,i,n){void 0===n&&(n=!1);var o=e.call(this,t,r,i,0,1,2,3)||this;return o._leftTrigger=0,o._rightTrigger=0,o.onButtonDownObservable=new s.c,o.onButtonUpObservable=new s.c,o.onPadDownObservable=new s.c,o.onPadUpObservable=new s.c,o._buttonA=0,o._buttonB=0,o._buttonX=0,o._buttonY=0,o._buttonBack=0,o._buttonStart=0,o._buttonLB=0,o._buttonRB=0,o._buttonLeftStick=0,o._buttonRightStick=0,o._dPadUp=0,o._dPadDown=0,o._dPadLeft=0,o._dPadRight=0,o._isXboxOnePad=!1,o.type=a.a.XBOX,o._isXboxOnePad=n,o}return o.d(t,e),t.prototype.onlefttriggerchanged=function(e){this._onlefttriggerchanged=e},t.prototype.onrighttriggerchanged=function(e){this._onrighttriggerchanged=e},Object.defineProperty(t.prototype,"leftTrigger",{get:function(){return this._leftTrigger},set:function(e){this._onlefttriggerchanged&&this._leftTrigger!==e&&this._onlefttriggerchanged(e),this._leftTrigger=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rightTrigger",{get:function(){return this._rightTrigger},set:function(e){this._onrighttriggerchanged&&this._rightTrigger!==e&&this._onrighttriggerchanged(e),this._rightTrigger=e},enumerable:!0,configurable:!0}),t.prototype.onbuttondown=function(e){this._onbuttondown=e},t.prototype.onbuttonup=function(e){this._onbuttonup=e},t.prototype.ondpaddown=function(e){this._ondpaddown=e},t.prototype.ondpadup=function(e){this._ondpadup=e},t.prototype._setButtonValue=function(e,t,r){return e!==t&&(1===e&&(this._onbuttondown&&this._onbuttondown(r),this.onButtonDownObservable.notifyObservers(r)),0===e&&(this._onbuttonup&&this._onbuttonup(r),this.onButtonUpObservable.notifyObservers(r))),e},t.prototype._setDPadValue=function(e,t,r){return e!==t&&(1===e&&(this._ondpaddown&&this._ondpaddown(r),this.onPadDownObservable.notifyObservers(r)),0===e&&(this._ondpadup&&this._ondpadup(r),this.onPadUpObservable.notifyObservers(r))),e},Object.defineProperty(t.prototype,"buttonA",{get:function(){return this._buttonA},set:function(e){this._buttonA=this._setButtonValue(e,this._buttonA,i.A)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttonB",{get:function(){return this._buttonB},set:function(e){this._buttonB=this._setButtonValue(e,this._buttonB,i.B)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttonX",{get:function(){return this._buttonX},set:function(e){this._buttonX=this._setButtonValue(e,this._buttonX,i.X)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttonY",{get:function(){return this._buttonY},set:function(e){this._buttonY=this._setButtonValue(e,this._buttonY,i.Y)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttonStart",{get:function(){return this._buttonStart},set:function(e){this._buttonStart=this._setButtonValue(e,this._buttonStart,i.Start)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttonBack",{get:function(){return this._buttonBack},set:function(e){this._buttonBack=this._setButtonValue(e,this._buttonBack,i.Back)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttonLB",{get:function(){return this._buttonLB},set:function(e){this._buttonLB=this._setButtonValue(e,this._buttonLB,i.LB)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttonRB",{get:function(){return this._buttonRB},set:function(e){this._buttonRB=this._setButtonValue(e,this._buttonRB,i.RB)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttonLeftStick",{get:function(){return this._buttonLeftStick},set:function(e){this._buttonLeftStick=this._setButtonValue(e,this._buttonLeftStick,i.LeftStick)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttonRightStick",{get:function(){return this._buttonRightStick},set:function(e){this._buttonRightStick=this._setButtonValue(e,this._buttonRightStick,i.RightStick)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dPadUp",{get:function(){return this._dPadUp},set:function(e){this._dPadUp=this._setDPadValue(e,this._dPadUp,n.Up)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dPadDown",{get:function(){return this._dPadDown},set:function(e){this._dPadDown=this._setDPadValue(e,this._dPadDown,n.Down)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dPadLeft",{get:function(){return this._dPadLeft},set:function(e){this._dPadLeft=this._setDPadValue(e,this._dPadLeft,n.Left)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dPadRight",{get:function(){return this._dPadRight},set:function(e){this._dPadRight=this._setDPadValue(e,this._dPadRight,n.Right)},enumerable:!0,configurable:!0}),t.prototype.update=function(){e.prototype.update.call(this),this._isXboxOnePad?(this.buttonA=this.browserGamepad.buttons[0].value,this.buttonB=this.browserGamepad.buttons[1].value,this.buttonX=this.browserGamepad.buttons[2].value,this.buttonY=this.browserGamepad.buttons[3].value,this.buttonLB=this.browserGamepad.buttons[4].value,this.buttonRB=this.browserGamepad.buttons[5].value,this.leftTrigger=this.browserGamepad.axes[2],this.rightTrigger=this.browserGamepad.axes[5],this.buttonBack=this.browserGamepad.buttons[9].value,this.buttonStart=this.browserGamepad.buttons[8].value,this.buttonLeftStick=this.browserGamepad.buttons[6].value,this.buttonRightStick=this.browserGamepad.buttons[7].value,this.dPadUp=this.browserGamepad.buttons[11].value,this.dPadDown=this.browserGamepad.buttons[12].value,this.dPadLeft=this.browserGamepad.buttons[13].value,this.dPadRight=this.browserGamepad.buttons[14].value):(this.buttonA=this.browserGamepad.buttons[0].value,this.buttonB=this.browserGamepad.buttons[1].value,this.buttonX=this.browserGamepad.buttons[2].value,this.buttonY=this.browserGamepad.buttons[3].value,this.buttonLB=this.browserGamepad.buttons[4].value,this.buttonRB=this.browserGamepad.buttons[5].value,this.leftTrigger=this.browserGamepad.buttons[6].value,this.rightTrigger=this.browserGamepad.buttons[7].value,this.buttonBack=this.browserGamepad.buttons[8].value,this.buttonStart=this.browserGamepad.buttons[9].value,this.buttonLeftStick=this.browserGamepad.buttons[10].value,this.buttonRightStick=this.browserGamepad.buttons[11].value,this.dPadUp=this.browserGamepad.buttons[12].value,this.dPadDown=this.browserGamepad.buttons[13].value,this.dPadLeft=this.browserGamepad.buttons[14].value,this.dPadRight=this.browserGamepad.buttons[15].value)},t.prototype.dispose=function(){e.prototype.dispose.call(this),this.onButtonDownObservable.clear(),this.onButtonUpObservable.clear(),this.onPadDownObservable.clear(),this.onPadUpObservable.clear()},t}(a.a)},13:function(e,t,r){"use strict";r.d(t,"a",function(){return o}),r.d(t,"c",function(){return s}),r.d(t,"d",function(){return a}),r.d(t,"b",function(){return h});var i=r(1),n=r(0),o=function(){function e(){}return e.POINTERDOWN=1,e.POINTERUP=2,e.POINTERMOVE=4,e.POINTERWHEEL=8,e.POINTERPICK=16,e.POINTERTAP=32,e.POINTERDOUBLETAP=64,e}(),s=function(){return function(e,t){this.type=e,this.event=t}}(),a=function(e){function t(t,r,i,o){var s=e.call(this,t,r)||this;return s.ray=null,s.skipOnPointerObservable=!1,s.localPosition=new n.Vector2(i,o),s}return i.d(t,e),t}(s),h=function(e){function t(t,r,i){var n=e.call(this,t,r)||this;return n.pickInfo=i,n}return i.d(t,e),t}(s)},191:function(e,t,r){"use strict";r.d(t,"a",function(){return i});var i=function(){return function(){this._timeElapsedQueryEnded=!1}}()},21:function(e,t,r){"use strict";r.d(t,"a",function(){return i});var i=function(){function e(){}return Object.defineProperty(e,"LastCreatedEngine",{get:function(){return 0===this.Instances.length?null:this.Instances[this.Instances.length-1]},enumerable:!0,configurable:!0}),Object.defineProperty(e,"LastCreatedScene",{get:function(){var e=this.LastCreatedEngine;return e?0===e.scenes.length?null:e.scenes[e.scenes.length-1]:null},enumerable:!0,configurable:!0}),e.Instances=new Array,e}()},225:function(e,t,r){"use strict";var i=r(57);r.d(t,"c",function(){return i.a}),r.d(t,"d",function(){return i.b}),r.d(t,"e",function(){return i.c});var n=r(13);r.d(t,"f",function(){return n.a}),r.d(t,"g",function(){return n.b}),r.d(t,"h",function(){return n.c}),r.d(t,"i",function(){return n.d});var o=r(75);r.d(t,"a",function(){return o.a}),r.d(t,"b",function(){return o.b})},248:function(e,t,r){"use strict";var i=r(1),n=r(9),o=r(29),s=r(61),a=r(42),h=function(e){function t(t){var r=e.call(this,t)||this;return r.controllerType=a.c.DAYDREAM,r}return i.d(t,e),t.prototype.initControllerMesh=function(e,r){var i=this;o.a.ImportMesh("",t.MODEL_BASE_URL,t.MODEL_FILENAME,e,function(e){i._defaultModel=e[1],i.attachToMesh(i._defaultModel),r&&r(i._defaultModel)})},t.prototype._handleButtonChange=function(e,t,r){if(0===e){var i=this.onTriggerStateChangedObservable;i&&i.notifyObservers(t)}else n.a.Warn("Unrecognized Daydream button index: "+e)},t.MODEL_BASE_URL="https://controllers.babylonjs.com/generic/",t.MODEL_FILENAME="generic.babylon",t.GAMEPAD_ID_PREFIX="Daydream",t}(s.a);a.b._ControllerFactories.push({canCreate:function(e){return 0===e.id.indexOf(h.GAMEPAD_ID_PREFIX)},create:function(e){return new h(e)}});var u=r(0),_=r(10),l=function(e){function t(t){var r=e.call(this,t)||this;return r._buttonIndexToObservableNameMap=["onTrackpadChangedObservable","onTriggerStateChangedObservable"],r.controllerType=a.c.GEAR_VR,r._calculatedPosition=new u.Vector3("left"==r.hand?-.15:.15,-.5,.25),r._disableTrackPosition(r._calculatedPosition),r}return i.d(t,e),t.prototype.initControllerMesh=function(e,r){var i=this;o.a.ImportMesh("",t.MODEL_BASE_URL,t.MODEL_FILENAME,e,function(t){var n=new _.Mesh("",e);t[1].parent=n,t[1].position.z=-.15,i._defaultModel=n,i.attachToMesh(i._defaultModel),r&&r(i._defaultModel)})},t.prototype._handleButtonChange=function(e,t,r){if(e<this._buttonIndexToObservableNameMap.length){var i=this[this._buttonIndexToObservableNameMap[e]];i&&i.notifyObservers(t)}},t.MODEL_BASE_URL="https://controllers.babylonjs.com/generic/",t.MODEL_FILENAME="generic.babylon",t.GAMEPAD_ID_PREFIX="Gear VR",t}(s.a);a.b._ControllerFactories.push({canCreate:function(e){return 0===e.id.indexOf(l.GAMEPAD_ID_PREFIX)||-1!==e.id.indexOf("Oculus Go")},create:function(e){return new l(e)}});var c=function(e){function t(t){return e.call(this,t)||this}return i.d(t,e),t.prototype.initControllerMesh=function(e,r){var i=this;o.a.ImportMesh("",t.MODEL_BASE_URL,t.MODEL_FILENAME,e,function(e){i._defaultModel=e[1],i.attachToMesh(i._defaultModel),r&&r(i._defaultModel)})},t.prototype._handleButtonChange=function(e,t,r){console.log("Button id: "+e+"state: "),console.dir(t)},t.MODEL_BASE_URL="https://controllers.babylonjs.com/generic/",t.MODEL_FILENAME="generic.babylon",t}(s.a);a.b._DefaultControllerFactory=function(e){return new c(e)};var d=r(7),p=function(e){function t(t){var r=e.call(this,t)||this;return r.onSecondaryTriggerStateChangedObservable=new d.c,r.onThumbRestChangedObservable=new d.c,r.controllerType=a.c.OCULUS,r}return i.d(t,e),t.prototype.initControllerMesh=function(e,r){var i,n=this;i="left"===this.hand?t.MODEL_LEFT_FILENAME:t.MODEL_RIGHT_FILENAME,o.a.ImportMesh("",t.MODEL_BASE_URL,i,e,function(e){n._defaultModel=e[1],n.attachToMesh(n._defaultModel),r&&r(n._defaultModel)})},Object.defineProperty(t.prototype,"onAButtonStateChangedObservable",{get:function(){if("right"===this.hand)return this.onMainButtonStateChangedObservable;throw new Error("No A button on left hand")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onBButtonStateChangedObservable",{get:function(){if("right"===this.hand)return this.onSecondaryButtonStateChangedObservable;throw new Error("No B button on left hand")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onXButtonStateChangedObservable",{get:function(){if("left"===this.hand)return this.onMainButtonStateChangedObservable;throw new Error("No X button on right hand")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onYButtonStateChangedObservable",{get:function(){if("left"===this.hand)return this.onSecondaryButtonStateChangedObservable;throw new Error("No Y button on right hand")},enumerable:!0,configurable:!0}),t.prototype._handleButtonChange=function(e,t,r){var i=t,n="right"===this.hand?-1:1;switch(e){case 0:return void this.onPadStateChangedObservable.notifyObservers(i);case 1:return this._defaultModel&&(this._defaultModel.getChildren()[3].rotation.x=.2*-i.value,this._defaultModel.getChildren()[3].position.y=.005*-i.value,this._defaultModel.getChildren()[3].position.z=.005*-i.value),void this.onTriggerStateChangedObservable.notifyObservers(i);case 2:return this._defaultModel&&(this._defaultModel.getChildren()[4].position.x=n*i.value*.0035),void this.onSecondaryTriggerStateChangedObservable.notifyObservers(i);case 3:return this._defaultModel&&(i.pressed?this._defaultModel.getChildren()[1].position.y=-.001:this._defaultModel.getChildren()[1].position.y=0),void this.onMainButtonStateChangedObservable.notifyObservers(i);case 4:return this._defaultModel&&(i.pressed?this._defaultModel.getChildren()[2].position.y=-.001:this._defaultModel.getChildren()[2].position.y=0),void this.onSecondaryButtonStateChangedObservable.notifyObservers(i);case 5:return void this.onThumbRestChangedObservable.notifyObservers(i)}},t.MODEL_BASE_URL="https://controllers.babylonjs.com/oculus/",t.MODEL_LEFT_FILENAME="left.babylon",t.MODEL_RIGHT_FILENAME="right.babylon",t}(s.a);a.b._ControllerFactories.push({canCreate:function(e){return-1!==e.id.indexOf("Oculus Touch")},create:function(e){return new p(e)}});var E=function(e){function t(t){var r=e.call(this,t)||this;return r.controllerType=a.c.VIVE,r._invertLeftStickY=!0,r}return i.d(t,e),t.prototype.initControllerMesh=function(e,r){var i=this;o.a.ImportMesh("",t.MODEL_BASE_URL,t.MODEL_FILENAME,e,function(e){i._defaultModel=e[1],i.attachToMesh(i._defaultModel),r&&r(i._defaultModel)})},Object.defineProperty(t.prototype,"onLeftButtonStateChangedObservable",{get:function(){return this.onMainButtonStateChangedObservable},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onRightButtonStateChangedObservable",{get:function(){return this.onMainButtonStateChangedObservable},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onMenuButtonStateChangedObservable",{get:function(){return this.onSecondaryButtonStateChangedObservable},enumerable:!0,configurable:!0}),t.prototype._handleButtonChange=function(e,t,r){var i=t;switch(e){case 0:return void this.onPadStateChangedObservable.notifyObservers(i);case 1:return this._defaultModel&&(this._defaultModel.getChildren()[6].rotation.x=.15*-i.value),void this.onTriggerStateChangedObservable.notifyObservers(i);case 2:return void this.onMainButtonStateChangedObservable.notifyObservers(i);case 3:return this._defaultModel&&(i.pressed?this._defaultModel.getChildren()[2].position.y=-.001:this._defaultModel.getChildren()[2].position.y=0),void this.onSecondaryButtonStateChangedObservable.notifyObservers(i)}},t.MODEL_BASE_URL="https://controllers.babylonjs.com/vive/",t.MODEL_FILENAME="wand.babylon",t}(s.a);a.b._ControllerFactories.push({canCreate:function(e){return-1!==e.id.toLowerCase().indexOf("openvr")},create:function(e){return new E(e)}});var f=r(35),T=function(){return function(){this.buttonMeshes={},this.axisMeshes={}}}(),g=function(e){function t(t){var r=e.call(this,t)||this;return r._mapping={buttons:["thumbstick","trigger","grip","menu","trackpad"],buttonMeshNames:{trigger:"SELECT",menu:"MENU",grip:"GRASP",thumbstick:"THUMBSTICK_PRESS",trackpad:"TOUCHPAD_PRESS"},buttonObservableNames:{trigger:"onTriggerStateChangedObservable",menu:"onSecondaryButtonStateChangedObservable",grip:"onMainButtonStateChangedObservable",thumbstick:"onPadStateChangedObservable",trackpad:"onTrackpadChangedObservable"},axisMeshNames:["THUMBSTICK_X","THUMBSTICK_Y","TOUCHPAD_TOUCH_X","TOUCHPAD_TOUCH_Y"],pointingPoseMeshName:a.a.POINTING_POSE},r.onTrackpadChangedObservable=new d.c,r.onTrackpadValuesChangedObservable=new d.c,r.trackpad={x:0,y:0},r.controllerType=a.c.WINDOWS,r._loadedMeshInfo=null,r}return i.d(t,e),Object.defineProperty(t.prototype,"onTriggerButtonStateChangedObservable",{get:function(){return this.onTriggerStateChangedObservable},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onMenuButtonStateChangedObservable",{get:function(){return this.onSecondaryButtonStateChangedObservable},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onGripButtonStateChangedObservable",{get:function(){return this.onMainButtonStateChangedObservable},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onThumbstickButtonStateChangedObservable",{get:function(){return this.onPadStateChangedObservable},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onTouchpadButtonStateChangedObservable",{get:function(){return this.onTrackpadChangedObservable},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onTouchpadValuesChangedObservable",{get:function(){return this.onTrackpadValuesChangedObservable},enumerable:!0,configurable:!0}),t.prototype._updateTrackpad=function(){!this.browserGamepad.axes||this.browserGamepad.axes[2]==this.trackpad.x&&this.browserGamepad.axes[3]==this.trackpad.y||(this.trackpad.x=this.browserGamepad.axes[2],this.trackpad.y=this.browserGamepad.axes[3],this.onTrackpadValuesChangedObservable.notifyObservers(this.trackpad))},t.prototype.update=function(){if(e.prototype.update.call(this),this.browserGamepad.axes&&(this._updateTrackpad(),this._loadedMeshInfo))for(var t=0;t<this._mapping.axisMeshNames.length;t++)this._lerpAxisTransform(t,this.browserGamepad.axes[t])},t.prototype._handleButtonChange=function(e,t,r){var i=this._mapping.buttons[e];if(i){this._updateTrackpad();var n=this[this._mapping.buttonObservableNames[i]];n&&n.notifyObservers(t),this._lerpButtonTransform(i,t.value)}},t.prototype._lerpButtonTransform=function(e,t){if(this._loadedMeshInfo){var r=this._loadedMeshInfo.buttonMeshes[e];r.unpressed.rotationQuaternion&&r.pressed.rotationQuaternion&&r.value.rotationQuaternion&&(u.Quaternion.SlerpToRef(r.unpressed.rotationQuaternion,r.pressed.rotationQuaternion,t,r.value.rotationQuaternion),u.Vector3.LerpToRef(r.unpressed.position,r.pressed.position,t,r.value.position))}},t.prototype._lerpAxisTransform=function(e,t){if(this._loadedMeshInfo){var r=this._loadedMeshInfo.axisMeshes[e];if(r&&r.min.rotationQuaternion&&r.max.rotationQuaternion&&r.value.rotationQuaternion){var i=.5*t+.5;u.Quaternion.SlerpToRef(r.min.rotationQuaternion,r.max.rotationQuaternion,i,r.value.rotationQuaternion),u.Vector3.LerpToRef(r.min.position,r.max.position,i,r.value.position)}}},t.prototype.initControllerMesh=function(e,r,i){var s,a,h=this;if(void 0===i&&(i=!1),o.a.IsPluginForExtensionAvailable(".glb")){var u="default";if(this.id&&!i){var _=this.id.match(t.GAMEPAD_ID_PATTERN);u=_&&_[0]||u}a="left"===this.hand?t.MODEL_LEFT_FILENAME:t.MODEL_RIGHT_FILENAME,s=t.MODEL_BASE_URL+u+"/"}else n.a.Warn("You need to reference GLTF loader to load Windows Motion Controllers model. Falling back to generic models"),s=c.MODEL_BASE_URL,a=c.MODEL_FILENAME;o.a.ImportMesh("",s,a,e,function(t){h._loadedMeshInfo=h.processModel(e,t),h._loadedMeshInfo&&(h._defaultModel=h._loadedMeshInfo.rootNode,h.attachToMesh(h._defaultModel),r&&r(h._defaultModel))},null,function(e,t){n.a.Log(t),n.a.Warn("Failed to retrieve controller model from the remote server: "+s+a),i||h.initControllerMesh(e,r,!0)})},t.prototype.processModel=function(e,t){for(var r=null,i=new _.Mesh(this.id+" "+this.hand,e),o=null,s=0;s<t.length;s++){var a=t[s];if(!a.parent){a.isPickable=!1,o=a;break}}return o?(o.setParent(i),r=this.createMeshInfo(i)):n.a.Warn("Could not find root node in model file."),r},t.prototype.createMeshInfo=function(e){var t,r=new T;for(r.rootNode=e,r.buttonMeshes={},r.axisMeshes={},t=0;t<this._mapping.buttons.length;t++){var i=this._mapping.buttonMeshNames[this._mapping.buttons[t]];if(i){var o=_(e,i);if(o){var s={index:t,value:l(o,"VALUE"),pressed:l(o,"PRESSED"),unpressed:l(o,"UNPRESSED")};s.value&&s.pressed&&s.unpressed?r.buttonMeshes[this._mapping.buttons[t]]=s:n.a.Warn("Missing button submesh under mesh with name: "+i+"(VALUE: "+!!s.value+", PRESSED: "+!!s.pressed+", UNPRESSED:"+!!s.unpressed+")")}else n.a.Warn("Missing button mesh with name: "+i)}else n.a.Log("Skipping unknown button at index: "+t+" with mapped name: "+this._mapping.buttons[t])}for(t=0;t<this._mapping.axisMeshNames.length;t++){var a=this._mapping.axisMeshNames[t];if(a){var h=_(e,a);if(h){var u={index:t,value:l(h,"VALUE"),min:l(h,"MIN"),max:l(h,"MAX")};u.value&&u.min&&u.max?r.axisMeshes[t]=u:n.a.Warn("Missing axis submesh under mesh with name: "+a+"(VALUE: "+!!u.value+", MIN: "+!!u.min+", MAX:"+!!u.max+")")}else n.a.Warn("Missing axis mesh with name: "+a)}else n.a.Log("Skipping unknown axis at index: "+t)}return r.pointingPoseNode=_(e,this._mapping.pointingPoseMeshName),r.pointingPoseNode?this._pointingPoseNode=r.pointingPoseNode:n.a.Warn("Missing pointing pose mesh with name: "+this._mapping.pointingPoseMeshName),r;function _(e,t){return e.getChildren(function(e){return e.name===t},!1)[0]}function l(e,t){return e.getChildren(function(e){return e.name==t},!0)[0]}},t.prototype.getForwardRay=function(t){if(void 0===t&&(t=100),!this._loadedMeshInfo||!this._loadedMeshInfo.pointingPoseNode)return e.prototype.getForwardRay.call(this,t);var r=this._loadedMeshInfo.pointingPoseNode.getWorldMatrix(),i=r.getTranslation(),n=new u.Vector3(0,0,-1),o=u.Vector3.TransformNormal(n,r),s=u.Vector3.Normalize(o);return new f.a(i,s,t)},t.prototype.dispose=function(){e.prototype.dispose.call(this),this.onTrackpadChangedObservable.clear()},t.MODEL_BASE_URL="https://controllers.babylonjs.com/microsoft/",t.MODEL_LEFT_FILENAME="left.glb",t.MODEL_RIGHT_FILENAME="right.glb",t.GAMEPAD_ID_PREFIX="Spatial Controller (Spatial Interaction Source) ",t.GAMEPAD_ID_PATTERN=/([0-9a-zA-Z]+-[0-9a-zA-Z]+)$/,t}(s.a);a.b._ControllerFactories.push({canCreate:function(e){return 0===e.id.indexOf(g.GAMEPAD_ID_PREFIX)},create:function(e){return new g(e)}});var b=r(52),m=r(5),R=r(51),y=r(116),A=function(){function e(e){var t=this;this._scene=e,this._babylonGamepads=[],this._oneGamepadConnected=!1,this._isMonitoring=!1,this.onGamepadDisconnectedObservable=new d.c,R.a.IsWindowObjectExist()?(this._gamepadEventSupported="GamepadEvent"in window,this._gamepadSupport=navigator.getGamepads||navigator.webkitGetGamepads||navigator.msGetGamepads||navigator.webkitGamepads):this._gamepadEventSupported=!1,this.onGamepadConnectedObservable=new d.c(function(e){for(var r in t._babylonGamepads){var i=t._babylonGamepads[r];i&&i._isConnected&&t.onGamepadConnectedObservable.notifyObserver(e,i)}}),this._onGamepadConnectedEvent=function(e){var r,i=e.gamepad;i.index in t._babylonGamepads&&t._babylonGamepads[i.index].isConnected||(t._babylonGamepads[i.index]?((r=t._babylonGamepads[i.index]).browserGamepad=i,r._isConnected=!0):r=t._addNewGamepad(i),t.onGamepadConnectedObservable.notifyObservers(r),t._startMonitoringGamepads())},this._onGamepadDisconnectedEvent=function(e){var r=e.gamepad;for(var i in t._babylonGamepads)if(t._babylonGamepads[i].index===r.index){var n=t._babylonGamepads[i];n._isConnected=!1,t.onGamepadDisconnectedObservable.notifyObservers(n);break}},this._gamepadSupport&&(this._updateGamepadObjects(),this._babylonGamepads.length&&this._startMonitoringGamepads(),this._gamepadEventSupported?(window.addEventListener("gamepadconnected",this._onGamepadConnectedEvent,!1),window.addEventListener("gamepaddisconnected",this._onGamepadDisconnectedEvent,!1)):this._startMonitoringGamepads())}return Object.defineProperty(e.prototype,"gamepads",{get:function(){return this._babylonGamepads},enumerable:!0,configurable:!0}),e.prototype.getGamepadByType=function(e){void 0===e&&(e=b.a.XBOX);for(var t=0,r=this._babylonGamepads;t<r.length;t++){var i=r[t];if(i&&i.type===e)return i}return null},e.prototype.dispose=function(){this._gamepadEventSupported&&(this._onGamepadConnectedEvent&&window.removeEventListener("gamepadconnected",this._onGamepadConnectedEvent),this._onGamepadDisconnectedEvent&&window.removeEventListener("gamepaddisconnected",this._onGamepadDisconnectedEvent),this._onGamepadConnectedEvent=null,this._onGamepadDisconnectedEvent=null),this._babylonGamepads.forEach(function(e){e.dispose()}),this.onGamepadConnectedObservable.clear(),this.onGamepadDisconnectedObservable.clear(),this._oneGamepadConnected=!1,this._stopMonitoringGamepads(),this._babylonGamepads=[]},e.prototype._addNewGamepad=function(e){var t;this._oneGamepadConnected||(this._oneGamepadConnected=!0);var r=-1!==e.id.search("Xbox One");return t=r||-1!==e.id.search("Xbox 360")||-1!==e.id.search("xinput")?new y.c(e.id,e.index,e,r):e.pose?a.b.InitiateController(e):new b.b(e.id,e.index,e),this._babylonGamepads[t.index]=t,t},e.prototype._startMonitoringGamepads=function(){this._isMonitoring||(this._isMonitoring=!0,this._scene||this._checkGamepadsStatus())},e.prototype._stopMonitoringGamepads=function(){this._isMonitoring=!1},e.prototype._checkGamepadsStatus=function(){var e=this;for(var t in this._updateGamepadObjects(),this._babylonGamepads){var r=this._babylonGamepads[t];r&&r.isConnected&&r.update()}this._isMonitoring&&!this._scene&&m.h.QueueNewFrame(function(){e._checkGamepadsStatus()})},e.prototype._updateGamepadObjects=function(){for(var e=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads():[],t=0;t<e.length;t++){var r=e[t];if(r)if(this._babylonGamepads[r.index])this._babylonGamepads[t].browserGamepad=r,this._babylonGamepads[t].isConnected||(this._babylonGamepads[t]._isConnected=!0,this.onGamepadConnectedObservable.notifyObservers(this._babylonGamepads[t]));else{var i=this._addNewGamepad(r);this.onGamepadConnectedObservable.notifyObservers(i)}}},e}(),v=r(19),M=r(15),S=r(129),x=r(179),O=r(130),P=r(173);Object.defineProperty(v.Scene.prototype,"gamepadManager",{get:function(){if(!this._gamepadManager){this._gamepadManager=new A(this);var e=this._getComponent(M.a.NAME_GAMEPAD);e||(e=new D(this),this._addComponent(e))}return this._gamepadManager},enumerable:!0,configurable:!0}),S.a.prototype.addGamepad=function(){return this.add(new x.a),this},O.a.prototype.addGamepad=function(){return this.add(new P.a),this};var D=function(){function e(e){this.name=M.a.NAME_GAMEPAD,this.scene=e}return e.prototype.register=function(){this.scene._beforeCameraUpdateStage.registerStep(M.a.STEP_BEFORECAMERAUPDATE_GAMEPAD,this,this._beforeCameraUpdate)},e.prototype.rebuild=function(){},e.prototype.dispose=function(){var e=this.scene._gamepadManager;e&&(e.dispose(),this.scene._gamepadManager=null)},e.prototype._beforeCameraUpdate=function(){var e=this.scene._gamepadManager;e&&e._isMonitoring&&e._checkGamepadsStatus()},e}();r.d(t,"a",function(){return h}),r.d(t,"e",function(){return l}),r.d(t,"f",function(){return c}),r.d(t,"h",function(){return p}),r.d(t,"k",function(){return a.c}),r.d(t,"j",function(){return a.b}),r.d(t,"i",function(){return a.a}),r.d(t,"m",function(){return E}),r.d(t,"n",function(){return s.a}),r.d(t,"o",function(){return g}),r.d(t,"l",function(){return b.c}),r.d(t,"b",function(){return b.a}),r.d(t,"g",function(){return b.b}),r.d(t,"c",function(){return A}),r.d(t,"d",function(){return D}),r.d(t,"p",function(){return y.a}),r.d(t,"q",function(){return y.b}),r.d(t,"r",function(){return y.c})},249:function(e,t,r){"use strict";var i=r(74),n=r(1),o=r(7),s=r(0),a=r(23),h=r(28),u=r(31),_=r(64),l=r(62),c=r(47),d=function(e){function t(t,r,i){void 0===r&&(r=s.Color3.Gray()),void 0===i&&(i=c.a.DefaultUtilityLayer);var n=e.call(this,i)||this;n._pointerObserver=null,n.snapDistance=0,n.onSnapObservable=new o.c,n.uniformScaling=!1,n._coloredMaterial=new u.StandardMaterial("",i.utilityLayerScene),n._coloredMaterial.disableLighting=!0,n._coloredMaterial.emissiveColor=r;var l=new u.StandardMaterial("",i.utilityLayerScene);l.disableLighting=!0,l.emissiveColor=r.add(new s.Color3(.3,.3,.3));var d=new a.a("",i.utilityLayerScene),p=h.MeshBuilder.CreateBox("yPosMesh",{size:.4},i.utilityLayerScene),E=h.MeshBuilder.CreateLines("yPosMesh",{points:[new s.Vector3(0,0,0),new s.Vector3(0,1.1,0)]},i.utilityLayerScene);E.color=n._coloredMaterial.emissiveColor,d.addChild(p),d.addChild(E),p.scaling.scaleInPlace(.1),p.material=n._coloredMaterial,p.rotation.x=Math.PI/2,p.position.z+=.3,E.scaling.scaleInPlace(.26),E.rotation.x=Math.PI/2,E.material=n._coloredMaterial,d.lookAt(n._rootMesh.position.add(t)),n._rootMesh.addChild(d),d.scaling.scaleInPlace(1/3),n.dragBehavior=new _.a({dragAxis:t}),n.dragBehavior.moveAttached=!1,n._rootMesh.addBehavior(n.dragBehavior);var f=0,T=new s.Vector3,g={snapDistance:0};return n.dragBehavior.onDragObservable.add(function(e){if(n.attachedMesh){var r=!1,i=0;n.uniformScaling?(n.attachedMesh.scaling.normalizeToRef(T),T.y<0&&T.scaleInPlace(-1)):T.copyFrom(t),0==n.snapDistance?T.scaleToRef(e.dragDistance,T):(f+=e.dragDistance,Math.abs(f)>n.snapDistance?(i=Math.floor(Math.abs(f)/n.snapDistance),f<0&&(i*=-1),f%=n.snapDistance,T.scaleToRef(n.snapDistance*i,T),r=!0):T.scaleInPlace(0)),n.attachedMesh.scaling.addInPlace(T),r&&(g.snapDistance=n.snapDistance*i,n.onSnapObservable.notifyObservers(g))}}),n._pointerObserver=i.utilityLayerScene.onPointerObservable.add(function(e){if(!n._customMeshSet){var t=e.pickInfo&&-1!=n._rootMesh.getChildMeshes().indexOf(e.pickInfo.pickedMesh)?l:n._coloredMaterial;n._rootMesh.getChildMeshes().forEach(function(e){e.material=t,e.color&&(e.color=t.emissiveColor)})}}),n}return n.d(t,e),t.prototype._attachedMeshChanged=function(e){this.dragBehavior&&(this.dragBehavior.enabled=!!e)},t.prototype.dispose=function(){this.onSnapObservable.clear(),this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver),this.dragBehavior.detach(),e.prototype.dispose.call(this)},t.prototype.setCustomMesh=function(t,r){var i=this;void 0===r&&(r=!1),e.prototype.setCustomMesh.call(this,t),r&&(this._rootMesh.getChildMeshes().forEach(function(e){e.material=i._coloredMaterial,e.color&&(e.color=i._coloredMaterial.emissiveColor)}),this._customMeshSet=!1)},t}(l.a),p=r(9),E=r(10),f=r(55),T=function(e){function t(t,r){void 0===t&&(t=s.Color3.Gray()),void 0===r&&(r=c.a.DefaultKeepDepthUtilityLayer);var i=e.call(this,r)||this;i._boundingDimensions=new s.Vector3(1,1,1),i._renderObserver=null,i._pointerObserver=null,i._scaleDragSpeed=.2,i._tmpQuaternion=new s.Quaternion,i._tmpVector=new s.Vector3(0,0,0),i._tmpRotationMatrix=new s.Matrix,i.ignoreChildren=!1,i.includeChildPredicate=null,i.rotationSphereSize=.1,i.scaleBoxSize=.1,i.fixedDragMeshScreenSize=!1,i.fixedDragMeshScreenSizeDistanceFactor=10,i.onDragStartObservable=new o.c,i.onScaleBoxDragObservable=new o.c,i.onScaleBoxDragEndObservable=new o.c,i.onRotationSphereDragObservable=new o.c,i.onRotationSphereDragEndObservable=new o.c,i.scalePivot=null,i._existingMeshScale=new s.Vector3,i._dragMesh=null,i.pointerDragBehavior=new _.a,i._updateScale=!1,i._anchorMesh=new a.a("anchor",r.utilityLayerScene);var n=new u.StandardMaterial("",r.utilityLayerScene);n.disableLighting=!0,n.emissiveColor=t;var l=new u.StandardMaterial("",r.utilityLayerScene);l.disableLighting=!0,l.emissiveColor=t.clone().add(new s.Color3(.3,.3,.3)),i._lineBoundingBox=new a.a("",r.utilityLayerScene),i._lineBoundingBox.rotationQuaternion=new s.Quaternion;var d=[];d.push(h.MeshBuilder.CreateLines("lines",{points:[new s.Vector3(0,0,0),new s.Vector3(i._boundingDimensions.x,0,0)]},r.utilityLayerScene)),d.push(h.MeshBuilder.CreateLines("lines",{points:[new s.Vector3(0,0,0),new s.Vector3(0,i._boundingDimensions.y,0)]},r.utilityLayerScene)),d.push(h.MeshBuilder.CreateLines("lines",{points:[new s.Vector3(0,0,0),new s.Vector3(0,0,i._boundingDimensions.z)]},r.utilityLayerScene)),d.push(h.MeshBuilder.CreateLines("lines",{points:[new s.Vector3(i._boundingDimensions.x,0,0),new s.Vector3(i._boundingDimensions.x,i._boundingDimensions.y,0)]},r.utilityLayerScene)),d.push(h.MeshBuilder.CreateLines("lines",{points:[new s.Vector3(i._boundingDimensions.x,0,0),new s.Vector3(i._boundingDimensions.x,0,i._boundingDimensions.z)]},r.utilityLayerScene)),d.push(h.MeshBuilder.CreateLines("lines",{points:[new s.Vector3(0,i._boundingDimensions.y,0),new s.Vector3(i._boundingDimensions.x,i._boundingDimensions.y,0)]},r.utilityLayerScene)),d.push(h.MeshBuilder.CreateLines("lines",{points:[new s.Vector3(0,i._boundingDimensions.y,0),new s.Vector3(0,i._boundingDimensions.y,i._boundingDimensions.z)]},r.utilityLayerScene)),d.push(h.MeshBuilder.CreateLines("lines",{points:[new s.Vector3(0,0,i._boundingDimensions.z),new s.Vector3(i._boundingDimensions.x,0,i._boundingDimensions.z)]},r.utilityLayerScene)),d.push(h.MeshBuilder.CreateLines("lines",{points:[new s.Vector3(0,0,i._boundingDimensions.z),new s.Vector3(0,i._boundingDimensions.y,i._boundingDimensions.z)]},r.utilityLayerScene)),d.push(h.MeshBuilder.CreateLines("lines",{points:[new s.Vector3(i._boundingDimensions.x,i._boundingDimensions.y,i._boundingDimensions.z),new s.Vector3(0,i._boundingDimensions.y,i._boundingDimensions.z)]},r.utilityLayerScene)),d.push(h.MeshBuilder.CreateLines("lines",{points:[new s.Vector3(i._boundingDimensions.x,i._boundingDimensions.y,i._boundingDimensions.z),new s.Vector3(i._boundingDimensions.x,0,i._boundingDimensions.z)]},r.utilityLayerScene)),d.push(h.MeshBuilder.CreateLines("lines",{points:[new s.Vector3(i._boundingDimensions.x,i._boundingDimensions.y,i._boundingDimensions.z),new s.Vector3(i._boundingDimensions.x,i._boundingDimensions.y,0)]},r.utilityLayerScene)),d.forEach(function(e){e.color=t,e.position.addInPlace(new s.Vector3(-i._boundingDimensions.x/2,-i._boundingDimensions.y/2,-i._boundingDimensions.z/2)),e.isPickable=!1,i._lineBoundingBox.addChild(e)}),i._rootMesh.addChild(i._lineBoundingBox),i._rotateSpheresParent=new a.a("",r.utilityLayerScene),i._rotateSpheresParent.rotationQuaternion=new s.Quaternion;for(var E=function(e){var t=h.MeshBuilder.CreateSphere("",{diameter:1},r.utilityLayerScene);t.rotationQuaternion=new s.Quaternion,t.material=n,(R=new _.a({})).moveAttached=!1,R.updateDragPlane=!1,t.addBehavior(R);var o=new s.Vector3(1,0,0),a=0;R.onDragStartObservable.add(function(){o.copyFrom(t.forward),a=0}),R.onDragObservable.add(function(t){if(i.onRotationSphereDragObservable.notifyObservers({}),i.attachedMesh){var r=i.attachedMesh.parent;if(r&&r.scaling&&r.scaling.isNonUniformWithinEpsilon(.001))return void p.a.Warn("BoundingBoxGizmo controls are not supported on child meshes with non-uniform parent scaling");f.a._RemoveAndStorePivotPoint(i.attachedMesh);var n=o,h=t.dragPlaneNormal.scale(s.Vector3.Dot(t.dragPlaneNormal,n)),u=n.subtract(h).normalizeToNew(),_=s.Vector3.Dot(u,t.delta)<0?Math.abs(t.delta.length()):-Math.abs(t.delta.length());_=_/i._boundingDimensions.length()*i._anchorMesh.scaling.length(),i.attachedMesh.rotationQuaternion||(i.attachedMesh.rotationQuaternion=s.Quaternion.RotationYawPitchRoll(i.attachedMesh.rotation.y,i.attachedMesh.rotation.x,i.attachedMesh.rotation.z)),i._anchorMesh.rotationQuaternion||(i._anchorMesh.rotationQuaternion=s.Quaternion.RotationYawPitchRoll(i._anchorMesh.rotation.y,i._anchorMesh.rotation.x,i._anchorMesh.rotation.z)),a+=_,Math.abs(a)<=2*Math.PI&&(e>=8?s.Quaternion.RotationYawPitchRollToRef(0,0,_,i._tmpQuaternion):e>=4?s.Quaternion.RotationYawPitchRollToRef(_,0,0,i._tmpQuaternion):s.Quaternion.RotationYawPitchRollToRef(0,_,0,i._tmpQuaternion),i._anchorMesh.addChild(i.attachedMesh),i._anchorMesh.rotationQuaternion.multiplyToRef(i._tmpQuaternion,i._anchorMesh.rotationQuaternion),i._anchorMesh.removeChild(i.attachedMesh),i.attachedMesh.setParent(r)),i.updateBoundingBox(),f.a._RestorePivotPoint(i.attachedMesh)}i._updateDummy()}),R.onDragStartObservable.add(function(){i.onDragStartObservable.notifyObservers({}),i._selectNode(t)}),R.onDragEndObservable.add(function(){i.onRotationSphereDragEndObservable.notifyObservers({}),i._selectNode(null),i._updateDummy()}),T._rotateSpheresParent.addChild(t)},T=this,g=0;g<12;g++)E(g);i._rootMesh.addChild(i._rotateSpheresParent),i._scaleBoxesParent=new a.a("",r.utilityLayerScene),i._scaleBoxesParent.rotationQuaternion=new s.Quaternion;for(var b=0;b<2;b++)for(var m=0;m<2;m++)for(var R,y=function(){var e=h.MeshBuilder.CreateBox("",{size:1},r.utilityLayerScene);e.material=n;var t=new s.Vector3(0==b?-1:1,0==m?-1:1,0==v?-1:1);(R=new _.a({dragAxis:t})).moveAttached=!1,e.addBehavior(R),R.onDragObservable.add(function(t){if(i.onScaleBoxDragObservable.notifyObservers({}),i.attachedMesh){var r=i.attachedMesh.parent;if(r&&r.scaling&&r.scaling.isNonUniformWithinEpsilon(.001))return void p.a.Warn("BoundingBoxGizmo controls are not supported on child meshes with non-uniform parent scaling");f.a._RemoveAndStorePivotPoint(i.attachedMesh);var n=t.dragDistance/i._boundingDimensions.length()*i._anchorMesh.scaling.length(),o=new s.Vector3(n,n,n);o.scaleInPlace(i._scaleDragSpeed),i.updateBoundingBox(),i.scalePivot?(i.attachedMesh.getWorldMatrix().getRotationMatrixToRef(i._tmpRotationMatrix),i._boundingDimensions.scaleToRef(.5,i._tmpVector),s.Vector3.TransformCoordinatesToRef(i._tmpVector,i._tmpRotationMatrix,i._tmpVector),i._anchorMesh.position.subtractInPlace(i._tmpVector),i._boundingDimensions.multiplyToRef(i.scalePivot,i._tmpVector),s.Vector3.TransformCoordinatesToRef(i._tmpVector,i._tmpRotationMatrix,i._tmpVector),i._anchorMesh.position.addInPlace(i._tmpVector)):(e.absolutePosition.subtractToRef(i._anchorMesh.position,i._tmpVector),i._anchorMesh.position.subtractInPlace(i._tmpVector)),i._anchorMesh.addChild(i.attachedMesh),i._anchorMesh.scaling.addInPlace(o),(i._anchorMesh.scaling.x<0||i._anchorMesh.scaling.y<0||i._anchorMesh.scaling.z<0)&&i._anchorMesh.scaling.subtractInPlace(o),i._anchorMesh.removeChild(i.attachedMesh),i.attachedMesh.setParent(r),f.a._RestorePivotPoint(i.attachedMesh)}i._updateDummy()}),R.onDragStartObservable.add(function(){i.onDragStartObservable.notifyObservers({}),i._selectNode(e)}),R.onDragEndObservable.add(function(){i.onScaleBoxDragEndObservable.notifyObservers({}),i._selectNode(null),i._updateDummy()}),A._scaleBoxesParent.addChild(e)},A=this,v=0;v<2;v++)y();i._rootMesh.addChild(i._scaleBoxesParent);var M=new Array;return i._pointerObserver=r.utilityLayerScene.onPointerObservable.add(function(e){M[e.event.pointerId]?e.pickInfo&&e.pickInfo.pickedMesh!=M[e.event.pointerId]&&(M[e.event.pointerId].material=n,delete M[e.event.pointerId]):i._rotateSpheresParent.getChildMeshes().concat(i._scaleBoxesParent.getChildMeshes()).forEach(function(t){e.pickInfo&&e.pickInfo.pickedMesh==t&&(M[e.event.pointerId]=t,t.material=l)})}),i._renderObserver=i.gizmoLayer.originalScene.onBeforeRenderObservable.add(function(){i.attachedMesh&&!i._existingMeshScale.equals(i.attachedMesh.scaling)?i.updateBoundingBox():i.fixedDragMeshScreenSize&&(i._updateRotationSpheres(),i._updateScaleBoxes()),i._dragMesh&&i.attachedMesh&&i.pointerDragBehavior.dragging&&(i._lineBoundingBox.position.rotateByQuaternionToRef(i._rootMesh.rotationQuaternion,i._tmpVector),i.attachedMesh.setAbsolutePosition(i._dragMesh.position.add(i._tmpVector.scale(-1))))}),i.updateBoundingBox(),i}return n.d(t,e),t.prototype._attachedMeshChanged=function(e){var t=this;if(e){f.a._RemoveAndStorePivotPoint(e);var r=e.parent;this._anchorMesh.addChild(e),this._anchorMesh.removeChild(e),e.setParent(r),f.a._RestorePivotPoint(e),this.updateBoundingBox(),e.getChildMeshes(!1).forEach(function(e){e.markAsDirty("scaling")}),this.gizmoLayer.utilityLayerScene.onAfterRenderObservable.addOnce(function(){t._updateDummy()})}},t.prototype._selectNode=function(e){this._rotateSpheresParent.getChildMeshes().concat(this._scaleBoxesParent.getChildMeshes()).forEach(function(t){t.isVisible=!e||t==e})},t.prototype.updateBoundingBox=function(){if(this.attachedMesh){f.a._RemoveAndStorePivotPoint(this.attachedMesh);var e=this.attachedMesh.parent;this.attachedMesh.setParent(null),this._update(),this.attachedMesh.rotationQuaternion||(this.attachedMesh.rotationQuaternion=s.Quaternion.RotationYawPitchRoll(this.attachedMesh.rotation.y,this.attachedMesh.rotation.x,this.attachedMesh.rotation.z)),this._anchorMesh.rotationQuaternion||(this._anchorMesh.rotationQuaternion=s.Quaternion.RotationYawPitchRoll(this._anchorMesh.rotation.y,this._anchorMesh.rotation.x,this._anchorMesh.rotation.z)),this._anchorMesh.rotationQuaternion.copyFrom(this.attachedMesh.rotationQuaternion),this._tmpQuaternion.copyFrom(this.attachedMesh.rotationQuaternion),this._tmpVector.copyFrom(this.attachedMesh.position),this.attachedMesh.rotationQuaternion.set(0,0,0,1),this.attachedMesh.position.set(0,0,0);var t=this.attachedMesh.getHierarchyBoundingVectors(!this.ignoreChildren,this.includeChildPredicate);t.max.subtractToRef(t.min,this._boundingDimensions),this._lineBoundingBox.scaling.copyFrom(this._boundingDimensions),this._lineBoundingBox.position.set((t.max.x+t.min.x)/2,(t.max.y+t.min.y)/2,(t.max.z+t.min.z)/2),this._rotateSpheresParent.position.copyFrom(this._lineBoundingBox.position),this._scaleBoxesParent.position.copyFrom(this._lineBoundingBox.position),this._lineBoundingBox.computeWorldMatrix(),this._anchorMesh.position.copyFrom(this._lineBoundingBox.absolutePosition),this.attachedMesh.rotationQuaternion.copyFrom(this._tmpQuaternion),this.attachedMesh.position.copyFrom(this._tmpVector),this.attachedMesh.setParent(e)}this._updateRotationSpheres(),this._updateScaleBoxes(),this.attachedMesh&&(this._existingMeshScale.copyFrom(this.attachedMesh.scaling),f.a._RestorePivotPoint(this.attachedMesh))},t.prototype._updateRotationSpheres=function(){for(var e=this._rotateSpheresParent.getChildMeshes(),t=0;t<3;t++)for(var r=0;r<2;r++)for(var i=0;i<2;i++){var n=4*t+2*r+i;if(0==t&&(e[n].position.set(this._boundingDimensions.x/2,this._boundingDimensions.y*r,this._boundingDimensions.z*i),e[n].position.addInPlace(new s.Vector3(-this._boundingDimensions.x/2,-this._boundingDimensions.y/2,-this._boundingDimensions.z/2)),e[n].lookAt(s.Vector3.Cross(e[n].position.normalizeToNew(),s.Vector3.Right()).normalizeToNew().add(e[n].position))),1==t&&(e[n].position.set(this._boundingDimensions.x*r,this._boundingDimensions.y/2,this._boundingDimensions.z*i),e[n].position.addInPlace(new s.Vector3(-this._boundingDimensions.x/2,-this._boundingDimensions.y/2,-this._boundingDimensions.z/2)),e[n].lookAt(s.Vector3.Cross(e[n].position.normalizeToNew(),s.Vector3.Up()).normalizeToNew().add(e[n].position))),2==t&&(e[n].position.set(this._boundingDimensions.x*r,this._boundingDimensions.y*i,this._boundingDimensions.z/2),e[n].position.addInPlace(new s.Vector3(-this._boundingDimensions.x/2,-this._boundingDimensions.y/2,-this._boundingDimensions.z/2)),e[n].lookAt(s.Vector3.Cross(e[n].position.normalizeToNew(),s.Vector3.Forward()).normalizeToNew().add(e[n].position))),this.fixedDragMeshScreenSize&&this.gizmoLayer.utilityLayerScene.activeCamera){e[n].absolutePosition.subtractToRef(this.gizmoLayer.utilityLayerScene.activeCamera.position,this._tmpVector);var o=this.rotationSphereSize*this._tmpVector.length()/this.fixedDragMeshScreenSizeDistanceFactor;e[n].scaling.set(o,o,o)}else e[n].scaling.set(this.rotationSphereSize,this.rotationSphereSize,this.rotationSphereSize)}},t.prototype._updateScaleBoxes=function(){for(var e=this._scaleBoxesParent.getChildMeshes(),t=0;t<2;t++)for(var r=0;r<2;r++)for(var i=0;i<2;i++){var n=4*t+2*r+i;if(e[n])if(e[n].position.set(this._boundingDimensions.x*t,this._boundingDimensions.y*r,this._boundingDimensions.z*i),e[n].position.addInPlace(new s.Vector3(-this._boundingDimensions.x/2,-this._boundingDimensions.y/2,-this._boundingDimensions.z/2)),this.fixedDragMeshScreenSize&&this.gizmoLayer.utilityLayerScene.activeCamera){e[n].absolutePosition.subtractToRef(this.gizmoLayer.utilityLayerScene.activeCamera.position,this._tmpVector);var o=this.scaleBoxSize*this._tmpVector.length()/this.fixedDragMeshScreenSizeDistanceFactor;e[n].scaling.set(o,o,o)}else e[n].scaling.set(this.scaleBoxSize,this.scaleBoxSize,this.scaleBoxSize)}},t.prototype.setEnabledRotationAxis=function(e){this._rotateSpheresParent.getChildMeshes().forEach(function(t,r){r<4?t.setEnabled(-1!=e.indexOf("x")):r<8?t.setEnabled(-1!=e.indexOf("y")):t.setEnabled(-1!=e.indexOf("z"))})},t.prototype.setEnabledScaling=function(e){this._scaleBoxesParent.getChildMeshes().forEach(function(t,r){t.setEnabled(e)})},t.prototype._updateDummy=function(){this._dragMesh&&(this._dragMesh.position.copyFrom(this._lineBoundingBox.getAbsolutePosition()),this._dragMesh.scaling.copyFrom(this._lineBoundingBox.scaling),this._dragMesh.rotationQuaternion.copyFrom(this._rootMesh.rotationQuaternion))},t.prototype.enableDragBehavior=function(){this._dragMesh=E.Mesh.CreateBox("dummy",1,this.gizmoLayer.utilityLayerScene),this._dragMesh.visibility=0,this._dragMesh.rotationQuaternion=new s.Quaternion,this.pointerDragBehavior.useObjectOrienationForDragging=!1,this._dragMesh.addBehavior(this.pointerDragBehavior)},t.prototype.dispose=function(){this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver),this.gizmoLayer.originalScene.onBeforeRenderObservable.remove(this._renderObserver),this._lineBoundingBox.dispose(),this._rotateSpheresParent.dispose(),this._scaleBoxesParent.dispose(),this._dragMesh&&this._dragMesh.dispose(),e.prototype.dispose.call(this)},t.MakeNotPickableAndWrapInBoundingBox=function(e){var t=function(e){e.isPickable=!1,e.getChildMeshes().forEach(function(e){t(e)})};t(e),e.rotationQuaternion||(e.rotationQuaternion=s.Quaternion.RotationYawPitchRoll(e.rotation.y,e.rotation.x,e.rotation.z));var r=e.position.clone(),i=e.rotationQuaternion.clone();e.rotationQuaternion.set(0,0,0,1),e.position.set(0,0,0);var n=h.MeshBuilder.CreateBox("box",{size:1},e.getScene()),o=e.getHierarchyBoundingVectors();return o.max.subtractToRef(o.min,n.scaling),0===n.scaling.y&&(n.scaling.y=s.Epsilon),0===n.scaling.x&&(n.scaling.x=s.Epsilon),0===n.scaling.z&&(n.scaling.z=s.Epsilon),n.position.set((o.max.x+o.min.x)/2,(o.max.y+o.min.y)/2,(o.max.z+o.min.z)/2),e.addChild(n),e.rotationQuaternion.copyFrom(i),e.position.copyFrom(r),e.removeChild(n),n.addChild(e),n.visibility=0,n},t.prototype.setCustomMesh=function(e){p.a.Error("Custom meshes are not supported on this gizmo")},t}(l.a),g=r(13),b=r(172),m=function(e){function t(t,r,i,n){void 0===r&&(r=s.Color3.Gray()),void 0===i&&(i=c.a.DefaultUtilityLayer),void 0===n&&(n=32);var h=e.call(this,i)||this;h._pointerObserver=null,h.snapDistance=0,h.onSnapObservable=new o.c;var l=new u.StandardMaterial("",i.utilityLayerScene);l.disableLighting=!0,l.emissiveColor=r;var d=new u.StandardMaterial("",i.utilityLayerScene);d.disableLighting=!0,d.emissiveColor=r.add(new s.Color3(.3,.3,.3));for(var p=new a.a("",i.utilityLayerScene),f=new Array,T=0;T<n;T++){var g=2*Math.PI*(T/(n-1));f.push(new s.Vector3(.8*Math.sin(g),0,.8*Math.cos(g)))}var b=E.Mesh.CreateLines("",f,i.utilityLayerScene);b.color=l.emissiveColor,b.scaling.scaleInPlace(.26),b.material=l,b.rotation.x=Math.PI/2,p.addChild(b),p.lookAt(h._rootMesh.position.add(t)),h._rootMesh.addChild(p),p.scaling.scaleInPlace(1/3),h.dragBehavior=new _.a({dragPlaneNormal:t}),h.dragBehavior.moveAttached=!1,h.dragBehavior.maxDragAngle=9*Math.PI/20,h.dragBehavior._useAlternatePickedPointAboveMaxDragAngle=!0,h._rootMesh.addBehavior(h.dragBehavior);var m=new s.Vector3;h.dragBehavior.onDragStartObservable.add(function(e){h.attachedMesh&&m.copyFrom(e.dragPlanePoint)});var R=new s.Matrix,y=new s.Vector3,A=new s.Vector3,v={snapDistance:0},M=0,S=new s.Matrix,x=new s.Vector3,O=new s.Quaternion;return h.dragBehavior.onDragObservable.add(function(e){if(h.attachedMesh){h.attachedMesh.rotationQuaternion||(h.attachedMesh.rotationQuaternion=s.Quaternion.RotationYawPitchRoll(h.attachedMesh.rotation.y,h.attachedMesh.rotation.x,h.attachedMesh.rotation.z));var r=e.dragPlanePoint.subtract(h.attachedMesh.absolutePosition).normalize(),n=m.subtract(h.attachedMesh.absolutePosition).normalize(),o=s.Vector3.Cross(r,n),a=s.Vector3.Dot(r,n),u=Math.atan2(o.length(),a);if(y.copyFrom(t),A.copyFrom(t),h.updateGizmoRotationToMatchAttachedMesh&&(h.attachedMesh.rotationQuaternion.toRotationMatrix(R),A=s.Vector3.TransformCoordinates(y,R)),i.utilityLayerScene.activeCamera){var _=i.utilityLayerScene.activeCamera.position.subtract(h.attachedMesh.position);s.Vector3.Dot(_,A)>0&&(y.scaleInPlace(-1),A.scaleInPlace(-1))}s.Vector3.Dot(A,o)>0&&(u=-u);var l=!1;if(0!=h.snapDistance)if(M+=u,Math.abs(M)>h.snapDistance){var c=Math.floor(Math.abs(M)/h.snapDistance);M<0&&(c*=-1),M%=h.snapDistance,u=h.snapDistance*c,l=!0}else u=0;S.reset(),h.attachedMesh.parent&&(h.attachedMesh.parent.computeWorldMatrix().invertToRef(S),S.getRotationMatrixToRef(S),s.Vector3.TransformCoordinatesToRef(y,S,y));var d=Math.sin(u/2);O.set(y.x*d,y.y*d,y.z*d,Math.cos(u/2)),S.determinant()>0&&(O.toEulerAnglesToRef(x),s.Quaternion.RotationYawPitchRollToRef(x.y,-x.x,-x.z,O)),h.updateGizmoRotationToMatchAttachedMesh?h.attachedMesh.rotationQuaternion.multiplyToRef(O,h.attachedMesh.rotationQuaternion):O.multiplyToRef(h.attachedMesh.rotationQuaternion,h.attachedMesh.rotationQuaternion),m.copyFrom(e.dragPlanePoint),l&&(v.snapDistance=u,h.onSnapObservable.notifyObservers(v))}}),h._pointerObserver=i.utilityLayerScene.onPointerObservable.add(function(e){if(!h._customMeshSet){var t=e.pickInfo&&-1!=h._rootMesh.getChildMeshes().indexOf(e.pickInfo.pickedMesh)?d:l;h._rootMesh.getChildMeshes().forEach(function(e){e.material=t,e.color&&(e.color=t.emissiveColor)})}}),h}return n.d(t,e),t.prototype._attachedMeshChanged=function(e){this.dragBehavior&&(this.dragBehavior.enabled=!!e)},t.prototype.dispose=function(){this.onSnapObservable.clear(),this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver),this.dragBehavior.detach(),e.prototype.dispose.call(this)},t}(l.a),R=function(e){function t(t,r){void 0===t&&(t=c.a.DefaultUtilityLayer),void 0===r&&(r=32);var i=e.call(this,t)||this;return i.onDragStartObservable=new o.c,i.onDragEndObservable=new o.c,i.xGizmo=new m(new s.Vector3(1,0,0),s.Color3.Red().scale(.5),t,r),i.yGizmo=new m(new s.Vector3(0,1,0),s.Color3.Green().scale(.5),t,r),i.zGizmo=new m(new s.Vector3(0,0,1),s.Color3.Blue().scale(.5),t,r),[i.xGizmo,i.yGizmo,i.zGizmo].forEach(function(e){e.dragBehavior.onDragStartObservable.add(function(){i.onDragStartObservable.notifyObservers({})}),e.dragBehavior.onDragEndObservable.add(function(){i.onDragEndObservable.notifyObservers({})})}),i.attachedMesh=null,i}return n.d(t,e),Object.defineProperty(t.prototype,"attachedMesh",{set:function(e){this.xGizmo&&(this.xGizmo.attachedMesh=e,this.yGizmo.attachedMesh=e,this.zGizmo.attachedMesh=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updateGizmoRotationToMatchAttachedMesh",{get:function(){return this.xGizmo.updateGizmoRotationToMatchAttachedMesh},set:function(e){this.xGizmo&&(this.xGizmo.updateGizmoRotationToMatchAttachedMesh=e,this.yGizmo.updateGizmoRotationToMatchAttachedMesh=e,this.zGizmo.updateGizmoRotationToMatchAttachedMesh=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"snapDistance",{get:function(){return this.xGizmo.snapDistance},set:function(e){this.xGizmo&&(this.xGizmo.snapDistance=e,this.yGizmo.snapDistance=e,this.zGizmo.snapDistance=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaleRatio",{get:function(){return this.xGizmo.scaleRatio},set:function(e){this.xGizmo&&(this.xGizmo.scaleRatio=e,this.yGizmo.scaleRatio=e,this.zGizmo.scaleRatio=e)},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){this.xGizmo.dispose(),this.yGizmo.dispose(),this.zGizmo.dispose(),this.onDragStartObservable.clear(),this.onDragEndObservable.clear()},t.prototype.setCustomMesh=function(e){p.a.Error("Custom meshes are not supported on this gizmo, please set the custom meshes on the gizmos contained within this one (gizmo.xGizmo, gizmo.yGizmo, gizmo.zGizmo)")},t}(l.a),y=function(e){function t(t){void 0===t&&(t=c.a.DefaultUtilityLayer);var r=e.call(this,t)||this;return r.onDragStartObservable=new o.c,r.onDragEndObservable=new o.c,r.xGizmo=new i.a(new s.Vector3(1,0,0),s.Color3.Red().scale(.5),t),r.yGizmo=new i.a(new s.Vector3(0,1,0),s.Color3.Green().scale(.5),t),r.zGizmo=new i.a(new s.Vector3(0,0,1),s.Color3.Blue().scale(.5),t),[r.xGizmo,r.yGizmo,r.zGizmo].forEach(function(e){e.dragBehavior.onDragStartObservable.add(function(){r.onDragStartObservable.notifyObservers({})}),e.dragBehavior.onDragEndObservable.add(function(){r.onDragEndObservable.notifyObservers({})})}),r.attachedMesh=null,r}return n.d(t,e),Object.defineProperty(t.prototype,"attachedMesh",{set:function(e){this.xGizmo&&(this.xGizmo.attachedMesh=e,this.yGizmo.attachedMesh=e,this.zGizmo.attachedMesh=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updateGizmoRotationToMatchAttachedMesh",{get:function(){return this.xGizmo.updateGizmoRotationToMatchAttachedMesh},set:function(e){this.xGizmo&&(this.xGizmo.updateGizmoRotationToMatchAttachedMesh=e,this.yGizmo.updateGizmoRotationToMatchAttachedMesh=e,this.zGizmo.updateGizmoRotationToMatchAttachedMesh=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"snapDistance",{get:function(){return this.xGizmo.snapDistance},set:function(e){this.xGizmo&&(this.xGizmo.snapDistance=e,this.yGizmo.snapDistance=e,this.zGizmo.snapDistance=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaleRatio",{get:function(){return this.xGizmo.scaleRatio},set:function(e){this.xGizmo&&(this.xGizmo.scaleRatio=e,this.yGizmo.scaleRatio=e,this.zGizmo.scaleRatio=e)},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){this.xGizmo.dispose(),this.yGizmo.dispose(),this.zGizmo.dispose(),this.onDragStartObservable.clear(),this.onDragEndObservable.clear()},t.prototype.setCustomMesh=function(e){p.a.Error("Custom meshes are not supported on this gizmo, please set the custom meshes on the gizmos contained within this one (gizmo.xGizmo, gizmo.yGizmo, gizmo.zGizmo)")},t}(l.a),A=function(e){function t(t){void 0===t&&(t=c.a.DefaultUtilityLayer);var r=e.call(this,t)||this;r.onDragStartObservable=new o.c,r.onDragEndObservable=new o.c,r.xGizmo=new d(new s.Vector3(1,0,0),s.Color3.Red().scale(.5),t),r.yGizmo=new d(new s.Vector3(0,1,0),s.Color3.Green().scale(.5),t),r.zGizmo=new d(new s.Vector3(0,0,1),s.Color3.Blue().scale(.5),t),r.uniformScaleGizmo=new d(new s.Vector3(0,1,0),s.Color3.Yellow().scale(.5),t),r.uniformScaleGizmo.updateGizmoRotationToMatchAttachedMesh=!1,r.uniformScaleGizmo.uniformScaling=!0;var i=E.Mesh.CreatePolyhedron("",{type:1},r.uniformScaleGizmo.gizmoLayer.utilityLayerScene);i.scaling.scaleInPlace(.02),i.visibility=0;var n=E.Mesh.CreatePolyhedron("",{type:1},r.uniformScaleGizmo.gizmoLayer.utilityLayerScene);return n.scaling.scaleInPlace(.007),i.addChild(n),r.uniformScaleGizmo.setCustomMesh(i,!0),[r.xGizmo,r.yGizmo,r.zGizmo,r.uniformScaleGizmo].forEach(function(e){e.dragBehavior.onDragStartObservable.add(function(){r.onDragStartObservable.notifyObservers({})}),e.dragBehavior.onDragEndObservable.add(function(){r.onDragEndObservable.notifyObservers({})})}),r.attachedMesh=null,r}return n.d(t,e),Object.defineProperty(t.prototype,"attachedMesh",{set:function(e){this.xGizmo&&(this.xGizmo.attachedMesh=e,this.yGizmo.attachedMesh=e,this.zGizmo.attachedMesh=e,this.uniformScaleGizmo.attachedMesh=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updateGizmoRotationToMatchAttachedMesh",{get:function(){return this.xGizmo.updateGizmoRotationToMatchAttachedMesh},set:function(e){e||p.a.Warn("Setting updateGizmoRotationToMatchAttachedMesh = false on scaling gizmo is not supported."),this.xGizmo&&(this.xGizmo.updateGizmoRotationToMatchAttachedMesh=e,this.yGizmo.updateGizmoRotationToMatchAttachedMesh=e,this.zGizmo.updateGizmoRotationToMatchAttachedMesh=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"snapDistance",{get:function(){return this.xGizmo.snapDistance},set:function(e){this.xGizmo&&(this.xGizmo.snapDistance=e,this.yGizmo.snapDistance=e,this.zGizmo.snapDistance=e,this.uniformScaleGizmo.snapDistance=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaleRatio",{get:function(){return this.xGizmo.scaleRatio},set:function(e){this.xGizmo&&(this.xGizmo.scaleRatio=e,this.yGizmo.scaleRatio=e,this.zGizmo.scaleRatio=e,this.uniformScaleGizmo.scaleRatio=e)},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){this.xGizmo.dispose(),this.yGizmo.dispose(),this.zGizmo.dispose(),this.uniformScaleGizmo.dispose(),this.onDragStartObservable.clear(),this.onDragEndObservable.clear()},t}(l.a),v=function(){function e(e){var t=this;this.scene=e,this.clearGizmoOnEmptyPointerEvent=!1,this.onAttachedToMeshObservable=new o.c,this._gizmosEnabled={positionGizmo:!1,rotationGizmo:!1,scaleGizmo:!1,boundingBoxGizmo:!1},this._pointerObserver=null,this._attachedMesh=null,this._boundingBoxColor=s.Color3.FromHexString("#0984e3"),this.boundingBoxDragBehavior=new b.a,this.attachableMeshes=null,this.usePointerToAttachGizmos=!0,this._defaultKeepDepthUtilityLayer=new c.a(e),this._defaultKeepDepthUtilityLayer.utilityLayerScene.autoClearDepthAndStencil=!1,this._defaultUtilityLayer=new c.a(e),this.gizmos={positionGizmo:null,rotationGizmo:null,scaleGizmo:null,boundingBoxGizmo:null},this._pointerObserver=e.onPointerObservable.add(function(e){if(t.usePointerToAttachGizmos&&e.type==g.a.POINTERDOWN)if(e.pickInfo&&e.pickInfo.pickedMesh){var r=e.pickInfo.pickedMesh;if(null==t.attachableMeshes)for(;r&&null!=r.parent;)r=r.parent;else{var i=!1;t.attachableMeshes.forEach(function(e){r&&(r==e||r.isDescendantOf(e))&&(r=e,i=!0)}),i||(r=null)}r instanceof a.a?t._attachedMesh!=r&&t.attachToMesh(r):t.clearGizmoOnEmptyPointerEvent&&t.attachToMesh(null)}else t.clearGizmoOnEmptyPointerEvent&&t.attachToMesh(null)})}return e.prototype.attachToMesh=function(e){for(var t in this._attachedMesh&&this._attachedMesh.removeBehavior(this.boundingBoxDragBehavior),this._attachedMesh=e,this.gizmos){var r=this.gizmos[t];r&&this._gizmosEnabled[t]&&(r.attachedMesh=e)}this.boundingBoxGizmoEnabled&&this._attachedMesh&&this._attachedMesh.addBehavior(this.boundingBoxDragBehavior),this.onAttachedToMeshObservable.notifyObservers(e)},Object.defineProperty(e.prototype,"positionGizmoEnabled",{get:function(){return this._gizmosEnabled.positionGizmo},set:function(e){e?(this.gizmos.positionGizmo||(this.gizmos.positionGizmo=new y(this._defaultUtilityLayer)),this.gizmos.positionGizmo.attachedMesh=this._attachedMesh):this.gizmos.positionGizmo&&(this.gizmos.positionGizmo.attachedMesh=null),this._gizmosEnabled.positionGizmo=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotationGizmoEnabled",{get:function(){return this._gizmosEnabled.rotationGizmo},set:function(e){e?(this.gizmos.rotationGizmo||(this.gizmos.rotationGizmo=new R(this._defaultUtilityLayer)),this.gizmos.rotationGizmo.attachedMesh=this._attachedMesh):this.gizmos.rotationGizmo&&(this.gizmos.rotationGizmo.attachedMesh=null),this._gizmosEnabled.rotationGizmo=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleGizmoEnabled",{get:function(){return this._gizmosEnabled.scaleGizmo},set:function(e){e?(this.gizmos.scaleGizmo=this.gizmos.scaleGizmo||new A(this._defaultUtilityLayer),this.gizmos.scaleGizmo.attachedMesh=this._attachedMesh):this.gizmos.scaleGizmo&&(this.gizmos.scaleGizmo.attachedMesh=null),this._gizmosEnabled.scaleGizmo=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"boundingBoxGizmoEnabled",{get:function(){return this._gizmosEnabled.boundingBoxGizmo},set:function(e){e?(this.gizmos.boundingBoxGizmo=this.gizmos.boundingBoxGizmo||new T(this._boundingBoxColor,this._defaultKeepDepthUtilityLayer),this.gizmos.boundingBoxGizmo.attachedMesh=this._attachedMesh,this._attachedMesh&&(this._attachedMesh.removeBehavior(this.boundingBoxDragBehavior),this._attachedMesh.addBehavior(this.boundingBoxDragBehavior))):this.gizmos.boundingBoxGizmo&&(this.gizmos.boundingBoxGizmo.attachedMesh=null),this._gizmosEnabled.boundingBoxGizmo=e},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){for(var e in this.scene.onPointerObservable.remove(this._pointerObserver),this.gizmos){var t=this.gizmos[e];t&&t.dispose()}this._defaultKeepDepthUtilityLayer.dispose(),this._defaultUtilityLayer.dispose(),this.boundingBoxDragBehavior.detach(),this.onAttachedToMeshObservable.clear()},e}();r.d(t,"a",function(){return i.a}),r.d(t,"b",function(){return d}),r.d(t,"c",function(){return T}),r.d(t,"d",function(){return l.a}),r.d(t,"e",function(){return v}),r.d(t,"f",function(){return m}),r.d(t,"g",function(){return y}),r.d(t,"h",function(){return R}),r.d(t,"i",function(){return A})},250:function(e,t,r){"use strict";var i=r(0),n=r(31),o=r(74),s=function(){function e(t,r,s,a,h,u){if(void 0===r&&(r=1),void 0===s&&(s=2),this._scaleLinesFactor=4,this._instanced=!1,this.scaleLines=1,this.scaleLines=r,!a){var _=new n.StandardMaterial("",t);_.disableLighting=!0,_.emissiveColor=i.Color3.Red().scale(.5),a=o.a._CreateArrow(t,_)}if(!h){var l=new n.StandardMaterial("",t);l.disableLighting=!0,l.emissiveColor=i.Color3.Green().scale(.5),h=o.a._CreateArrow(t,l)}if(!u){var c=new n.StandardMaterial("",t);c.disableLighting=!0,c.emissiveColor=i.Color3.Blue().scale(.5),u=o.a._CreateArrow(t,c)}this._xAxis=a,this._xAxis.scaling.setAll(this.scaleLines*this._scaleLinesFactor),this._yAxis=h,this._yAxis.scaling.setAll(this.scaleLines*this._scaleLinesFactor),this._zAxis=u,this._zAxis.scaling.setAll(this.scaleLines*this._scaleLinesFactor),null!=s&&(e._SetRenderingGroupId(this._xAxis,s),e._SetRenderingGroupId(this._yAxis,s),e._SetRenderingGroupId(this._zAxis,s)),this.scene=t,this.update(new i.Vector3,i.Vector3.Right(),i.Vector3.Up(),i.Vector3.Forward())}return Object.defineProperty(e.prototype,"xAxis",{get:function(){return this._xAxis},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"yAxis",{get:function(){return this._yAxis},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"zAxis",{get:function(){return this._zAxis},enumerable:!0,configurable:!0}),e.prototype.update=function(e,t,r,i){this._xAxis.position.copyFrom(e),this._xAxis.setDirection(t),this._xAxis.scaling.setAll(this.scaleLines*this._scaleLinesFactor),this._yAxis.position.copyFrom(e),this._yAxis.setDirection(r),this._yAxis.scaling.setAll(this.scaleLines*this._scaleLinesFactor),this._zAxis.position.copyFrom(e),this._zAxis.setDirection(i),this._zAxis.scaling.setAll(this.scaleLines*this._scaleLinesFactor)},e.prototype.createInstance=function(){var t=o.a._CreateArrowInstance(this.scene,this._xAxis),r=o.a._CreateArrowInstance(this.scene,this._yAxis),i=o.a._CreateArrowInstance(this.scene,this._zAxis),n=new e(this.scene,this.scaleLines,null,t,r,i);return n._instanced=!0,n},e.prototype.dispose=function(){this._xAxis&&(this._xAxis.dispose(!1,!this._instanced),delete this._xAxis),this._yAxis&&(this._yAxis.dispose(!1,!this._instanced),delete this._yAxis),this._zAxis&&(this._zAxis.dispose(!1,!this._instanced),delete this._zAxis),delete this.scene},e._SetRenderingGroupId=function(e,t){e.getChildMeshes().forEach(function(e){e.renderingGroupId=t})},e}(),a=r(1),h=function(e){function t(t,r,n,o){void 0===o&&(o=1);var s=e.call(this,t,o)||this;return s.pos=i.Vector3.Zero(),s.xaxis=i.Vector3.Zero(),s.yaxis=i.Vector3.Zero(),s.zaxis=i.Vector3.Zero(),s.mesh=n,s.bone=r,s}return a.d(t,e),t.prototype.update=function(){if(this.mesh&&this.bone){var t=this.bone;t.getAbsolutePositionToRef(this.mesh,this.pos),t.getDirectionToRef(i.Axis.X,this.mesh,this.xaxis),t.getDirectionToRef(i.Axis.Y,this.mesh,this.yaxis),t.getDirectionToRef(i.Axis.Z,this.mesh,this.zaxis),e.prototype.update.call(this,this.pos,this.xaxis,this.yaxis,this.zaxis)}},t.prototype.dispose=function(){this.mesh&&(this.mesh=null,this.bone=null,e.prototype.dispose.call(this))},t}(s),u=r(5),_=r(7),l=r(19);Object.defineProperty(l.Scene.prototype,"debugLayer",{get:function(){return this._debugLayer||(this._debugLayer=new c(this)),this._debugLayer},enumerable:!0,configurable:!0});var c=function(){function e(e){var t=this;this.BJSINSPECTOR=this._getGlobalInspector(),this.onPropertyChangedObservable=new _.c,this._scene=e,this._scene.onDisposeObservable.add(function(){t._scene._debugLayer&&t._scene._debugLayer.hide()})}return e.prototype._createInspector=function(e){if(!this.isVisible()){var t=a.a({overlay:!1,showExplorer:!0,showInspector:!0,embedMode:!1,handleResize:!0,enablePopup:!0},e);this.BJSINSPECTOR=this.BJSINSPECTOR||this._getGlobalInspector(),this.BJSINSPECTOR.Inspector.Show(this._scene,t)}},e.prototype._getGlobalInspector=function(){return"undefined"!=typeof INSPECTOR?INSPECTOR:"undefined"!=typeof BABYLON&&void 0!==BABYLON.Inspector?BABYLON:void 0},e.prototype.isVisible=function(){return this.BJSINSPECTOR&&this.BJSINSPECTOR.Inspector.IsVisible},e.prototype.hide=function(){this.BJSINSPECTOR&&this.BJSINSPECTOR.Inspector.Hide()},e.prototype.show=function(t){void 0===this.BJSINSPECTOR?u.h.LoadScript(e.InspectorURL,this._createInspector.bind(this,t)):this._createInspector(t)},e.InspectorURL="https://preview.babylonjs.com/inspector/babylon.inspector.bundle.js",e}(),d=r(28),p=r(21),E=r(37),f=r(47),T=function(){function e(e){this._impostors=[],this._meshes=[],this._numMeshes=0,this._scene=e||p.a.LastCreatedScene;var t=this._scene.getPhysicsEngine();t&&(this._physicsEnginePlugin=t.getPhysicsPlugin()),this._utilityLayer=new f.a(this._scene,!1),this._utilityLayer.pickUtilitySceneFirst=!1,this._utilityLayer.utilityLayerScene.autoClearDepthAndStencil=!0}return e.prototype._updateDebugMeshes=function(){for(var e=this._physicsEnginePlugin,t=0;t<this._numMeshes;t++){var r=this._impostors[t];if(r)if(r.isDisposed)this.hideImpostor(this._impostors[t--]);else{var i=this._meshes[t];i&&e&&e.syncMeshWithImpostor(i,r)}}},e.prototype.showImpostor=function(e){if(!this._scene)return null;for(var t=0;t<this._numMeshes;t++)if(this._impostors[t]==e)return null;var r=this._getDebugMesh(e);return r&&(this._impostors[this._numMeshes]=e,this._meshes[this._numMeshes]=r,0===this._numMeshes&&(this._renderFunction=this._updateDebugMeshes.bind(this),this._scene.registerBeforeRender(this._renderFunction)),this._numMeshes++),r},e.prototype.hideImpostor=function(e){if(e&&this._scene&&this._utilityLayer){for(var t=!1,r=this._utilityLayer.utilityLayerScene,i=0;i<this._numMeshes;i++)if(this._impostors[i]==e){var n=this._meshes[i];if(!n)continue;r.removeMesh(n),n.dispose(),this._numMeshes--,this._numMeshes>0?(this._meshes[i]=this._meshes[this._numMeshes],this._impostors[i]=this._impostors[this._numMeshes],this._meshes[this._numMeshes]=null,this._impostors[this._numMeshes]=null):(this._meshes[0]=null,this._impostors[0]=null),t=!0;break}t&&0===this._numMeshes&&this._scene.unregisterBeforeRender(this._renderFunction)}},e.prototype._getDebugMaterial=function(e){return this._debugMaterial||(this._debugMaterial=new n.StandardMaterial("",e),this._debugMaterial.wireframe=!0,this._debugMaterial.emissiveColor=i.Color3.White(),this._debugMaterial.disableLighting=!0),this._debugMaterial},e.prototype._getDebugBoxMesh=function(e){return this._debugBoxMesh||(this._debugBoxMesh=d.MeshBuilder.CreateBox("physicsBodyBoxViewMesh",{size:1},e),this._debugBoxMesh.rotationQuaternion=i.Quaternion.Identity(),this._debugBoxMesh.material=this._getDebugMaterial(e)),this._debugBoxMesh.createInstance("physicsBodyBoxViewInstance")},e.prototype._getDebugSphereMesh=function(e){return this._debugSphereMesh||(this._debugSphereMesh=d.MeshBuilder.CreateSphere("physicsBodySphereViewMesh",{diameter:1},e),this._debugSphereMesh.rotationQuaternion=i.Quaternion.Identity(),this._debugSphereMesh.material=this._getDebugMaterial(e)),this._debugSphereMesh.createInstance("physicsBodyBoxViewInstance")},e.prototype._getDebugMesh=function(e){if(!this._utilityLayer)return null;var t=null,r=this._utilityLayer.utilityLayerScene;if(e.type==E.a.BoxImpostor)t=this._getDebugBoxMesh(r),e.getBoxSizeToRef(t.scaling);else if(e.type==E.a.SphereImpostor){t=this._getDebugSphereMesh(r);var i=e.getRadius();t.scaling.x=2*i,t.scaling.y=2*i,t.scaling.z=2*i}return t},e.prototype.dispose=function(){for(var e=0;e<this._numMeshes;e++)this.hideImpostor(this._impostors[e]);this._debugBoxMesh&&this._debugBoxMesh.dispose(),this._debugSphereMesh&&this._debugSphereMesh.dispose(),this._debugMaterial&&this._debugMaterial.dispose(),this._impostors.length=0,this._scene=null,this._physicsEnginePlugin=null,this._utilityLayer&&(this._utilityLayer.dispose(),this._utilityLayer=null)},e}(),g=r(10),b=function(){function e(e){this.ray=e}return e.CreateAndShow=function(t,r,i){var n=new e(t);return n.show(r,i),n},e.prototype.show=function(e,t){if(!this._renderFunction&&this.ray){var r=this.ray;this._renderFunction=this._render.bind(this),this._scene=e,this._renderPoints=[r.origin,r.origin.add(r.direction.scale(r.length))],this._renderLine=g.Mesh.CreateLines("ray",this._renderPoints,e,!0),this._renderFunction&&this._scene.registerBeforeRender(this._renderFunction)}t&&this._renderLine&&this._renderLine.color.copyFrom(t)},e.prototype.hide=function(){this._renderFunction&&this._scene&&(this._scene.unregisterBeforeRender(this._renderFunction),this._scene=null,this._renderFunction=null,this._renderLine&&(this._renderLine.dispose(),this._renderLine=null),this._renderPoints=[])},e.prototype._render=function(){var e=this.ray;if(e){var t=this._renderPoints[1],r=Math.min(e.length,1e6);t.copyFrom(e.direction),t.scaleInPlace(r),t.addInPlace(e.origin),g.Mesh.CreateLines("ray",this._renderPoints,this._scene,!0,this._renderLine)}},e.prototype.attachToMesh=function(e,t,r,n){this._attachedToMesh=e;var o=this.ray;o&&(o.direction||(o.direction=i.Vector3.Zero()),o.origin||(o.origin=i.Vector3.Zero()),n&&(o.length=n),r||(r=i.Vector3.Zero()),t||(t=new i.Vector3(0,0,-1)),this._meshSpaceDirection?(this._meshSpaceDirection.copyFrom(t),this._meshSpaceOrigin.copyFrom(r)):(this._meshSpaceDirection=t.clone(),this._meshSpaceOrigin=r.clone()),this._updateToMeshFunction||(this._updateToMeshFunction=this._updateToMesh.bind(this),this._attachedToMesh.getScene().registerBeforeRender(this._updateToMeshFunction)),this._updateToMesh())},e.prototype.detachFromMesh=function(){this._attachedToMesh&&(this._updateToMeshFunction&&this._attachedToMesh.getScene().unregisterBeforeRender(this._updateToMeshFunction),this._attachedToMesh=null,this._updateToMeshFunction=null)},e.prototype._updateToMesh=function(){var e=this.ray;this._attachedToMesh&&e&&(this._attachedToMesh._isDisposed?this.detachFromMesh():(this._attachedToMesh.getDirectionToRef(this._meshSpaceDirection,e.direction),i.Vector3.TransformCoordinatesToRef(this._meshSpaceOrigin,this._attachedToMesh.getWorldMatrix(),e.origin)))},e.prototype.dispose=function(){this.hide(),this.detachFromMesh(),this.ray=null},e}(),m=function(){function e(e,t,r,n,o){void 0===n&&(n=!0),void 0===o&&(o=1),this.skeleton=e,this.mesh=t,this.autoUpdateBonesMatrices=n,this.renderingGroupId=o,this.color=i.Color3.White(),this._debugLines=new Array,this._isEnabled=!1,this._scene=r,this._utilityLayer=new f.a(this._scene,!1),this._utilityLayer.pickUtilitySceneFirst=!1,this._utilityLayer.utilityLayerScene.autoClearDepthAndStencil=!0,this.update(),this._renderFunction=this.update.bind(this)}return Object.defineProperty(e.prototype,"debugMesh",{get:function(){return this._debugMesh},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(e){this._isEnabled!==e&&(this._isEnabled=e,e?this._scene.registerBeforeRender(this._renderFunction):this._scene.unregisterBeforeRender(this._renderFunction))},enumerable:!0,configurable:!0}),e.prototype._getBonePosition=function(e,t,r,n,o,s){void 0===n&&(n=0),void 0===o&&(o=0),void 0===s&&(s=0);var a=i.Tmp.Matrix[0],h=t.getParent();if(a.copyFrom(t.getLocalMatrix()),0!==n||0!==o||0!==s){var u=i.Tmp.Matrix[1];i.Matrix.IdentityToRef(u),u.setTranslationFromFloats(n,o,s),u.multiplyToRef(a,a)}h&&a.multiplyToRef(h.getAbsoluteTransform(),a),a.multiplyToRef(r,a),e.x=a.m[12],e.y=a.m[13],e.z=a.m[14]},e.prototype._getLinesForBonesWithLength=function(e,t){for(var r=e.length,n=this.mesh.position,o=0;o<r;o++){var s=e[o],a=this._debugLines[o];a||(a=[i.Vector3.Zero(),i.Vector3.Zero()],this._debugLines[o]=a),this._getBonePosition(a[0],s,t),this._getBonePosition(a[1],s,t,0,s.length,0),a[0].subtractInPlace(n),a[1].subtractInPlace(n)}},e.prototype._getLinesForBonesNoLength=function(e,t){for(var r=e.length,n=0,o=this.mesh.position,s=r-1;s>=0;s--){var a=e[s],h=a.getParent();if(h){var u=this._debugLines[n];u||(u=[i.Vector3.Zero(),i.Vector3.Zero()],this._debugLines[n]=u),a.getAbsolutePositionToRef(this.mesh,u[0]),h.getAbsolutePositionToRef(this.mesh,u[1]),u[0].subtractInPlace(o),u[1].subtractInPlace(o),n++}}},e.prototype.update=function(){if(this._utilityLayer){this.autoUpdateBonesMatrices&&this.skeleton.computeAbsoluteTransforms(),void 0===this.skeleton.bones[0].length?this._getLinesForBonesNoLength(this.skeleton.bones,this.mesh.getWorldMatrix()):this._getLinesForBonesWithLength(this.skeleton.bones,this.mesh.getWorldMatrix());var e=this._utilityLayer.utilityLayerScene;this._debugMesh?d.MeshBuilder.CreateLineSystem("",{lines:this._debugLines,updatable:!0,instance:this._debugMesh},e):(this._debugMesh=d.MeshBuilder.CreateLineSystem("",{lines:this._debugLines,updatable:!0,instance:null},e),this._debugMesh.renderingGroupId=this.renderingGroupId),this._debugMesh.position.copyFrom(this.mesh.position),this._debugMesh.color=this.color}},e.prototype.dispose=function(){this.isEnabled=!1,this._debugMesh&&(this.isEnabled=!1,this._debugMesh.dispose(),this._debugMesh=null),this._utilityLayer&&(this._utilityLayer.dispose(),this._utilityLayer=null)},e}();r.d(t,"a",function(){return s}),r.d(t,"b",function(){return h}),r.d(t,"c",function(){return c}),r.d(t,"d",function(){return T}),r.d(t,"e",function(){return b}),r.d(t,"f",function(){return m})},253:function(e,t,r){"use strict";var i=r(4),n=r(11),o=r(21),s=r(1),a=r(9),h=r(139),u=r(30),_=function(){return function(){this.renderWidth=512,this.renderHeight=256,this.textureSize=512,this.deterministicLockstep=!1,this.lockstepMaxSteps=4}}(),l=function(e){function t(t){void 0===t&&(t=new _);var r=e.call(this,null)||this;return void 0===t.deterministicLockstep&&(t.deterministicLockstep=!1),void 0===t.lockstepMaxSteps&&(t.lockstepMaxSteps=4),r._options=t,r._caps=new n.EngineCapabilities,r._caps.maxTexturesImageUnits=16,r._caps.maxVertexTextureImageUnits=16,r._caps.maxTextureSize=512,r._caps.maxCubemapTextureSize=512,r._caps.maxRenderTextureSize=512,r._caps.maxVertexAttribs=16,r._caps.maxVaryingVectors=16,r._caps.maxFragmentUniformVectors=16,r._caps.maxVertexUniformVectors=16,r._caps.standardDerivatives=!1,r._caps.astc=null,r._caps.s3tc=null,r._caps.pvrtc=null,r._caps.etc1=null,r._caps.etc2=null,r._caps.textureAnisotropicFilterExtension=null,r._caps.maxAnisotropy=0,r._caps.uintIndices=!1,r._caps.fragmentDepthSupported=!1,r._caps.highPrecisionShaderSupported=!0,r._caps.colorBufferFloat=!1,r._caps.textureFloat=!1,r._caps.textureFloatLinearFiltering=!1,r._caps.textureFloatRender=!1,r._caps.textureHalfFloat=!1,r._caps.textureHalfFloatLinearFiltering=!1,r._caps.textureHalfFloatRender=!1,r._caps.textureLOD=!1,r._caps.drawBuffersExtension=!1,r._caps.depthTextureExtension=!1,r._caps.vertexArrayObject=!1,r._caps.instancedArrays=!1,a.a.Log("Babylon.js v"+n.Engine.Version+" - Null engine"),"undefined"==typeof URL&&(URL={createObjectURL:function(){},revokeObjectURL:function(){}}),"undefined"==typeof Blob&&(Blob=function(){}),r}return s.d(t,e),t.prototype.isDeterministicLockStep=function(){return this._options.deterministicLockstep},t.prototype.getLockstepMaxSteps=function(){return this._options.lockstepMaxSteps},t.prototype.getHardwareScalingLevel=function(){return 1},t.prototype.createVertexBuffer=function(e){return{capacity:0,references:1,is32Bits:!1}},t.prototype.createIndexBuffer=function(e){return{capacity:0,references:1,is32Bits:!1}},t.prototype.clear=function(e,t,r,i){void 0===i&&(i=!1)},t.prototype.getRenderWidth=function(e){return void 0===e&&(e=!1),!e&&this._currentRenderTarget?this._currentRenderTarget.width:this._options.renderWidth},t.prototype.getRenderHeight=function(e){return void 0===e&&(e=!1),!e&&this._currentRenderTarget?this._currentRenderTarget.height:this._options.renderHeight},t.prototype.setViewport=function(e,t,r){this._cachedViewport=e},t.prototype.createShaderProgram=function(e,t,r,i){return{transformFeedback:null,__SPECTOR_rebuildProgram:null,isParallelCompiled:!1}},t.prototype.getUniforms=function(e,t){return[]},t.prototype.getAttributes=function(e,t){return[]},t.prototype.bindSamplers=function(e){this._currentEffect=null},t.prototype.enableEffect=function(e){this._currentEffect=e,e.onBind&&e.onBind(e),e._onBindObservable&&e._onBindObservable.notifyObservers(e)},t.prototype.setState=function(e,t,r,i){void 0===t&&(t=0),void 0===i&&(i=!1)},t.prototype.setIntArray=function(e,t){},t.prototype.setIntArray2=function(e,t){},t.prototype.setIntArray3=function(e,t){},t.prototype.setIntArray4=function(e,t){},t.prototype.setFloatArray=function(e,t){},t.prototype.setFloatArray2=function(e,t){},t.prototype.setFloatArray3=function(e,t){},t.prototype.setFloatArray4=function(e,t){},t.prototype.setArray=function(e,t){},t.prototype.setArray2=function(e,t){},t.prototype.setArray3=function(e,t){},t.prototype.setArray4=function(e,t){},t.prototype.setMatrices=function(e,t){},t.prototype.setMatrix=function(e,t){},t.prototype.setMatrix3x3=function(e,t){},t.prototype.setMatrix2x2=function(e,t){},t.prototype.setFloat=function(e,t){},t.prototype.setFloat2=function(e,t,r){},t.prototype.setFloat3=function(e,t,r,i){},t.prototype.setBool=function(e,t){},t.prototype.setFloat4=function(e,t,r,i,n){},t.prototype.setColor3=function(e,t){},t.prototype.setColor4=function(e,t,r){},t.prototype.setAlphaMode=function(e,t){void 0===t&&(t=!1),this._alphaMode!==e&&(this._alphaState.alphaBlend=e!==i.a.ALPHA_DISABLE,t||this.setDepthWrite(e===i.a.ALPHA_DISABLE),this._alphaMode=e)},t.prototype.bindBuffers=function(e,t,r){},t.prototype.wipeCaches=function(e){this.preventCacheWipeBetweenFrames||(this.resetTextureCache(),this._currentEffect=null,e&&(this._currentProgram=null,this._stencilState.reset(),this._depthCullingState.reset(),this._alphaState.reset()),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null)},t.prototype.draw=function(e,t,r,i){},t.prototype.drawElementsType=function(e,t,r,i){},t.prototype.drawArraysType=function(e,t,r,i){},t.prototype._createTexture=function(){return{}},t.prototype._releaseTexture=function(e){},t.prototype.createTexture=function(e,t,r,n,o,s,a,h,_,l){void 0===o&&(o=i.a.TEXTURE_TRILINEAR_SAMPLINGMODE),void 0===s&&(s=null),void 0===a&&(a=null),void 0===h&&(h=null);var c=new u.a(this,u.a.DATASOURCE_URL),d=String(e);return c.url=d,c.generateMipMaps=!t,c.samplingMode=o,c.invertY=r,c.baseWidth=this._options.textureSize,c.baseHeight=this._options.textureSize,c.width=this._options.textureSize,c.height=this._options.textureSize,l&&(c.format=l),c.isReady=!0,s&&s(),this._internalTexturesCache.push(c),c},t.prototype.createRenderTargetTexture=function(e,t){var r=new h.a;void 0!==t&&"object"==typeof t?(r.generateMipMaps=t.generateMipMaps,r.generateDepthBuffer=void 0===t.generateDepthBuffer||t.generateDepthBuffer,r.generateStencilBuffer=r.generateDepthBuffer&&t.generateStencilBuffer,r.type=void 0===t.type?i.a.TEXTURETYPE_UNSIGNED_INT:t.type,r.samplingMode=void 0===t.samplingMode?i.a.TEXTURE_TRILINEAR_SAMPLINGMODE:t.samplingMode):(r.generateMipMaps=t,r.generateDepthBuffer=!0,r.generateStencilBuffer=!1,r.type=i.a.TEXTURETYPE_UNSIGNED_INT,r.samplingMode=i.a.TEXTURE_TRILINEAR_SAMPLINGMODE);var n=new u.a(this,u.a.DATASOURCE_RENDERTARGET),o=e.width||e,s=e.height||e;return n._depthStencilBuffer={},n._framebuffer={},n.baseWidth=o,n.baseHeight=s,n.width=o,n.height=s,n.isReady=!0,n.samples=1,n.generateMipMaps=!!r.generateMipMaps,n.samplingMode=r.samplingMode,n.type=r.type,n._generateDepthBuffer=r.generateDepthBuffer,n._generateStencilBuffer=!!r.generateStencilBuffer,this._internalTexturesCache.push(n),n},t.prototype.updateTextureSamplingMode=function(e,t){t.samplingMode=e},t.prototype.bindFramebuffer=function(e,t,r,i,n){this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=e,this._currentFramebuffer=e._MSAAFramebuffer?e._MSAAFramebuffer:e._framebuffer,this._cachedViewport&&!n&&this.setViewport(this._cachedViewport,r,i)},t.prototype.unBindFramebuffer=function(e,t,r){void 0===t&&(t=!1),this._currentRenderTarget=null,r&&(e._MSAAFramebuffer&&(this._currentFramebuffer=e._framebuffer),r()),this._currentFramebuffer=null},t.prototype.createDynamicVertexBuffer=function(e){return{capacity:1,references:1,is32Bits:!1}},t.prototype.updateDynamicTexture=function(e,t,r,i,n){void 0===i&&(i=!1)},t.prototype.areAllEffectsReady=function(){return!0},t.prototype.getError=function(){return 0},t.prototype._getUnpackAlignement=function(){return 1},t.prototype._unpackFlipY=function(e){},t.prototype.updateDynamicIndexBuffer=function(e,t,r){void 0===r&&(r=0)},t.prototype.updateDynamicVertexBuffer=function(e,t,r,i){},t.prototype._bindTextureDirectly=function(e,t){return this._boundTexturesCache[this._activeChannel]!==t&&(this._boundTexturesCache[this._activeChannel]=t,!0)},t.prototype._bindTexture=function(e,t){e<0||this._bindTextureDirectly(0,t)},t.prototype._releaseBuffer=function(e){return e.references--,0===e.references},t.prototype.releaseEffects=function(){},t.prototype.displayLoadingUI=function(){},t.prototype.hideLoadingUI=function(){},t.prototype._uploadCompressedDataToTextureDirectly=function(e,t,r,i,n,o,s){void 0===o&&(o=0),void 0===s&&(s=0)},t.prototype._uploadDataToTextureDirectly=function(e,t,r,i){void 0===r&&(r=0),void 0===i&&(i=0)},t.prototype._uploadArrayBufferViewToTexture=function(e,t,r,i){void 0===r&&(r=0),void 0===i&&(i=0)},t.prototype._uploadImageToTexture=function(e,t,r,i){void 0===r&&(r=0),void 0===i&&(i=0)},t}(n.Engine),c=r(23),d=r(191),p=function(){return function(){this.occlusionInternalRetryCounter=0,this.isOcclusionQueryInProgress=!1,this.isOccluded=!1,this.occlusionRetryCount=-1,this.occlusionType=c.a.OCCLUSION_TYPE_NONE,this.occlusionQueryAlgorithmType=c.a.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE}}();n.Engine.prototype.createQuery=function(){return this._gl.createQuery()},n.Engine.prototype.deleteQuery=function(e){return this._gl.deleteQuery(e),this},n.Engine.prototype.isQueryResultAvailable=function(e){return this._gl.getQueryParameter(e,this._gl.QUERY_RESULT_AVAILABLE)},n.Engine.prototype.getQueryResult=function(e){return this._gl.getQueryParameter(e,this._gl.QUERY_RESULT)},n.Engine.prototype.beginOcclusionQuery=function(e,t){var r=this._getGlAlgorithmType(e);return this._gl.beginQuery(r,t),this},n.Engine.prototype.endOcclusionQuery=function(e){var t=this._getGlAlgorithmType(e);return this._gl.endQuery(t),this},n.Engine.prototype._createTimeQuery=function(){var e=this.getCaps().timerQuery;return e.createQueryEXT?e.createQueryEXT():this.createQuery()},n.Engine.prototype._deleteTimeQuery=function(e){var t=this.getCaps().timerQuery;t.deleteQueryEXT?t.deleteQueryEXT(e):this.deleteQuery(e)},n.Engine.prototype._getTimeQueryResult=function(e){var t=this.getCaps().timerQuery;return t.getQueryObjectEXT?t.getQueryObjectEXT(e,t.QUERY_RESULT_EXT):this.getQueryResult(e)},n.Engine.prototype._getTimeQueryAvailability=function(e){var t=this.getCaps().timerQuery;return t.getQueryObjectEXT?t.getQueryObjectEXT(e,t.QUERY_RESULT_AVAILABLE_EXT):this.isQueryResultAvailable(e)},n.Engine.prototype.startTimeQuery=function(){var e=this.getCaps(),t=e.timerQuery;if(!t)return null;var r=new d.a;if(this._gl.getParameter(t.GPU_DISJOINT_EXT),e.canUseTimestampForTimerQuery)r._startTimeQuery=this._createTimeQuery(),t.queryCounterEXT(r._startTimeQuery,t.TIMESTAMP_EXT);else{if(this._currentNonTimestampToken)return this._currentNonTimestampToken;r._timeElapsedQuery=this._createTimeQuery(),t.beginQueryEXT?t.beginQueryEXT(t.TIME_ELAPSED_EXT,r._timeElapsedQuery):this._gl.beginQuery(t.TIME_ELAPSED_EXT,r._timeElapsedQuery),this._currentNonTimestampToken=r}return r},n.Engine.prototype.endTimeQuery=function(e){var t=this.getCaps(),r=t.timerQuery;if(!r||!e)return-1;if(t.canUseTimestampForTimerQuery){if(!e._startTimeQuery)return-1;e._endTimeQuery||(e._endTimeQuery=this._createTimeQuery(),r.queryCounterEXT(e._endTimeQuery,r.TIMESTAMP_EXT))}else if(!e._timeElapsedQueryEnded){if(!e._timeElapsedQuery)return-1;r.endQueryEXT?r.endQueryEXT(r.TIME_ELAPSED_EXT):this._gl.endQuery(r.TIME_ELAPSED_EXT),e._timeElapsedQueryEnded=!0}var i=this._gl.getParameter(r.GPU_DISJOINT_EXT),n=!1;if(e._endTimeQuery?n=this._getTimeQueryAvailability(e._endTimeQuery):e._timeElapsedQuery&&(n=this._getTimeQueryAvailability(e._timeElapsedQuery)),n&&!i){var o=0;if(t.canUseTimestampForTimerQuery){if(!e._startTimeQuery||!e._endTimeQuery)return-1;var s=this._getTimeQueryResult(e._startTimeQuery);o=this._getTimeQueryResult(e._endTimeQuery)-s,this._deleteTimeQuery(e._startTimeQuery),this._deleteTimeQuery(e._endTimeQuery),e._startTimeQuery=null,e._endTimeQuery=null}else{if(!e._timeElapsedQuery)return-1;o=this._getTimeQueryResult(e._timeElapsedQuery),this._deleteTimeQuery(e._timeElapsedQuery),e._timeElapsedQuery=null,e._timeElapsedQueryEnded=!1,this._currentNonTimestampToken=null}return o}return-1},n.Engine.prototype._getGlAlgorithmType=function(e){return e===c.a.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE?this._gl.ANY_SAMPLES_PASSED_CONSERVATIVE:this._gl.ANY_SAMPLES_PASSED},Object.defineProperty(c.a.prototype,"isOcclusionQueryInProgress",{get:function(){return this._occlusionDataStorage.isOcclusionQueryInProgress},enumerable:!1,configurable:!0}),Object.defineProperty(c.a.prototype,"_occlusionDataStorage",{get:function(){return this.__occlusionDataStorage||(this.__occlusionDataStorage=new p),this.__occlusionDataStorage},enumerable:!1,configurable:!0}),Object.defineProperty(c.a.prototype,"isOccluded",{get:function(){return this._occlusionDataStorage.isOccluded},set:function(e){this._occlusionDataStorage.isOccluded=e},enumerable:!0,configurable:!0}),Object.defineProperty(c.a.prototype,"occlusionQueryAlgorithmType",{get:function(){return this._occlusionDataStorage.occlusionQueryAlgorithmType},set:function(e){this._occlusionDataStorage.occlusionQueryAlgorithmType=e},enumerable:!0,configurable:!0}),Object.defineProperty(c.a.prototype,"occlusionType",{get:function(){return this._occlusionDataStorage.occlusionType},set:function(e){this._occlusionDataStorage.occlusionType=e},enumerable:!0,configurable:!0}),Object.defineProperty(c.a.prototype,"occlusionRetryCount",{get:function(){return this._occlusionDataStorage.occlusionRetryCount},set:function(e){this._occlusionDataStorage.occlusionRetryCount=e},enumerable:!0,configurable:!0}),c.a.prototype._checkOcclusionQuery=function(){var e=this._occlusionDataStorage;if(e.occlusionType===c.a.OCCLUSION_TYPE_NONE)return e.isOccluded=!1,!1;var t=this.getEngine();if(t.webGLVersion<2)return e.isOccluded=!1,!1;if(!t.isQueryResultAvailable)return e.isOccluded=!1,!1;if(this.isOcclusionQueryInProgress&&this._occlusionQuery)if(t.isQueryResultAvailable(this._occlusionQuery)){var r=t.getQueryResult(this._occlusionQuery);e.isOcclusionQueryInProgress=!1,e.occlusionInternalRetryCounter=0,e.isOccluded=1!==r}else{if(e.occlusionInternalRetryCounter++,!(-1!==e.occlusionRetryCount&&e.occlusionInternalRetryCounter>e.occlusionRetryCount))return!1;e.isOcclusionQueryInProgress=!1,e.occlusionInternalRetryCounter=0,e.isOccluded=e.occlusionType!==c.a.OCCLUSION_TYPE_OPTIMISTIC&&e.isOccluded}var i=this.getScene();if(i.getBoundingBoxRenderer){var n=i.getBoundingBoxRenderer();this._occlusionQuery||(this._occlusionQuery=t.createQuery()),t.beginOcclusionQuery(e.occlusionQueryAlgorithmType,this._occlusionQuery),n.renderOcclusionBoundingBox(this),t.endOcclusionQuery(e.occlusionQueryAlgorithmType),this._occlusionDataStorage.isOcclusionQueryInProgress=!0}return e.isOccluded};n.Engine.prototype.createTransformFeedback=function(){return this._gl.createTransformFeedback()},n.Engine.prototype.deleteTransformFeedback=function(e){this._gl.deleteTransformFeedback(e)},n.Engine.prototype.bindTransformFeedback=function(e){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,e)},n.Engine.prototype.beginTransformFeedback=function(e){void 0===e&&(e=!0),this._gl.beginTransformFeedback(e?this._gl.POINTS:this._gl.TRIANGLES)},n.Engine.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},n.Engine.prototype.setTranformFeedbackVaryings=function(e,t){this._gl.transformFeedbackVaryings(e,t,this._gl.INTERLEAVED_ATTRIBS)},n.Engine.prototype.bindTransformFeedbackBuffer=function(e){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,e)},r.d(t,"a",function(){return i.a}),r.d(t,"f",function(){return n.InstancingAttributeInfo}),r.d(t,"b",function(){return n.DepthTextureCreationOptions}),r.d(t,"d",function(){return n.EngineCapabilities}),r.d(t,"c",function(){return n.Engine}),r.d(t,"e",function(){return o.a}),r.d(t,"h",function(){return _}),r.d(t,"g",function(){return l}),r.d(t,"i",function(){return p}),r.d(t,"j",function(){return!0})},254:function(e,t,r){"use strict";var i=r(1),n=r(7),o=r(70),s=r(0),a=r(10),h=r(58),u=r(6),_=r(192),l=r(83),c=r(100),d=r(4),p=function(){function e(t,r){var o=this;this._errorHandler=function(e,t){o.onErrorObservable.notifyObservers({message:e,exception:t})},this._options=i.a({},e._getDefaultOptions(),t),this._scene=r,this.onErrorObservable=new n.c,this._setupBackground(),this._setupImageProcessing()}return e._getDefaultOptions=function(){return{createGround:!0,groundSize:15,groundTexture:this._groundTextureCDNUrl,groundColor:new s.Color3(.2,.2,.3).toLinearSpace().scale(3),groundOpacity:.9,enableGroundShadow:!0,groundShadowLevel:.5,enableGroundMirror:!1,groundMirrorSizeRatio:.3,groundMirrorBlurKernel:64,groundMirrorAmount:1,groundMirrorFresnelWeight:1,groundMirrorFallOffDistance:0,groundMirrorTextureType:d.a.TEXTURETYPE_UNSIGNED_INT,groundYBias:1e-5,createSkybox:!0,skyboxSize:20,skyboxTexture:this._skyboxTextureCDNUrl,skyboxColor:new s.Color3(.2,.2,.3).toLinearSpace().scale(3),backgroundYRotation:0,sizeAuto:!0,rootPosition:s.Vector3.Zero(),setupImageProcessing:!0,environmentTexture:this._environmentTextureCDNUrl,cameraExposure:.8,cameraContrast:1.2,toneMappingEnabled:!0}},Object.defineProperty(e.prototype,"rootMesh",{get:function(){return this._rootMesh},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"skybox",{get:function(){return this._skybox},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"skyboxTexture",{get:function(){return this._skyboxTexture},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"skyboxMaterial",{get:function(){return this._skyboxMaterial},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ground",{get:function(){return this._ground},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"groundTexture",{get:function(){return this._groundTexture},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"groundMirror",{get:function(){return this._groundMirror},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"groundMirrorRenderList",{get:function(){return this._groundMirror?this._groundMirror.renderList:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"groundMaterial",{get:function(){return this._groundMaterial},enumerable:!0,configurable:!0}),e.prototype.updateOptions=function(e){var t=i.a({},this._options,e);this._ground&&!t.createGround&&(this._ground.dispose(),this._ground=null),this._groundMaterial&&!t.createGround&&(this._groundMaterial.dispose(),this._groundMaterial=null),this._groundTexture&&this._options.groundTexture!=t.groundTexture&&(this._groundTexture.dispose(),this._groundTexture=null),this._skybox&&!t.createSkybox&&(this._skybox.dispose(),this._skybox=null),this._skyboxMaterial&&!t.createSkybox&&(this._skyboxMaterial.dispose(),this._skyboxMaterial=null),this._skyboxTexture&&this._options.skyboxTexture!=t.skyboxTexture&&(this._skyboxTexture.dispose(),this._skyboxTexture=null),this._groundMirror&&!t.enableGroundMirror&&(this._groundMirror.dispose(),this._groundMirror=null),this._scene.environmentTexture&&this._options.environmentTexture!=t.environmentTexture&&this._scene.environmentTexture.dispose(),this._options=t,this._setupBackground(),this._setupImageProcessing()},e.prototype.setMainColor=function(e){this.groundMaterial&&(this.groundMaterial.primaryColor=e),this.skyboxMaterial&&(this.skyboxMaterial.primaryColor=e),this.groundMirror&&(this.groundMirror.clearColor=new s.Color4(e.r,e.g,e.b,1))},e.prototype._setupImageProcessing=function(){this._options.setupImageProcessing&&(this._scene.imageProcessingConfiguration.contrast=this._options.cameraContrast,this._scene.imageProcessingConfiguration.exposure=this._options.cameraExposure,this._scene.imageProcessingConfiguration.toneMappingEnabled=this._options.toneMappingEnabled,this._setupEnvironmentTexture())},e.prototype._setupEnvironmentTexture=function(){if(!this._scene.environmentTexture)if(this._options.environmentTexture instanceof h.a)this._scene.environmentTexture=this._options.environmentTexture;else{var e=l.a.CreateFromPrefilteredData(this._options.environmentTexture,this._scene);this._scene.environmentTexture=e}},e.prototype._setupBackground=function(){this._rootMesh||(this._rootMesh=new a.Mesh("BackgroundHelper",this._scene)),this._rootMesh.rotation.y=this._options.backgroundYRotation;var e=this._getSceneSize();this._options.createGround&&(this._setupGround(e),this._setupGroundMaterial(),this._setupGroundDiffuseTexture(),this._options.enableGroundMirror&&this._setupGroundMirrorTexture(e),this._setupMirrorInGroundMaterial()),this._options.createSkybox&&(this._setupSkybox(e),this._setupSkyboxMaterial(),this._setupSkyboxReflectionTexture()),this._rootMesh.position.x=e.rootPosition.x,this._rootMesh.position.z=e.rootPosition.z,this._rootMesh.position.y=e.rootPosition.y},e.prototype._getSceneSize=function(){var e=this,t=this._options.groundSize,r=this._options.skyboxSize,i=this._options.rootPosition;if(!this._scene.meshes||1===this._scene.meshes.length)return{groundSize:t,skyboxSize:r,rootPosition:i};var n=this._scene.getWorldExtends(function(t){return t!==e._ground&&t!==e._rootMesh&&t!==e._skybox}),s=n.max.subtract(n.min);if(this._options.sizeAuto){this._scene.activeCamera instanceof o.ArcRotateCamera&&this._scene.activeCamera.upperRadiusLimit&&(r=t=2*this._scene.activeCamera.upperRadiusLimit);var a=s.length();a>t&&(r=t=2*a),t*=1.1,r*=1.5,(i=n.min.add(s.scale(.5))).y=n.min.y-this._options.groundYBias}return{groundSize:t,skyboxSize:r,rootPosition:i}},e.prototype._setupGround=function(e){var t=this;this._ground&&!this._ground.isDisposed()||(this._ground=a.Mesh.CreatePlane("BackgroundPlane",e.groundSize,this._scene),this._ground.rotation.x=Math.PI/2,this._ground.parent=this._rootMesh,this._ground.onDisposeObservable.add(function(){t._ground=null})),this._ground.receiveShadows=this._options.enableGroundShadow},e.prototype._setupGroundMaterial=function(){this._groundMaterial||(this._groundMaterial=new c.a("BackgroundPlaneMaterial",this._scene)),this._groundMaterial.alpha=this._options.groundOpacity,this._groundMaterial.alphaMode=d.a.ALPHA_PREMULTIPLIED_PORTERDUFF,this._groundMaterial.shadowLevel=this._options.groundShadowLevel,this._groundMaterial.primaryColor=this._options.groundColor,this._groundMaterial.useRGBColor=!1,this._groundMaterial.enableNoise=!0,this._ground&&(this._ground.material=this._groundMaterial)},e.prototype._setupGroundDiffuseTexture=function(){if(this._groundMaterial&&!this._groundTexture)if(this._options.groundTexture instanceof h.a)this._groundMaterial.diffuseTexture=this._options.groundTexture;else{var e=new u.a(this._options.groundTexture,this._scene,void 0,void 0,void 0,void 0,this._errorHandler);e.gammaSpace=!1,e.hasAlpha=!0,this._groundMaterial.diffuseTexture=e}},e.prototype._setupGroundMirrorTexture=function(e){var t=u.a.CLAMP_ADDRESSMODE;if(!this._groundMirror&&(this._groundMirror=new _.a("BackgroundPlaneMirrorTexture",{ratio:this._options.groundMirrorSizeRatio},this._scene,!1,this._options.groundMirrorTextureType,u.a.BILINEAR_SAMPLINGMODE,!0),this._groundMirror.mirrorPlane=new s.Plane(0,-1,0,e.rootPosition.y),this._groundMirror.anisotropicFilteringLevel=1,this._groundMirror.wrapU=t,this._groundMirror.wrapV=t,this._groundMirror.gammaSpace=!1,this._groundMirror.renderList))for(var r=0;r<this._scene.meshes.length;r++){var i=this._scene.meshes[r];i!==this._ground&&i!==this._skybox&&i!==this._rootMesh&&this._groundMirror.renderList.push(i)}this._groundMirror.clearColor=new s.Color4(this._options.groundColor.r,this._options.groundColor.g,this._options.groundColor.b,1),this._groundMirror.adaptiveBlurKernel=this._options.groundMirrorBlurKernel},e.prototype._setupMirrorInGroundMaterial=function(){this._groundMaterial&&(this._groundMaterial.reflectionTexture=this._groundMirror,this._groundMaterial.reflectionFresnel=!0,this._groundMaterial.reflectionAmount=this._options.groundMirrorAmount,this._groundMaterial.reflectionStandardFresnelWeight=this._options.groundMirrorFresnelWeight,this._groundMaterial.reflectionFalloffDistance=this._options.groundMirrorFallOffDistance)},e.prototype._setupSkybox=function(e){var t=this;this._skybox&&!this._skybox.isDisposed()||(this._skybox=a.Mesh.CreateBox("BackgroundSkybox",e.skyboxSize,this._scene,void 0,a.Mesh.BACKSIDE),this._skybox.onDisposeObservable.add(function(){t._skybox=null})),this._skybox.parent=this._rootMesh},e.prototype._setupSkyboxMaterial=function(){this._skybox&&(this._skyboxMaterial||(this._skyboxMaterial=new c.a("BackgroundSkyboxMaterial",this._scene)),this._skyboxMaterial.useRGBColor=!1,this._skyboxMaterial.primaryColor=this._options.skyboxColor,this._skyboxMaterial.enableNoise=!0,this._skybox.material=this._skyboxMaterial)},e.prototype._setupSkyboxReflectionTexture=function(){this._skyboxMaterial&&(this._skyboxTexture||(this._options.skyboxTexture instanceof h.a?this._skyboxMaterial.reflectionTexture=this._options.skyboxTexture:(this._skyboxTexture=new l.a(this._options.skyboxTexture,this._scene,void 0,void 0,void 0,void 0,this._errorHandler),this._skyboxTexture.coordinatesMode=u.a.SKYBOX_MODE,this._skyboxTexture.gammaSpace=!1,this._skyboxMaterial.reflectionTexture=this._skyboxTexture)))},e.prototype.dispose=function(){this._groundMaterial&&this._groundMaterial.dispose(!0,!0),this._skyboxMaterial&&this._skyboxMaterial.dispose(!0,!0),this._rootMesh.dispose(!1)},e._groundTextureCDNUrl="https://assets.babylonjs.com/environments/backgroundGround.png",e._skyboxTextureCDNUrl="https://assets.babylonjs.com/environments/backgroundSkybox.dds",e._environmentTextureCDNUrl="https://assets.babylonjs.com/environments/environmentSpecular.env",e}(),E=r(49),f=(r(28),function(e){function t(t,r,i,o,s){void 0===s&&(s=null);var h=e.call(this,t,o)||this;h._useDirectMapping=!1,h.onLoadErrorObservable=new n.c,t=t||"photoDome",i.resolution=0|Math.abs(i.resolution)||32,i.size=Math.abs(i.size)||(o.activeCamera?.48*o.activeCamera.maxZ:1e3),void 0===i.useDirectMapping?h._useDirectMapping=!0:h._useDirectMapping=i.useDirectMapping,h._setReady(!1);var _=h._material=new c.a(t+"_material",o);return h._mesh=a.Mesh.CreateSphere(t+"_mesh",i.resolution,i.size,o,!1,a.Mesh.BACKSIDE),_.opacityFresnel=!1,_.useEquirectangularFOV=!0,_.fovMultiplier=1,h.photoTexture=new u.a(r,o,!0,!h._useDirectMapping,void 0,void 0,function(e,t){h.onLoadErrorObservable.notifyObservers(e||"Unknown error occured"),s&&s(e,t)}),h.photoTexture.onLoadObservable.addOnce(function(){h._setReady(!0)}),h._mesh.material=_,h._mesh.parent=h,h}return i.d(t,e),Object.defineProperty(t.prototype,"photoTexture",{get:function(){return this._photoTexture},set:function(e){this._photoTexture!==e&&(this._photoTexture=e,this._useDirectMapping?(this._photoTexture.wrapU=u.a.CLAMP_ADDRESSMODE,this._photoTexture.wrapV=u.a.CLAMP_ADDRESSMODE,this._material.diffuseTexture=this._photoTexture):(this._photoTexture.coordinatesMode=u.a.FIXED_EQUIRECTANGULAR_MIRRORED_MODE,this._photoTexture.wrapV=u.a.CLAMP_ADDRESSMODE,this._material.reflectionTexture=this._photoTexture))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fovMultiplier",{get:function(){return this._material.fovMultiplier},set:function(e){this._material.fovMultiplier=e},enumerable:!0,configurable:!0}),t.prototype.dispose=function(t,r){void 0===r&&(r=!1),this._photoTexture.dispose(),this._mesh.dispose(),this._material.dispose(),this.onLoadErrorObservable.clear(),e.prototype.dispose.call(this,t,r)},t}(E.a)),T=r(9),g=r(19),b=r(31),m=r(54),R=r(71),y=r(48),A=r(190),v=r(189),M=r(187),S=r(85),x=r(184);g.Scene.prototype.createDefaultLight=function(e){if(void 0===e&&(e=!1),e&&this.lights)for(var t=0;t<this.lights.length;t++)this.lights[t].dispose();0===this.lights.length&&new R.HemisphericLight("default light",s.Vector3.Up(),this)},g.Scene.prototype.createDefaultCamera=function(e,t,r){if(void 0===e&&(e=!1),void 0===t&&(t=!1),void 0===r&&(r=!1),t&&this.activeCamera&&(this.activeCamera.dispose(),this.activeCamera=null),!this.activeCamera){var i,n=this.getWorldExtends(),a=n.max.subtract(n.min),h=n.min.add(a.scale(.5)),u=1.5*a.length();if(isFinite(u)||(u=1,h.copyFromFloats(0,0,0)),e){var _=new o.ArcRotateCamera("default camera",-Math.PI/2,Math.PI/2,u,h,this);_.lowerRadiusLimit=.01*u,_.wheelPrecision=100/u,i=_}else{var l=new y.a("default camera",new s.Vector3(h.x,h.y,-u),this);l.setTarget(h),i=l}i.minZ=.01*u,i.maxZ=1e3*u,i.speed=.2*u,this.activeCamera=i;var c=this.getEngine().getRenderingCanvas();r&&c&&i.attachControl(c)}},g.Scene.prototype.createDefaultCameraOrLight=function(e,t,r){void 0===e&&(e=!1),void 0===t&&(t=!1),void 0===r&&(r=!1),this.createDefaultLight(t),this.createDefaultCamera(e,t,r)},g.Scene.prototype.createDefaultSkybox=function(e,t,r,i,n){if(void 0===t&&(t=!1),void 0===r&&(r=1e3),void 0===i&&(i=0),void 0===n&&(n=!0),!e)return T.a.Warn("Can not create default skybox without environment texture."),null;n&&e&&(this.environmentTexture=e);var o=a.Mesh.CreateBox("hdrSkyBox",r,this);if(t){var s=new m.a("skyBox",this);s.backFaceCulling=!1,s.reflectionTexture=e.clone(),s.reflectionTexture&&(s.reflectionTexture.coordinatesMode=u.a.SKYBOX_MODE),s.microSurface=1-i,s.disableLighting=!0,s.twoSidedLighting=!0,o.infiniteDistance=!0,o.material=s}else{var h=new b.StandardMaterial("skyBox",this);h.backFaceCulling=!1,h.reflectionTexture=e.clone(),h.reflectionTexture&&(h.reflectionTexture.coordinatesMode=u.a.SKYBOX_MODE),h.disableLighting=!0,o.infiniteDistance=!0,o.material=h}return o.isPickable=!1,o},g.Scene.prototype.createDefaultEnvironment=function(e){return p?new p(e,this):null},g.Scene.prototype.createDefaultVRExperience=function(e){return void 0===e&&(e={}),new x.a(this,e)},g.Scene.prototype.createDefaultXRExperienceAsync=function(){var e=this;return S.a.CreateAsync(this).then(function(t){var r=new A.a(t);return M.a.CreateAsync(e,t,{outputCanvasContext:r.canvasContext}).then(function(e){return new v.b(t),t})})};var O=r(193),P=function(e){function t(t,r,i,n){var o=e.call(this,t,n)||this;o._useDirectMapping=!1,t=t||"videoDome",i.resolution=0|Math.abs(i.resolution)||32,i.clickToPlay=Boolean(i.clickToPlay),i.autoPlay=void 0===i.autoPlay||Boolean(i.autoPlay),i.loop=void 0===i.loop||Boolean(i.loop),i.size=Math.abs(i.size)||(n.activeCamera?.48*n.activeCamera.maxZ:1e3),void 0===i.useDirectMapping?o._useDirectMapping=!0:o._useDirectMapping=i.useDirectMapping,o._setReady(!1);var s={loop:i.loop,autoPlay:i.autoPlay,autoUpdateTexture:!0,poster:i.poster},h=o._material=new c.a(t+"_material",n),_=o._videoTexture=new O.a(t+"_texture",r,n,!1,o._useDirectMapping,u.a.TRILINEAR_SAMPLINGMODE,s);return o._mesh=a.Mesh.CreateSphere(t+"_mesh",i.resolution,i.size,n,!1,a.Mesh.BACKSIDE),_.onLoadObservable.addOnce(function(){o._setReady(!0)}),h.useEquirectangularFOV=!0,h.fovMultiplier=1,h.opacityFresnel=!1,o._useDirectMapping?(_.wrapU=u.a.CLAMP_ADDRESSMODE,_.wrapV=u.a.CLAMP_ADDRESSMODE,h.diffuseTexture=_):(_.coordinatesMode=u.a.FIXED_EQUIRECTANGULAR_MIRRORED_MODE,_.wrapV=u.a.CLAMP_ADDRESSMODE,h.reflectionTexture=_),o._mesh.material=h,o._mesh.parent=o,i.clickToPlay&&(n.onPointerUp=function(){o._videoTexture.video.play()}),o}return i.d(t,e),Object.defineProperty(t.prototype,"videoTexture",{get:function(){return this._videoTexture},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fovMultiplier",{get:function(){return this._material.fovMultiplier},set:function(e){this._material.fovMultiplier=e},enumerable:!0,configurable:!0}),t.prototype.dispose=function(t,r){void 0===r&&(r=!1),this._videoTexture.dispose(),this._mesh.dispose(),this._material.dispose(),e.prototype.dispose.call(this,t,r)},t}(E.a);r.d(t,"a",function(){return p}),r.d(t,"b",function(){return f}),r.d(t,"d",function(){return!0}),r.d(t,"c",function(){return P})},261:function(e,t,r){"use strict";var i=r(5),n=function(){function e(e){this.engine=e,this._captureGPUFrameTime=!1,this._gpuFrameTime=new i.f,this._captureShaderCompilationTime=!1,this._shaderCompilationTime=new i.f,this._onBeginFrameObserver=null,this._onEndFrameObserver=null,this._onBeforeShaderCompilationObserver=null,this._onAfterShaderCompilationObserver=null}return Object.defineProperty(e.prototype,"gpuFrameTimeCounter",{get:function(){return this._gpuFrameTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"captureGPUFrameTime",{get:function(){return this._captureGPUFrameTime},set:function(e){var t=this;e!==this._captureGPUFrameTime&&(this._captureGPUFrameTime=e,e?(this._onBeginFrameObserver=this.engine.onBeginFrameObservable.add(function(){t._gpuFrameTimeToken||(t._gpuFrameTimeToken=t.engine.startTimeQuery())}),this._onEndFrameObserver=this.engine.onEndFrameObservable.add(function(){if(t._gpuFrameTimeToken){var e=t.engine.endTimeQuery(t._gpuFrameTimeToken);e>-1&&(t._gpuFrameTimeToken=null,t._gpuFrameTime.fetchNewFrame(),t._gpuFrameTime.addCount(e,!0))}})):(this.engine.onBeginFrameObservable.remove(this._onBeginFrameObserver),this._onBeginFrameObserver=null,this.engine.onEndFrameObservable.remove(this._onEndFrameObserver),this._onEndFrameObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"shaderCompilationTimeCounter",{get:function(){return this._shaderCompilationTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"captureShaderCompilationTime",{get:function(){return this._captureShaderCompilationTime},set:function(e){var t=this;e!==this._captureShaderCompilationTime&&(this._captureShaderCompilationTime=e,e?(this._onBeforeShaderCompilationObserver=this.engine.onBeforeShaderCompilationObservable.add(function(){t._shaderCompilationTime.fetchNewFrame(),t._shaderCompilationTime.beginMonitoring()}),this._onAfterShaderCompilationObserver=this.engine.onAfterShaderCompilationObservable.add(function(){t._shaderCompilationTime.endMonitoring()})):(this.engine.onBeforeShaderCompilationObservable.remove(this._onBeforeShaderCompilationObserver),this._onBeforeShaderCompilationObserver=null,this.engine.onAfterShaderCompilationObservable.remove(this._onAfterShaderCompilationObserver),this._onAfterShaderCompilationObserver=null))},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this.engine.onBeginFrameObservable.remove(this._onBeginFrameObserver),this._onBeginFrameObserver=null,this.engine.onEndFrameObservable.remove(this._onEndFrameObserver),this._onEndFrameObserver=null,this.engine.onBeforeShaderCompilationObservable.remove(this._onBeforeShaderCompilationObserver),this._onBeforeShaderCompilationObserver=null,this.engine.onAfterShaderCompilationObservable.remove(this._onAfterShaderCompilationObserver),this._onAfterShaderCompilationObserver=null,this.engine=null},e}(),o=function(){function e(e){var t=this;this.scene=e,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new i.f,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new i.f,this._captureFrameTime=!1,this._frameTime=new i.f,this._captureRenderTime=!1,this._renderTime=new i.f,this._captureInterFrameTime=!1,this._interFrameTime=new i.f,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new i.f,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new i.f,this._capturePhysicsTime=!1,this._physicsTime=new i.f,this._captureAnimationsTime=!1,this._animationsTime=new i.f,this._captureCameraRenderTime=!1,this._cameraRenderTime=new i.f,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._onBeforeAnimationsObserver=e.onBeforeAnimationsObservable.add(function(){t._captureActiveMeshesEvaluationTime&&t._activeMeshesEvaluationTime.fetchNewFrame(),t._captureRenderTargetsRenderTime&&t._renderTargetsRenderTime.fetchNewFrame(),t._captureFrameTime&&(i.h.StartPerformanceCounter("Scene rendering"),t._frameTime.beginMonitoring()),t._captureInterFrameTime&&t._interFrameTime.endMonitoring(),t._captureParticlesRenderTime&&t._particlesRenderTime.fetchNewFrame(),t._captureSpritesRenderTime&&t._spritesRenderTime.fetchNewFrame(),t._captureAnimationsTime&&t._animationsTime.beginMonitoring(),t.scene.getEngine()._drawCalls.fetchNewFrame(),t.scene.getEngine()._textureCollisions.fetchNewFrame()}),this._onAfterRenderObserver=e.onAfterRenderObservable.add(function(){t._captureFrameTime&&(i.h.EndPerformanceCounter("Scene rendering"),t._frameTime.endMonitoring()),t._captureRenderTime&&t._renderTime.endMonitoring(!1),t._captureInterFrameTime&&t._interFrameTime.beginMonitoring()})}return Object.defineProperty(e.prototype,"activeMeshesEvaluationTimeCounter",{get:function(){return this._activeMeshesEvaluationTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"captureActiveMeshesEvaluationTime",{get:function(){return this._captureActiveMeshesEvaluationTime},set:function(e){var t=this;e!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=e,e?(this._onBeforeActiveMeshesEvaluationObserver=this.scene.onBeforeActiveMeshesEvaluationObservable.add(function(){i.h.StartPerformanceCounter("Active meshes evaluation"),t._activeMeshesEvaluationTime.beginMonitoring()}),this._onAfterActiveMeshesEvaluationObserver=this.scene.onAfterActiveMeshesEvaluationObservable.add(function(){i.h.EndPerformanceCounter("Active meshes evaluation"),t._activeMeshesEvaluationTime.endMonitoring()})):(this.scene.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.scene.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderTargetsRenderTimeCounter",{get:function(){return this._renderTargetsRenderTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"captureRenderTargetsRenderTime",{get:function(){return this._captureRenderTargetsRenderTime},set:function(e){var t=this;e!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=e,e?(this._onBeforeRenderTargetsRenderObserver=this.scene.onBeforeRenderTargetsRenderObservable.add(function(){i.h.StartPerformanceCounter("Render targets rendering"),t._renderTargetsRenderTime.beginMonitoring()}),this._onAfterRenderTargetsRenderObserver=this.scene.onAfterRenderTargetsRenderObservable.add(function(){i.h.EndPerformanceCounter("Render targets rendering"),t._renderTargetsRenderTime.endMonitoring(!1)})):(this.scene.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.scene.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"particlesRenderTimeCounter",{get:function(){return this._particlesRenderTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"captureParticlesRenderTime",{get:function(){return this._captureParticlesRenderTime},set:function(e){var t=this;e!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=e,e?(this._onBeforeParticlesRenderingObserver=this.scene.onBeforeParticlesRenderingObservable.add(function(){i.h.StartPerformanceCounter("Particles"),t._particlesRenderTime.beginMonitoring()}),this._onAfterParticlesRenderingObserver=this.scene.onAfterParticlesRenderingObservable.add(function(){i.h.EndPerformanceCounter("Particles"),t._particlesRenderTime.endMonitoring(!1)})):(this.scene.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.scene.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"spritesRenderTimeCounter",{get:function(){return this._spritesRenderTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"captureSpritesRenderTime",{get:function(){return this._captureSpritesRenderTime},set:function(e){var t=this;e!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=e,this.scene.spriteManagers&&(e?(this._onBeforeSpritesRenderingObserver=this.scene.onBeforeSpritesRenderingObservable.add(function(){i.h.StartPerformanceCounter("Sprites"),t._spritesRenderTime.beginMonitoring()}),this._onAfterSpritesRenderingObserver=this.scene.onAfterSpritesRenderingObservable.add(function(){i.h.EndPerformanceCounter("Sprites"),t._spritesRenderTime.endMonitoring(!1)})):(this.scene.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.scene.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"physicsTimeCounter",{get:function(){return this._physicsTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"capturePhysicsTime",{get:function(){return this._capturePhysicsTime},set:function(e){var t=this;e!==this._capturePhysicsTime&&this.scene.onBeforePhysicsObservable&&(this._capturePhysicsTime=e,e?(this._onBeforePhysicsObserver=this.scene.onBeforePhysicsObservable.add(function(){i.h.StartPerformanceCounter("Physics"),t._physicsTime.beginMonitoring()}),this._onAfterPhysicsObserver=this.scene.onAfterPhysicsObservable.add(function(){i.h.EndPerformanceCounter("Physics"),t._physicsTime.endMonitoring()})):(this.scene.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.scene.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"animationsTimeCounter",{get:function(){return this._animationsTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"captureAnimationsTime",{get:function(){return this._captureAnimationsTime},set:function(e){var t=this;e!==this._captureAnimationsTime&&(this._captureAnimationsTime=e,e?this._onAfterAnimationsObserver=this.scene.onAfterAnimationsObservable.add(function(){t._animationsTime.endMonitoring()}):(this.scene.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"frameTimeCounter",{get:function(){return this._frameTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"captureFrameTime",{get:function(){return this._captureFrameTime},set:function(e){this._captureFrameTime=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"interFrameTimeCounter",{get:function(){return this._interFrameTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"captureInterFrameTime",{get:function(){return this._captureInterFrameTime},set:function(e){this._captureInterFrameTime=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderTimeCounter",{get:function(){return this._renderTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"captureRenderTime",{get:function(){return this._captureRenderTime},set:function(e){var t=this;e!==this._captureRenderTime&&(this._captureRenderTime=e,e?(this._onBeforeDrawPhaseObserver=this.scene.onBeforeDrawPhaseObservable.add(function(){t._renderTime.beginMonitoring(),i.h.StartPerformanceCounter("Main render")}),this._onAfterDrawPhaseObserver=this.scene.onAfterDrawPhaseObservable.add(function(){t._renderTime.endMonitoring(!1),i.h.EndPerformanceCounter("Main render")})):(this.scene.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.scene.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cameraRenderTimeCounter",{get:function(){return this._cameraRenderTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"captureCameraRenderTime",{get:function(){return this._captureCameraRenderTime},set:function(e){var t=this;e!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=e,e?(this._onBeforeCameraRenderObserver=this.scene.onBeforeCameraRenderObservable.add(function(e){t._cameraRenderTime.beginMonitoring(),i.h.StartPerformanceCounter("Rendering camera "+e.name)}),this._onAfterCameraRenderObserver=this.scene.onAfterCameraRenderObservable.add(function(e){t._cameraRenderTime.endMonitoring(!1),i.h.EndPerformanceCounter("Rendering camera "+e.name)})):(this.scene.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.scene.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"drawCallsCounter",{get:function(){return this.scene.getEngine()._drawCalls},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textureCollisionsCounter",{get:function(){return this.scene.getEngine()._textureCollisions},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this.scene.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.scene.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.scene.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.scene.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.scene.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.scene.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.scene.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.scene.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.scene.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.scene.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.scene.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.scene.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.scene.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.scene.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.scene.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.scene.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.scene.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.scene=null},e}(),s=r(191);r.d(t,"a",function(){return n}),r.d(t,"b",function(){return o}),r.d(t,"c",function(){return s.a})},4:function(e,t,r){"use strict";r.d(t,"a",function(){return i});var i=function(){function e(){}return e.ALPHA_DISABLE=0,e.ALPHA_ADD=1,e.ALPHA_COMBINE=2,e.ALPHA_SUBTRACT=3,e.ALPHA_MULTIPLY=4,e.ALPHA_MAXIMIZED=5,e.ALPHA_ONEONE=6,e.ALPHA_PREMULTIPLIED=7,e.ALPHA_PREMULTIPLIED_PORTERDUFF=8,e.ALPHA_INTERPOLATE=9,e.ALPHA_SCREENMODE=10,e.DELAYLOADSTATE_NONE=0,e.DELAYLOADSTATE_LOADED=1,e.DELAYLOADSTATE_LOADING=2,e.DELAYLOADSTATE_NOTLOADED=4,e.NEVER=512,e.ALWAYS=519,e.LESS=513,e.EQUAL=514,e.LEQUAL=515,e.GREATER=516,e.GEQUAL=518,e.NOTEQUAL=517,e.KEEP=7680,e.REPLACE=7681,e.INCR=7682,e.DECR=7683,e.INVERT=5386,e.INCR_WRAP=34055,e.DECR_WRAP=34056,e.TEXTURE_CLAMP_ADDRESSMODE=0,e.TEXTURE_WRAP_ADDRESSMODE=1,e.TEXTURE_MIRROR_ADDRESSMODE=2,e.TEXTUREFORMAT_ALPHA=0,e.TEXTUREFORMAT_LUMINANCE=1,e.TEXTUREFORMAT_LUMINANCE_ALPHA=2,e.TEXTUREFORMAT_RGB=4,e.TEXTUREFORMAT_RGBA=5,e.TEXTUREFORMAT_RED=6,e.TEXTUREFORMAT_R=6,e.TEXTUREFORMAT_RG=7,e.TEXTUREFORMAT_RED_INTEGER=8,e.TEXTUREFORMAT_R_INTEGER=8,e.TEXTUREFORMAT_RG_INTEGER=9,e.TEXTUREFORMAT_RGB_INTEGER=10,e.TEXTUREFORMAT_RGBA_INTEGER=11,e.TEXTURETYPE_UNSIGNED_BYTE=0,e.TEXTURETYPE_UNSIGNED_INT=0,e.TEXTURETYPE_FLOAT=1,e.TEXTURETYPE_HALF_FLOAT=2,e.TEXTURETYPE_BYTE=3,e.TEXTURETYPE_SHORT=4,e.TEXTURETYPE_UNSIGNED_SHORT=5,e.TEXTURETYPE_INT=6,e.TEXTURETYPE_UNSIGNED_INTEGER=7,e.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,e.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,e.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,e.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,e.TEXTURETYPE_UNSIGNED_INT_24_8=12,e.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,e.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,e.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,e.TEXTURE_NEAREST_SAMPLINGMODE=1,e.TEXTURE_BILINEAR_SAMPLINGMODE=2,e.TEXTURE_TRILINEAR_SAMPLINGMODE=3,e.TEXTURE_NEAREST_NEAREST_MIPLINEAR=1,e.TEXTURE_LINEAR_LINEAR_MIPNEAREST=2,e.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,e.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,e.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,e.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,e.TEXTURE_NEAREST_LINEAR=7,e.TEXTURE_NEAREST_NEAREST=8,e.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,e.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,e.TEXTURE_LINEAR_LINEAR=11,e.TEXTURE_LINEAR_NEAREST=12,e.TEXTURE_EXPLICIT_MODE=0,e.TEXTURE_SPHERICAL_MODE=1,e.TEXTURE_PLANAR_MODE=2,e.TEXTURE_CUBIC_MODE=3,e.TEXTURE_PROJECTION_MODE=4,e.TEXTURE_SKYBOX_MODE=5,e.TEXTURE_INVCUBIC_MODE=6,e.TEXTURE_EQUIRECTANGULAR_MODE=7,e.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,e.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,e.SCALEMODE_FLOOR=1,e.SCALEMODE_NEAREST=2,e.SCALEMODE_CEILING=3,e.MATERIAL_TextureDirtyFlag=1,e.MATERIAL_LightDirtyFlag=2,e.MATERIAL_FresnelDirtyFlag=4,e.MATERIAL_AttributesDirtyFlag=8,e.MATERIAL_MiscDirtyFlag=16,e.MATERIAL_AllDirtyFlag=31,e.MATERIAL_TriangleFillMode=0,e.MATERIAL_WireFrameFillMode=1,e.MATERIAL_PointFillMode=2,e.MATERIAL_PointListDrawMode=3,e.MATERIAL_LineListDrawMode=4,e.MATERIAL_LineLoopDrawMode=5,e.MATERIAL_LineStripDrawMode=6,e.MATERIAL_TriangleStripDrawMode=7,e.MATERIAL_TriangleFanDrawMode=8,e.MATERIAL_ClockWiseSideOrientation=0,e.MATERIAL_CounterClockWiseSideOrientation=1,e.ACTION_NothingTrigger=0,e.ACTION_OnPickTrigger=1,e.ACTION_OnLeftPickTrigger=2,e.ACTION_OnRightPickTrigger=3,e.ACTION_OnCenterPickTrigger=4,e.ACTION_OnPickDownTrigger=5,e.ACTION_OnDoublePickTrigger=6,e.ACTION_OnPickUpTrigger=7,e.ACTION_OnPickOutTrigger=16,e.ACTION_OnLongPressTrigger=8,e.ACTION_OnPointerOverTrigger=9,e.ACTION_OnPointerOutTrigger=10,e.ACTION_OnEveryFrameTrigger=11,e.ACTION_OnIntersectionEnterTrigger=12,e.ACTION_OnIntersectionExitTrigger=13,e.ACTION_OnKeyDownTrigger=14,e.ACTION_OnKeyUpTrigger=15,e.PARTICLES_BILLBOARDMODE_Y=2,e.PARTICLES_BILLBOARDMODE_ALL=7,e.PARTICLES_BILLBOARDMODE_STRETCHED=8,e.PARTICLES_BaseAssetsUrl="https://assets.babylonjs.com/particles",e.MESHES_CULLINGSTRATEGY_STANDARD=0,e.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,e.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,e.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,e.SCENELOADER_NO_LOGGING=0,e.SCENELOADER_MINIMAL_LOGGING=1,e.SCENELOADER_SUMMARY_LOGGING=2,e.SCENELOADER_DETAILED_LOGGING=3,e}()},42:function(e,t,r){"use strict";r.d(t,"c",function(){return i}),r.d(t,"b",function(){return _}),r.d(t,"a",function(){return l});var i,n=r(1),o=r(7),s=r(0),a=r(35),h=r(21),u=r(52);!function(e){e[e.VIVE=0]="VIVE",e[e.OCULUS=1]="OCULUS",e[e.WINDOWS=2]="WINDOWS",e[e.GEAR_VR=3]="GEAR_VR",e[e.DAYDREAM=4]="DAYDREAM",e[e.GENERIC=5]="GENERIC"}(i||(i={}));var _=function(){function e(){}return e.InitiateController=function(e){for(var t=0,r=this._ControllerFactories;t<r.length;t++){var i=r[t];if(i.canCreate(e))return i.create(e)}if(this._DefaultControllerFactory)return this._DefaultControllerFactory(e);throw"The type of gamepad you are trying to load needs to be imported first or is not supported."},e._ControllerFactories=[],e._DefaultControllerFactory=null,e}(),l=function(e){function t(t){var r=e.call(this,t.id,t.index,t)||this;return r._deviceRoomPosition=s.Vector3.Zero(),r._deviceRoomRotationQuaternion=new s.Quaternion,r.devicePosition=s.Vector3.Zero(),r.deviceRotationQuaternion=new s.Quaternion,r.deviceScaleFactor=1,r._trackPosition=!0,r._maxRotationDistFromHeadset=Math.PI/5,r._draggedRoomRotation=0,r._leftHandSystemQuaternion=new s.Quaternion,r._deviceToWorld=s.Matrix.Identity(),r._pointingPoseNode=null,r._workingMatrix=s.Matrix.Identity(),r._meshAttachedObservable=new o.c,r.type=u.a.POSE_ENABLED,r.controllerType=i.GENERIC,r.position=s.Vector3.Zero(),r.rotationQuaternion=new s.Quaternion,r._calculatedPosition=s.Vector3.Zero(),r._calculatedRotation=new s.Quaternion,s.Quaternion.RotationYawPitchRollToRef(Math.PI,0,0,r._leftHandSystemQuaternion),r}return n.d(t,e),t.prototype._disableTrackPosition=function(e){this._trackPosition&&(this._calculatedPosition.copyFrom(e),this._trackPosition=!1)},t.prototype.update=function(){e.prototype.update.call(this),this._updatePoseAndMesh()},t.prototype._updatePoseAndMesh=function(){var e=this.browserGamepad.pose;if((this.updateFromDevice(e),!this._trackPosition&&h.a.LastCreatedScene&&h.a.LastCreatedScene.activeCamera&&h.a.LastCreatedScene.activeCamera.devicePosition)&&((t=h.a.LastCreatedScene.activeCamera)._computeDevicePosition(),this._deviceToWorld.setTranslation(t.devicePosition),t.deviceRotationQuaternion)){var t;(t=t)._deviceRoomRotationQuaternion.toEulerAnglesToRef(s.Tmp.Vector3[0]);var r=Math.atan2(Math.sin(s.Tmp.Vector3[0].y-this._draggedRoomRotation),Math.cos(s.Tmp.Vector3[0].y-this._draggedRoomRotation));if(Math.abs(r)>this._maxRotationDistFromHeadset){var i=r-(r<0?-this._maxRotationDistFromHeadset:this._maxRotationDistFromHeadset);this._draggedRoomRotation+=i;var n=Math.sin(-i),o=Math.cos(-i);this._calculatedPosition.x=this._calculatedPosition.x*o-this._calculatedPosition.z*n,this._calculatedPosition.z=this._calculatedPosition.x*n+this._calculatedPosition.z*o}}s.Vector3.TransformCoordinatesToRef(this._calculatedPosition,this._deviceToWorld,this.devicePosition),this._deviceToWorld.getRotationMatrixToRef(this._workingMatrix),s.Quaternion.FromRotationMatrixToRef(this._workingMatrix,this.deviceRotationQuaternion),this.deviceRotationQuaternion.multiplyInPlace(this._calculatedRotation),this._mesh&&(this._mesh.position.copyFrom(this.devicePosition),this._mesh.rotationQuaternion&&this._mesh.rotationQuaternion.copyFrom(this.deviceRotationQuaternion))},t.prototype.updateFromDevice=function(e){if(e){this.rawPose=e,e.position&&(this._deviceRoomPosition.copyFromFloats(e.position[0],e.position[1],-e.position[2]),this._mesh&&this._mesh.getScene().useRightHandedSystem&&(this._deviceRoomPosition.z*=-1),this._trackPosition&&this._deviceRoomPosition.scaleToRef(this.deviceScaleFactor,this._calculatedPosition),this._calculatedPosition.addInPlace(this.position));var t=this.rawPose;e.orientation&&t.orientation&&(this._deviceRoomRotationQuaternion.copyFromFloats(t.orientation[0],t.orientation[1],-t.orientation[2],-t.orientation[3]),this._mesh&&(this._mesh.getScene().useRightHandedSystem?(this._deviceRoomRotationQuaternion.z*=-1,this._deviceRoomRotationQuaternion.w*=-1):this._deviceRoomRotationQuaternion.multiplyToRef(this._leftHandSystemQuaternion,this._deviceRoomRotationQuaternion)),this._deviceRoomRotationQuaternion.multiplyToRef(this.rotationQuaternion,this._calculatedRotation))}},t.prototype.attachToMesh=function(e){if(this._mesh&&(this._mesh.parent=null),this._mesh=e,this._poseControlledCamera&&(this._mesh.parent=this._poseControlledCamera),this._mesh.rotationQuaternion||(this._mesh.rotationQuaternion=new s.Quaternion),this._updatePoseAndMesh(),this._pointingPoseNode){for(var t=[],r=this._pointingPoseNode;r.parent;)t.push(r.parent),r=r.parent;t.reverse().forEach(function(e){e.computeWorldMatrix(!0)})}this._meshAttachedObservable.notifyObservers(e)},t.prototype.attachToPoseControlledCamera=function(e){this._poseControlledCamera=e,this._mesh&&(this._mesh.parent=this._poseControlledCamera)},t.prototype.dispose=function(){this._mesh&&this._mesh.dispose(),this._mesh=null,e.prototype.dispose.call(this)},Object.defineProperty(t.prototype,"mesh",{get:function(){return this._mesh},enumerable:!0,configurable:!0}),t.prototype.getForwardRay=function(e){if(void 0===e&&(e=100),!this.mesh)return new a.a(s.Vector3.Zero(),new s.Vector3(0,0,1),e);var t=this._pointingPoseNode?this._pointingPoseNode.getWorldMatrix():this.mesh.getWorldMatrix(),r=t.getTranslation(),i=new s.Vector3(0,0,-1),n=s.Vector3.TransformNormal(i,t),o=s.Vector3.Normalize(n);return new a.a(r,o,e)},t.POINTING_POSE="POINTING_POSE",t}(u.a)},52:function(e,t,r){"use strict";r.d(t,"c",function(){return o}),r.d(t,"a",function(){return s}),r.d(t,"b",function(){return a});var i=r(1),n=r(7),o=function(){return function(e,t){this.x=e,this.y=t}}(),s=function(){function e(t,r,i,n,o,s,a){void 0===n&&(n=0),void 0===o&&(o=1),void 0===s&&(s=2),void 0===a&&(a=3),this.id=t,this.index=r,this.browserGamepad=i,this._leftStick={x:0,y:0},this._rightStick={x:0,y:0},this._isConnected=!0,this._invertLeftStickY=!1,this.type=e.GAMEPAD,this._leftStickAxisX=n,this._leftStickAxisY=o,this._rightStickAxisX=s,this._rightStickAxisY=a,this.browserGamepad.axes.length>=2&&(this._leftStick={x:this.browserGamepad.axes[this._leftStickAxisX],y:this.browserGamepad.axes[this._leftStickAxisY]}),this.browserGamepad.axes.length>=4&&(this._rightStick={x:this.browserGamepad.axes[this._rightStickAxisX],y:this.browserGamepad.axes[this._rightStickAxisY]})}return Object.defineProperty(e.prototype,"isConnected",{get:function(){return this._isConnected},enumerable:!0,configurable:!0}),e.prototype.onleftstickchanged=function(e){this._onleftstickchanged=e},e.prototype.onrightstickchanged=function(e){this._onrightstickchanged=e},Object.defineProperty(e.prototype,"leftStick",{get:function(){return this._leftStick},set:function(e){!this._onleftstickchanged||this._leftStick.x===e.x&&this._leftStick.y===e.y||this._onleftstickchanged(e),this._leftStick=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rightStick",{get:function(){return this._rightStick},set:function(e){!this._onrightstickchanged||this._rightStick.x===e.x&&this._rightStick.y===e.y||this._onrightstickchanged(e),this._rightStick=e},enumerable:!0,configurable:!0}),e.prototype.update=function(){this._leftStick&&(this.leftStick={x:this.browserGamepad.axes[this._leftStickAxisX],y:this.browserGamepad.axes[this._leftStickAxisY]},this._invertLeftStickY&&(this.leftStick.y*=-1)),this._rightStick&&(this.rightStick={x:this.browserGamepad.axes[this._rightStickAxisX],y:this.browserGamepad.axes[this._rightStickAxisY]})},e.prototype.dispose=function(){},e.GAMEPAD=0,e.GENERIC=1,e.XBOX=2,e.POSE_ENABLED=3,e}(),a=function(e){function t(t,r,i){var o=e.call(this,t,r,i)||this;return o.onButtonDownObservable=new n.c,o.onButtonUpObservable=new n.c,o.type=s.GENERIC,o._buttons=new Array(i.buttons.length),o}return i.d(t,e),t.prototype.onbuttondown=function(e){this._onbuttondown=e},t.prototype.onbuttonup=function(e){this._onbuttonup=e},t.prototype._setButtonValue=function(e,t,r){return e!==t&&(1===e&&(this._onbuttondown&&this._onbuttondown(r),this.onButtonDownObservable.notifyObservers(r)),0===e&&(this._onbuttonup&&this._onbuttonup(r),this.onButtonUpObservable.notifyObservers(r))),e},t.prototype.update=function(){e.prototype.update.call(this);for(var t=0;t<this._buttons.length;t++)this._buttons[t]=this._setButtonValue(this.browserGamepad.buttons[t].value,this._buttons[t],t)},t.prototype.dispose=function(){e.prototype.dispose.call(this),this.onButtonDownObservable.clear(),this.onButtonUpObservable.clear()},t}(s)},57:function(e,t,r){"use strict";r.d(t,"a",function(){return n}),r.d(t,"b",function(){return o}),r.d(t,"c",function(){return s});var i=r(1),n=function(){function e(){}return e.KEYDOWN=1,e.KEYUP=2,e}(),o=function(){return function(e,t){this.type=e,this.event=t}}(),s=function(e){function t(t,r){var i=e.call(this,t,r)||this;return i.type=t,i.event=r,i.skipOnPointerObservable=!1,i}return i.d(t,e),t}(o)},61:function(e,t,r){"use strict";r.d(t,"a",function(){return o});var i=r(1),n=r(7),o=function(e){function t(t){var r=e.call(this,t)||this;return r.onTriggerStateChangedObservable=new n.c,r.onMainButtonStateChangedObservable=new n.c,r.onSecondaryButtonStateChangedObservable=new n.c,r.onPadStateChangedObservable=new n.c,r.onPadValuesChangedObservable=new n.c,r.pad={x:0,y:0},r._changes={pressChanged:!1,touchChanged:!1,valueChanged:!1,changed:!1},r._buttons=new Array(t.buttons.length),r.hand=t.hand,r}return i.d(t,e),t.prototype.onButtonStateChange=function(e){this._onButtonStateChange=e},Object.defineProperty(t.prototype,"defaultModel",{get:function(){return this._defaultModel},enumerable:!0,configurable:!0}),t.prototype.update=function(){e.prototype.update.call(this);for(var t=0;t<this._buttons.length;t++)this._setButtonValue(this.browserGamepad.buttons[t],this._buttons[t],t);this.leftStick.x===this.pad.x&&this.leftStick.y===this.pad.y||(this.pad.x=this.leftStick.x,this.pad.y=this.leftStick.y,this.onPadValuesChangedObservable.notifyObservers(this.pad))},t.prototype._setButtonValue=function(e,t,r){e||(e={pressed:!1,touched:!1,value:0}),t?(this._checkChanges(e,t),this._changes.changed&&(this._onButtonStateChange&&this._onButtonStateChange(this.index,r,e),this._handleButtonChange(r,e,this._changes)),this._buttons[r].pressed=e.pressed,this._buttons[r].touched=e.touched,this._buttons[r].value=e.value<1e-8?0:e.value):this._buttons[r]={pressed:e.pressed,touched:e.touched,value:e.value}},t.prototype._checkChanges=function(e,t){return this._changes.pressChanged=e.pressed!==t.pressed,this._changes.touchChanged=e.touched!==t.touched,this._changes.valueChanged=e.value!==t.value,this._changes.changed=this._changes.pressChanged||this._changes.touchChanged||this._changes.valueChanged,this._changes},t.prototype.dispose=function(){e.prototype.dispose.call(this),this.onTriggerStateChangedObservable.clear(),this.onMainButtonStateChangedObservable.clear(),this.onSecondaryButtonStateChangedObservable.clear(),this.onPadStateChangedObservable.clear(),this.onPadValuesChangedObservable.clear()},t}(r(42).a)},62:function(e,t,r){"use strict";r.d(t,"a",function(){return s});var i=r(0),n=r(10),o=r(47),s=function(){function e(e){void 0===e&&(e=o.a.DefaultUtilityLayer);var t=this;this.gizmoLayer=e,this.scaleRatio=1,this._tmpMatrix=new i.Matrix,this._customMeshSet=!1,this.updateGizmoRotationToMatchAttachedMesh=!0,this.updateGizmoPositionToMatchAttachedMesh=!0,this._updateScale=!0,this._interactionsEnabled=!0,this._tempVector=new i.Vector3,this._rootMesh=new n.Mesh("gizmoRootNode",e.utilityLayerScene),this._beforeRenderObserver=this.gizmoLayer.utilityLayerScene.onBeforeRenderObservable.add(function(){t._update()}),this.attachedMesh=null}return Object.defineProperty(e.prototype,"attachedMesh",{get:function(){return this._attachedMesh},set:function(e){this._attachedMesh=e,this._rootMesh.setEnabled(!!e),this._attachedMeshChanged(e)},enumerable:!0,configurable:!0}),e.prototype.setCustomMesh=function(e){if(e.getScene()!=this.gizmoLayer.utilityLayerScene)throw"When setting a custom mesh on a gizmo, the custom meshes scene must be the same as the gizmos (eg. gizmo.gizmoLayer.utilityLayerScene)";this._rootMesh.getChildMeshes().forEach(function(e){e.dispose()}),e.parent=this._rootMesh,this._customMeshSet=!0},e.prototype._attachedMeshChanged=function(e){},e.prototype._update=function(){if(this.attachedMesh&&(this.updateGizmoRotationToMatchAttachedMesh?(this._rootMesh.rotationQuaternion||(this._rootMesh.rotationQuaternion=i.Quaternion.RotationYawPitchRoll(this._rootMesh.rotation.y,this._rootMesh.rotation.x,this._rootMesh.rotation.z)),this._tempVector.copyFrom(this.attachedMesh.scaling),this.attachedMesh.scaling.x<0&&(this.attachedMesh.scaling.x*=-1),this.attachedMesh.scaling.y<0&&(this.attachedMesh.scaling.y*=-1),this.attachedMesh.scaling.z<0&&(this.attachedMesh.scaling.z*=-1),this.attachedMesh.computeWorldMatrix().getRotationMatrixToRef(this._tmpMatrix),this.attachedMesh.scaling.copyFrom(this._tempVector),this.attachedMesh.computeWorldMatrix(),i.Quaternion.FromRotationMatrixToRef(this._tmpMatrix,this._rootMesh.rotationQuaternion)):this._rootMesh.rotationQuaternion&&this._rootMesh.rotationQuaternion.set(0,0,0,1),this.updateGizmoPositionToMatchAttachedMesh&&this._rootMesh.position.copyFrom(this.attachedMesh.absolutePosition),this._updateScale&&this.gizmoLayer.utilityLayerScene.activeCamera&&this.attachedMesh)){var e=this.gizmoLayer.utilityLayerScene.activeCamera.globalPosition;this.gizmoLayer.utilityLayerScene.activeCamera.devicePosition&&(e=this.gizmoLayer.utilityLayerScene.activeCamera.devicePosition),this._rootMesh.position.subtractToRef(e,this._tempVector);var t=this._tempVector.length()*this.scaleRatio;this._rootMesh.scaling.set(t,t,t)}},e.prototype.dispose=function(){this._rootMesh.dispose(),this._beforeRenderObserver&&this.gizmoLayer.utilityLayerScene.onBeforeRenderObservable.remove(this._beforeRenderObserver)},e}()},74:function(e,t,r){"use strict";r.d(t,"a",function(){return c});var i=r(1),n=r(7),o=r(0),s=r(49),a=r(28),h=r(64),u=r(62),_=r(47),l=r(31),c=function(e){function t(r,i,s){void 0===i&&(i=o.Color3.Gray()),void 0===s&&(s=_.a.DefaultUtilityLayer);var a=e.call(this,s)||this;a._pointerObserver=null,a.snapDistance=0,a.onSnapObservable=new n.c;var u=new l.StandardMaterial("",s.utilityLayerScene);u.disableLighting=!0,u.emissiveColor=i;var c=new l.StandardMaterial("",s.utilityLayerScene);c.disableLighting=!0,c.emissiveColor=i.add(new o.Color3(.3,.3,.3));var d=t._CreateArrow(s.utilityLayerScene,u);d.lookAt(a._rootMesh.position.add(r)),d.scaling.scaleInPlace(1/3),d.parent=a._rootMesh;var p=0,E=new o.Vector3,f={snapDistance:0};a.dragBehavior=new h.a({dragAxis:r}),a.dragBehavior.moveAttached=!1,a._rootMesh.addBehavior(a.dragBehavior);var T=new o.Vector3,g=new o.Matrix;return a.dragBehavior.onDragObservable.add(function(e){if(a.attachedMesh)if(a.attachedMesh.parent?(a.attachedMesh.parent.computeWorldMatrix().invertToRef(g),g.setTranslationFromFloats(0,0,0),o.Vector3.TransformCoordinatesToRef(e.delta,g,T)):T.copyFrom(e.delta),0==a.snapDistance)a.attachedMesh.position.addInPlace(T);else if(p+=e.dragDistance,Math.abs(p)>a.snapDistance){var t=Math.floor(Math.abs(p)/a.snapDistance);p%=a.snapDistance,T.normalizeToRef(E),E.scaleInPlace(a.snapDistance*t),a.attachedMesh.position.addInPlace(E),f.snapDistance=a.snapDistance*t,a.onSnapObservable.notifyObservers(f)}}),a._pointerObserver=s.utilityLayerScene.onPointerObservable.add(function(e){if(!a._customMeshSet){var t=e.pickInfo&&-1!=a._rootMesh.getChildMeshes().indexOf(e.pickInfo.pickedMesh)?c:u;a._rootMesh.getChildMeshes().forEach(function(e){e.material=t,e.color&&(e.color=t.emissiveColor)})}}),a}return i.d(t,e),t._CreateArrow=function(e,t){var r=new s.a("arrow",e),i=a.MeshBuilder.CreateCylinder("cylinder",{diameterTop:0,height:1.5,diameterBottom:.75,tessellation:96},e),n=a.MeshBuilder.CreateLines("line",{points:[new o.Vector3(0,0,0),new o.Vector3(0,1.1,0)]},e);return n.color=t.emissiveColor,i.parent=r,n.parent=r,i.scaling.scaleInPlace(.05),i.material=t,i.rotation.x=Math.PI/2,i.position.z+=.3,n.scaling.scaleInPlace(.26),n.rotation.x=Math.PI/2,n.material=t,r},t._CreateArrowInstance=function(e,t){for(var r=new s.a("arrow",e),i=0,n=t.getChildMeshes();i<n.length;i++){var o=n[i];o.createInstance(o.name).parent=r}return r},t.prototype._attachedMeshChanged=function(e){this.dragBehavior&&(this.dragBehavior.enabled=!!e)},t.prototype.dispose=function(){this.onSnapObservable.clear(),this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver),this.dragBehavior.detach(),e.prototype.dispose.call(this)},t}(u.a)},75:function(e,t,r){"use strict";r.d(t,"a",function(){return i}),r.d(t,"b",function(){return n});var i=function(){function e(){}return e.COPY=1,e.CUT=2,e.PASTE=3,e}(),n=function(){function e(e,t){this.type=e,this.event=t}return e.GetTypeFromCharacter=function(e){switch(e){case 67:return i.COPY;case 86:return i.PASTE;case 88:return i.CUT;default:return-1}},e}()}}]);